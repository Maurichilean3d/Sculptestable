/*! For license information please see sculptgl.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SculptGL=t():e.SculptGL=t()}(self,()=>(()=>{var __webpack_modules__={46(e,t,r){"use strict";r.d(t,{A:()=>u});var i,s=r(299),a=s.A.KeyAction,n=function(e,t){return void 0===e?t:"false"!==e&&"0"!==e},o=function(e,t,r,i){var s=parseFloat(e);return s||0===s?Math.max(t,Math.min(r,s)):i},l=function(e,t,r,i){var s=parseInt(e,10);return s||0===s?Math.max(t,Math.min(r,s)):i},c=function(e,t,r){if(t){var i=e[t.toUpperCase()];if(void 0!==i)return i}return r},h=function(){if(i)return i;i={};var e=function(){for(var e=window.location.search.substr(1).split("&"),t={},r=0,i=e.length;r<i;r++){var s=e[r].split("=",2);2===s.length&&(t[s[0].toLowerCase()]=s[1])}return t}();return i.language=e.language,i.scalecenter=n(e.scalecenter,!1),i.grid=n(e.grid,!0),i.outline=n(e.outline,!1),i.outlinecolor=function(e,t){if(!e)return t;var r=e.split(",");if(r.length<3)return t;var i=t.slice();return i[0]=parseInt(r[0]||0,10)/255,i[1]=parseInt(r[1]||0,10)/255,i[2]=parseInt(r[2]||0,10)/255,void 0!==r[3]&&(i[3]=parseFloat(r[3])),i}(e.outlinecolor,[.3,0,0,1]),i.mirrorline=n(e.mirrorline,!1),i.darkenunselected=n(e.darkenunselected,!0),i.projection=c(s.A.Projection,e.projection,s.A.Projection.PERSPECTIVE),i.cameramode=c(s.A.CameraMode,e.cameramode,s.A.Projection.ORBIT),i.pivot=n(e.pivot,!0),i.fov=o(e.fov,10,90,45),i.flatshading=n(e.flatshading,!1),i.wireframe=n(e.wireframe,!1),i.curvature=o(e.curvature,0,5,0),i.exposure=o(e.exposure,0,5),i.environment=l(e.environment,0,1/0,0),i.matcap=l(e.matcap,0,1/0,3),i.shader=c(s.A.Shader,e.shader,s.A.Shader.MATCAP),i.filmic=n(e.filmic,!1),i.modelurl=e.modelurl,i.shortcuts=function(e){var t={};if(t["0".charCodeAt(0)]=a.MOVE,t["1".charCodeAt(0)]=a.BRUSH,t["2".charCodeAt(0)]=a.INFLATE,t["3".charCodeAt(0)]=a.TWIST,t["4".charCodeAt(0)]=a.SMOOTH,t["5".charCodeAt(0)]=a.FLATTEN,t["6".charCodeAt(0)]=a.PINCH,t["7".charCodeAt(0)]=a.CREASE,t["8".charCodeAt(0)]=a.DRAG,t["9".charCodeAt(0)]=a.PAINT,t["E".charCodeAt(0)]=a.TRANSFORM,t["C".charCodeAt(0)]=a.INTENSITY,t["X".charCodeAt(0)]=a.RADIUS,t["N".charCodeAt(0)]=a.NEGATIVE,t["S".charCodeAt(0)]=a.PICKER,t[46]=a.DELETE,t["F".charCodeAt(0)]=a.CAMERA_FRONT,t["T".charCodeAt(0)]=a.CAMERA_TOP,t["L".charCodeAt(0)]=a.CAMERA_LEFT,t[32]=a.CAMERA_RESET,t[37]=a.STRIFE_LEFT,t[39]=a.STRIFE_RIGHT,t[38]=a.STRIFE_UP,t[40]=a.STRIFE_DOWN,t["W".charCodeAt(0)]=a.WIREFRAME,t["R".charCodeAt(0)]=a.REMESH,!e)return t;for(var r=e.split(","),i=0,s=r.length;i<s;i++){var n=r[i].split(":",2);if(2===n.length){var o=n[1].toUpperCase(),l=parseInt(o,10);o=l==l&&l>=10?l:o.charCodeAt(0);var c=a[n[0].toUpperCase()];void 0!==c&&(t[o]=c)}}return t}(e.shortcuts),i};h(),h.getShortKey=function(e){return e>=96&&e<=105&&(e-=48),h().shortcuts[e]};const u=h},75(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var gl_matrix__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(152),gl_matrix__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(989),math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(622),misc_Tablet__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(117),misc_Utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(344),gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(352),_TMP_NEAR=[0,0,0],_TMP_NEAR_1=[0,0,0],_TMP_FAR=[0,0,0],_TMP_INV=gl_matrix__WEBPACK_IMPORTED_MODULE_0__.vt(),_TMP_INTER=[0,0,0],_TMP_INTER_1=[0,0,0],_TMP_V1=[0,0,0],_TMP_V2=[0,0,0],_TMP_V3=[0,0,0];class Picking{static addAlpha(e,t,r,i){var s={};s._name=i,s._texture=e,s._ratioX=Math.max(1,t/r),s._ratioY=Math.max(1,r/t),s._ratioMax=Math.max(s._ratioX,s._ratioY),s._width=t,s._height=r;for(var a=1;Picking.ALPHAS[s._name];)s._name=i+a++;return Picking.ALPHAS[s._name]=s,Picking.ALPHAS_NAMES[s._name]=s._name,s}constructor(e,t){this._mesh=null,this._main=e,this._pickedFace=-1,this._pickedVertices=[],this._interPoint=[0,0,0],this._rLocal2=0,this._rWorld2=0,this._eyeDir=[0,0,0],this._xSym=!!t,this._pickedNormal=[0,0,0],this._alphaOrigin=[0,0,0],this._alphaSide=0,this._alphaLookAt=gl_matrix__WEBPACK_IMPORTED_MODULE_0__.vt(),this._alpha=null}setIdAlpha(e){this._alpha=Picking.ALPHAS[e]}getAlpha(e,t,r){var i=this._alpha;if(!i||!i._texture)return 1;var s=this._alphaLookAt,a=this._alphaSide,n=i._ratioY*(s[0]*e+s[4]*t+s[8]*r+s[12])/(this._xSym?-a:a);if(Math.abs(n)>1)return 0;var o=i._ratioX*(s[1]*e+s[5]*t+s[9]*r+s[13])/a;if(Math.abs(o)>1)return 0;var l=i._width;return n=(.5-.5*n)*l,o=(.5-.5*o)*i._height,i._texture[(0|n)+l*(0|o)]/255}updateAlpha(e){var t=_TMP_V1,r=_TMP_V2,i=Math.sqrt(this._rLocal2);if(this._alphaSide=i*Math.SQRT1_2,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.jb(t,this._interPoint,this._alphaOrigin),0!==gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Il(t)){gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(t,t);var s=this._pickedNormal;gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,s,-gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Om(t,s)),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(t,t),e||gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(this._alphaOrigin,this._interPoint),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(r,this._alphaOrigin,s,i),gl_matrix__WEBPACK_IMPORTED_MODULE_0__.t5(this._alphaLookAt,this._alphaOrigin,r,t)}}initAlpha(){this.computePickedNormal(),this.updateAlpha()}getMesh(){return this._mesh}setLocalRadius2(e){this._rLocal2=e}getLocalRadius2(){return this._rLocal2}getLocalRadius(){return Math.sqrt(this._rLocal2)}getWorldRadius2(){return this._rWorld2}getWorldRadius(){return Math.sqrt(this._rWorld2)}setIntersectionPoint(e){this._interPoint=e}getEyeDirection(){return this._eyeDir}getIntersectionPoint(){return this._interPoint}getPickedVertices(){return this._pickedVertices}getPickedFace(){return this._pickedFace}getPickedNormal(){return this._pickedNormal}intersectionMouseMeshes(e=this._main.getMeshes(),t=this._main._mouseX,r=this._main._mouseY){for(var i=this.unproject(t,r,0),s=this.unproject(t,r,.1),a=1/0,n=null,o=-1,l=0,c=e.length;l<c;++l){var h=e[l];if(h.isVisible()&&(gl_matrix__WEBPACK_IMPORTED_MODULE_0__.B8(_TMP_INV,h.getMatrix()),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(_TMP_NEAR_1,i,_TMP_INV),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(_TMP_FAR,s,_TMP_INV),this.intersectionRayMesh(h,_TMP_NEAR_1,_TMP_FAR))){var u=this.getIntersectionPoint(),d=gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(_TMP_NEAR_1,u)*h.getScale();d<a&&(a=d,n=h,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(_TMP_INTER_1,u),o=this.getPickedFace())}}return this._mesh=n,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(this._interPoint,_TMP_INTER_1),this._pickedFace=o,-1!==o&&this.updateLocalAndWorldRadius2(),!!n}intersectionMouseMesh(e=this._main.getMesh(),t=this._main._mouseX,r=this._main._mouseY){var i=this.unproject(t,r,0),s=this.unproject(t,r,.1),a=gl_matrix__WEBPACK_IMPORTED_MODULE_0__.vt();return gl_matrix__WEBPACK_IMPORTED_MODULE_0__.B8(a,e.getMatrix()),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(i,i,a),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(s,s,a),this.intersectionRayMesh(e,i,s)}intersectionRayMesh(e,t,r){if(this._mesh=null,this._pickedFace=-1,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(_TMP_NEAR,t),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(_TMP_FAR,r),this._xSym){var i=e.getSymmetryOrigin(),s=e.getSymmetryNormal();math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.mirrorPoint(_TMP_NEAR,i,s),math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.mirrorPoint(_TMP_FAR,i,s)}var a=e.getVertices(),n=e.getFaces(),o=this.getEyeDirection();gl_matrix__WEBPACK_IMPORTED_MODULE_1__.jb(o,_TMP_FAR,_TMP_NEAR),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(o,o);for(var l=e.intersectRay(_TMP_NEAR,o),c=1/0,h=l.length,u=0;u<h;++u){var d=4*l[u],_=3*n[d],p=3*n[d+1],g=3*n[d+2];_TMP_V1[0]=a[_],_TMP_V1[1]=a[_+1],_TMP_V1[2]=a[_+2],_TMP_V2[0]=a[p],_TMP_V2[1]=a[p+1],_TMP_V2[2]=a[p+2],_TMP_V3[0]=a[g],_TMP_V3[1]=a[g+1],_TMP_V3[2]=a[g+2];var m=math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.intersectionRayTriangle(_TMP_NEAR,o,_TMP_V1,_TMP_V2,_TMP_V3,_TMP_INTER);m<0&&(p=n[d+3])!==misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TRI_INDEX&&(p*=3,_TMP_V2[0]=a[p],_TMP_V2[1]=a[p+1],_TMP_V2[2]=a[p+2],m=math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.intersectionRayTriangle(_TMP_NEAR,o,_TMP_V1,_TMP_V3,_TMP_V2,_TMP_INTER)),m>=0&&m<c&&(c=m,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(this._interPoint,_TMP_INTER),this._pickedFace=l[u])}return-1!==this._pickedFace?(this._mesh=e,this.updateLocalAndWorldRadius2(),!0):(this._rLocal2=0,!1)}pickVerticesInSphere(e){for(var t=this._mesh,r=t.getVertices(),i=t.getVerticesSculptFlags(),s=this.getIntersectionPoint(),a=t.intersectSphere(s,e,!0),n=t.getVerticesFromFaces(a),o=n.length,l=++misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.SCULPT_FLAG,c=new Uint32Array(misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.getMemory(4*o),0,o),h=0,u=s[0],d=s[1],_=s[2],p=0;p<o;++p){var g=n[p],m=3*g,f=u-r[m],v=d-r[m+1],A=_-r[m+2];f*f+v*v+A*A<e&&(i[g]=l,c[h++]=g)}return this._pickedVertices=new Uint32Array(c.subarray(0,h)),this._pickedVertices}_isInsideSphere(e,t,r){if(e===misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TRI_INDEX)return!1;var i=3*e;return gl_matrix__WEBPACK_IMPORTED_MODULE_1__.lo(t,this._mesh.getVertices().subarray(i,i+3))<=r}pickVerticesInSphereTopological(e){var t=this._mesh,r=t.getNbVertices(),i=t.getVertices(),s=t.getFaces(),a=t.getVerticesRingVertStartCount(),n=t.getVerticesRingVert(),o=n instanceof Array?n:null,l=t.getVerticesSculptFlags(),c=t.getVerticesTagFlags(),h=++misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.SCULPT_FLAG,u=++misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TAG_FLAG,d=this.getIntersectionPoint(),_=d[0],p=d[1],g=d[2],m=new Uint32Array(misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.getMemory(4*r),0,r),f=4*this.getPickedFace(),v=1;this._isInsideSphere(s[f],d,e)?m[0]=s[f]:this._isInsideSphere(s[f+1],d,e)?m[0]=s[f+1]:this._isInsideSphere(s[f+2],d,e)?m[0]=s[f+2]:this._isInsideSphere(s[f+3],d,e)?m[0]=s[f+3]:v=0,1===v&&(l[m[0]]=h,c[m[0]]=u);for(var A=0;A<v;++A){var T,b,M=m[A];o?(T=0,b=(n=o[M]).length):b=(T=a[2*M])+a[2*M+1];for(var y=T;y<b;++y){var E=n[y];if(c[E]!==u){c[E]=u;var S=3*E,R=_-i[S],x=p-i[S+1],C=g-i[S+2];R*R+x*x+C*C>e||(l[E]=h,m[v++]=E)}}}return this._pickedVertices=new Uint32Array(m.subarray(0,v)),this._pickedVertices}computeWorldRadius2(e){gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(_TMP_INTER,this.getIntersectionPoint(),this._mesh.getMatrix());var t=this._main.getSculptManager().getCurrentTool().getScreenRadius();e||(t*=misc_Tablet__WEBPACK_IMPORTED_MODULE_3__.A.getPressureRadius());var r=this.project(_TMP_INTER);return gl_matrix__WEBPACK_IMPORTED_MODULE_1__.lo(_TMP_INTER,this.unproject(r[0]+t,r[1],r[2]))}updateLocalAndWorldRadius2(){this._mesh&&(this._rWorld2=this.computeWorldRadius2(),this._rLocal2=this._rWorld2/this._mesh.getScale2())}unproject(e,t,r){return this._main.getCamera().unproject(e,t,r)}project(e){return this._main.getCamera().project(e)}computePickedNormal(){if(this._mesh&&!(this._pickedFace<0))return this.polyLerp(this._mesh.getNormals(),this._pickedNormal),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(this._pickedNormal,this._pickedNormal)}polyLerp(e,t){var r=this._mesh.getVertices(),i=this._mesh.getFaces(),s=4*this._pickedFace,a=3*i[s],n=3*i[s+1],o=3*i[s+2],l=i[s+3],c=l!==misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TRI_INDEX;c&&(l*=3);var h=1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,r.subarray(a,a+3)),u=1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,r.subarray(n,n+3)),d=1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,r.subarray(o,o+3)),_=c?1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,r.subarray(l,l+3)):0,p=1/(h+u+d+_);return gl_matrix__WEBPACK_IMPORTED_MODULE_1__.hZ(t,0,0,0),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(a,a+3),h*p),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(n,n+3),u*p),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(o,o+3),d*p),c&&gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(l,l+3),_*p),t}}Picking.INIT_ALPHAS_NAMES=[(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__.A)("alphaSquare"),(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__.A)("alphaSkin")],Picking.INIT_ALPHAS_PATHS=["square.jpg","skin.jpg"];var readAlphas=function(){if(window.module&&window.module.exports){var fs=eval("require")("fs"),path=eval("require")("path"),directoryPath=path.join(window.__filename,"../resources/alpha");fs.readdir(directoryPath,function(e,t){if(!e)for(var r=0;r<t.length;++r){var i=t[r];"square.jpg"!=i&&"skin.jpg"!=i&&(Picking.INIT_ALPHAS_NAMES.push(i),Picking.INIT_ALPHAS_PATHS.push(i))}})}};readAlphas();var none=(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__.A)("alphaNone");Picking.ALPHAS_NAMES={},Picking.ALPHAS_NAMES[none]=none,Picking.ALPHAS={},Picking.ALPHAS[none]=null;const __WEBPACK_DEFAULT_EXPORT__=Picking},117(e,t,r){"use strict";r.d(t,{A:()=>s});var i={radiusFactor:.75,intensityFactor:0,pressure:.5,getPressureIntensity:function(){return 1+i.intensityFactor*(2*i.pressure-1)},getPressureRadius:function(){return 1+i.radiusFactor*(2*i.pressure-1)}};const s=i},141(e,t,r){var i;!function(s,a,n,o){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],h=a.createElement("div"),u=Math.round,d=Math.abs,_=Date.now;function p(e,t,r){return setTimeout(b(e,r),t)}function g(e,t,r){return!!Array.isArray(e)&&(m(e,r[t],r),!0)}function m(e,t,r){var i;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==o)for(i=0;i<e.length;)t.call(r,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}function f(e,t,r){var i="DEPRECATED METHOD: "+t+"\n"+r+" AT \n";return function(){var t=new Error("get-stack-trace"),r=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=s.console&&(s.console.warn||s.console.log);return a&&a.call(s.console,i,r),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===o||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(i!==o&&null!==i)for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}return t}:Object.assign;var v=f(function(e,t,r){for(var i=Object.keys(t),s=0;s<i.length;)(!r||r&&e[i[s]]===o)&&(e[i[s]]=t[i[s]]),s++;return e},"extend","Use `assign`."),A=f(function(e,t){return v(e,t,!0)},"merge","Use `assign`.");function T(e,t,r){var i,s=t.prototype;(i=e.prototype=Object.create(s)).constructor=e,i._super=s,r&&l(i,r)}function b(e,t){return function(){return e.apply(t,arguments)}}function M(e,t){return"function"==typeof e?e.apply(t&&t[0]||o,t):e}function y(e,t){return e===o?t:e}function E(e,t,r){m(C(t),function(t){e.addEventListener(t,r,!1)})}function S(e,t,r){m(C(t),function(t){e.removeEventListener(t,r,!1)})}function R(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function x(e,t){return e.indexOf(t)>-1}function C(e){return e.trim().split(/\s+/g)}function w(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var i=0;i<e.length;){if(r&&e[i][r]==t||!r&&e[i]===t)return i;i++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function D(e,t,r){for(var i=[],s=[],a=0;a<e.length;){var n=t?e[a][t]:e[a];w(s,n)<0&&i.push(e[a]),s[a]=n,a++}return r&&(i=t?i.sort(function(e,r){return e[t]>r[t]}):i.sort()),i}function k(e,t){for(var r,i,s=t[0].toUpperCase()+t.slice(1),a=0;a<c.length;){if((i=(r=c[a])?r+s:t)in e)return i;a++}return o}var I=1;function F(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||s}var L="ontouchstart"in s,V=k(s,"PointerEvent")!==o,N=L&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),O="touch",B="mouse",U=["x","y"],G=["clientX","clientY"];function W(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){M(e.options.enable,[e])&&r.handler(t)},this.init()}function z(e,t,r){var i=r.pointers.length,s=r.changedPointers.length,a=1&t&&i-s===0,n=12&t&&i-s===0;r.isFirst=!!a,r.isFinal=!!n,a&&(e.session={}),r.eventType=t,function(e,t){var r=e.session,i=t.pointers,s=i.length;r.firstInput||(r.firstInput=X(t)),s>1&&!r.firstMultiple?r.firstMultiple=X(t):1===s&&(r.firstMultiple=!1);var a=r.firstInput,n=r.firstMultiple,l=n?n.center:a.center,c=t.center=j(i);t.timeStamp=_(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=q(l,c),t.distance=H(l,c),function(e,t){var r=t.center,i=e.offsetDelta||{},s=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(s=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},i=e.offsetDelta={x:r.x,y:r.y}),t.deltaX=s.x+(r.x-i.x),t.deltaY=s.y+(r.y-i.y)}(r,t),t.offsetDirection=K(t.deltaX,t.deltaY);var h,u,p=Y(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=d(p.x)>d(p.y)?p.x:p.y,t.scale=n?(h=n.pointers,H((u=i)[0],u[1],G)/H(h[0],h[1],G)):1,t.rotation=n?function(e,t){return q(t[1],t[0],G)+q(e[1],e[0],G)}(n.pointers,i):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,function(e,t){var r,i,s,a,n=e.lastInterval||t,l=t.timeStamp-n.timeStamp;if(8!=t.eventType&&(l>25||n.velocity===o)){var c=t.deltaX-n.deltaX,h=t.deltaY-n.deltaY,u=Y(l,c,h);i=u.x,s=u.y,r=d(u.x)>d(u.y)?u.x:u.y,a=K(c,h),e.lastInterval=t}else r=n.velocity,i=n.velocityX,s=n.velocityY,a=n.direction;t.velocity=r,t.velocityX=i,t.velocityY=s,t.direction=a}(r,t);var g=e.element;R(t.srcEvent.target,g)&&(g=t.srcEvent.target),t.target=g}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function X(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:u(e.pointers[r].clientX),clientY:u(e.pointers[r].clientY)},r++;return{timeStamp:_(),pointers:t,center:j(t),deltaX:e.deltaX,deltaY:e.deltaY}}function j(e){var t=e.length;if(1===t)return{x:u(e[0].clientX),y:u(e[0].clientY)};for(var r=0,i=0,s=0;s<t;)r+=e[s].clientX,i+=e[s].clientY,s++;return{x:u(r/t),y:u(i/t)}}function Y(e,t,r){return{x:t/e||0,y:r/e||0}}function K(e,t){return e===t?1:d(e)>=d(t)?e<0?2:4:t<0?8:16}function H(e,t,r){r||(r=U);var i=t[r[0]]-e[r[0]],s=t[r[1]]-e[r[1]];return Math.sqrt(i*i+s*s)}function q(e,t,r){r||(r=U);var i=t[r[0]]-e[r[0]],s=t[r[1]]-e[r[1]];return 180*Math.atan2(s,i)/Math.PI}W.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(F(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4};function Q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,W.apply(this,arguments)}T(Q,W,{handler:function(e){var t=Z[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:B,srcEvent:e}))}});var J={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},$={2:O,3:"pen",4:B,5:"kinect"},ee="pointerdown",te="pointermove pointerup pointercancel";function re(){this.evEl=ee,this.evWin=te,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}s.MSPointerEvent&&!s.PointerEvent&&(ee="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel"),T(re,W,{handler:function(e){var t=this.store,r=!1,i=e.type.toLowerCase().replace("ms",""),s=J[i],a=$[e.pointerType]||e.pointerType,n=a==O,o=w(t,e.pointerId,"pointerId");1&s&&(0===e.button||n)?o<0&&(t.push(e),o=t.length-1):12&s&&(r=!0),o<0||(t[o]=e,this.callback(this.manager,s,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),r&&t.splice(o,1))}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function se(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,W.apply(this,arguments)}function ae(e,t){var r=P(e.touches),i=P(e.changedTouches);return 12&t&&(r=D(r.concat(i),"identifier",!0)),[r,i]}T(se,W,{handler:function(e){var t=ie[e.type];if(1===t&&(this.started=!0),this.started){var r=ae.call(this,e,t);12&t&&r[0].length-r[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:O,srcEvent:e})}}});var ne={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function oe(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},W.apply(this,arguments)}function le(e,t){var r=P(e.touches),i=this.targetIds;if(3&t&&1===r.length)return i[r[0].identifier]=!0,[r,r];var s,a,n=P(e.changedTouches),o=[],l=this.target;if(a=r.filter(function(e){return R(e.target,l)}),1===t)for(s=0;s<a.length;)i[a[s].identifier]=!0,s++;for(s=0;s<n.length;)i[n[s].identifier]&&o.push(n[s]),12&t&&delete i[n[s].identifier],s++;return o.length?[D(a.concat(o),"identifier",!0),o]:void 0}function ce(){W.apply(this,arguments);var e=b(this.handler,this);this.touch=new oe(this.manager,e),this.mouse=new Q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function he(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ue.call(this,t)):12&e&&ue.call(this,t)}function ue(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var i=this.lastTouches;setTimeout(function(){var e=i.indexOf(r);e>-1&&i.splice(e,1)},2500)}}function de(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var s=this.lastTouches[i],a=Math.abs(t-s.x),n=Math.abs(r-s.y);if(a<=25&&n<=25)return!0}return!1}T(oe,W,{handler:function(e){var t=ne[e.type],r=le.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:O,srcEvent:e})}}),T(ce,W,{handler:function(e,t,r){var i=r.pointerType==O,s=r.pointerType==B;if(!(s&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(i)he.call(this,t,r);else if(s&&de.call(this,r))return;this.callback(e,t,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var _e=k(h.style,"touchAction"),pe=_e!==o,ge="compute",me="auto",fe="manipulation",ve="none",Ae="pan-x",Te="pan-y",be=function(){if(!pe)return!1;var e={},t=s.CSS&&s.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(r){e[r]=!t||s.CSS.supports("touch-action",r)}),e}();function Me(e,t){this.manager=e,this.set(t)}Me.prototype={set:function(e){e==ge&&(e=this.compute()),pe&&this.manager.element.style&&be[e]&&(this.manager.element.style[_e]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return m(this.manager.recognizers,function(t){M(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(x(e,ve))return ve;var t=x(e,Ae),r=x(e,Te);return t&&r?ve:t||r?t?Ae:Te:x(e,fe)?fe:me}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,r=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,s=x(i,ve)&&!be[ve],a=x(i,Te)&&!be[Te],n=x(i,Ae)&&!be[Ae];if(s){var o=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(o&&l&&c)return}if(!n||!a)return s||a&&6&r||n&&24&r?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var ye=32;function Ee(e){this.options=l({},this.defaults,e||{}),this.id=I++,this.manager=null,this.options.enable=y(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Se(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Re(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function xe(e,t){var r=t.manager;return r?r.get(e):e}function Ce(){Ee.apply(this,arguments)}function we(){Ce.apply(this,arguments),this.pX=null,this.pY=null}function Pe(){Ce.apply(this,arguments)}function De(){Ee.apply(this,arguments),this._timer=null,this._input=null}function ke(){Ce.apply(this,arguments)}function Ie(){Ce.apply(this,arguments)}function Fe(){Ee.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Le(e,t){return(t=t||{}).recognizers=y(t.recognizers,Le.defaults.preset),new Ve(e,t)}function Ve(e,t){this.options=l({},Le.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(V?re:N?oe:L?ce:Q))(this,z),this.touchAction=new Me(this,this.options.touchAction),Ne(this,!0),m(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Ne(e,t){var r,i=e.element;i.style&&(m(e.options.cssProps,function(s,a){r=k(i.style,a),t?(e.oldCssProps[r]=i.style[r],i.style[r]=s):i.style[r]=e.oldCssProps[r]||""}),t||(e.oldCssProps={}))}Ee.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(g(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=xe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return g(e,"dropRecognizeWith",this)||(e=xe(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(g(e,"requireFailure",this))return this;var t=this.requireFail;return-1===w(t,e=xe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(g(e,"dropRequireFailure",this))return this;e=xe(e,this);var t=w(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,r=this.state;function i(r){t.manager.emit(r,e)}r<8&&i(t.options.event+Se(r)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),r>=8&&i(t.options.event+Se(r))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=ye},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!M(this.options.enable,[this,t]))return this.reset(),void(this.state=ye);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},T(Ce,Ee,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,r=e.eventType,i=6&t,s=this.attrTest(e);return i&&(8&r||!s)?16|t:i||s?4&r?8|t:2&t?4|t:2:ye}}),T(we,Ce,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Te),24&e&&t.push(Ae),t},directionTest:function(e){var t=this.options,r=!0,i=e.distance,s=e.direction,a=e.deltaX,n=e.deltaY;return s&t.direction||(6&t.direction?(s=0===a?1:a<0?2:4,r=a!=this.pX,i=Math.abs(e.deltaX)):(s=0===n?1:n<0?8:16,r=n!=this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>t.threshold&&s&t.direction},attrTest:function(e){return Ce.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Re(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),T(Pe,Ce,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ve]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),T(De,Ee,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[me]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime>t.time;if(this._input=e,!i||!r||12&e.eventType&&!s)this.reset();else if(1&e.eventType)this.reset(),this._timer=p(function(){this.state=8,this.tryEmit()},t.time,this);else if(4&e.eventType)return 8;return ye},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=_(),this.manager.emit(this.options.event,this._input)))}}),T(ke,Ce,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ve]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),T(Ie,Ce,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return we.prototype.getTouchAction.call(this)},attrTest:function(e){var t,r=this.options.direction;return 30&r?t=e.overallVelocity:6&r?t=e.overallVelocityX:24&r&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&d(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Re(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),T(Fe,Ee,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fe]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(i&&s&&r){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,n=!this.pCenter||H(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,n&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=p(function(){this.state=8,this.tryEmit()},t.interval,this),2):8}return ye},failTimeout:function(){return this._timer=p(function(){this.state=ye},this.options.interval,this),ye},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Le.VERSION="2.0.7",Le.defaults={domEvents:!1,touchAction:ge,enable:!0,inputTarget:null,inputClass:null,preset:[[ke,{enable:!1}],[Pe,{enable:!1},["rotate"]],[Ie,{direction:6}],[we,{direction:6},["swipe"]],[Fe],[Fe,{event:"doubletap",taps:2},["tap"]],[De]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ve.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var r;this.touchAction.preventDefaults(e);var i=this.recognizers,s=t.curRecognizer;(!s||s&&8&s.state)&&(s=t.curRecognizer=null);for(var a=0;a<i.length;)r=i[a],2===t.stopped||s&&r!=s&&!r.canRecognizeWith(s)?r.reset():r.recognize(e),!s&&14&r.state&&(s=t.curRecognizer=r),a++}},get:function(e){if(e instanceof Ee)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function(e){if(g(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(g(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=w(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function(e,t){if(e!==o&&t!==o){var r=this.handlers;return m(C(e),function(e){r[e]=r[e]||[],r[e].push(t)}),this}},off:function(e,t){if(e!==o){var r=this.handlers;return m(C(e),function(e){t?r[e]&&r[e].splice(w(r[e],t),1):delete r[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var r=a.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&Ne(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Le,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:ye,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ve,Input:W,TouchAction:Me,TouchInput:oe,MouseInput:Q,PointerEventInput:re,TouchMouseInput:ce,SingleTouchInput:se,Recognizer:Ee,AttrRecognizer:Ce,Tap:Fe,Pan:we,Swipe:Ie,Pinch:Pe,Rotate:ke,Press:De,on:E,off:S,each:m,merge:A,extend:v,assign:l,inherit:T,bindFn:b,prefixed:k}),(void 0!==s?s:"undefined"!=typeof self?self:{}).Hammer=Le,(i=function(){return Le}.call(t,r,t,e))===o||(e.exports=i)}(window,document)},152(e,t,r){"use strict";r.d(t,{B8:()=>l,C:()=>n,D_:()=>o,I0:()=>g,Qr:()=>p,Tl:()=>c,Z8:()=>_,e$:()=>u,eL:()=>d,fN:()=>m,hs:()=>h,lK:()=>A,o8:()=>a,t5:()=>v,v3:()=>f,vt:()=>s});var i=r(939);function s(){var e=new i.tb(16);return i.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function a(e){var t=new i.tb(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],_=t[11],p=t[12],g=t[13],m=t[14],f=t[15],v=r*o-i*n,A=r*l-s*n,T=r*c-a*n,b=i*l-s*o,M=i*c-a*o,y=s*c-a*l,E=h*g-u*p,S=h*m-d*p,R=h*f-_*p,x=u*m-d*g,C=u*f-_*g,w=d*f-_*m,P=v*w-A*C+T*x+b*R-M*S+y*E;return P?(P=1/P,e[0]=(o*w-l*C+c*x)*P,e[1]=(s*C-i*w-a*x)*P,e[2]=(g*y-m*M+f*b)*P,e[3]=(d*M-u*y-_*b)*P,e[4]=(l*R-n*w-c*S)*P,e[5]=(r*w-s*R+a*S)*P,e[6]=(m*T-p*y-f*A)*P,e[7]=(h*y-d*T+_*A)*P,e[8]=(n*C-o*R+c*E)*P,e[9]=(i*R-r*C-a*E)*P,e[10]=(p*M-g*T+f*v)*P,e[11]=(u*T-h*M-_*v)*P,e[12]=(o*S-n*x-l*E)*P,e[13]=(r*x-i*S+s*E)*P,e[14]=(g*A-p*b-m*v)*P,e[15]=(h*b-u*A+d*v)*P,e):null}function c(e,t,r){var i,s,a,n,o,l,c,h,u,d,_,p,g=r[0],m=r[1],f=r[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*f+t[12],e[13]=t[1]*g+t[5]*m+t[9]*f+t[13],e[14]=t[2]*g+t[6]*m+t[10]*f+t[14],e[15]=t[3]*g+t[7]*m+t[11]*f+t[15]):(i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],_=t[10],p=t[11],e[0]=i,e[1]=s,e[2]=a,e[3]=n,e[4]=o,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=_,e[11]=p,e[12]=i*g+o*m+u*f+t[12],e[13]=s*g+l*m+d*f+t[13],e[14]=a*g+c*m+_*f+t[14],e[15]=n*g+h*m+p*f+t[15]),e}function h(e,t,r){var i=r[0],s=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function u(e,t,r,s){var a,n,o,l,c,h,u,d,_,p,g,m,f,v,A,T,b,M,y,E,S,R,x,C,w=s[0],P=s[1],D=s[2],k=Math.sqrt(w*w+P*P+D*D);return k<i.p8?null:(w*=k=1/k,P*=k,D*=k,a=Math.sin(r),o=1-(n=Math.cos(r)),l=t[0],c=t[1],h=t[2],u=t[3],d=t[4],_=t[5],p=t[6],g=t[7],m=t[8],f=t[9],v=t[10],A=t[11],T=w*w*o+n,b=P*w*o+D*a,M=D*w*o-P*a,y=w*P*o-D*a,E=P*P*o+n,S=D*P*o+w*a,R=w*D*o+P*a,x=P*D*o-w*a,C=D*D*o+n,e[0]=l*T+d*b+m*M,e[1]=c*T+_*b+f*M,e[2]=h*T+p*b+v*M,e[3]=u*T+g*b+A*M,e[4]=l*y+d*E+m*S,e[5]=c*y+_*E+f*S,e[6]=h*y+p*E+v*S,e[7]=u*y+g*E+A*S,e[8]=l*R+d*x+m*C,e[9]=c*R+_*x+f*C,e[10]=h*R+p*x+v*C,e[11]=u*R+g*x+A*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function d(e,t,r){var i=Math.sin(r),s=Math.cos(r),a=t[4],n=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*s+c*i,e[5]=n*s+h*i,e[6]=o*s+u*i,e[7]=l*s+d*i,e[8]=c*s-a*i,e[9]=h*s-n*i,e[10]=u*s-o*i,e[11]=d*s-l*i,e}function _(e,t,r){var i=Math.sin(r),s=Math.cos(r),a=t[0],n=t[1],o=t[2],l=t[3],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*s-c*i,e[1]=n*s-h*i,e[2]=o*s-u*i,e[3]=l*s-d*i,e[8]=a*i+c*s,e[9]=n*i+h*s,e[10]=o*i+u*s,e[11]=l*i+d*s,e}function p(e,t,r){var i=Math.sin(r),s=Math.cos(r),a=t[0],n=t[1],o=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*s+c*i,e[1]=n*s+h*i,e[2]=o*s+u*i,e[3]=l*s+d*i,e[4]=c*s-a*i,e[5]=h*s-n*i,e[6]=u*s-o*i,e[7]=d*s-l*i,e}function g(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=r+r,o=i+i,l=s+s,c=r*n,h=i*n,u=i*o,d=s*n,_=s*o,p=s*l,g=a*n,m=a*o,f=a*l;return e[0]=1-u-p,e[1]=h+f,e[2]=d-m,e[3]=0,e[4]=h-f,e[5]=1-c-p,e[6]=_+g,e[7]=0,e[8]=d+m,e[9]=_-g,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var m=function(e,t,r,i,s){var a=1/Math.tan(t/2);if(e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0){var n=1/(i-s);e[10]=(s+i)*n,e[14]=2*s*i*n}else e[10]=-1,e[14]=-2*i;return e},f=function(e,t,r,i,s,a,n){var o=1/(t-r),l=1/(i-s),c=1/(a-n);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(s+i)*l,e[14]=(n+a)*c,e[15]=1,e};function v(e,t,r,s){var a,n,l,c,h,u,d,_,p,g,m=t[0],f=t[1],v=t[2],A=s[0],T=s[1],b=s[2],M=r[0],y=r[1],E=r[2];return Math.abs(m-M)<i.p8&&Math.abs(f-y)<i.p8&&Math.abs(v-E)<i.p8?o(e):(d=m-M,_=f-y,p=v-E,a=T*(p*=g=1/Math.sqrt(d*d+_*_+p*p))-b*(_*=g),n=b*(d*=g)-A*p,l=A*_-T*d,(g=Math.sqrt(a*a+n*n+l*l))?(a*=g=1/g,n*=g,l*=g):(a=0,n=0,l=0),c=_*l-p*n,h=p*a-d*l,u=d*n-_*a,(g=Math.sqrt(c*c+h*h+u*u))?(c*=g=1/g,h*=g,u*=g):(c=0,h=0,u=0),e[0]=a,e[1]=c,e[2]=d,e[3]=0,e[4]=n,e[5]=h,e[6]=_,e[7]=0,e[8]=l,e[9]=u,e[10]=p,e[11]=0,e[12]=-(a*m+n*f+l*v),e[13]=-(c*m+h*f+u*v),e[14]=-(d*m+_*f+p*v),e[15]=1,e)}var A=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],_=t[10],p=t[11],g=t[12],m=t[13],f=t[14],v=t[15],A=r[0],T=r[1],b=r[2],M=r[3];return e[0]=A*i+T*o+b*u+M*g,e[1]=A*s+T*l+b*d+M*m,e[2]=A*a+T*c+b*_+M*f,e[3]=A*n+T*h+b*p+M*v,A=r[4],T=r[5],b=r[6],M=r[7],e[4]=A*i+T*o+b*u+M*g,e[5]=A*s+T*l+b*d+M*m,e[6]=A*a+T*c+b*_+M*f,e[7]=A*n+T*h+b*p+M*v,A=r[8],T=r[9],b=r[10],M=r[11],e[8]=A*i+T*o+b*u+M*g,e[9]=A*s+T*l+b*d+M*m,e[10]=A*a+T*c+b*_+M*f,e[11]=A*n+T*h+b*p+M*v,A=r[12],T=r[13],b=r[14],M=r[15],e[12]=A*i+T*o+b*u+M*g,e[13]=A*s+T*l+b*d+M*m,e[14]=A*a+T*c+b*_+M*f,e[15]=A*n+T*h+b*p+M*v,e}},299(e,t,r){"use strict";r.d(t,{A:()=>n});var i=r(344),s={Action:{NOTHING:0,MASK_EDIT:1,SCULPT_EDIT:2,CAMERA_ZOOM:3,CAMERA_ROTATE:4,CAMERA_PAN:5,CAMERA_PAN_ZOOM_ALT:6},Tools:{BRUSH:0,INFLATE:1,TWIST:2,SMOOTH:3,FLATTEN:4,PINCH:5,CREASE:6,DRAG:7,PAINT:8,MOVE:9,MASKING:10,LOCALSCALE:11,TRANSFORM:12,ELEMENTSELECT:13},Shader:{PBR:0,FLAT:1,NORMAL:2,WIREFRAME:3,UV:4,MATCAP:5,SELECTION:6,BACKGROUND:7,MERGE:8,FXAA:9,CONTOUR:10,PAINTUV:11,BLUR:12},Projection:{PERSPECTIVE:0,ORTHOGRAPHIC:1},CameraMode:{ORBIT:0,SPHERICAL:1,PLANE:2},MultiState:{NONE:0,SCULPT:1,CAMERA:2,PICKING:3}},a=Object.keys(s.Tools).length;s.KeyAction=i.A.extend({INTENSITY:a++,RADIUS:a++,NEGATIVE:a++,PICKER:a++,DELETE:a++,CAMERA_FRONT:a++,CAMERA_TOP:a++,CAMERA_LEFT:a++,CAMERA_RESET:a++,STRIFE_LEFT:a++,STRIFE_RIGHT:a++,STRIFE_UP:a++,STRIFE_DOWN:a++,WIREFRAME:a++,REMESH:a++},s.Tools);const n=s},344(e,t,r){"use strict";r.d(t,{A:()=>l});var i=r(989),s={SCALE:100,TAG_FLAG:1,SCULPT_FLAG:1,STATE_FLAG:1,TRI_INDEX:4294967295,cursors:{},getResourceBase:function(){if(s.resourceBase)return s.resourceBase;var e="resources/";if("undefined"!=typeof document){var t=document.currentScript;if(!t)for(var r=document.getElementsByTagName("script"),i=r.length-1;i>=0;--i){var a=r[i].src;if(a&&-1!==a.indexOf("sculptgl.js")){t=r[i];break}}t&&t.src?e=new URL("resources/",t.src).toString():"undefined"!=typeof window&&window.location&&(e=new URL("resources/",window.location.href).toString())}return s.resourceBase=e,e},getResourcePath:function(e){return s.getResourceBase()+e}};s.cursors.dropper="url("+s.getResourcePath("dropper.png")+") 5 25, auto",s.linearToSRGB1=function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},s.sRGBToLinear1=function(e){return e<.04045?e*(1/12.92):Math.pow((e+.055)*(1/1.055),2.4)},s.extend=function(e,t){for(var r=Object.keys(t),i=0,s=r.length;i<s;++i){var a=r[i];void 0===e[a]&&(e[a]=t[a])}return e},s.invert=function(e){for(var t=Object.keys(e),r={},i=0,s=t.length;i<s;++i)r[e[t[i]]]=t[i];return r},s.replaceElement=function(e,t,r){for(var i=0,s=e.length;i<s;++i)if(e[i]===t)return void(e[i]=r)},s.removeElement=function(e,t){for(var r=0,i=e.length;r<i;++r)if(e[r]===t)return e[r]=e[i-1],void e.pop()},s.appendArray=function(e,t){var r=e.length,i=t.length;e.length+=i;for(var s=0;s<i;++s)e[r+s]=t[s]},s.isPowerOfTwo=function(e){return 0!==e&&!(e&e-1)},s.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1};var a,n,o=function(e,t){return e-t};s.tidy=function(e){e.sort(o);var t=e.length,r=0,i=0;for(r=1;r<t;++r)e[i]!==e[r]&&(e[++i]=e[r]);r>1&&(e.length=i+1)},s.intersectionArrays=function(e,t){for(var r=0,i=0,s=[],a=e.length,n=t.length;r<a&&i<n;)e[r]<t[i]?r++:e[r]>t[i]?i++:(s.push(e[r]),++r,++i);return s},s.littleEndian=(a=new ArrayBuffer(2),new DataView(a).setInt16(0,256,!0),256===new Int16Array(a)[0]),s.getBytes=function(e,t){return[e[t].charCodeAt(),e[t+1].charCodeAt(),e[t+2].charCodeAt(),e[t+3].charCodeAt()]},s.getUint32=function(e,t){var r=s.getBytes(e,t);return r[0]|r[1]<<8|r[2]<<16|r[3]<<24},s.getFloat32=function(e,t){var r=s.getBytes(e,t),i=1-2*(r[3]>>7),a=(r[3]<<1&255|r[2]>>7)-127,n=(127&r[2])<<16|r[1]<<8|r[0];return 128===a?0!==n?NaN:i*(1/0):-127===a?i*n*Math.pow(2,-149):i*(1+n*Math.pow(2,-23))*Math.pow(2,a)},s.ab2str=function(e){for(var t="",r=new Uint8Array(e),i=65535,s=0,a=r.length;s<a;s+=i){var n=r.subarray(s,i<a-s?i+s:a);t+=String.fromCharCode.apply(null,n)}return t},s.getMemory=(n=new ArrayBuffer(1e5),function(e){return n.byteLength>=e?n:n=new ArrayBuffer(e)}),s.now=Date.now||function(){return(new Date).getTime()},s.throttle=function(e,t){var r,i=[],a=null,n=0,o=function(){n=s.now(),a=null,r=e.apply(e,i)};return function(){for(var l=s.now(),c=t-(l-n),h=i.length=arguments.length,u=0;u<h;++u)i[u]=arguments[u];return c<=0||c>t?(window.clearTimeout(a),a=null,n=l,r=e.apply(e,i)):a||(a=window.setTimeout(o,c)),r}},s.normalizeArrayVec3=function(e,t=e){for(var r=0,i=e.length/3;r<i;++r){var s=3*r,a=e[s],n=e[s+1],o=e[s+2],l=a*a+n*n+o*o;0!==l?(l=1/Math.sqrt(l),t[s]=a*l,t[s+1]=n*l,t[s+2]=o*l):t[s]=1}return t},s.convertArrayVec3toSRGB=function(e,t=e){for(var r=0,i=e.length;r<i;++r)t[r]=s.linearToSRGB1(e[r]);return t},s.convertArrayVec3toLinear=function(e,t=e){for(var r=0,i=e.length;r<i;++r)t[r]=s.sRGBToLinear1(e[r]);return t},s.computeWorldVertices=function(e,t){var r=e.getNbVertices(),s=e.getVertices().subarray(0,3*r);t||(t=new Float32Array(3*r));for(var a=e.getMatrix(),n=i.vt(),o=0;o<r;++o){var l=3*o;i.hZ(n,s[l],s[l+1],s[l+2]),i.Z0(n,n,a),t[l]=n[0],t[l+1]=n[1],t[l+2]=n[2]}return t};const l=s},352(e,t,r){"use strict";r.d(t,{A:()=>n});var i=r(46);var s=function(e){var t=s.languages[s.select][e]||s.languages.english[e];return"string"==typeof t?t:"function"==typeof t?t.apply(this,Array.prototype.slice.call(arguments,1)):(console.error("No TR found for : "+e),e)};s.languages={english:{backgroundTitle:"Background",backgroundReset:"Reset",backgroundImport:"Import (jpg, png...)",backgroundFill:"Fill",cameraTitle:"Camera",cameraReset:"View",cameraCenter:"Reset (bar)",cameraFront:"Front (F)",cameraLeft:"Left (L)",cameraTop:"Top (T)",cameraMode:"Mode",cameraOrbit:"Orbit (Turntable)",cameraSpherical:"Spherical (Trackball)",cameraPlane:"Plane (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographic",cameraFov:"Fov",cameraPivot:"Picking pivot",fileTitle:"Files (import/export)",fileImportTitle:"Import",fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:"Scale and center",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Export Scene",fileExportAll:"Export all",fileExportSGL:"Save .sgl (SculptGL)",fileExportOBJ:"Save .obj",fileExportPLY:"Save .ply",fileExportSTL:"Save .stl",fileExportTextureTitle:"Export textures",fileExportTextureSize:"Size",fileExportColor:"Save diffuse",fileExportRoughness:"Save roughness",fileExportMetalness:"Save metalness",sceneTitle:"Scene",sceneReset:"Clear scene",sceneResetConfirm:"Confirm clear scene",sceneAddSphere:"Add sphere",sceneAddCube:"Add cube",sceneAddPlane:"Add plane",sceneAddCylinder:"Add cylinder",sceneAddTorus:"Add torus",sceneSelection:"Selection",sceneMerge:"Merge selection",sceneDuplicate:"Copy selection",sceneDelete:"Delete selection",sceneSelectAll:"Select all",sceneSelectMore:"Select more",sceneSelectLess:"Select less",sceneCopyPattern:"Copy pattern",sceneCopyPatternType:"Pattern type",sceneCopyPatternLinear:"Linear",sceneCopyPatternPolar:"Polar",sceneCopyPatternCount:"Copies",sceneCopyPatternSpacing:"Spacing",sceneCopyPatternAngle:"Angle step",sceneCopyPatternRadius:"Radius",sceneCopyPatternAxis:"Axis",sceneCopyPatternApply:"Apply pattern",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topology",multiresTitle:"Multiresolution",multiresSubdivide:"Subdivide",multiresReverse:"Reverse",multiresResolution:"Resolution",multiresNoLower:"There is no lower resolution level.",multiresNoHigher:"There is no higher resolution level.",multiresDelHigher:"Delete higher",multiresDelLower:"Delete lower",multiresSelectLowest:"Select the lowest resolution before reversing.",multiresSelectHighest:"Select the highest resolution before subdividing.",multiresWarnBigMesh:function(e){return"The next subdivision level will reach "+e+' faces.\nIf you know what you are doing, click again on "subdivide".'},multiresNotReversible:"Sorry it is not possile to reverse this mesh.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voxel remeshing (quads)",remeshRemesh:"Remesh",remeshResolution:"Resolution",remeshBlock:"Block",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dynamic Topology",dynamicActivated:"Activated (no quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Decimation",dynamicLinear:"Linear subdivision",sculptTitle:"Sculpting & Painting",sculptBrush:"Brush",sculptInflate:"Inflate",sculptTwist:"Twist",sculptSmooth:"Smooth (-Shift)",sculptFlatten:"Flatten",sculptPinch:"Pinch",sculptCrease:"Crease",sculptDrag:"Drag",sculptPaint:"Paint",sculptMasking:"Masking (-Ctrl)",sculptMove:"Move",sculptLocalScale:"Local scale",sculptTransform:"Transform (E)",sculptElementSelect:"Element selection",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Coordinate space",sculptGlobal:"Global",sculptLocal:"Local",sculptLocalTransform:"Yaw/Pitch/Roll",sculptYaw:"Yaw",sculptPitch:"Pitch",sculptRoll:"Roll",sculptGizmoFilters:"Gizmo filters",sculptGizmoOperation:"Operation",sculptGizmoAxis:"Axis",sculptGizmoAll:"All",sculptGizmoMove:"Move",sculptGizmoRotate:"Rotate",sculptGizmoScale:"Scale",sculptGizmoAxisX:"X",sculptGizmoAxisY:"Y",sculptGizmoAxisZ:"Z",sculptElementSelectMode:"Element",sculptElementSelectVertex:"Vertex",sculptElementSelectEdge:"Edge",sculptElementSelectFace:"Face",sculptElementSelectAction:"Action",sculptElementSelectReplace:"Replace",sculptElementSelectAdd:"Add",sculptElementSelectRemove:"Remove",sculptElementSelectAll:"Select all",sculptElementSelectClear:"Clear selection",sculptElementSelectInvert:"Invert selection",sculptCommon:"Common",sculptTool:"Tool",sculptSymmetry:"Symmetry",sculptContinuous:"Continuous",sculptRadius:"Radius (-X)",sculptIntensity:"Intensity (-C)",sculptHardness:"Hardness",sculptCulling:"Thin surface (front vertex only)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Lock position",sculptAlphaTex:"Texture",sculptImportAlpha:"Import alpha tex (jpg, png...)",sculptNegative:"Negative (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Roughness",sculptMetallic:"Metallic",sculptClay:"Clay",sculptAccumulate:"Accumulate (no limit per stroke)",sculptColorGlobal:"Global",sculptPickColor:"Material / Color picker (-S)",sculptTangentialSmoothing:"Relax only",sculptTopologicalCheck:"Topological check",sculptMoveAlongNormal:"Move along normal (N or -Alt)",sculptMaskingClear:"Clear (-Ctrl + Drag)",sculptMaskingInvert:"Invert (-Ctrl + Click)",sculptMaskingBlur:"Blur",sculptMaskingSharpen:"Sharpen",sculptPBRTitle:"PBR materials",sculptPaintAll:"Paint all",sculptExtractTitle:"Extract",sculptExtractThickness:"Thickness",sculptExtractAction:"Extract !",stateTitle:"History",stateUndo:"Undo",stateRedo:"Redo",stateMaxStack:"Max Stack",pressureTitle:"Tablet pressure",pressureRadius:"Pressure radius",pressureIntensity:"Pressure intensity",renderingTitle:"Rendering",renderingGrid:"Show grid",renderingSymmetryLine:"Show mirror line",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Transparency",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Import (jpg, png...)",renderingImportMatcap:"Import (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flat shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exposure",renderingEnvironment:"Environment",renderingIsolate:"Isolate/Show (I)",renderingFilmic:"Filmic tonemapping",contour:"Contour",contourShow:"Show contour",contourColor:"Color",darkenUnselected:"Darken unselected",resolution:"Resolution",matcapPearl:"Pearl",matcapClay:"Clay",matcapSkin:"Skin",matcapGreen:"Green",matcapWhite:"White",sketchfabTitle:"Go to Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"About & Help",alphaNone:"None",alphaSquare:"Square",alphaSkin:"Skin",remeshTitleMC:"Voxel remeshing (manifold tris)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Relax topology"},:{backgroundTitle:"",backgroundReset:"",backgroundImport:"  (jpg, png...)",backgroundFill:null,cameraTitle:"",cameraReset:"View",cameraCenter:null,cameraFront:null,cameraLeft:null,cameraTop:null,cameraMode:"",cameraOrbit:null,cameraSpherical:" (Trackball)",cameraPlane:" (Trackball)",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:"",cameraPivot:"",fileTitle:" (/)",fileImportTitle:null,fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportSceneTitle:null,fileExportAll:null,fileExportSGL:null,fileExportOBJ:null,fileExportPLY:null,fileExportSTL:null,fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:null,sceneReset:null,sceneAddSphere:null,sceneAddCube:null,sceneAddPlane:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,sceneDuplicate:null,meshTitle:"",meshNbVertices:null,meshNbFaces:null,topologyTitle:null,multiresTitle:null,multiresSubdivide:null,multiresReverse:null,multiresResolution:null,multiresNoLower:null,multiresNoHigher:null,multiresDelHigher:null,multiresDelLower:null,multiresSelectLowest:null,multiresSelectHighest:null,multiresWarnBigMesh:null,multiresNotReversible:null,remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,retopoQuadTitle:null,retopoQuadAction:null,retopoQuadResolution:null,retopoQuadRelax:null,retopoQuadIntensity:null,retopoQuadTangent:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"",sculptInflate:"",sculptTwist:"",sculptSmooth:" (-Shift)",sculptFlatten:"",sculptPinch:"",sculptCrease:"",sculptDrag:"",sculptPaint:"",sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,sculptRotomoldTitle:null,sculptRotomoldEnable:null,sculptRotomoldSpeed:null,sculptRotomoldAxis:null,sculptRotomoldAxisX:null,sculptRotomoldAxisY:null,sculptRotomoldAxisZ:null,sculptRotomoldPivot:null,sculptRotomoldPivotMesh:null,sculptRotomoldPivotWorld:null,sculptGizmoTransform:null,sculptCoordSpace:null,sculptGlobal:null,sculptLocal:null,sculptLocalTransform:null,sculptYaw:null,sculptPitch:null,sculptRoll:null,sculptCommon:null,sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:" (N or -Alt)",sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:"",sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"",stateUndo:"",stateRedo:"",stateMaxStack:null,pressureTitle:"",pressureRadius:"",pressureIntensity:"",renderingTitle:null,renderingGrid:null,renderingSymmetryLine:null,renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"",renderingNormal:"",renderingUV:null,renderingShader:"",renderingMaterial:null,renderingImportUV:null,renderingImportMatcap:null,renderingExtra:null,renderingFlat:"",renderingWireframe:" (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:"",matcapSkin:"",matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfab",sketchfabUpload:"",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null},:{backgroundTitle:"",backgroundReset:"",backgroundImport:" (jpg, png...)",backgroundFill:"",cameraTitle:"",cameraReset:"",cameraCenter:" ()",cameraFront:" (F)",cameraLeft:" (L)",cameraTop:" (T)",cameraMode:"",cameraOrbit:" ()",cameraSpherical:" ()",cameraPlane:" ()",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:"",cameraPivot:"",fileTitle:" (/)",fileImportTitle:"",fileAdd:" (obj, sgl, ply, stl)",fileAutoMatrix:"",fileVertexSRGB:"sRGB ",fileExportSceneTitle:"",fileExportAll:"",fileExportSGL:" .sgl (SculptGL)",fileExportOBJ:" .obj",fileExportPLY:" .ply",fileExportSTL:" .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"",sceneReset:"",sceneResetConfirm:"",sceneAddSphere:"",sceneAddCube:"",sceneAddPlane:"",sceneAddCylinder:"",sceneAddTorus:"",sceneSelection:"",sceneMerge:"",sceneDuplicate:"",sceneDuplicate:null,meshTitle:"",meshNbVertices:" : ",meshNbFaces:" : ",topologyTitle:"()",multiresTitle:"",multiresSubdivide:"",multiresReverse:"",multiresResolution:"",multiresNoLower:"",multiresNoHigher:"",multiresDelHigher:"",multiresDelLower:"",multiresSelectLowest:"",multiresSelectHighest:"",multiresWarnBigMesh:function(e){return" "+e+" \n"},multiresNotReversible:"\n (loop-catmull) ",remeshTitle:"",remeshRemesh:"",remeshResolution:"",remeshBlock:"",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"",dynamicActivated:" ()",dynamicSubdivision:"",dynamicDecimation:"",dynamicLinear:"",sculptTitle:"",sculptBrush:"",sculptInflate:"",sculptTwist:"",sculptSmooth:" (-Shift)",sculptFlatten:"",sculptPinch:"",sculptCrease:"",sculptDrag:"",sculptPaint:"",sculptMasking:" (-Ctrl)",sculptMove:"",sculptLocalScale:"",sculptTransform:" (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"",sculptCoordSpace:"",sculptGlobal:"",sculptLocal:"",sculptLocalTransform:"//",sculptYaw:"",sculptPitch:"",sculptRoll:"",sculptCommon:"",sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:"",sculptCulling:" ()",sculptAlphaTitle:" (Alpha)",sculptLockPositon:"",sculptAlphaTex:"",sculptImportAlpha:" alpha  (jpg, png...)",sculptNegative:" (N  -Alt)",sculptColor:"",sculptRoughness:"",sculptMetallic:"",sculptClay:"",sculptAccumulate:" ()",sculptColorGlobal:"",sculptPickColor:" (-S)",sculptTangentialSmoothing:"",sculptTopologicalCheck:"",sculptMoveAlongNormal:" (N  -Alt)",sculptMaskingClear:" (-Ctrl + )",sculptMaskingInvert:" (-Ctrl + )",sculptMaskingBlur:"",sculptMaskingSharpen:"",sculptPBRTitle:"PBR ",sculptPaintAll:"",sculptExtractTitle:"",sculptExtractThickness:"",sculptExtractAction:" !",stateTitle:"",stateUndo:"",stateRedo:"",stateMaxStack:"",pressureTitle:"",pressureRadius:"",pressureIntensity:"",renderingTitle:"",renderingGrid:"",renderingSymmetryLine:"",renderingMatcap:" (Matcap)",renderingCurvature:"",renderingPBR:"(PBR)",renderingTransparency:"",renderingNormal:"",renderingUV:"UV ",renderingShader:"",renderingMaterial:"",renderingImportUV:" (jpg, png...)",renderingImportMatcap:" (jpg, png...)",renderingExtra:"",renderingFlat:"",renderingWireframe:" (W)",renderingExposure:"",renderingEnvironment:"",renderingIsolate:"/ (I)",renderingFilmic:"",contour:"",contourShow:"",contourColor:"",darkenUnselected:"",resolution:"",matcapPearl:"",matcapClay:"",matcapSkin:"",matcapGreen:"",matcapWhite:"",sketchfabTitle:" Sketchfab !",sketchfabUpload:"",sketchfabUploadMessage:' sketchfab API .\n "guest" \n()',sketchfabUploadError:function(e){return"Sketchfab  :\n"+e},sketchfabUploadSuccess:" !\n :",sketchfabAbort:" ?",sketchfabUploadProcessing:"...\n",about:"",alphaNone:"",alphaSquare:"",alphaSkin:""},:{backgroundTitle:"",backgroundReset:"",backgroundImport:" (jpg, png...)",backgroundFill:"  ",cameraTitle:"",cameraReset:"",cameraCenter:" (bar)",cameraFront:" (F)",cameraLeft:" (L)",cameraTop:" (T)",cameraMode:"",cameraOrbit:" (Turntable)",cameraSpherical:" (Trackball)",cameraPlane:" (Trackball)",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:"",cameraPivot:" ",fileTitle:" (/)",fileImportTitle:"",fileAdd:" (obj, sgl, ply, stl)",fileAutoMatrix:"  ",fileVertexSRGB:"sRGB  ",fileExportSceneTitle:" ",fileExportAll:" ",fileExportSGL:".sgl  ",fileExportOBJ:".obj  ",fileExportPLY:".ply  ",fileExportSTL:".stl  ",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"",sceneReset:" ",sceneResetConfirm:"  ",sceneAddSphere:" ",sceneAddCube:" ",sceneAddPlane:" ",sceneAddCylinder:" ",sceneAddTorus:" ",sceneSelection:"",sceneMerge:" ",sceneDuplicate:null,sceneDelete:"  ",meshTitle:"",meshNbVertices:"  : ",meshNbFaces:"  : ",topologyTitle:"",multiresTitle:" ",multiresSubdivide:"",multiresReverse:"",multiresResolution:"",multiresNoLower:"    .",multiresNoHigher:"    .",multiresDelHigher:"  ",multiresDelLower:"  ",multiresSelectLowest:"      .",multiresSelectHighest:"      ",multiresWarnBigMesh:function(e){return"     "+e+'   .\n      ""   .'},multiresNotReversible:"     .\n    (loop-catmull)  .",remeshTitle:" ",remeshRemesh:"",remeshResolution:"",remeshBlock:"",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:" ",dynamicActivated:" (  )",dynamicSubdivision:"",dynamicDecimation:"",dynamicLinear:" ",sculptTitle:" & ",sculptBrush:"",sculptInflate:"",sculptTwist:"",sculptSmooth:" (-Shift)",sculptFlatten:"",sculptPinch:"",sculptCrease:"",sculptDrag:"",sculptPaint:"",sculptMasking:" (-Ctrl)",sculptMove:"",sculptLocalScale:" ",sculptTransform:" (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"",sculptCoordSpace:" ",sculptGlobal:"",sculptLocal:"",sculptLocalTransform:"//",sculptYaw:"",sculptPitch:"",sculptRoll:"",sculptCommon:"",sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:"",sculptCulling:"  (  )",sculptAlphaTitle:"",sculptLockPositon:" ",sculptAlphaTex:"",sculptImportAlpha:"   (jpg, png...)",sculptNegative:" (N  -Alt)",sculptColor:"",sculptRoughness:"",sculptMetallic:"",sculptClay:"",sculptAccumulate:" (   )",sculptColorGlobal:null,sculptPickColor:" /   (-S)",sculptTangentialSmoothing:" ",sculptTopologicalCheck:" ",sculptMoveAlongNormal:"  ",sculptMaskingClear:" (-Ctrl + Drag)",sculptMaskingInvert:" (-Ctrl + Click)",sculptMaskingBlur:"",sculptMaskingSharpen:"",sculptPBRTitle:"PBR ",sculptPaintAll:" ",sculptExtractTitle:"",sculptExtractThickness:"",sculptExtractAction:"!",stateTitle:"",stateUndo:" ",stateRedo:" ",stateMaxStack:"  ",pressureTitle:"",pressureRadius:"",pressureIntensity:" ",renderingTitle:"",renderingGrid:" ",renderingSymmetryLine:" ",renderingMatcap:"",renderingCurvature:" ",renderingPBR:"PBR",renderingTransparency:"",renderingNormal:" ",renderingUV:"UV ",renderingShader:"",renderingMaterial:"",renderingImportUV:" (jpg, png...)",renderingImportMatcap:" (jpg, png...)",renderingExtra:" ",renderingFlat:" ",renderingWireframe:" (W)",renderingExposure:"",renderingEnvironment:"",renderingIsolate:"/ (I)",renderingFilmic:"(filmic) ",contour:"",contourShow:" ",contourColor:"",darkenUnselected:" ",resolution:"",matcapPearl:"",matcapClay:"",matcapSkin:"",matcapGreen:"",matcapWhite:"",sketchfabTitle:"Sketchfab ",sketchfabUpload:"",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:"SculptGL ",alphaNone:null,alphaSquare:null,alphaSkin:null},:{backgroundTitle:"",backgroundReset:"",backgroundImport:" (jpg, png...)",backgroundFill:"",cameraTitle:"",cameraReset:"",cameraCenter:" (bar)",cameraFront:" (F)",cameraLeft:" (L)",cameraTop:" (T)",cameraMode:" ",cameraOrbit:" ()",cameraSpherical:" ()",cameraPlane:" ()",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:" ",cameraPivot:" ",fileTitle:"",fileImportTitle:"",fileAdd:"(obj,sgl,ply,stl)",fileAutoMatrix:"-",fileVertexSRGB:"  sRGB",fileExportSceneTitle:" ",fileExportAll:" ",fileExportSGL:" .sgl",fileExportOBJ:" .obj",fileExportPLY:" .ply",fileExportSTL:" .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"",sceneReset:" ",sceneResetConfirm:"  ",sceneAddSphere:" ",sceneAddCube:" ",sceneAddPlane:" ",sceneAddCylinder:" ",sceneAddTorus:" ",sceneSelection:"",sceneMerge:"",sceneDuplicate:null,sceneDelete:" ",meshTitle:"",meshNbVertices:" : ",meshNbFaces:" : ",topologyTitle:"",multiresTitle:"",multiresSubdivide:"",multiresReverse:"",multiresResolution:"",multiresNoLower:"   .",multiresNoHigher:"   .",multiresDelHigher:" ",multiresDelLower:" ",multiresSelectLowest:"   .",multiresSelectHighest:"   .",multiresWarnBigMesh:function(e){return"  "+e+' faces.\n  ,    "".'},multiresNotReversible:"    ,    .\n  .",remeshTitle:" ",remeshRemesh:"",remeshResolution:"",remeshBlock:"-",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:" ",dynamicActivated:" ( )",dynamicSubdivision:"",dynamicDecimation:"",dynamicLinear:" ",sculptTitle:"  ",sculptBrush:"3D ",sculptInflate:"3D ",sculptTwist:"3D ",sculptSmooth:"3D  (-Shift)",sculptFlatten:"3D ",sculptPinch:"3D ",sculptCrease:"3D ",sculptDrag:"3D ",sculptMove:"3D ",sculptLocalScale:"3D ",sculptPaint:"2D ",sculptMasking:"2D  (-Ctrl)",sculptTransform:"",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"",sculptCoordSpace:" ",sculptGlobal:"",sculptLocal:"",sculptLocalTransform:"//",sculptYaw:"",sculptPitch:"",sculptRoll:"",sculptCommon:"",sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:"",sculptCulling:" ( )",sculptAlphaTitle:"",sculptLockPositon:"",sculptAlphaTex:"",sculptImportAlpha:"   (jpg, png...)",sculptNegative:" (N  -Alt)",sculptColor:"",sculptRoughness:"",sculptMetallic:"",sculptClay:"  ",sculptAccumulate:"  ",sculptColorGlobal:"",sculptPickColor:"  (-S)",sculptTangentialSmoothing:"  ",sculptTopologicalCheck:" ",sculptMoveAlongNormal:"  ",sculptMaskingClear:" (-Ctrl + Drag)",sculptMaskingInvert:" (-Ctrl + Click)",sculptMaskingBlur:"",sculptMaskingSharpen:"",sculptPBRTitle:"PBR ",sculptPaintAll:"",sculptExtractTitle:"",sculptExtractThickness:"",sculptExtractAction:"!",stateTitle:"",stateUndo:"",stateRedo:"",stateMaxStack:" ",pressureTitle:" pressure",pressureRadius:"-",pressureIntensity:"-",renderingTitle:"",renderingGrid:" ",renderingSymmetryLine:" ",renderingMatcap:null,renderingCurvature:"",renderingPBR:"PBR",renderingTransparency:"",renderingNormal:" ",renderingUV:"UV",renderingShader:"",renderingMaterial:"",renderingImportUV:" (jpg, png...)",renderingImportMatcap:" (jpg, png...)",renderingExtra:"",renderingFlat:"",renderingWireframe:" (W)",renderingExposure:"",renderingEnvironment:"",renderingIsolate:" /  (I)",renderingFilmic:"",contour:"",contourShow:" ",contourColor:"",darkenUnselected:" ",resolution:"",matcapPearl:"",matcapClay:"",matcapSkin:"",matcapGreen:"",matcapWhite:"",sketchfabTitle:" Sketchfab.com ",sketchfabUpload:"",sketchfabUploadMessage:" API- sketchfab.\n  guest,    .\n(       )",sketchfabUploadError:function(e){return"   Sketchfab :\n"+e},sketchfabUploadSuccess:"  !\n :",sketchfabAbort:" ?",sketchfabUploadProcessing:"...\n    :",about:" ",alphaNone:"",alphaSquare:"",alphaSkin:""},turkish:{backgroundTitle:"Arka plan",backgroundReset:"Temizle",backgroundImport:"e Aktar (jpg, png...)",backgroundFill:"Doldur",cameraTitle:"Kamera",cameraReset:"Grnm",cameraCenter:"Temizle (boluk)",cameraFront:"n (F)",cameraLeft:"Sol (L)",cameraTop:"st (T)",cameraMode:"Mod",cameraOrbit:"Eksen (Dner Tabla)",cameraSpherical:"Kresel (Trackball)",cameraPlane:"Dzlem (Trackball)",cameraProjection:"z Dm",cameraPerspective:"Perspektif",cameraOrthographic:"Orthografik",cameraFov:"Gr Alan",cameraPivot:"Eksen",fileTitle:"Dosyalar (ieri/dar)",fileImportTitle:"e Aktar",fileAdd:"Aktar (obj, sgl, ply, stl)",fileAutoMatrix:"lekle ve ortala",fileVertexSRGB:"sRGB verteks renk",fileExportSceneTitle:"Sahneyi Da Aktar",fileExportAll:"tmn ver",fileExportSGL:"Kaydet .sgl (SculptGL)",fileExportOBJ:"Kaydet .obj",fileExportPLY:"Kaydet .ply",fileExportSTL:"Kaydet .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Sahne",sceneReset:"Sahneyi temizle",sceneResetConfirm:"Net sahneyi dorulayn",sceneAddSphere:"Kre ekle",sceneAddCube:"Kp ekle",sceneAddPlane:"Dzlem ekle",sceneAddCylinder:"Silindir ekle",sceneAddTorus:"Halka ekle",sceneSelection:"Seim",sceneMerge:"Seimi birletir",sceneDuplicate:null,sceneDelete:"Seimi sil",meshTitle:"Nesne",meshNbVertices:"Verteks : ",meshNbFaces:"Cephe : ",topologyTitle:"Topoloji",multiresTitle:"oklu znrlk",multiresSubdivide:"Bl",multiresReverse:"Ters",multiresResolution:"znrlk",multiresNoLower:"Daha dk znrlk yok.",multiresNoHigher:"Daha yksek znrlk yok.",multiresDelHigher:"st znrl sil",multiresDelLower:"Alt znrl sil",multiresSelectLowest:"Tersine evirmeden nce en dk znrl se.",multiresSelectHighest:"Tesine evirmeden nce en yksek znrl se.",multiresWarnBigMesh:function(e){return"Sonraki znrlk "+e+' cepheden oluacak.\nEer devam etmek istiyorsanz, tekrar "bl" butonuna basn.'},multiresNotReversible:"Malesef bu nesneyi tersine evirmek mmkn deil.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voksel Remeshing",remeshRemesh:"Remesh",remeshResolution:"znrlk",remeshBlock:"Engelle",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dinamik Topoloji",dynamicActivated:"Aktifletirildi (no quads)",dynamicSubdivision:"Altblm",dynamicDecimation:"stblm",dynamicLinear:"Dorusal altblm",sculptTitle:"Oyma & Boyama",sculptBrush:"Fra",sculptInflate:"iir",sculptTwist:"Bklme",sculptSmooth:"Yumuat (-Shift)",sculptFlatten:"Dzletir",sculptPinch:"imdik",sculptCrease:"Kvrm",sculptDrag:"Srkle",sculptPaint:"Boya",sculptMasking:"Maskeleme (-Ctrl)",sculptMove:"Ta",sculptLocalScale:"Yerel lek",sculptTransform:"Transform (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Koordinat alan",sculptGlobal:"Kresel",sculptLocal:"Yerel",sculptLocalTransform:"Sapma/Yunuslama/Yalpalama",sculptYaw:"Sapma",sculptPitch:"Yunuslama",sculptRoll:"Yalpalama",sculptCommon:"Genel",sculptTool:"Ara",sculptSymmetry:"Simetri",sculptContinuous:"Srekli",sculptRadius:"Yara (-X)",sculptIntensity:"Younluk (-C)",sculptHardness:"Sertlik",sculptCulling:"nce yzey (front vertex only)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Pozisyonu kilitle",sculptAlphaTex:"Kaplama",sculptImportAlpha:"Alfa kaplama ykle (jpg, png...)",sculptNegative:"Negatif (N or -Alt)",sculptColor:"Aklk",sculptRoughness:"Przllk",sculptMetallic:"Metalik",sculptClay:"Kil",sculptAccumulate:"Biriktir (limitsiz)",sculptColorGlobal:"Evrensel",sculptPickColor:"Materyal / Renk seici (-S)",sculptTangentialSmoothing:"Rahatlat",sculptTopologicalCheck:"Topoloji kontrol",sculptMoveAlongNormal:"Normal boyunca ta (N or -Alt)",sculptMaskingClear:"Temizle (-Ctrl + Drag)",sculptMaskingInvert:"Tersine evir (-Ctrl + Click)",sculptMaskingBlur:"Bulanklatr",sculptMaskingSharpen:"Keskinletir",sculptPBRTitle:"PBR materyali",sculptPaintAll:"Tmn boya",sculptExtractTitle:"kar",sculptExtractThickness:"Kalnlk",sculptExtractAction:"kar !",stateTitle:"Gemi",stateUndo:"Geri Al",stateRedo:"leri Al",stateMaxStack:"Maksimum Yn",pressureTitle:"Tablet pressure",pressureRadius:"Basn ap",pressureIntensity:"Basn hassasiyeti",renderingTitle:"Sahneleme",renderingGrid:"Izgaray gster",renderingSymmetryLine:"aynalama izgisini gster",renderingMatcap:"Matcap",renderingCurvature:"Erilik",renderingPBR:"PBR",renderingTransparency:"Transparanlk",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materyal",renderingImportUV:"e AKtar (jpg, png...)",renderingImportMatcap:"e AKtar (jpg, png...)",renderingExtra:"Ekstra",renderingFlat:"Dz glgeleme",renderingWireframe:"Tel kafes (W)",renderingExposure:"Teir",renderingEnvironment:"Ortam",renderingIsolate:"zole/Gster (I)",renderingFilmic:"Film Ton Elemesi",contour:"Kontr",contourShow:"Kontr gster",contourColor:"Renk",darkenUnselected:"Seilmeyenleri koyu yap",resolution:"znrlk",matcapPearl:"nci",matcapClay:"Kil",matcapSkin:"Deri",matcapGreen:"Yeil",matcapWhite:"Beyaz",sketchfabTitle:"Sketchfab'a git !",sketchfabUpload:"Ykle",sketchfabUploadMessage:'Ltfen sketchfab entegrasyon anahtarn giriniz.\nAnonim olarak kullanmak iin "guest" olarak braknz.\n(leme ve ykleme tamamlandnda yeni bir pencere alacak)',sketchfabUploadError:function(e){return"Sketchfab ykleme hatas :\n"+e},sketchfabUploadSuccess:"Ykleme baarl !\nAdresiniz burada :",sketchfabAbort:"Son yklemeyi iptal et ?",sketchfabUploadProcessing:"Hesaplanyor...\nModeliniz u adreste olacak :",about:"Hakknda & Yardm",alphaNone:"Hi Biri",alphaSquare:"Kare",alphaSkin:"Deri"},svenska:{backgroundTitle:"Bakgrund",backgroundReset:"terstll",backgroundImport:"Importera (jpg, png...)",backgroundFill:"Fyll",cameraTitle:"Kamera",cameraReset:"Vy",cameraCenter:"terstll (bar)",cameraFront:"Fram (F)",cameraLeft:"Vnster (L)",cameraTop:"ver (T)",cameraMode:"Lge",cameraOrbit:"Omloppsbana (skivtallrik)",cameraSpherical:"Sfrisk (trackball)",cameraPlane:"Plan (trackball)",cameraProjection:"Projektion",cameraPerspective:"Perspektiv",cameraOrthographic:"Ortografisk",cameraFov:"Fov",cameraPivot:"Plocka pivot",fileTitle:"Filer (import/export)",fileImportTitle:"Importera",fileAdd:"Lgg till (obj, sgl, ply, stl)",fileAutoMatrix:"Skala och centrera",fileVertexSRGB:"sRGB vertexfrg",fileExportSceneTitle:"Exportera Scen",fileExportAll:"Exportera alla",fileExportSGL:"Spara .sgl (SculptGL)",fileExportOBJ:"Spara .obj",fileExportPLY:"Spara .ply",fileExportSTL:"Spara .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Scen",sceneReset:"Rensa scen",sceneResetConfirm:"Bekrfta klar scen",sceneAddSphere:"Lgg till sfr",sceneAddCube:"Lgg till kub",sceneAddPlane:"Lgg till plan",sceneAddCylinder:"Lgg till cylinder",sceneAddTorus:"Lgg till torus",sceneSelection:"Urval",sceneMerge:"Sammanfoga urval",sceneDuplicate:null,sceneDelete:"Radera valet",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologi",multiresTitle:"Upplsningar",multiresSubdivide:"Dela upp yta",multiresReverse:"Omvnd",multiresResolution:"Upplsning",multiresNoLower:"Det finns ingen lgre upplsningsniv.",multiresNoHigher:"Det finns ingen hgre upplsningsniv.",multiresDelHigher:"Ta bort hgre",multiresDelLower:"Ta bort lgre",multiresSelectLowest:"Vlj den lgsta upplsningen innan omvndning.",multiresSelectHighest:"Vlj den hgsta upplsningen innan uppdelning.",multiresWarnBigMesh:function(e){return"Nsta underavdelning niv kommer att ha "+e+' faces.\nOm du vet vad du gr, klicka igen p "dela upp yta".'},multiresNotReversible:"Tyvrr, det gr inte att omvnda denna mesh.\nMeshen r inte en produkt av en (loop-calmull) mngfaldsytindelning.",remeshTitle:"Voxel Meshombyggnation",remeshRemesh:"Bygg om mesh",remeshResolution:"Upplsning",remeshBlock:"Kuber",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dynamisk Topologi",dynamicActivated:"Aktiverad (inga quads)",dynamicSubdivision:"Ytindelning",dynamicDecimation:"Decimering",dynamicLinear:"Linjr ytindelning",sculptTitle:"Skulptering & Mleri",sculptBrush:"Pensel",sculptInflate:"Bls upp",sculptTwist:"Tvista",sculptSmooth:"Jmna ut (-Shift)",sculptFlatten:"Platta till",sculptPinch:"Nyp",sculptCrease:"Vecka",sculptDrag:"Dra",sculptPaint:"Mla",sculptMasking:"Maskera (-Ctrl)",sculptMove:"Flytta",sculptLocalScale:"Skala lokalt",sculptTransform:"Transformera (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Koordinatutrymme",sculptGlobal:"Global",sculptLocal:"Lokal",sculptLocalTransform:"Gir/Lutning/Roll",sculptYaw:"Gir",sculptPitch:"Lutning",sculptRoll:"Roll",sculptCommon:"Generellt",sculptTool:"Verktyg",sculptSymmetry:"Symmetri",sculptContinuous:"Kontinuerlig",sculptRadius:"Radie (-X)",sculptIntensity:"Intensitet (-C)",sculptHardness:"Hrdhet",sculptCulling:"Tunn yta (endast frmre vertex)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Ls position",sculptAlphaTex:"Textur",sculptImportAlpha:"Importera alfatextur (jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Ytjmnhet",sculptMetallic:"Metallisk",sculptClay:"Lera",sculptAccumulate:"Ackumulera (ingen grns per strykning)",sculptColorGlobal:"Global",sculptPickColor:"Material / Frgvlgare (-S)",sculptTangentialSmoothing:"Tangentiell utjmning",sculptTopologicalCheck:"Topologisk check",sculptMoveAlongNormal:"Flytta lngsmed normal (N or -Alt)",sculptMaskingClear:"Rensa (-Ctrl + Drag)",sculptMaskingInvert:"Invertera (-Ctrl + Click)",sculptMaskingBlur:"Gr suddig",sculptMaskingSharpen:"Gr skarp",sculptPBRTitle:"PBR-material",sculptPaintAll:"Mla allt",sculptExtractTitle:"Extrahera",sculptExtractThickness:"Tjocklek",sculptExtractAction:"Extrahera!",stateTitle:"Historia",stateUndo:"ngra",stateRedo:"Gr om",stateMaxStack:"gra antal steg",pressureTitle:"pressureplatta",pressureRadius:"Tryckradie",pressureIntensity:"Tryckintensitet",renderingTitle:"Rendering",renderingGrid:"Visa rutnt",renderingSymmetryLine:"Visa speglingslinje",renderingMatcap:"MatCap",renderingCurvature:"Kurvatur",renderingPBR:"PBR",renderingTransparency:"Genomskinlighet",renderingNormal:"Normal shader",renderingUV:"UV-shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importera (jpg, png...)",renderingImportMatcap:"Importera (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Platt shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exponering",renderingEnvironment:"Milj",renderingIsolate:"Isolera/Visa (I)",renderingFilmic:"Filmiska frgtoner",contour:"Kontur",contourShow:"Visa kontur",contourColor:"Frg",darkenUnselected:"Skym ej valda",resolution:"Upplsning",matcapPearl:"Prla",matcapClay:"Lera",matcapSkin:"Hud",matcapGreen:"Grn",matcapWhite:"Vit",sketchfabTitle:"G till Sketchfab!",sketchfabUpload:"Ladda upp",sketchfabUploadMessage:'Vnligen fyll i din sketchfab API-nyckel.\nDu kan ven ange "guest" fr att ladda upp anonymt.\n(ett nytt fnster kommer att ppnas nr uppladdning och bearbetning r klar)',sketchfabUploadError:function(e){return"Sketchfab uppladdningsfel:\n"+e},sketchfabUploadSuccess:"Uppladdning lyckades!\nHr r din lnk:",sketchfabAbort:"Avbryta senaste uppladdningen?",sketchfabUploadProcessing:"Bearbetar...\nDin modell kommer bli tillgnglig hr:",about:"Om & Hjlp",alphaNone:"Ingen",alphaSquare:"Fyrkant",alphaSkin:"Hud"},franais:{backgroundTitle:"Fond d'cran",backgroundReset:"Rinitialiser",backgroundImport:"Importer (jpg, png...)",backgroundFill:"Remplir",cameraTitle:"Camra",cameraReset:"Vue",cameraCenter:"Reset (bar)",cameraFront:"De face (F)",cameraLeft:"De gauche (L)",cameraTop:"De haut (T)",cameraMode:"Mode",cameraOrbit:"Orbite (Turntable)",cameraSpherical:"Spherique (Trackball)",cameraPlane:"Planaire (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographique",cameraFov:"Champs de vision",cameraPivot:"Point de pivot",fileTitle:"Fichiers (importer/exporter)",fileImportTitle:"Importer",fileAdd:"Ajouter (obj, sgl, ply, stl)",fileAutoMatrix:"Mise a l'chelle et centrage",fileVertexSRGB:"Couleur de vertex en sRGB",fileExportSceneTitle:"Exporter Scene",fileExportAll:"Tout exporter",fileExportSGL:"Sauver .sgl (SculptGL)",fileExportOBJ:"Sauver .obj",fileExportPLY:"Sauver .ply",fileExportSTL:"Sauver .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Scne",sceneReset:"Rinitialiser scne",sceneResetConfirm:"Confirmer rinitialiser la scne?",sceneAddSphere:"Ajouter sphere",sceneAddCube:"Ajouter cube",sceneAddPlane:"Ajouter plan",sceneAddCylinder:"Ajouter cylindre",sceneAddTorus:"Ajouter tore",sceneSelection:"Slection",sceneMerge:"Fusionner selection",sceneDuplicate:null,sceneDelete:"Supprimer la slection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Multirsolution",multiresSubdivide:"Subdiviser",multiresReverse:"Inverser",multiresResolution:"Rsolution",multiresNoLower:"Il n'y a pas de niveau de rsolution infrieur.",multiresNoHigher:"Il n'y a pas de niveau de rsolution plus lev.",multiresDelHigher:"Suppression suprieur",multiresDelLower:"Suppression infrieur",multiresSelectLowest:"Slectionnez la rsolution la plus basse avant d'inverser.",multiresSelectHighest:"Slectionnez la rsolution la plus leve avant de subdiviser.",multiresWarnBigMesh:function(e){return"Le prochain niveau de subdivision atteindra "+e+' faces.\nSi vous savez ce que vous faites, cliquez de nouveau sur "subdiviser".'},multiresNotReversible:"Dsol, il n'est pas possible d'inverser ce maillage.\nLe mesh n'est pas un produit d'une surface de subdivision (loop-catmull) provenant manifold.",remeshTitle:"Remaillage volumtrique",remeshRemesh:"Remaillage",remeshResolution:"Rsolution",remeshBlock:"Bloc",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Topologie dynamique",dynamicActivated:"Activat (pas quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Dcimation",dynamicLinear:"Subdivision linaire",sculptTitle:"Sculpture & Painture",sculptBrush:"Brosse",sculptInflate:"Gonfler",sculptTwist:"Tordre",sculptSmooth:"Lisser (-Shift)",sculptFlatten:"Aplatir",sculptPinch:"Pincer",sculptCrease:"Plier",sculptDrag:"Tirer",sculptPaint:"Peindre",sculptMasking:"Masquer (-Ctrl)",sculptMove:"Bouger",sculptLocalScale:"Mise  l'chelle locale",sculptTransform:"Transformer (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Espace de coordonnes",sculptGlobal:"Global",sculptLocal:"Local",sculptLocalTransform:"Lacet/Tangage/Roulis",sculptYaw:"Lacet",sculptPitch:"Tangage",sculptRoll:"Roulis",sculptCommon:"Commun",sculptTool:"Outil",sculptSymmetry:"Symtrie",sculptContinuous:"Continu",sculptRadius:"Rayon (-X)",sculptIntensity:"Intensit (-C)",sculptHardness:"Duret",sculptCulling:"Surface fine (vertex de face uniquement)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Bloquer position",sculptAlphaTex:"Texture",sculptImportAlpha:"Importer texture alpha (jpg, png...)",sculptNegative:"Ngatif (N ou -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosit",sculptMetallic:"Mtallique",sculptClay:"Argile",sculptAccumulate:"Accumuler effet",sculptColorGlobal:"Global",sculptPickColor:"Matriau / selection de couleur (-S)",sculptTangentialSmoothing:"Relaxer uniquement",sculptTopologicalCheck:"Vrification topologique",sculptMoveAlongNormal:"Extruder suivant la normale (N ou -Alt)",sculptMaskingClear:"Reset (-Ctrl + Drag)",sculptMaskingInvert:"Inverser (-Ctrl + Click)",sculptMaskingBlur:"Brouiller",sculptMaskingSharpen:"Aiguiser",sculptPBRTitle:"Matriaux physiques (PBR)",sculptPaintAll:"Peindre tout",sculptExtractTitle:"Extraire",sculptExtractThickness:"Epaisseur",sculptExtractAction:"Extraire !",stateTitle:"Historique",stateUndo:"Annuler",stateRedo:"Refaire",stateMaxStack:"Nombre maximale d'action",pressureTitle:"Pression de la tablette",pressureRadius:"Pression sur le rayon",pressureIntensity:"Pression sur l'intensit",renderingTitle:"Rendu",renderingGrid:"Afficher grille",renderingSymmetryLine:"Afficher ligne de symtrie",renderingMatcap:"Matcap",renderingCurvature:"Courbure",renderingPBR:"PBR",renderingTransparency:"Transparence",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Matriau",renderingImportUV:"Importer (jpg, png...)",renderingImportMatcap:"Importer (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Ombrage plat",renderingWireframe:"Fil de fer (W)",renderingExposure:"Exposition",renderingEnvironment:"Environment",renderingIsolate:"Isoler/Afficher (I)",renderingFilmic:"Tonemapping filmique",contour:"Contour",contourShow:"Afficher les contours",contourColor:"Couleur",darkenUnselected:"Assombrir non slction",resolution:"Rsolution",matcapPearl:"Perle",matcapClay:"Argile",matcapSkin:"Peau",matcapGreen:"Vert",matcapWhite:"Blanc",sketchfabTitle:"Vers Sketchfab !",sketchfabUpload:"Uploader",sketchfabUploadMessage:"Entrez votre cl d'API sketchfab.\n",sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Tlchargement fini !\nVoici le lien :",sketchfabAbort:"Annuler le dernier tlchargement ?",sketchfabUploadProcessing:"En traitement...\nLe modle sera disponible sur :",about:"A propos & aide",alphaNone:"Vide",alphaSquare:"Carr",alphaSkin:"Peau",remeshTitleMC:"Remaillage surfacique (manifold tris)",remeshRemeshMC:"Remaillage",remeshSmoothingMC:"Lisser topologie"},deutsch:{backgroundTitle:"Hintergrund",backgroundReset:"Zurcksetzen",backgroundImport:"Importieren (jpg, png...)",backgroundFill:"Fllen",cameraTitle:"Kamera",cameraReset:"Ansicht",cameraCenter:"Reset (space)",cameraFront:"Front (F)",cameraLeft:"Links (L)",cameraTop:"Oben (T)",cameraMode:"Modus",cameraOrbit:"Orbit (Drehscheibe)",cameraSpherical:"Sphrisch (Rollkugel)",cameraPlane:"Ebene (Rollkugel)",cameraProjection:"Projektion",cameraPerspective:"Perspektivisch",cameraOrthographic:"Orthographisch",cameraFov:"Sichtfeld (fov)",cameraPivot:"Pivot auswhlen",fileTitle:"Datei (import/export)",fileImportTitle:"Importieren",fileAdd:"Hinzufgen (obj, sgl, ply, stl)",fileAutoMatrix:"Skalieren und zentrieren",fileVertexSRGB:"Vertexfarbe sRGB",fileExportSceneTitle:"Exportieren",fileExportAll:"Alles Exportieren",fileExportSGL:"Speichern .sgl (SculptGL)",fileExportOBJ:"Speichern .obj",fileExportPLY:"Speichern .ply",fileExportSTL:"Speichern .stl",fileExportTextureTitle:"Texturen exportieren",fileExportTextureSize:"Gre",fileExportColor:"Farben speichern",fileExportRoughness:"Rauheit speichern",fileExportMetalness:"Metallisches speichern",sceneTitle:"Szene",sceneReset:"Szene lschen",sceneResetConfirm:"Besttige das Lschen der aktuellen Szene",sceneAddSphere:"Kugel hinzufgen",sceneAddCube:"Wrfel hinzufgen",sceneAddPlane:"Ebene hinzufgen",sceneAddCylinder:"Zylinder hinzufgen",sceneAddTorus:"Torus hinzufgen",sceneSelection:"Auswahl",sceneMerge:"Auswahl zusammenfhren",sceneDuplicate:"Auswahl kopieren",sceneDelete:"Auswahl lschen",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Mehrfachauflsung",multiresSubdivide:"Aufteilen",multiresReverse:"Umkehren",multiresResolution:"Auflsung",multiresNoLower:"Es gibt keine kleinere Auflsung.",multiresNoHigher:"Es gibt keine hhere Auflsung.",multiresDelHigher:"Hhere lschen",multiresDelLower:"Niedrigere lschen",multiresSelectLowest:"Whlen Sie vor dem Umkehren die kleinste Auflsung aus.",multiresSelectHighest:"Whlen Sie vor dem Umkehren die hchste Auflsung aus.",multiresWarnBigMesh:function(e){return"Die nchste Unterteilungsebene wird "+e+' Flchen erreichen\nWenn Sie wissen, was Sie tun, dann klicken Sie nocheinmal auf "umkehren".'},multiresNotReversible:"Es ist leider nicht mglich dieses Netz umzukehren.\nDas Netz ist kein Produkt einer (loop/catmull) Unterteilungsflche auf eines mannigfaltigen Netzes",remeshTitle:"Voxel remeshing (Vierecke)",remeshRemesh:"Remesh",remeshResolution:"Auflsung",remeshBlock:"Block",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dynamische Topologie",dynamicActivated:"Aktiviert (ohne Vierecke)",dynamicSubdivision:"Aufteilung",dynamicDecimation:"Dezimierung",dynamicLinear:"Lineare Aufteilung",sculptTitle:"Modellieren & Bemalen",sculptBrush:"Pinsel",sculptInflate:"Aufblasen",sculptTwist:"Verdrehen",sculptSmooth:"Gltten (-Shift)",sculptFlatten:"Ebnen",sculptPinch:"Kneifen",sculptCrease:"Falten",sculptDrag:"Ziehen",sculptPaint:"Malen",sculptMasking:"Maskieren (-Strg)",sculptMove:"Bewegen",sculptLocalScale:"Lokales Skalieren",sculptTransform:"Transformieren (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Koordinatenraum",sculptGlobal:"Global",sculptLocal:"Lokal",sculptLocalTransform:"Gieren/Nicken/Rollen",sculptYaw:"Gieren",sculptPitch:"Nicken",sculptRoll:"Rollen",sculptCommon:"Allgemein",sculptTool:"Werkzeuge",sculptSymmetry:"Symmetrie",sculptContinuous:"Kontinuierlich",sculptRadius:"Radius (-X)",sculptIntensity:"Intensitt (-C)",sculptHardness:"Hrte",sculptCulling:"Dnne Oberflche (nur vorderer vertex)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Verriegelungsposition",sculptAlphaTex:"Textur",sculptImportAlpha:"Alpha tex importieren(jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Rauheit",sculptMetallic:"Metallisches",sculptClay:"Lehm",sculptAccumulate:"Akkumulieren (Kein Limit pro Anschlag)",sculptColorGlobal:"Global",sculptPickColor:"Material / Farb Auswahl (-S)",sculptTangentialSmoothing:"Tangentiale Glttung",sculptTopologicalCheck:"Topologischer Check",sculptMoveAlongNormal:"Normal weiterlaufen (N or -Alt)",sculptMaskingClear:"Lschen (-Ctrl + Drag)",sculptMaskingInvert:"Invertieren (-Ctrl + Click)",sculptMaskingBlur:"Verwischen",sculptMaskingSharpen:"Schrfen",sculptPBRTitle:"PBR Materialen",sculptPaintAll:"Alles Anmalen",sculptExtractTitle:"Extrahieren",sculptExtractThickness:"Dicke",sculptExtractAction:"Extrahieren !",stateTitle:"Verlauf",stateUndo:"Rckgngig",stateRedo:"Wiederholen",stateMaxStack:"Max. Schritte",pressureTitle:"Tablet Druck",pressureRadius:"Druckradius",pressureIntensity:"Druckintensitt",renderingTitle:"Rendering",renderingGrid:"Gitter anzeigen",renderingSymmetryLine:"Spiegellinie anzeigen",renderingMatcap:"Matcap",renderingCurvature:"Krmmung",renderingPBR:"PBR",renderingTransparency:"Transparenz",renderingNormal:"Normale Shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importieren (jpg, png...)",renderingImportMatcap:"Importieren (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flaches Schattieren",renderingWireframe:"Drahtgitter (W)",renderingExposure:"Belichtung",renderingEnvironment:"Umgebung",renderingIsolate:"Isoliert/Zeige (I)",renderingFilmic:"Filmische Tonzuordnung",contour:"Kontur",contourShow:"Kontur anzeigen",contourColor:"Farbe",darkenUnselected:"Nicht markiertes abdunkeln",resolution:"Auflsung",matcapPearl:"Perle",matcapClay:"Ton",matcapSkin:"Haut",matcapGreen:"Grn",matcapWhite:"Wei",sketchfabTitle:"Hier gehts zu Sketchfab !",sketchfabUpload:"Hochladen",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"ber & Hilfe (Englisch)",alphaNone:"None",alphaSquare:"Wrfel",alphaSkin:"Haut",remeshTitleMC:"Voxel remeshing (mannigfaltige Dreiecke)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Topologie entspannen"},italiano:{backgroundTitle:"Sfondo",backgroundReset:"Resetta",backgroundImport:"Importa (jpg, png...)",backgroundFill:"Riempi",cameraTitle:"Camera",cameraReset:"Vista",cameraCenter:"Resetta (bar)",cameraFront:"Fronte (F)",cameraLeft:"Sinistra (L)",cameraTop:"Sopra (T)",cameraMode:"Modalit",cameraOrbit:"Orbita (Ruota intorno)",cameraSpherical:"Sferica (Trackball)",cameraPlane:"Planare (Trackball)",cameraProjection:"Proiezione",cameraPerspective:"Prospettiva",cameraOrthographic:"Ortografica",cameraFov:"Fov",cameraPivot:"Seleziona pivot",fileTitle:"Files (importa/esporta)",fileImportTitle:"Importa",fileAdd:"Aggiungi (obj, sgl, ply, stl)",fileAutoMatrix:"Scala e centra",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Esporta Scena",fileExportAll:"Exporta tutto",fileExportSGL:"Salva .sgl (SculptGL)",fileExportOBJ:"Salva .obj",fileExportPLY:"Salva .ply",fileExportSTL:"Salva .stl",fileExportTextureTitle:"Esporta textures",fileExportTextureSize:"Dimensione",fileExportColor:"Salva diffuse",fileExportRoughness:"Salva roughness",fileExportMetalness:"Salva metalness",sceneTitle:"Scena",sceneReset:"Pulisci scena",sceneResetConfirm:"Conferma pulitura scena",sceneAddSphere:"Aggiungi sfera",sceneAddCube:"Aggiungi cubo",sceneAddPlane:"Aggiungi piano",sceneAddCylinder:"Aggiungi cilindro",sceneAddTorus:"Aggiungi toroide",sceneSelection:"Selezione",sceneMerge:"Unisci selezione",sceneDuplicate:"Copia selezione",sceneDelete:"Elimina selezione",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologia",multiresTitle:"Multirisoluzione",multiresSubdivide:"Suddivisione",multiresReverse:"Invertire",multiresResolution:"Risoluzione",multiresNoLower:"Non esiste un livello di risoluzione inferiore.",multiresNoHigher:"Non esiste un livello di risoluzione pi alto.",multiresDelHigher:"Elimina superiore",multiresDelLower:"Elimina inferiore",multiresSelectLowest:"Selezionare la risoluzione pi bassa prima di invertire.",multiresSelectHighest:"Seleziona la risoluzione pi alta prima di suddividere.",multiresWarnBigMesh:function(e){return"Il livello di suddivisione successivo raggiunger "+e+' facce.\nSe sai cosa stai facendo, clicca di nuovo su "Suddividi".'},multiresNotReversible:"Spiacenti, non  possibile invertire questa mesh.\nLa mesh non  un prodotto di una superficie di suddivisione (loop-catmull) su una mesh collettore.",remeshTitle:"Voxel remeshing (quads)",remeshRemesh:"Remesh",remeshResolution:"Risolutione",remeshBlock:"Blocca",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Topologia Dinamica",dynamicActivated:"Attivata (no quads)",dynamicSubdivision:"Suddivisione",dynamicDecimation:"Decimazione",dynamicLinear:"Suddivisione Lineare",sculptTitle:"Scalpisci & Dipingi",sculptBrush:"Spazzola",sculptInflate:"Gonfia",sculptTwist:"Torci",sculptSmooth:"Ammorbidisci (-Shift)",sculptFlatten:"Appiattisci",sculptPinch:"Pizzica",sculptCrease:"Piega",sculptDrag:"Trascina",sculptPaint:"Dipingi",sculptMasking:"Maschera (-Ctrl)",sculptMove:"Muovi",sculptLocalScale:"Scala Locale",sculptTransform:"Trasformazioni (E)",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Spazio coordinate",sculptGlobal:"Globale",sculptLocal:"Locale",sculptLocalTransform:"Imbardata/Beccheggio/Rollio",sculptYaw:"Imbardata",sculptPitch:"Beccheggio",sculptRoll:"Rollio",sculptCommon:"Comune",sculptTool:"Strumento",sculptSymmetry:"Simmetria",sculptContinuous:"Continua",sculptRadius:"Raggio (-X)",sculptIntensity:"Intensit (-C)",sculptHardness:"Durezza",sculptCulling:"Superficie sottile (solo vertici frontali)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Blocca posizione",sculptAlphaTex:"Texture",sculptImportAlpha:"Importa alpha tex (jpg, png...)",sculptNegative:"Negativo (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosit",sculptMetallic:"Metallico",sculptClay:"Clay",sculptAccumulate:"Accumulazione (no limit per stroke)",sculptColorGlobal:"Globale",sculptPickColor:"Materiale / Color picker (-S)",sculptTangentialSmoothing:"Solo Relax",sculptTopologicalCheck:"Controllo Topologia",sculptMoveAlongNormal:"Muovi lungo la normale (N o -Alt)",sculptMaskingClear:"Pulisci (-Ctrl + Drag)",sculptMaskingInvert:"Inverti (-Ctrl + Click)",sculptMaskingBlur:"Sfoca",sculptMaskingSharpen:"Nitidezza",sculptPBRTitle:"Materiali PBR",sculptPaintAll:"Dipingi tutto",sculptExtractTitle:"Estrazione",sculptExtractThickness:"Assottigliamento",sculptExtractAction:"Estrai !",stateTitle:"Story",stateUndo:"Indietro",stateRedo:"Avanti",stateMaxStack:"Pila massima",pressureTitle:"Pressione tavoletta",pressureRadius:"Raggio pressione",pressureIntensity:"Intensit pressione",renderingTitle:"Rendering",renderingGrid:"Vedi Griglia",renderingSymmetryLine:"Vedi linea di specchiatura",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Trasparenza",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materiale",renderingImportUV:"Importa (jpg, png...)",renderingImportMatcap:"Importa (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Shading piatto",renderingWireframe:"Wireframe (W)",renderingExposure:"Esposizione",renderingEnvironment:"Ambiente",renderingIsolate:"Isola/Vedi (I)",renderingFilmic:"Coloritura tipo Film",contour:"Contorno",contourShow:"Vedi contorno",contourColor:"Colore",darkenUnselected:"Scurisci i non selezionati",resolution:"Risolutione",matcapPearl:"Perla",matcapClay:"Argilla",matcapSkin:"Pelle",matcapGreen:"Verde",matcapWhite:"Bianco",sketchfabTitle:"Vai su Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Inserisci la tua chiave API di sketchfab.\nPuoi anche lasciare "guest" per caricare in modo anonimo.\n(verr visualizzata una nuova finestra al termine del caricamento e dell\'elaborazione)',sketchfabUploadError:function(e){return"Sketchfab errore upload :\n"+e},sketchfabUploadSuccess:"Caricato con successo !\nEcco il tuo link :",sketchfabAbort:"Annulla l'ultimo caricamento?",sketchfabUploadProcessing:"Processing...\nIl tuo modello sar disponibile su :",about:"Informazioni & Aiuto",alphaNone:"Nessuno",alphaSquare:"Quadrata",alphaSkin:"Pelle",remeshTitleMC:"Voxel remeshing (manifold tris)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Relax topology"}},s.select="english";var a=window.navigator.language||window.navigator.userLanguage;switch(a&&(a=a.substr(0,2)),"ja"===a?s.select="":"zh"===a?s.select="":"ko"===a?s.select="":"tr"===a?s.select="turkish":"sv"===a?s.select="svenska":"fr"===a?s.select="franais":"de"===a&&(s.select="deutsch"),(0,i.A)().language){case"english":s.select="english";break;case"chinese":s.select="";break;case"korean":s.select="";break;case"japanese":s.select="";break;case"russian":s.select="";break;case"turkish":s.select="turkish";break;case"swedish":s.select="svenska";break;case"french":s.select="franais";break;case"german":s.select="deutsch";break;case"italian":s.select="italiano"}const n=s},377(module){var factory;window,factory=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(i,s,function(t){return e[t]}.bind(null,s));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/yagui.js")}({"./src/GuiMain.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Sidebar */ \"./src/containers/Sidebar.js\");\n/* harmony import */ var containers_Topbar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! containers/Topbar */ \"./src/containers/Topbar.js\");\n\n\n\nclass GuiMain {\n\n  constructor(viewport, callbackResize) {\n    this.domMain = document.createElement('div');\n    this.viewport = viewport;\n\n    this.callbackResize = callbackResize;\n    if (this.viewport) {\n      this.viewport.style.width = document.documentElement.clientWidth + 'px';\n      this.viewport.style.height = document.documentElement.clientHeight + 'px';\n    }\n    this.cbResize_ = this._onWindowResize.bind(this);\n\n    document.body.appendChild(this.domMain);\n    this.leftSidebar = undefined;\n    this.rightSidebar = undefined;\n    this.topbar = undefined;\n\n    window.addEventListener('resize', this._onWindowResize.bind(this), false);\n  }\n\n  _onWindowResize() {\n    if (this.viewport) {\n      this.viewport.style.width = document.documentElement.clientWidth + 'px';\n      this.viewport.style.height = document.documentElement.clientHeight + 'px';\n      this.viewport.style.left = '0px';\n      this.viewport.style.top = '0px';\n      if (this.leftSidebar)\n        this.leftSidebar._updateViewportPosition(this.viewport);\n      if (this.rightSidebar)\n        this.rightSidebar._updateViewportPosition(this.viewport);\n      if (this.topbar)\n        this.topbar._updateViewportPosition(this.viewport);\n    }\n    this._updateSidebarsPosition();\n    if (this.callbackResize)\n      this.callbackResize();\n  }\n\n  _updateSidebarsPosition() {\n    if (!this.topbar) return;\n    var off = this.topbar.domTopbar.offsetHeight;\n    if (this.leftSidebar)\n      this.leftSidebar._setTop(off);\n    if (this.rightSidebar)\n      this.rightSidebar._setTop(off);\n  }\n\n  addLeftSidebar() {\n    this.leftSidebar = new containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.cbResize_);\n    var domSide = this.leftSidebar.domSidebar;\n    this.domMain.appendChild(domSide);\n    this.domMain.appendChild(this.leftSidebar.domResize);\n\n    this._updateSidebarsPosition();\n    this.leftSidebar._updateViewportPosition(this.viewport);\n    return this.leftSidebar;\n  }\n\n  addRightSidebar() {\n    this.rightSidebar = new containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.cbResize_);\n    var domSide = this.rightSidebar.domSidebar;\n    this.domMain.appendChild(domSide);\n    this.domMain.appendChild(this.rightSidebar.domResize);\n\n    this.rightSidebar._onTheRight();\n    this._updateSidebarsPosition();\n    this.rightSidebar._updateViewportPosition(this.viewport);\n    return this.rightSidebar;\n  }\n\n  addTopbar() {\n    this.topbar = new containers_Topbar__WEBPACK_IMPORTED_MODULE_1__[\"default\"](this.cbResize_);\n    this.domMain.appendChild(this.topbar.domTopbar);\n\n    this._updateSidebarsPosition();\n    this.topbar._updateViewportPosition(this.viewport);\n    return this.topbar;\n  }\n\n  setVisibility(visible) {\n    this.domMain.hidden = !visible;\n    this._onWindowResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GuiMain);\n\n\n//# sourceURL=webpack://yagui/./src/GuiMain.js?")},"./src/containers/BaseContainer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_Button__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/Button */ "./src/widgets/Button.js");\n/* harmony import */ var widgets_Checkbox__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/Checkbox */ "./src/widgets/Checkbox.js");\n/* harmony import */ var widgets_Color__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! widgets/Color */ "./src/widgets/Color.js");\n/* harmony import */ var widgets_Combobox__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! widgets/Combobox */ "./src/widgets/Combobox.js");\n/* harmony import */ var widgets_Slider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! widgets/Slider */ "./src/widgets/Slider.js");\n/* harmony import */ var widgets_Title__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! widgets/Title */ "./src/widgets/Title.js");\n\n\n\n\n\n\n\n// label : 36%\n// slider : bar 52% + margin 2% + input 10%\n// combobox : 64%\n// color : 64%\nclass BaseContainer {\n\n  constructor() {}\n\n  _addLine(name) {\n    var domLine = document.createElement(\'li\');\n    domLine.innerHTML = name || \'\';\n    this.domUl.appendChild(domLine);\n    return domLine;\n  }\n\n  _createLabel(name) {\n    var domLabel = document.createElement(\'label\');\n    domLabel.className = \'gui-label-side\';\n    domLabel.innerHTML = name || \'\';\n    return domLabel;\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  addTitle(name) {\n    var widget = new widgets_Title__WEBPACK_IMPORTED_MODULE_5__["default"](name);\n    this.domUl.appendChild(widget.domText);\n    return widget;\n  }\n\n  addCheckbox(name, valOrObject, callbackOrKey) {\n    var widget = new widgets_Checkbox__WEBPACK_IMPORTED_MODULE_1__["default"](valOrObject, callbackOrKey);\n    var domLine = this._addLine();\n    domLine.className += \' gui-pointerOnHover gui-glowOnHover\';\n    var domLabel = this._createLabel(name);\n    domLabel.style.overflow = \'visible\';\n    domLabel.className += \' gui-pointerOnHover\';\n    domLine.appendChild(domLabel);\n    domLine.appendChild(widget.domCheckbox);\n    domLine.appendChild(widget.domLabelCheckbox);\n    domLine.addEventListener(\'mousedown\', widget._onMouseDown.bind(widget));\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addCombobox(name, valOrObject, callbackOrKey, options) {\n    var widget = new widgets_Combobox__WEBPACK_IMPORTED_MODULE_3__["default"](valOrObject, callbackOrKey, options);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    else widget.domSelect.style.width = \'100%\';\n    domLine.appendChild(widget.domSelect);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addSlider(name, valOrObject, callbackOrKey, min, max, step) {\n    var widget = new widgets_Slider__WEBPACK_IMPORTED_MODULE_4__["default"](valOrObject, callbackOrKey, min, max, step);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    domLine.appendChild(widget.domInputText);\n    domLine.appendChild(widget.domSlider);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addColor(name, valOrObject, callbackOrKey) {\n    var widget = new widgets_Color__WEBPACK_IMPORTED_MODULE_2__["default"](valOrObject, callbackOrKey);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    else widget.domColor.style.width = \'100%\';\n    domLine.appendChild(widget.domColor);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addButton(name, callbackOrObject, key) {\n    var widget = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name, callbackOrObject, key);\n    var domLine = this._addLine();\n    domLine.appendChild(widget.domButton);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addDualButton(name1, name2, callbackOrObject1, callbackOrObject2, key1, key2) {\n    var widget1 = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name1, callbackOrObject1, key1);\n    var widget2 = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name2, callbackOrObject2, key2);\n    var domLine = this._addLine();\n    domLine.appendChild(widget2.domButton);\n    domLine.appendChild(widget1.domButton);\n    var style1 = widget1.domButton.style;\n    var style2 = widget2.domButton.style;\n    style1.width = style2.width = \'49%\';\n    style1.marginRight = style2.marginLeft = \'1%\';\n    widget1._setDomContainer(domLine);\n    widget2._setDomContainer(domLine);\n    return [widget1, widget2];\n  }\n\n  setVisibility(visible) {\n    if (!this.domContainer) return;\n    this.domContainer.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (BaseContainer);\n\n\n//# sourceURL=webpack://yagui/./src/containers/BaseContainer.js?')},"./src/containers/Folder.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/BaseContainer */ \"./src/containers/BaseContainer.js\");\n\n\nclass Folder extends containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name) {\n    super();\n\n    this.domUl = document.createElement('ul');\n    this.domUl.setAttribute('opened', true);\n\n    var domTitle = document.createElement('label');\n    domTitle.innerHTML = name || '';\n\n    domTitle.addEventListener('mousedown', this._onMouseDown.bind(this));\n\n    this.domUl.appendChild(domTitle);\n    this.isOpen = true;\n  }\n\n  _onMouseDown() {\n    this.isOpen = !this.isOpen;\n    this.domUl.setAttribute('opened', this.isOpen);\n  }\n\n  open() {\n    this.isOpen = true;\n    this.domUl.setAttribute('opened', true);\n  }\n\n  close() {\n    this.isOpen = false;\n    this.domUl.setAttribute('opened', false);\n  }\n\n  setVisibility(visible) {\n    if (!visible) this.domUl.setAttribute('opened', false);\n    else if (this.isOpen) this.domUl.setAttribute('opened', true);\n    this.domUl.style.height = visible ? 'auto' : '0px';\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Folder);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Folder.js?")},"./src/containers/Menu.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/BaseContainer */ "./src/containers/BaseContainer.js");\n/* harmony import */ var widgets_MenuButton__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/MenuButton */ "./src/widgets/MenuButton.js");\n\n\n\nclass Menu extends containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__["default"] {\n\n  constructor() {\n    super();\n\n    this.domUl = document.createElement(\'ul\');\n  }\n\n  addButton(name, callbackOrObject, shortcutOrKey, shortcut) {\n    var widget = new widgets_MenuButton__WEBPACK_IMPORTED_MODULE_1__["default"](callbackOrObject, shortcutOrKey, shortcut);\n    var domLine = this._addLine(name);\n    domLine.appendChild(widget.domSpan);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addSlider(name, valOrObject, callbackOrKey, min, max, step) {\n    var wid = super.addSlider(name, valOrObject, callbackOrKey, min, max, step);\n    // label 36% + slider ?% + 2% + input 18%\n    wid.domInputText.style.width = \'18%\';\n    wid.domSlider.style.width = name ? \'44%\' : \'80%\';\n    return wid;\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (Menu);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Menu.js?')},"./src/containers/Sidebar.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Folder__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Folder */ \"./src/containers/Folder.js\");\n\n\nclass Sidebar {\n\n  constructor(callbackResize) {\n    this.domSidebar = document.createElement('div');\n    this.domSidebar.className = 'gui-sidebar';\n\n    this.domResize = document.createElement('div');\n    this.domResize.className = 'gui-resize';\n\n    this.isDragging = false;\n    this.mouseX = 0;\n    this.domResize.addEventListener('mousedown', this._onMouseDown.bind(this));\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this));\n\n    this.callbackResize = callbackResize;\n    this.isOnTheRight = false;\n  }\n\n  _setTop(nb) {\n    this.domSidebar.style.top = this.domResize.style.top = nb + 'px';\n  }\n\n  _onTheRight() {\n    this.isOnTheRight = true;\n    this.domSidebar.style.right = 0;\n    this.domSidebar.style.borderRight = 0;\n    this.domSidebar.style.borderLeft = 'double';\n    this.domSidebar.style.borderColor = 'rgba(255,255,255,0.3)';\n    this.domResize.style.left = 'auto';\n    this.domResize.style.right = this.domSidebar.offsetWidth + 'px';\n    this.domResize.style.marginRight = '-3px';\n  }\n\n  _onMouseDown(ev) {\n    this.isDragging = true;\n    this.mouseX = ev.clientX;\n  }\n\n  _updateViewportPosition(viewport) {\n    var w = this.domSidebar.hidden ? 0 : this.domSidebar.offsetWidth;\n    if (this.isOnTheRight) {\n      viewport.style.width = (viewport.clientWidth - w) + 'px';\n    } else {\n      viewport.style.left = (this.domSidebar.offsetLeft + w) + 'px';\n      viewport.style.width = (viewport.clientWidth - w) + 'px';\n    }\n  }\n\n  _onMouseMove(ev) {\n    if (this.isDragging === false) return;\n    var mouseX = ev.clientX;\n    var delta = mouseX - this.mouseX;\n    if (this.isOnTheRight) delta = -delta;\n    var widthBar = Math.max(50, this.domSidebar.offsetWidth + delta);\n\n    var val = widthBar + 'px';\n    this.domSidebar.style.width = val;\n    if (this.isOnTheRight) this.domResize.style.right = this.domSidebar.offsetWidth + 'px';\n    else this.domResize.style.left = val;\n\n    this.mouseX = mouseX;\n    this.callbackResize();\n  }\n\n  _onMouseUp() {\n    this.isDragging = false;\n  }\n\n  addMenu(name) {\n    var folder = new containers_Folder__WEBPACK_IMPORTED_MODULE_0__[\"default\"](name);\n    this.domSidebar.appendChild(folder.domUl);\n    return folder;\n  }\n\n  setVisibility(visible) {\n    this.domSidebar.hidden = !visible;\n    this.domResize.hidden = !visible;\n    this.callbackResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Sidebar);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Sidebar.js?")},"./src/containers/Topbar.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Menu__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Menu */ "./src/containers/Menu.js");\n/* harmony import */ var utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! utils/EditStyle */ "./src/utils/EditStyle.js");\n\n\n\nclass Topbar {\n\n  constructor(callbackResize) {\n    this.domTopbar = document.createElement(\'div\');\n    this.domTopbar.className = \'gui-topbar\';\n\n    this.domUl = document.createElement(\'ul\');\n    this.domTopbar.appendChild(this.domUl);\n\n    this.callbackResize = callbackResize;\n    this.uiExtra = {};\n  }\n\n  _updateViewportPosition(viewport) {\n    var h = this.domTopbar.hidden ? 0 : this.domTopbar.offsetHeight;\n    viewport.style.top = h + \'px\';\n    viewport.style.height = (viewport.clientHeight - h) + \'px\';\n  }\n\n  _onChangeColor(callback, color) {\n    callback(color);\n    this.uiExtra.overallColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, true);\n    this.uiExtra.widgetColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, true);\n    this.uiExtra.backColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curBackgroundColor, true);\n    this.uiExtra.textColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curTextColor, true);\n  }\n\n  addMenu(name) {\n    var menu = new containers_Menu__WEBPACK_IMPORTED_MODULE_0__["default"]();\n    var li = document.createElement(\'li\');\n    li.setAttribute(\'onclick\', \'void(0)\'); // iOS trick to trigger click on hover\n    li.innerHTML = name || \'\';\n    this.domUl.appendChild(li);\n    li.appendChild(menu.domUl);\n    menu._setDomContainer(li);\n    return menu;\n  }\n\n  addExtra() {\n    var cb = this._onChangeColor;\n    var menu = this.addMenu(\'Extra UI\');\n    var ext = this.uiExtra;\n    menu.addTitle(\'Overall\');\n    ext.overallColor = menu.addColor(\'\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeOverallColor));\n\n    menu.addTitle(\'Advanced\');\n    ext.widgetColor = menu.addColor(\'Widget\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeWidgetsColor));\n    ext.backColor = menu.addColor(\'Back\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curBackgroundColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeBackgroundColor));\n    ext.textColor = menu.addColor(\'Text\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curTextColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeTextColor));\n    ext.showBorder = menu.addCheckbox(\'Border\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curShowBorder, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeDisplayBoorder);\n    return menu;\n  }\n\n  setVisibility(visible) {\n    this.domTopbar.hidden = !visible;\n    this.callbackResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (Topbar);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Topbar.js?')},"./src/utils/EditStyle.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/GuiUtils */ \"./src/utils/GuiUtils.js\");\n\n\nvar EditStyle = {};\n\nEditStyle.refRules = {};\n\nvar yaguiSheet;\nvar findSheet = function () {\n  if (yaguiSheet) return yaguiSheet;\n  var sheets = document.styleSheets;\n  for (var i = 0, nb = sheets.length; i < nb; ++i) {\n    var href = sheets[i].href;\n    if (href && href.indexOf('yagui.css') !== -1) {\n      yaguiSheet = sheets[i];\n      return yaguiSheet;\n    }\n  }\n  return;\n};\n\nvar editStyle = function (selector, key, value) {\n  var sheet = findSheet();\n  if (!sheet)\n    return;\n  var rules = sheet.cssRules || sheet.rules;\n  var rule = EditStyle.refRules[selector];\n  if (!rule) {\n    var i = 0;\n    var len = rules.length;\n    for (i = 0; i < len; ++i) {\n      if (rules[i].selectorText === selector) break;\n    }\n    if (i === len) return false;\n    rule = EditStyle.refRules[selector] = rules[i];\n  }\n  if (rule)\n    rule.style[key] = value;\n};\n\nEditStyle.changeWidgetsColor = function (color) {\n  var str = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color);\n  // button\n  editStyle('.gui-button', 'background', str);\n  // select\n  editStyle('.gui-select', 'background', str);\n  // slider\n  editStyle('.gui-slider > div', 'background', str);\n  EditStyle._curWidgetColor = color;\n};\n\nEditStyle.changeDisplayBoorder = function (bool) {\n  var str = bool ? '1px solid #000' : '0';\n  editStyle('.gui-button', 'border', str);\n  // select\n  editStyle('.gui-select', 'border', str);\n  // slider\n  editStyle('.gui-slider', 'border', str);\n  editStyle('.gui-input-number', 'border', str);\n  // folder\n  editStyle('.gui-sidebar > ul > label', 'borderTop', str);\n  editStyle('.gui-sidebar > ul > label', 'borderBottom', str);\n  // side bar\n  editStyle('.gui-sidebar', 'borderLeft', str);\n  editStyle('.gui-sidebar', 'borderRight', str);\n  // top bar\n  editStyle('.gui-topbar', 'borderBottom', str);\n  EditStyle._curShowBorder = bool;\n};\n\nEditStyle.changeBackgroundColor = function (color) {\n  // side bar\n  editStyle('.gui-sidebar', 'background', utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color));\n  // top bar\n  var colTop = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorMult(color, 0.5));\n  editStyle('.gui-topbar', 'background', colTop);\n  editStyle('.gui-topbar ul > li > ul', 'background', colTop);\n  EditStyle._curBackgroundColor = color;\n};\n\nEditStyle.changeTextColor = function (color) {\n  var strColor = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color);\n  editStyle('*', 'color', strColor);\n  editStyle('.gui-sidebar > ul > label', 'color', strColor);\n  EditStyle._curTextColor = color;\n};\n\nEditStyle.changeOverallColor = function (color) {\n  EditStyle.changeWidgetsColor(color);\n  var bgCol = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorMult(color, 0.5);\n  bgCol.length = 3;\n  EditStyle.changeBackgroundColor(bgCol);\n\n  var texCol = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorAdd(color, 0.5);\n  for (var i = 0; i < 3; ++i) texCol[i] = Math.min(0.8, texCol[i]);\n  EditStyle.changeTextColor(texCol);\n\n  EditStyle._curWidgetColor = color;\n  EditStyle._curBackgroundColor = bgCol;\n  EditStyle._curTextColor = texCol;\n};\n\n// init value\nEditStyle._curTextColor = [0.73, 0.73, 0.73, 1.0];\nEditStyle._curWidgetColor = [0.32, 0.37, 0.39, 1.0];\nEditStyle._curBackgroundColor = [0.24, 0.24, 0.24];\nEditStyle._curShowBorder = false;\n\nEditStyle.changeOverallColor([0.3, 0.34, 0.4, 1.0]);\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (EditStyle);\n\n\n//# sourceURL=webpack://yagui/./src/utils/EditStyle.js?")},"./src/utils/GuiUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\nvar GuiUtils = {};\n\nGuiUtils.rgbToHsv = function (rgb) {\n  var r = rgb[0];\n  var g = rgb[1];\n  var b = rgb[2];\n  var maxRGB = Math.max(r, g, b);\n  var minRGB = Math.min(r, g, b);\n  if (minRGB === maxRGB) return [0, 0, minRGB];\n  var d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\n  var h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\n  return [(h - d / (maxRGB - minRGB)) / 6, (maxRGB - minRGB) / maxRGB, maxRGB];\n};\n\nGuiUtils.hsvToRgb = function (hsv) {\n  var h = hsv[0] * 6;\n  var s = hsv[1];\n  var v = hsv[2];\n  var i = Math.floor(h);\n  var f = h - i;\n  var p = v * (1.0 - s);\n  var q = v * (1.0 - f * s);\n  var t = v * (1.0 - (1.0 - f) * s);\n  var mod = i % 6;\n  if (mod === 0) return [v, t, p];\n  else if (mod === 1) return [q, v, p];\n  else if (mod === 2) return [p, v, t];\n  else if (mod === 3) return [p, q, v];\n  else if (mod === 4) return [t, p, v];\n  else return [v, p, q];\n};\n\nGuiUtils.getValidColor = function (color) {\n  for (var i = 0, len = color.length; i < len; ++i) color[i] = Math.max(0.0, Math.min(1.0, color[i]));\n  return color;\n};\n\nGuiUtils.getStrColor = function (color) {\n  if (color.length === 3) return GuiUtils.rgbToHex(color);\n  return 'rgba(' + Math.round(color[0] * 255) + ',' + Math.round(color[1] * 255) + ',' + Math.round(color[2] * 255) + ',' + color[3] + ')';\n};\n\nGuiUtils.getColorMult = function (color, fac) {\n  var out = [color[0] * fac, color[1] * fac, color[2] * fac];\n  if (color.length === 4) out.push(color[3]);\n  return GuiUtils.getValidColor(out);\n};\n\nGuiUtils.getColorAdd = function (color, add) {\n  var out = [color[0] + add, color[1] + add, color[2] + add];\n  if (color.length === 4) out.push(color[3]);\n  return GuiUtils.getValidColor(out);\n};\n\nGuiUtils.rgbToHex = function (rgb) {\n  var h = '#';\n  for (var i = 0; i < 3; ++i) {\n    var c = Math.round(rgb[i] * 255).toString(16);\n    h += c.length === 1 ? '0' + c : c;\n  }\n  return h;\n};\n\nGuiUtils.hexToRgb = function (hex) {\n  var i = 0;\n  if (hex[0] === '#') hex = hex.slice(1);\n  var h = hex;\n  if (hex.length > 6) h = hex.slice(0, 6);\n  else if (hex.length < 6) {\n    h = '';\n    for (i = 0; i < 3; ++i)\n      h += hex[i] ? hex[i] + hex[i] : '00';\n  }\n  var col = [0, 0, 0];\n  for (i = 0; i < 3; ++i) {\n    var c = parseInt(h[i * 2] + h[i * 2 + 1], 16);\n    col[i] = (c !== c ? 0 : c) / 255;\n  }\n  return col;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GuiUtils);\n\n\n//# sourceURL=webpack://yagui/./src/utils/GuiUtils.js?")},"./src/widgets/BaseWidget.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\nclass BaseWidget {\n\n  constructor() {}\n\n  _getInitialValue(valOrObject, callbackOrKey) {\n    if (typeof callbackOrKey !== 'string') return valOrObject;\n    return valOrObject[callbackOrKey];\n  }\n\n  _getCheckCallback(valOrObject, callbackOrKey) {\n    if (typeof callbackOrKey !== 'string') return callbackOrKey;\n    return function (val) {\n      valOrObject[callbackOrKey] = val;\n    };\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  setCallback(callback) {\n    this.callback = callback;\n  }\n\n  setVisibility(visible) {\n    if (!this.domContainer) return;\n    this.domContainer.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (BaseWidget);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/BaseWidget.js?")},"./src/widgets/Button.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Button extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name, callbackOrObject, key) {\n    super();\n\n    var callback = key ? callbackOrObject[key].bind(callbackOrObject) : callbackOrObject;\n\n    this.domButton = document.createElement('button');\n    this.domButton.className = 'gui-button';\n    this.domButton.innerHTML = name || '';\n    this.domButton.addEventListener('click', this._onClick.bind(this));\n\n    this.setCallback(callback);\n  }\n\n  setEnable(bool) {\n    this.domButton.disabled = bool === undefined ? false : !bool;\n  }\n\n  _onClick() {\n    if (this.callback) this.callback();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Button);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Button.js?")},"./src/widgets/Checkbox.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Checkbox extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    this.domCheckbox = document.createElement('input');\n    this.domCheckbox.className = 'gui-input-checkbox';\n    this.domCheckbox.type = 'checkbox';\n\n    this.domLabelCheckbox = document.createElement('label');\n\n    this.setValue(value === undefined ? true : value);\n    this.setCallback(callback);\n  }\n\n  _onMouseDown() {\n    this.setValue(!this.domCheckbox.checked);\n  }\n\n  setValue(val, ignoreCB) {\n    this.domCheckbox.checked = val;\n    if (!ignoreCB && this.callback) this.callback(val);\n  }\n\n  getValue() {\n    return this.domCheckbox.checked;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Checkbox);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Checkbox.js?")},"./src/widgets/Color.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/GuiUtils */ \"./src/utils/GuiUtils.js\");\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\n\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nvar urlAlpha = 'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAChJREFUeNpiPHPmDAMMGBsbw9lMDDgA6RKM%2F%2F%2F%2Fh3POnj1LCzsAAgwAQtYIcFfEyzkAAAAASUVORK5CYII%3D\")';\n\nclass Color extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    if (value) this.color = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getValidColor(value.slice());\n    else this.color = [1.0, 0.0, 0.0];\n\n    // container\n    this.domColor = document.createElement('div');\n    this.domColor.className = 'gui-widget-color';\n\n    // input text\n    this.domInputColor = document.createElement('input');\n    this.domPopup = document.createElement('div');\n\n    // hue picker\n    this.domHue = document.createElement('div');\n    this.domHue.className = 'gui-color-hue';\n    this.domHueKnob = document.createElement('div');\n    this.domHueKnob.className = 'gui-knob-hue';\n\n    // saturation picker\n    this.domSaturation = document.createElement('div');\n    this.domSaturation.className = 'gui-color-saturation';\n    var zAlphaSat = document.createElement('div');\n    this.domSaturation.appendChild(zAlphaSat);\n    this.domSaturationKnob = document.createElement('div');\n    this.domSaturationKnob.className = 'gui-knob-saturation';\n\n    this.domHue.appendChild(this.domHueKnob);\n    this.domPopup.appendChild(this.domSaturationKnob);\n    this.domPopup.appendChild(this.domSaturation);\n    this.domPopup.appendChild(this.domHue);\n    this.domColor.appendChild(this.domInputColor);\n    this.domColor.appendChild(this.domPopup);\n\n    this._hueGradient(this.domHue);\n    this._linearGradient(zAlphaSat, 'top', 'rgba(0,0,0,0)', '#000');\n\n    this.domColor.addEventListener('keydown', this._onInputDown.bind(this));\n    this.domSaturation.addEventListener('mousedown', this._onSaturationDown.bind(this));\n    this.domHue.addEventListener('mousedown', this._onHueDown.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this));\n    window.addEventListener('mouseout', this._onMouseUp.bind(this));\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n\n    // alpha picker\n    this.hasAlpha = this.color.length === 4;\n    this.alpha = 1.0;\n    if (this.hasAlpha) {\n      this.domPopup.style.width = '142px';\n      this.domAlpha = document.createElement('div');\n      this.domAlpha.className = 'gui-color-alpha';\n      this.domAlphaKnob = document.createElement('div');\n      this.domAlphaKnob.className = 'gui-knob-alpha';\n\n      this._alphaGradient(this.domAlpha, 'top', 'rgba(0,0,0,1.0)', 'rgba(0,0,0,0.0)');\n\n      this.domAlpha.addEventListener('mousedown', this._onAlphaDown.bind(this));\n      this.domAlpha.appendChild(this.domAlphaKnob);\n      this.domPopup.appendChild(this.domAlpha);\n    }\n\n    this.editHue = this.editSaturation = this.editAlpha = false;\n    this.widgetHeight = this.widgetWidth = 100;\n    this.setValue(this.color);\n    this.setCallback(callback);\n  }\n\n  _onInputDown(ev) {\n    ev.stopPropagation();\n    if (ev.keyCode === 13)\n      this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hexToRgb(ev.target.value));\n  }\n\n  _onUpdateSaturation(ev) {\n    var rect = this.domSaturation.getBoundingClientRect();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(this.getValue());\n    hsv[1] = Math.min(1.0, Math.max(0.0, (ev.clientX - rect.left) / rect.width));\n    hsv[2] = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.width));\n    this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv), false, true);\n    this._updateGui();\n  }\n\n  _onUpdateHue(ev) {\n    var rect = this.domHue.getBoundingClientRect();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(this.getValue());\n    hsv[0] = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.height));\n    this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv), false, true);\n    this._updateGui();\n  }\n\n  _onUpdateAlpha(ev) {\n    var rect = this.domAlpha.getBoundingClientRect();\n    var col = this.getValue();\n    col[3] = this.alpha = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.height));\n    this.setValue(col, false, true);\n    this._updateGui();\n  }\n\n  _updateGui() {\n    var color = this.getValue();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(color);\n\n    this.domSaturationKnob.style.marginLeft = this.widgetWidth * hsv[1] - 7 + 'px';\n    this.domSaturationKnob.style.marginTop = this.widgetHeight * (1.0 - hsv[2]) - 7 + 'px';\n\n    hsv[1] = hsv[2] = 1.0;\n    this._linearGradient(this.domSaturation, 'left', '#fff', utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv)));\n\n    this.domHueKnob.style.marginTop = (1.0 - hsv[0]) * this.widgetHeight + 'px';\n\n    if (this.hasAlpha && color[3] !== undefined)\n      this.domAlphaKnob.style.marginTop = (1.0 - this.alpha) * this.widgetHeight + 'px';\n  }\n\n  _onMouseMove(ev) {\n    if (!this.editSaturation && !this.editHue && !this.editAlpha) return;\n    if (this.editSaturation) return this._onUpdateSaturation(ev);\n    if (this.editHue) return this._onUpdateHue(ev);\n    if (this.editAlpha) return this._onUpdateAlpha(ev);\n  }\n\n  _onSaturationDown(ev) {\n    this.editSaturation = true;\n    this._onMouseMove(ev);\n  }\n\n  _onHueDown(ev) {\n    this.editHue = true;\n    this._onMouseMove(ev);\n  }\n\n  _onAlphaDown(ev) {\n    this.editAlpha = true;\n    this._onMouseMove(ev);\n  }\n\n  _onMouseUp() {\n    this.editHue = this.editSaturation = this.editAlpha = false;\n  }\n\n  _hueGradient(dom) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  }\n\n  _alphaGradient(dom, dir, col1, col2) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(' + dir + ', ' + col1 + ',' + col2 + '),' + urlAlpha + ';';\n  }\n\n  _linearGradient(dom, dir, col1, col2) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(' + dir + ', ' + col1 + ' 0%, ' + col2 + ' 100%);';\n  }\n\n  setValue(color, ignoreCB, ignoreUI) {\n    var c = this.color;\n    for (var i = 0, nbC = color.length; i < nbC; ++i)\n      c[i] = color[i];\n\n    var hex = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHex(color);\n    this.domInputColor.value = hex;\n    if (this.hasAlpha) {\n      if (color.length >= 4) this.alpha = color[3];\n      else color.push(this.alpha);\n      var col = 'rgba(' + parseInt(color[0] * 255, 10) + ',' + parseInt(color[1] * 255, 10) + ',' + parseInt(color[2] * 255, 10) + ',' + this.alpha + ')';\n      this._alphaGradient(this.domInputColor, '0deg', col, col);\n    } else {\n      this.domInputColor.style.background = hex;\n    }\n\n    // color of text\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(color);\n    this.domSaturationKnob.style.borderColor = (hsv[2] < 0.5 || hsv[1] > 0.5) ? '#fff' : '#000';\n    this.domInputColor.style.color = (this.alpha > 0.2 && (hsv[2] < 0.5 || hsv[1] > 0.5)) ? '#fff' : '#000';\n    if (!ignoreUI) this._updateGui();\n    if (!ignoreCB && this.callback) this.callback(color);\n  }\n\n  getValue() {\n    return this.color;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Color);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Color.js?")},"./src/widgets/Combobox.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Combobox extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey, options) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    options = options || {};\n    value = value !== undefined ? value : options[0];\n\n    this.isArray = options.length !== undefined;\n\n    this.domSelect = document.createElement('select');\n    this.domSelect.className = 'gui-select';\n    this.addOptions(options);\n\n    this.domSelect.addEventListener('change', this._onChange.bind(this));\n    this.setValue(value);\n    this.setCallback(callback);\n  }\n\n  _parseValue(val) {\n    return this.isArray ? parseInt(val, 10) : val;\n  }\n\n  _onChange(ev) {\n    this.setValue(ev.target.value);\n  }\n\n  addOptions(options) {\n    var keys = Object.keys(options);\n    for (var i = 0; i < keys.length; ++i) {\n      var opt = document.createElement('option');\n      opt.innerHTML = options[keys[i]];\n      opt.value = keys[i];\n      this.domSelect.appendChild(opt);\n    }\n  }\n\n  setValue(val, ignoreCB) {\n    this.domSelect.value = val;\n    if (!ignoreCB && this.callback) this.callback(this._parseValue(val));\n  }\n\n  getValue() {\n    return this._parseValue(this.domSelect.value);\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Combobox);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Combobox.js?")},"./src/widgets/MenuButton.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass MenuButton extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(callbackOrObject, shortcutOrKey, shortcut) {\n    super();\n\n    var callback = callbackOrObject;\n    if (callback && typeof callback !== 'function') callback = callbackOrObject[shortcutOrKey].bind(callbackOrObject);\n    else shortcut = shortcutOrKey;\n\n    this.domSpan = document.createElement('span');\n    this.domSpan.className = 'shortcut';\n    this.domSpan.innerHTML = shortcut || '';\n\n    this.setCallback(callback);\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n    container.addEventListener('click', this._onClick.bind(this));\n  }\n\n  _onClick() {\n    if (this.callback) this.callback();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (MenuButton);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/MenuButton.js?")},"./src/widgets/Slider.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Slider extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey, min, max, step) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    value = value !== undefined ? value : 100;\n    min = min !== undefined ? min : 0;\n    max = max !== undefined ? max : 200;\n    step = step !== undefined ? step : 1;\n\n    // slider\n    this.domSlider = document.createElement('div');\n    this.domSlider.className = 'gui-slider';\n    this.domSliderFill = document.createElement('div');\n    this.domSlider.appendChild(this.domSliderFill);\n\n    // text input\n    this.domInputText = document.createElement('input');\n    this.domInputText.className = 'gui-input-number';\n    this.domInputText.type = 'number';\n    this.min = this.domInputText.min = min;\n    this.max = this.domInputText.max = max;\n    this.step = this.domInputText.step = step;\n\n    this.domInputText.addEventListener('keydown', this._onKeyDown.bind(this));\n    this.domInputText.addEventListener('change', this._onInputText.bind(this));\n    this.domInputText.addEventListener('blur', this._onInputText.bind(this));\n    this.domSlider.addEventListener('mousedown', this._onMouseDown.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this), true);\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n\n    this.lastValue = value;\n    this.isDown = false;\n    this.setValue(value);\n    this.setCallback(callback);\n  }\n\n  _onInputText(ev) {\n    var val = parseFloat(ev.target.value);\n    if (val !== val || val === this.lastValue) return;\n    this.setValue(val);\n  }\n\n  _onKeyDown(ev) {\n    ev.stopPropagation();\n    if (ev.which === 13) // enter\n      this.domInputText.blur();\n  }\n\n  _onMouseMove(ev) {\n    ev.preventDefault();\n    if (!this.isDown)\n      return;\n    var rect = this.domSlider.getBoundingClientRect();\n    var val = this.min + (this.max - this.min) * ((ev.clientX - rect.left) / rect.width);\n    this.setValue(val);\n  }\n\n  _onMouseDown(ev) {\n    this.isDown = true;\n    this._onMouseMove(ev);\n  }\n\n  _onMouseUp() {\n    this.isDown = false;\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  getValue() {\n    return parseFloat(this.domInputText.value);\n  }\n\n  setValue(val, ignoreCB) {\n    this.lastValue = val;\n    val = Math.max(Math.min(val, this.max), this.min);\n    val = Math.round(val / this.step) * this.step;\n    this.domInputText.value = val;\n    var per = this.min;\n    if (this.max !== this.min) per = (val - this.min) / (this.max - this.min);\n    this.domSliderFill.style.width = 100 * per + '%';\n    if (!ignoreCB && this.callback) this.callback(val);\n  }\n\n  setMax(max) {\n    this.domInputText.max = this.max = max;\n    return this;\n  }\n\n  setMin(min) {\n    this.min = min;\n    return this;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Slider);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Slider.js?")},"./src/widgets/Title.js":function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Title extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name) {\n    super();\n\n    this.domText = document.createElement('div');\n    this.domText.innerHTML = name || '';\n    this.domText.className = 'group-title';\n  }\n\n  setText(text) {\n    this.domText.innerHTML = text;\n  }\n\n  setVisibility(visible) {\n    this.domText.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Title);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Title.js?")},"./src/yagui.js":function(module,exports,__webpack_require__){eval('var GuiMain = __webpack_require__(/*! GuiMain */ "./src/GuiMain.js").default;\n\nvar yagui = {\n  GuiMain: GuiMain\n};\n\nmodule.exports = yagui;\n\n\n//# sourceURL=webpack://yagui/./src/yagui.js?')}})},module.exports=factory()},386(){if(window.Map||(window.Map=function(){this.map={}},window.Map.prototype={set:function(e,t){this.map[e]=t},get:function(e){return this.map[e]}}),!Float32Array.prototype.slice){var e=function(e,t){return new this.constructor(this.subarray(e,t))};Int8Array.prototype.slice=e,Uint8Array.prototype.slice=e,Uint8ClampedArray.prototype.slice=e,Int16Array.prototype.slice=e,Uint16Array.prototype.slice=e,Int32Array.prototype.slice=e,Uint32Array.prototype.slice=e,Float32Array.prototype.slice=e,Float64Array.prototype.slice=e}String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.slice(-e.length)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});for(var t=["moz","webkit"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.requestAnimationFrame||window.alert("browser is too old. Probably no webgl there anyway")},622(e,t,r){"use strict";r.d(t,{A:()=>b});var i,s,a,n,o,l,c,h,u,d,_,p,g,m,f,v,A=r(989),T={normalizedMouse:function(e,t,r,i){return[2*e/r-1,1-2*t/i]},mouseOnUnitSphere:function(e){var t=e[0],r=e[1],i=1-t*t-r*r,s=[t,r,i>0?Math.sqrt(i):0];return A.S8(s,s)}};T.intersectionRayTriangleEdges=(i=1+1e-15,s=-1e-15,a=[0,0,0],n=[0,0,0],o=[0,0,0],function(e,t,r,l,c,h){A.$A(a,t,l);var u=A.Om(r,a);if(u>-1e-15&&u<1e-15)return-1;var d=1/u;A.jb(n,e,c);var _=A.Om(n,a)*d;if(_<s||_>i)return-1;A.$A(o,n,r);var p=A.Om(t,o)*d;if(p<s||_+p>i)return-1;var g=A.Om(l,o)*d;return g<s?-1:(h&&A.Ln(h,e,t,g),g)}),T.intersectionRayTriangle=(l=[0,0,0],c=[0,0,0],function(e,t,r,i,s,a){return A.jb(l,i,r),A.jb(c,s,r),T.intersectionRayTriangleEdges(e,t,l,c,r,a)}),T.distance2PointTriangleEdges=(h=[0,0,0],function(e,t,r,i,s,a,n,o){A.jb(h,i,e);var l,c,u,d,_,p=A.Om(h,t),g=A.Om(h,r),m=A.uE(h),f=Math.abs(s*n-a*a),v=a*g-n*p,T=a*p-s*g,b=4;if(v+T<=f)if(v<0)T<0?(b=4,p<0?(T=0,-p>=s?(v=1,l=s+2*p+m):l=p*(v=-p/s)+m):(v=0,g>=0?(T=0,l=m):-g>=n?(T=1,l=n+2*g+m):l=g*(T=-g/n)+m)):(b=3,v=0,g>=0?(T=0,l=m):-g>=n?(T=1,l=n+2*g+m):l=g*(T=-g/n)+m);else if(T<0)b=5,T=0,p>=0?(v=0,l=m):-p>=s?(v=1,l=s+2*p+m):l=p*(v=-p/s)+m;else{b=0;var M=1/f;l=(v*=M)*(s*v+a*(T*=M)+2*p)+T*(a*v+n*T+2*g)+m}else v<0?(b=2,(u=n+g)>(c=a+p)?(d=u-c)>=(_=s-2*a+n)?(v=1,T=0,l=s+2*p+m):l=(v=d/_)*(s*v+a*(T=1-v)+2*p)+T*(a*v+n*T+2*g)+m:(v=0,u<=0?(T=1,l=n+2*g+m):g>=0?(T=0,l=m):l=g*(T=-g/n)+m)):T<0?(b=6,(u=s+p)>(c=a+g)?(d=u-c)>=(_=s-2*a+n)?(T=1,v=0,l=n+2*g+m):l=(v=1-(T=d/_))*(s*v+a*T+2*p)+T*(a*v+n*T+2*g)+m:(T=0,u<=0?(v=1,l=s+2*p+m):p>=0?(v=0,l=m):l=p*(v=-p/s)+m)):(b=1,(d=n+g-a-p)<=0?(v=0,T=1,l=n+2*g+m):d>=(_=s-2*a+n)?(v=1,T=0,l=s+2*p+m):l=(v=d/_)*(s*v+a*(T=1-v)+2*p)+T*(a*v+n*T+2*g)+m);return l<0&&(l=0),o&&(o[0]=i[0]+v*t[0]+T*r[0],o[1]=i[1]+v*t[1]+T*r[1],o[2]=i[2]+v*t[2]+T*r[2],o[3]=b),l}),T.distance2PointTriangle=function(){var e=[0,0,0],t=[0,0,0];return function(r,i,s,a,n){A.jb(e,s,i),A.jb(t,a,i);var o=A.uE(e),l=A.Om(e,t),c=A.uE(t);return T.distance2PointTriangleEdges(r,e,t,i,o,l,c,n)}}(),T.pointInsideTriangle=(u=[0,0,0],d=[0,0,0],_=[0,0,0],p=[0,0,0],g=[0,0,0],function(e,t,r,i){A.jb(u,t,r),A.jb(d,t,i),A.jb(_,e,r),A.jb(p,e,i);var s=A.Il(A.$A(g,u,d)),a=A.Il(A.$A(g,u,_)),n=A.Il(A.$A(g,d,p)),o=A.Il(A.$A(g,_,p));return Math.abs(s-(a+n+o))<1e-20}),T.triangleInsideSphere=function(e,t,r,i,s){return T.distanceSqToSegment(e,r,i)<t||T.distanceSqToSegment(e,i,s)<t||T.distanceSqToSegment(e,r,s)<t},T.distanceSqToSegment=(m=[0,0,0],f=[0,0,0],function(e,t,r){A.jb(m,e,t),A.jb(f,r,t);var i=A.uE(f),s=A.Om(m,f)/i;return s<0?A.uE(m):s>1?A.uE(A.jb(m,e,r)):(m[0]=e[0]-t[0]-s*f[0],m[1]=e[1]-t[1]-s*f[1],m[2]=e[2]-t[2]-s*f[2],A.uE(m))}),T.signedAngle2d=function(e,t){var r=e[0],i=e[1],s=t[0],a=t[1];return Math.atan2(r*a-i*s,r*s+i*a)},T.pointPlaneDistance=function(){var e=[0,0,0];return function(t,r,i){return A.Om(A.jb(e,t,r),i)}}(),T.mirrorPoint=function(){var e=[0,0,0];return function(t,r,i){return A.jb(t,t,A.hs(e,i,2*T.pointPlaneDistance(t,r,i)))}}(),T.vertexOnLine=(v=[0,0,0],function(e,t,r){A.jb(v,r,t);var i=[0,0,0],s=A.Om(v,A.jb(i,e,t));return A.Ln(i,t,v,s/A.uE(v))}),T.intersectLinePlane=function(e,t,r,i,s){var a=A.Om(A.jb(s,e,r),i),n=A.Om(A.jb(s,t,r),i);if(a===n)return t;var o=-a/(n-a);return A.Ln(s,e,A.jb(s,t,e),o)},T.getPerpendicularVector=function(e){var t=[0,0,0];return 0===e[0]?t[0]=1:0===e[1]?t[1]=1:0===e[2]?t[2]=1:(t[0]=e[2],t[1]=e[2],t[2]=-e[0]-e[1],A.S8(t,t)),t};const b=T},846(){!function(e){"use strict";var t,r="File format is not recognized.",i="Error while reading zip file.",s="Error while reading file data.",a=524288,n="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(){this.crc=-1}function l(){}function c(e,t){var r,i;return r=new ArrayBuffer(e),i=new Uint8Array(r),t&&i.set(t,0),{buffer:r,array:i,view:new DataView(r)}}function h(){}function u(e){var t,r=this;r.size=0,r.init=function(i,s){var a=new Blob([e],{type:n});(t=new _(a)).init(function(){r.size=t.size,i()},s)},r.readUint8Array=function(e,r,i,s){t.readUint8Array(e,r,i,s)}}function d(t){var r,i=this;i.size=0,i.init=function(e){for(var s=t.length;"="==t.charAt(s-1);)s--;r=t.indexOf(",")+1,i.size=Math.floor(.75*(s-r)),e()},i.readUint8Array=function(i,s,a){var n,o=c(s),l=4*Math.floor(i/3),h=4*Math.ceil((i+s)/3),u=e.atob(t.substring(l+r,h+r)),d=i-3*Math.floor(l/4);for(n=d;n<d+s;n++)o.array[n-d]=u.charCodeAt(n);a(o.array)}}function _(e){var t=this;t.size=0,t.init=function(r){t.size=e.size,r()},t.readUint8Array=function(t,r,i,s){var a=new FileReader;a.onload=function(e){i(new Uint8Array(e.target.result))},a.onerror=s;try{a.readAsArrayBuffer(function(e,t,r){if(t<0||r<0||t+r>e.size)throw new RangeError("offset:"+t+", length:"+r+", size:"+e.size);return e.slice?e.slice(t,t+r):e.webkitSlice?e.webkitSlice(t,t+r):e.mozSlice?e.mozSlice(t,t+r):e.msSlice?e.msSlice(t,t+r):void 0}(e,t,r))}catch(e){s(e)}}}function p(){}function g(e){var r,i=this;i.init=function(e){r=new Blob([],{type:n}),e()},i.writeUint8Array=function(e,i){r=new Blob([r,t?e:e.buffer],{type:n}),i()},i.getData=function(t,i){var s=new FileReader;s.onload=function(e){t(e.target.result)},s.onerror=i,s.readAsText(r,e)}}function m(t){var r=this,i="",s="";r.init=function(e){i+="data:"+(t||"")+";base64,",e()},r.writeUint8Array=function(t,r){var a,n=s.length,o=s;for(s="",a=0;a<3*Math.floor((n+t.length)/3)-n;a++)o+=String.fromCharCode(t[a]);for(;a<t.length;a++)s+=String.fromCharCode(t[a]);o.length>2?i+=e.btoa(o):s=o,r()},r.getData=function(t){t(i+e.btoa(s))}}function f(e){var r,i=this;i.init=function(t){r=new Blob([],{type:e}),t()},i.writeUint8Array=function(i,s){r=new Blob([r,t?i:i.buffer],{type:e}),s()},i.getData=function(e){e(r)}}function v(e,t,r,i,s,n,o,l,c,h){var u,d,_,p=0,g=t.sn;function m(){e.removeEventListener("message",f,!1),l(d,_)}function f(t){var r=t.data,s=r.data,a=r.error;if(a)return a.toString=function(){return"Error: "+this.message},void c(a);if(r.sn===g)switch("number"==typeof r.codecTime&&(e.codecTime+=r.codecTime),"number"==typeof r.crcTime&&(e.crcTime+=r.crcTime),r.type){case"append":s?(d+=s.length,i.writeUint8Array(s,function(){v()},h)):v();break;case"flush":_=r.crc,s?(d+=s.length,i.writeUint8Array(s,function(){m()},h)):m();break;case"progress":o&&o(u+r.loaded,n);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",r)}}function v(){(u=p*a)<n?r.readUint8Array(s+u,Math.min(a,n-u),function(r){o&&o(u,n);var i=0===u?t:{sn:g};i.type="append",i.data=r,e.postMessage(i,[r.buffer]),p++},c):e.postMessage({sn:g,type:"flush"})}d=0,e.addEventListener("message",f,!1),v()}function A(e,t,r,i,s,n,l,c,h,u){var d,_=0,p=0,g="input"===n,m="output"===n,f=new o;!function n(){var o;if((d=_*a)<s)t.readUint8Array(i+d,Math.min(a,s-d),function(t){var i;try{i=e.append(t,function(e){l&&l(d+e,s)})}catch(e){return void h(e)}i?(p+=i.length,r.writeUint8Array(i,function(){_++,setTimeout(n,1)},u),m&&f.append(i)):(_++,setTimeout(n,1)),g&&f.append(t),l&&l(d,s)},h);else{try{o=e.flush()}catch(e){return void h(e)}o?(m&&f.append(o),p+=o.length,r.writeUint8Array(o,function(){c(p,f.get())},u)):c(p,f.get())}}()}function T(t,r,i,s,a,n,o,c,h,u,d){var _="input";e.zip.useWebWorkers&&o?v(t,{sn:r,codecClass:"NOOP",crcType:_},i,s,a,n,h,c,u,d):A(new l,i,s,a,n,_,h,c,u,d)}function b(e){var t,r,i="",s=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)i+=(r=255&e.charCodeAt(t))>127?s[r-128]:String.fromCharCode(r);return i}function M(e){return decodeURIComponent(escape(e))}function y(e){var t,r="";for(t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}function E(e,t,r,i,s){e.version=t.view.getUint16(r,!0),e.bitFlag=t.view.getUint16(r+2,!0),e.compressionMethod=t.view.getUint16(r+4,!0),e.lastModDateRaw=t.view.getUint32(r+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,r=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&r)>>11,(2016&r)>>5,2*(31&r),0)}catch(e){}}(e.lastModDateRaw),1&~e.bitFlag?((i||8&~e.bitFlag)&&(e.crc32=t.view.getUint32(r+10,!0),e.compressedSize=t.view.getUint32(r+14,!0),e.uncompressedSize=t.view.getUint32(r+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(r+22,!0),e.extraFieldLength=t.view.getUint16(r+24,!0)):s("File is using Zip64 (4gb+ file size).")):s("File contains encrypted entry.")}function S(e){return unescape(encodeURIComponent(e))}function R(e){var t,r=[];for(t=0;t<e.length;t++)r.push(e.charCodeAt(t));return r}function x(t,r,i,a){var n={},o=[],l=0,h=0;function u(e){i(e||"Error while writing zip file.")}function d(e){i(e||s)}var _={add:function(r,s,_,p,g){var m,f,b,M=this._worker;function y(e,r){var i=c(16);l+=e||0,i.view.setUint32(0,1347094280),void 0!==r&&(m.view.setUint32(10,r,!0),i.view.setUint32(4,r,!0)),s&&(i.view.setUint32(8,e,!0),m.view.setUint32(14,e,!0),i.view.setUint32(12,s.size,!0),m.view.setUint32(18,s.size,!0)),t.writeUint8Array(i.array,function(){l+=16,_()},u)}function E(){var _;g=g||{},r=r.trim(),g.directory&&"/"!=r.charAt(r.length-1)&&(r+="/"),n.hasOwnProperty(r)?i("File already exists."):(f=R(S(r)),o.push(r),b=g.lastModDate||new Date,m=c(26),n[r]={headerArray:m.array,directory:g.directory,filename:f,offset:l,comment:R(S(g.comment||""))},m.view.setUint32(0,335546376),g.version&&m.view.setUint8(0,g.version),a||0===g.level||g.directory||m.view.setUint16(4,2048),m.view.setUint16(6,(b.getHours()<<6|b.getMinutes())<<5|b.getSeconds()/2,!0),m.view.setUint16(8,(b.getFullYear()-1980<<4|b.getMonth()+1)<<5|b.getDate(),!0),m.view.setUint16(22,f.length,!0),(_=c(30+f.length)).view.setUint32(0,1347093252),_.array.set(m.array,4),_.array.set(f,30),l+=_.array.length,t.writeUint8Array(_.array,function(){s?a||0===g.level?T(M,h++,s,t,0,s.size,!0,y,p,d,u):function(t,r,i,s,a,n,o,l,c){var h="input";e.zip.useWebWorkers?v(t,{sn:r,options:{level:a},codecClass:"Deflater",crcType:h},i,s,0,i.size,o,n,l,c):A(new e.zip.Deflater,i,s,0,i.size,h,o,n,l,c)}(M,h++,s,t,g.level,y,p,d,u):y()},u))}s?s.init(E,d):E()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var r,i,s,a=0,h=0;for(i=0;i<o.length;i++)a+=46+(s=n[o[i]]).filename.length+s.comment.length;for(r=c(a+22),i=0;i<o.length;i++)s=n[o[i]],r.view.setUint32(h,1347092738),r.view.setUint16(h+4,5120),r.array.set(s.headerArray,h+6),r.view.setUint16(h+32,s.comment.length,!0),s.directory&&r.view.setUint8(h+38,16),r.view.setUint32(h+42,s.offset,!0),r.array.set(s.filename,h+46),r.array.set(s.comment,h+46+s.filename.length),h+=46+s.filename.length+s.comment.length;r.view.setUint32(h,1347093766),r.view.setUint16(h+8,o.length,!0),r.view.setUint16(h+10,o.length,!0),r.view.setUint32(h+12,a,!0),r.view.setUint32(h+16,l,!0),t.writeUint8Array(r.array,function(){t.getData(e)},u)},_worker:null};e.zip.useWebWorkers?w("deflater",function(e){_._worker=e,r(_)},function(e){i(e)}):r(_)}o.prototype.append=function(e){for(var t=0|this.crc,r=this.table,i=0,s=0|e.length;i<s;i++)t=t>>>8^r[255&(t^e[i])];this.crc=t},o.prototype.get=function(){return~this.crc},o.prototype.table=function(){var e,t,r,i=[];for(e=0;e<256;e++){for(r=e,t=0;t<8;t++)1&r?r=r>>>1^3988292384:r>>>=1;i[e]=r}return i}(),l.prototype.append=function(e,t){return e},l.prototype.flush=function(){},u.prototype=new h,u.prototype.constructor=u,d.prototype=new h,d.prototype.constructor=d,_.prototype=new h,_.prototype.constructor=_,p.prototype.getData=function(e){e(this.data)},g.prototype=new p,g.prototype.constructor=g,m.prototype=new p,m.prototype.constructor=m,f.prototype=new p,f.prototype.constructor=f;var C={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function w(t,r,i){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var s,a,n;if(e.zip.workerScripts){if(s=e.zip.workerScripts[t],!Array.isArray(s))return void i(new Error("zip.workerScripts."+t+" is not an array!"));a=s,n=document.createElement("a"),s=a.map(function(e){return n.href=e,n.href})}else(s=C[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+s[0];var o=new Worker(s[0]);o.codecTime=o.crcTime=0,o.postMessage({type:"importScripts",scripts:s.slice(1)}),o.addEventListener("message",function e(t){var s=t.data;if(s.error)return o.terminate(),void i(s.error);"importScripts"===s.type&&(o.removeEventListener("message",e),o.removeEventListener("error",l),r(o))}),o.addEventListener("error",l)}else i(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function l(e){o.terminate(),i(e)}}function P(e){console.error(e)}e.zip={Reader:h,Writer:p,BlobReader:_,Data64URIReader:d,TextReader:u,BlobWriter:f,Data64URIWriter:m,TextWriter:g,createReader:function(t,a,n){n=n||P,t.init(function(){!function(t,a,n){var o=0;function l(){}l.prototype.getData=function(i,a,l,h){var u=this;function d(e,t){h&&!function(e){var t=c(4);return t.view.setUint32(0,e),u.crc32==t.view.getUint32(0)}(t)?n("CRC failed."):i.getData(function(e){a(e)})}function _(e){n(e||s)}function p(e){n(e||"Error while writing file data.")}t.readUint8Array(u.offset,30,function(s){var a,g=c(s.length,s);1347093252==g.view.getUint32(0)?(E(u,g,4,!1,n),a=u.offset+30+u.filenameLength+u.extraFieldLength,i.init(function(){0===u.compressionMethod?T(u._worker,o++,t,i,a,u.compressedSize,h,d,l,_,p):function(t,r,i,s,a,n,o,l,c,h,u){var d=o?"output":"none";e.zip.useWebWorkers?v(t,{sn:r,codecClass:"Inflater",crcType:d},i,s,a,n,c,l,h,u):A(new e.zip.Inflater,i,s,a,n,d,c,l,h,u)}(u._worker,o++,t,i,a,u.compressedSize,h,d,l,_,p)},p)):n(r)},_)};var h={getEntries:function(e){var s=this._worker;!function(e){function s(r,s){t.readUint8Array(t.size-r,r,function(t){for(var r=t.length-22;r>=0;r--)if(80===t[r]&&75===t[r+1]&&5===t[r+2]&&6===t[r+3])return void e(new DataView(t.buffer,r,22));s()},function(){n(i)})}t.size<22?n(r):s(22,function(){s(Math.min(65558,t.size),function(){n(r)})})}(function(a){var o,h;o=a.getUint32(16,!0),h=a.getUint16(8,!0),o<0||o>=t.size?n(r):t.readUint8Array(o,t.size-o,function(t){var i,a,o,u,d=0,_=[],p=c(t.length,t);for(i=0;i<h;i++){if((a=new l)._worker=s,1347092738!=p.view.getUint32(d))return void n(r);E(a,p,d+6,!0,n),a.commentLength=p.view.getUint16(d+32,!0),a.directory=!(16&~p.view.getUint8(d+38)),a.offset=p.view.getUint32(d+42,!0),o=y(p.array.subarray(d+46,d+46+a.filenameLength)),a.filename=2048&~a.bitFlag?b(o):M(o),a.directory||"/"!=a.filename.charAt(a.filename.length-1)||(a.directory=!0),u=y(p.array.subarray(d+46+a.filenameLength+a.extraFieldLength,d+46+a.filenameLength+a.extraFieldLength+a.commentLength)),a.comment=2048&~a.bitFlag?b(u):M(u),_.push(a),d+=46+a.filenameLength+a.extraFieldLength+a.commentLength}e(_)},function(){n(i)})})},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?w("inflater",function(e){h._worker=e,a(h)},function(e){n(e)}):a(h)}(t,a,n)},n)},createWriter:function(e,t,r,i){r=r||P,i=!!i,e.init(function(){x(e,t,r,i)},r)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this)},910(e){e.exports=function(e){function t(i){if(r[i])return r[i].exports;var s=r[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function i(e){if(!e)throw new Error("SketchfabOAuth2 config is missing.");if(e.hasOwnProperty("hostname")||(e.hostname="sketchfab.com"),!e.hasOwnProperty("client_id"))throw new Error("client_id is missing. Please check the config of SketchfabOAuth2.");if(!e.hasOwnProperty("redirect_uri"))throw new Error("redirect_uri is missing. Please check the config of SketchfabOAuth2.");this.config=e}r(5);var s=r(2),a=r(6),n=a.buildQueryString,o=a.parseQueryString;i.prototype.connect=function(e){return new s(function(t,r){if(this.config.client_id)var i={response_type:"token",state:+new Date,client_id:this.config.client_id,redirect_uri:this.config.redirect_uri},s=Object.assign({},i,e),a="https://"+this.config.hostname+"/oauth2/authorize/?"+n(s),l=window.open(a,"loginWindow","width=640,height=400"),c=setInterval(function(){try{var e=l.location.href;if(void 0===e)return clearInterval(c),void r(new Error("Access denied (User closed popup)"));if(-1!==e.indexOf("?error=access_denied"))return clearInterval(c),void r(new Error("Access denied (User canceled)"));if(-1!==e.indexOf(this.config.redirect_uri)){clearInterval(c);var i,s=l.location.hash,a=RegExp("access_token=([^&]+)");return s.match(a)?(i=o(s.substring(1)),void t(i)):void r(new Error("Access denied (missing token)"))}}catch(e){}}.bind(this),1e3);else r(new Error("client_id is missing."))}.bind(this))},e.exports=i},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(c===setTimeout)return setTimeout(e,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function a(){p&&d&&(p=!1,d.length?_=d.concat(_):g=-1,_.length&&n())}function n(){if(!p){var e=s(a);p=!0;for(var t=_.length;t;){for(d=_,_=[];++g<t;)d&&d[g].run();g=-1,t=_.length}d=null,p=!1,function(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var c,h,u=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var d,_=[],p=!1,g=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];_.push(new o(e,t)),1!==_.length||p||s(n)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=l,u.addListener=l,u.once=l,u.off=l,u.removeListener=l,u.removeAllListeners=l,u.emit=l,u.prependListener=l,u.prependOnceListener=l,u.listeners=function(e){return[]},u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t,r){(function(t){"use strict";function r(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function s(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void i._immediateFn(function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var i;try{i=r(e._value)}catch(e){return void n(t.promise,e)}a(t.promise,i)}else(1===e._state?a:n)(t.promise,e._value)}))}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof i)return e._state=3,e._value=t,void o(e);if("function"==typeof r)return void c(function(e,t){return function(){e.apply(t,arguments)}}(r,t),e)}e._state=1,e._value=t,o(e)}catch(t){n(e,t)}}function n(e,t){e._state=2,e._value=t,o(e)}function o(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)s(e,e._deferreds[t]);e._deferreds=null}function l(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function c(e,t){var r=!1;try{e(function(e){r||(r=!0,a(t,e))},function(e){r||(r=!0,n(t,e))})}catch(e){if(r)return;r=!0,n(t,e)}}var h=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var i=new this.constructor(r);return s(this,new l(e,t,i)),i},i.prototype.finally=function(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){return t.reject(r)})})},i.all=function(e){return new i(function(t,r){function i(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if("function"==typeof o)return void o.call(n,function(t){i(e,t)},r)}s[e]=n,0===--a&&t(s)}catch(e){r(e)}}if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var s=Array.prototype.slice.call(e);if(0===s.length)return t([]);for(var a=s.length,n=0;n<s.length;n++)i(n,s[n])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,r){r(e)})},i.race=function(e){return new i(function(t,r){for(var i=0,s=e.length;i<s;i++)e[i].then(t,r)})},i._immediateFn="function"==typeof t&&function(e){t(e)}||function(e){h(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},e.exports=i}).call(t,r(4).setImmediate)},function(e,t,r){(function(e,t){!function(e){"use strict";function r(e){delete n[e]}function i(e){if(o)setTimeout(i,0,e);else{var t=n[e];if(t){o=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{r(e),o=!1}}}}if(!e.setImmediate){var s,a=1,n={},o=!1,l=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?s=function(e){t.nextTick(function(){i(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&i(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),s=function(r){e.postMessage(t+r,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){i(e.data)},s=function(t){e.port2.postMessage(t)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var e=l.documentElement;s=function(t){var r=l.createElement("script");r.onreadystatechange=function(){i(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():s=function(e){setTimeout(i,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return n[a]=i,s(a),a++},c.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,function(){return this}(),r(1))},function(e,t,r){(function(e){function i(e,t){this._id=e,this._clearFn=t}var s=Function.prototype.apply;t.setTimeout=function(){return new i(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(3),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,function(){return this}())},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},writable:!0,configurable:!0})},function(e,t){e.exports={parseQueryString:function(e){var t={};return e.split("&").forEach(function(e){var r=e.split("=");t[r[0]]=decodeURIComponent(r[1])}),t},buildQueryString:function(e){for(var t=Object.keys(e),r=[],i=0,s=t.length;i<s;i++)r.push(t[i]+"="+encodeURIComponent(e[t[i]]));return r.join("&")}}}])},939(e,t,r){"use strict";r.d(t,{p8:()=>i,tb:()=>s});var i=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.PI},972(e,t,r){var i,s;void 0===(s="function"==typeof(i=function(){"use strict";function t(e,t,r){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){o(i.response,t,r)},i.onerror=function(){console.error("could not download file")},i.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,n=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!n?function(e,r,n){var o=a.URL||a.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):i(l.href)?t(e,r,n):s(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(l.href)},4e4),setTimeout(function(){s(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),r);else if(i(e))t(e,r,a);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){s(n)})}}:function(e,r,i,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof e)return t(e,r,i);var o="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&l||n)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var e=h.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=e:location=e,s=null},h.readAsDataURL(e)}else{var u=a.URL||a.webkitURL,d=u.createObjectURL(e);s?s.location=d:location.href=d,s=null,setTimeout(function(){u.revokeObjectURL(d)},4e4)}});a.saveAs=o.saveAs=o,e.exports=o})?i.apply(t,[]):i)||(e.exports=s)},989(e,t,r){"use strict";r.d(t,{$A:()=>p,C:()=>n,Il:()=>b,Ln:()=>h,Om:()=>_,S8:()=>d,WQ:()=>l,Z0:()=>g,ei:()=>m,fA:()=>a,gL:()=>f,hZ:()=>o,hs:()=>c,jb:()=>v,lo:()=>T,uE:()=>M,vt:()=>s,xg:()=>A,ze:()=>u});var i=r(939);function s(){var e=new i.tb(3);return i.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function a(e,t,r){var s=new i.tb(3);return s[0]=e,s[1]=t,s[2]=r,s}function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function c(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function h(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function u(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function d(e,t){var r=t[0],i=t[1],s=t[2],a=r*r+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function _(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function p(e,t,r){var i=t[0],s=t[1],a=t[2],n=r[0],o=r[1],l=r[2];return e[0]=s*l-a*o,e[1]=a*n-i*l,e[2]=i*o-s*n,e}function g(e,t,r){var i=t[0],s=t[1],a=t[2],n=r[3]*i+r[7]*s+r[11]*a+r[15];return n=n||1,e[0]=(r[0]*i+r[4]*s+r[8]*a+r[12])/n,e[1]=(r[1]*i+r[5]*s+r[9]*a+r[13])/n,e[2]=(r[2]*i+r[6]*s+r[10]*a+r[14])/n,e}function m(e,t,r){var i=t[0],s=t[1],a=t[2];return e[0]=i*r[0]+s*r[3]+a*r[6],e[1]=i*r[1]+s*r[4]+a*r[7],e[2]=i*r[2]+s*r[5]+a*r[8],e}function f(e,t,r){var i=r[0],s=r[1],a=r[2],n=r[3],o=t[0],l=t[1],c=t[2],h=s*c-a*l,u=a*o-i*c,d=i*l-s*o;return h+=h,u+=u,d+=d,e[0]=o+n*h+s*d-a*u,e[1]=l+n*u+a*h-i*d,e[2]=c+n*d+i*u-s*h,e}var v=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},A=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)},T=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s},b=function(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)},M=function(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i};s()}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>Ms}),__webpack_require__(386);var e=__webpack_require__(989),t=__webpack_require__(141),r=__webpack_require__(117),i=__webpack_require__(299),s=__webpack_require__(344),a=__webpack_require__(152),n=__webpack_require__(46),o=__webpack_require__(939);function l(){var e=new o.tb(9);return o.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function c(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function h(e,t){if(e===t){var r=t[1],i=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function u(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],_=t[11],p=t[12],g=t[13],m=t[14],f=t[15],v=r*o-i*n,A=r*l-s*n,T=r*c-a*n,b=i*l-s*o,M=i*c-a*o,y=s*c-a*l,E=h*g-u*p,S=h*m-d*p,R=h*f-_*p,x=u*m-d*g,C=u*f-_*g,w=d*f-_*m,P=v*w-A*C+T*x+b*R-M*S+y*E;return P?(P=1/P,e[0]=(o*w-l*C+c*x)*P,e[1]=(l*R-n*w-c*S)*P,e[2]=(n*C-o*R+c*E)*P,e[3]=(s*C-i*w-a*x)*P,e[4]=(r*w-s*R+a*S)*P,e[5]=(i*R-r*C-a*E)*P,e[6]=(g*y-m*M+f*b)*P,e[7]=(m*T-p*y-f*A)*P,e[8]=(p*M-g*T+f*v)*P,e):null}const d=class{constructor(e,t,r){this._gl=e,this._buffer=e.createBuffer(),this._type=t,this._hint=r,this._size=0}bind(){this._buffer||(this._buffer=this._gl.createBuffer()),this._gl.bindBuffer(this._type,this._buffer)}release(){this._gl.deleteBuffer(this._buffer),this._buffer=null,this._size=0}update(e,t){this.bind(),void 0!==t&&t!==e.length&&(e=e.subarray(0,t)),e.length>this._size?(this._gl.bufferData(this._type,e,this._hint),this._size=e.length):this._gl.bufferSubData(this._type,0,e)}},_=class{constructor(e,t,r,i,s){this._gl=e,this._location=e.getAttribLocation(t,r),this._size=i,this._type=s}unbind(){this._gl.disableVertexAttribArray(this._location)}bindToBuffer(e){var t=this._gl;e.bind(),t.enableVertexAttribArray(this._location),t.vertexAttribPointer(this._location,this._size,this._type,!1,0,0)}},p="// reference\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n#define RANGE 5.0\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col) {\n    vec4 rgbm;\n    vec3 color = col / RANGE;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col) {\n  return RANGE * col.rgb * col.a;\n}\n";var g={vertexName:"VertexName",fragmentName:"FragmentName",activeAttributes:{vertex:!0,normal:!0,material:!0,color:!0}};g.showSymmetryLine=(0,n.A)().mirrorline,g.darkenUnselected=(0,n.A)().darkenunselected,g.uniformNames={},g.uniformNames.commonUniforms=["uMV","uMVP","uN","uEM","uEN","uFlat","uPlaneO","uPlaneN","uSym","uCurvature","uAlpha","uFov","uDarken"],g.strings={},g.strings.colorSpaceGLSL=p,g.strings.vertUniforms=["uniform mat4 uMV;","uniform mat4 uMVP;","uniform mat3 uN;","uniform mat4 uEM;","uniform mat3 uEN;","uniform float uAlpha;"].join("\n"),g.strings.fragColorUniforms=["uniform vec3 uPlaneN;","uniform vec3 uPlaneO;","uniform int uSym;","uniform int uDarken;","uniform float uCurvature;","uniform float uFov;","varying float vMasking;","uniform int uFlat;"].join("\n"),g.strings.fragColorFunction=["// http://madebyevan.com/shaders/curvature/\n#extension GL_OES_standard_derivatives : enable\nvec3 computeCurvature( const in vec3 vertex, const in vec3 normal, const in vec3 color, const in float str, const in float fov) {\n  if(str < 1e-3)\n    return color;\n#ifndef GL_OES_standard_derivatives\n    return color * pow(length(normal), str * 100.0);\n#else\n  vec3 n = normalize(normal);\n  // Compute curvature\n  vec3 dx = dFdx(n);\n  vec3 dy = dFdy(n);\n  vec3 xneg = n - dx;\n  vec3 xpos = n + dx;\n  vec3 yneg = n - dy;\n  vec3 ypos = n + dy;\n  // fov < 0.0 means ortho\n  float depth = fov > 0.0 ? length(vertex) * fov : -fov;\n  float cur = (cross(xneg, xpos).y - cross(yneg, ypos).x) * str * 80.0 / depth;\n  return mix(mix(color, color * 0.3, clamp(-cur * 15.0, 0.0, 1.0)), color * 2.0, clamp(cur * 25.0, 0.0, 1.0));\n#endif\n}\n",p,"#extension GL_OES_standard_derivatives : enable","vec3 getNormal() {","  #ifndef GL_OES_standard_derivatives","    return normalize(gl_FrontFacing ? vNormal : -vNormal);","  #else","    return uFlat == 0 ? normalize(gl_FrontFacing ? vNormal : -vNormal) : -normalize(cross(dFdy(vVertex), dFdx(vVertex)));","  #endif","}","vec4 encodeFragColor(const in vec3 frag, const in float alpha) {","  vec3 col = computeCurvature(vVertex, vNormal, frag, uCurvature, uFov);","  if(uDarken == 1) col *= 0.3;","  col *= (0.3 + 0.7 * vMasking);","  if(uSym == 1 && abs(dot(uPlaneN, vVertex - uPlaneO)) < 0.15)","      col = min(col * 1.5, 1.0);","  return alpha != 1.0 ? vec4(col * alpha, alpha) : encodeRGBM(col);","}"].join("\n");var m,f=function(e){var t="",r=e.match(/^\s*(#extension).*/gm);if(r)for(var i={},s=0,a=r.length;s<a;++s){var n=r[s].substr(r[s].indexOf("#extension"));e=e.replace(r[s],""),i[n]||(i[n]=!0,t+=n+"\n")}var o="";-1===e.indexOf("#version")&&(o+="#version 100\n");var l="";return/precision\s+(high|low|medium)p\s+float/.test(e)||(l+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n"),o+t+l+e};g.getOrCreate=function(e){if(this.program)return this;var t="\n#define SHADER_NAME "+this.vertexName+"\n",r="\n#define SHADER_NAME "+this.fragmentName+"\n",i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,f(this.vertex+t)),e.compileShader(i);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,f(this.fragment+r)),e.compileShader(s);var a=this.program=e.createProgram();e.attachShader(a,i),e.attachShader(a,s),e.linkProgram(a),e.useProgram(a);var n=e.getShaderInfoLog(i),o=e.getShaderInfoLog(s),l=e.getProgramInfoLog(a);return n&&console.warn(this.vertexName+" (vertex)\n"+n),o&&console.warn(this.fragmentName+" (fragment)\n"+o),l&&console.warn(this.fragmentName+" (program)\n"+l),this.initAttributes(e),this.initUniforms(e),this},g.initUniforms=function(e){for(var t=this.program,r=this.uniformNames,i=this.uniforms,s=0,a=r.length;s<a;++s){var n=r[s];i[n]=e.getUniformLocation(t,n)}},g.updateUniforms=(m=[0,0,0],function(t,r){var i=t.getGL(),s=g.darkenUnselected&&r.getIndexSelectMesh(t)<0,a=g.showSymmetryLine&&t.getID()===r.getMesh().getID()&&r.getSculptManager().getSymmetry(),n=this.uniforms;i.uniformMatrix4fv(n.uEM,!1,t.getEditMatrix()),i.uniformMatrix3fv(n.uEN,!1,t.getEN()),i.uniformMatrix4fv(n.uMV,!1,t.getMV()),i.uniformMatrix4fv(n.uMVP,!1,t.getMVP()),i.uniformMatrix3fv(n.uN,!1,t.getN()),i.uniform1i(n.uDarken,s?1:0),i.uniform1i(n.uFlat,t.getFlatShading()),i.uniform3fv(n.uPlaneO,e.Z0(m,t.getSymmetryOrigin(),t.getMV())),i.uniform3fv(n.uPlaneN,e.S8(m,e.ei(m,t.getSymmetryNormal(),t.getN()))),i.uniform1i(n.uSym,a?1:0),i.uniform1f(n.uAlpha,t.getOpacity()),i.uniform1f(n.uCurvature,t.getCurvature());var o=r.getCamera();i.uniform1f(n.uFov,o.isOrthographic()?25*-Math.abs(o._trans[2]):o.getFov())}),g.draw=function(e,t){e.getGL().useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e,t),this.drawBuffer(e)},g.drawBuffer=function(e){var t=e.getGL();e.isUsingDrawArrays()?t.drawArrays(e.getMode(),0,e.getCount()):(e.getIndexBuffer().bind(),t.drawElements(e.getMode(),e.getCount(),t.UNSIGNED_INT,0)),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.unbindAttributes()},g.setTextureParameters=function(e,t){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),s.A.isPowerOfTwo(t.width)&&s.A.isPowerOfTwo(t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.generateMipmap(e.TEXTURE_2D)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))},g.onLoadTexture0=function(e,t,r){this.texture0=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),g.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),r&&r.render()},g.getDummyTexture=function(e){return this._dummyTex||(this._dummyTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._dummyTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.bindTexture(e.TEXTURE_2D,null)),this._dummyTex},g.getOrCreateTexture0=function(e,t,r){if(void 0!==this.texture0)return this.texture0;this.texture0=null;var i=new Image;return i.src=t,i.onload=this.onLoadTexture0.bind(this,e,i,r),!1},g.initAttributes=function(e){var t=this.program,r=this.attributes;r.aVertex=new _(e,t,"aVertex",3,e.FLOAT),r.aNormal=new _(e,t,"aNormal",3,e.FLOAT),r.aColor=new _(e,t,"aColor",3,e.FLOAT),r.aMaterial=new _(e,t,"aMaterial",3,e.FLOAT)},g.bindAttributes=function(e){var t=this.attributes,r=this.activeAttributes;r.vertex&&t.aVertex.bindToBuffer(e.getVertexBuffer()),r.normal&&t.aNormal.bindToBuffer(e.getNormalBuffer()),r.color&&t.aColor.bindToBuffer(e.getColorBuffer()),r.material&&t.aMaterial.bindToBuffer(e.getMaterialBuffer())},g.unbindAttributes=function(){var e=this.attributes,t=this.activeAttributes;t.vertex&&e.aVertex.unbind(),t.normal&&e.aNormal.unbind(),t.color&&e.aColor.unbind(),t.material&&e.aMaterial.unbind()},g.getCopy=function(){for(var e=Object.keys(g),t={},r=0,i=e.length;r<i;++r)t[e[r]]=this[e[r]];return t.program=null,t};const v=g,A="#define PI 3.1415926535897932384626433832795\n#define PI_2 (2.0 * 3.1415926535897932384626433832795)\n#define INV_PI 1.0 / PI\n#define INV_LOG2 1.4426950408889634073599246810019\n\nuniform sampler2D uTexture0;\nuniform float uExposure;\nuniform mat3 uIblTransform;\nuniform vec3 uSPH[9];\n\nuniform vec2 uEnvSize;\n#define LIMIT_LOD 5.0\n\n// https://mynameismjp.wordpress.com/2008/12/12/logluv-encoding-for-hdr/\nconst mat3 LUVInverse = mat3(6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720,\n                             0.3007, -1.088, 5.6268);\nvec3 decodeLUV(const in vec4 logLuv) {\n  float Le = logLuv.z * 255.0 + logLuv.w;\n  vec3 xp;\n  xp.y = exp2((Le - 127.0) / 2.0);\n  xp.z = xp.y / logLuv.y;\n  xp.x = logLuv.x * xp.z;\n  return max(LUVInverse * xp, 0.0);\n}\n\nvec2 toUVMipmap(const in float lod, const in vec2 uv) {\n  float widthForLevel = uEnvSize.x / exp2(lod);\n  vec2 uvSpaceLocal = vec2(1.0) + uv * (widthForLevel - 2.0);\n  uvSpaceLocal.y += uEnvSize.y - widthForLevel * 2.0;\n  return uvSpaceLocal / uEnvSize;\n}\n\nvec2 directionToUV(const in vec3 dir) {\n  vec3 signOct = sign(dir);\n  vec3 uvOct = dir / dot(dir, signOct);\n  if (uvOct.z < 0.0) {\n    uvOct.xy = signOct.xy * (1.0 - abs(uvOct)).yx;\n  }\n  return uvOct.xy * 0.5 + 0.5;\n}\n\nvec3 texturePanoramaLod(const in vec3 direction, const in float rLinear) {\n  float lod = rLinear * (LIMIT_LOD - 1.0);\n  vec2 uvBase = directionToUV(direction);\n  return decodeLUV(mix(texture2D(uTexture0, toUVMipmap(floor(lod), uvBase)),\n                       texture2D(uTexture0, toUVMipmap(ceil(lod), uvBase)),\n                       fract(lod)));\n}\n\nvec3 integrateBRDFApprox(const in vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\n  vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\n  return specular * AB.x + AB.y;\n}\n\nvec3 getSpecularDominantDir(const in vec3 N, const in vec3 R,\n                            const in float realRoughness) {\n  float smoothness = 1.0 - realRoughness;\n  return mix(N, R, smoothness * (sqrt(smoothness) + realRoughness));\n}\n\nvec3 approximateSpecularIBL(const in vec3 specularColor, float rLinear,\n                            const in vec3 N, const in vec3 V) {\n  float NoV = clamp(dot(N, V), 0.0, 1.0);\n  vec3 R = normalize((2.0 * NoV) * N - V);\n  R = getSpecularDominantDir(N, R, rLinear);\n  vec3 prefilteredColor = texturePanoramaLod(uIblTransform * R, rLinear);\n  return prefilteredColor * integrateBRDFApprox(specularColor, rLinear, NoV);\n}\n\n// expect shCoefs uniform\n// https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\nvec3 sphericalHarmonics(const in vec3 N) {\n  float x = N.x;\n  float y = N.y;\n  float z = -N.z;\n  vec3 result = uSPH[0] + uSPH[1] * y + uSPH[2] * z + uSPH[3] * x +\n                uSPH[4] * y * x + uSPH[5] * y * z +\n                uSPH[6] * (3.0 * z * z - 1.0) + uSPH[7] * (z * x) +\n                uSPH[8] * (x * x - y * y);\n  return max(result, vec3(0.0));\n}\n\nvec3 computeIBL_UE4(const in vec3 N, const in vec3 V, const in vec3 albedo,\n                    const in float roughness, const in vec3 specular) {\n  vec3 color = albedo * sphericalHarmonics(uIblTransform * N);\n  color += approximateSpecularIBL(specular, roughness, N, V);\n  return color;\n}\n";var T=v.getCopy();T.vertexName=T.fragmentName="ShadingPBR",T.textures={};var b=s.A.getResourcePath("environments/");T.environments=[{path:b+"mpumalanga_veld_1k.png",sph:[.136819,.174125,.253762,.027778,.056838,.131221,.074356,.086793,.099181,-.07904,-.091269,-.102346,-.02755,-.0323,-.039217,.031822,.034773,.039945,.017235,.021044,.026136,-.106608,-.11864,-.132761,.041,.049794,.061183],exposure:2.5,name:"Mpumalanga veld"},{path:b+"venetian_crossroads_1k.png",sph:[.200626,.198426,.209579,.090452,.127807,.18839,.093188,.103245,.106131,.033349,.054751,.067044,.07435,.08167,.079716,.063127,.08594,.10171,.007751,.00571,-791e-6,.104134,.103979,.094236,-.022747,-.028166,-.037714],exposure:2.5,name:"Venetian crossroads"},{path:b+"studio_small_01_1k.png",sph:[.534107,.589985,.617478,.119999,.13048,.128019,.089872,.088707,.088017,.099999,.151282,.138458,.005015,.035588,.027592,.114999,.116739,.120579,-.057997,-.069532,-.070401,.385123,.411714,.454725,.303242,.333004,.35027],exposure:.5,name:"Studio small 01"},{path:b+"moonless_golf_1k.png",sph:[.137579,.112906,.09347,.070711,.066043,.065337,-.029564,-.02072,-.007737,-.037254,-.03327,-.028294,-.023847,-.021208,-.018767,-.007873,-.002587,.003955,.009241,.007711,.006063,.017917,.011733,.007669,.036859,.026285,.01474],exposure:1,name:"Moonless golf"},{path:b+"winter_river_1k.png",sph:[.560145,.554695,.513523,-.213105,-.15519,-.063568,.135182,.114211,.069349,.172852,.15182,.105477,.065753,.06405,.052622,.096352,.086557,.063826,.02183,.01656,.008804,.186193,.16372,.119627,.025363,.022278,.014461],exposure:.5,name:"Winter river"}];var M=(0,n.A)();T.idEnv=Math.min(M.environment,T.environments.length-1),T.exposure=void 0===M.exposure?T.environments[T.idEnv].exposure:Math.min(M.exposure,5),T.uniforms={},T.attributes={},T.uniformNames=["uIblTransform","uTexture0","uAlbedo","uRoughness","uMetallic","uExposure","uSPH","uEnvSize"],Array.prototype.push.apply(T.uniformNames,v.uniformNames.commonUniforms),T.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",v.strings.vertUniforms,"uniform float uRoughness;","uniform float uMetallic;","uniform vec3 uAlbedo;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","varying float vMasking;","void main() {","  vAlbedo = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vRoughness = uRoughness >= 0.0 ? uRoughness : aMaterial.x;","  vMetallic = uMetallic >= 0.0 ? uMetallic : aMaterial.y;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),T.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","uniform float uAlpha;",v.strings.fragColorUniforms,v.strings.fragColorFunction,A,"","void main(void) {","  vec3 normal = getNormal();","  float roughness = max( 0.0001, vRoughness );","  vec3 linColor = sRGBToLinear(vAlbedo);","  vec3 albedo = linColor * (1.0 - vMetallic);","  vec3 specular = mix( vec3(0.04), linColor, vMetallic);","","  vec3 color = uExposure * computeIBL_UE4( normal, -normalize(vVertex), albedo, roughness, specular );","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),T.onLoadEnvironment=function(e,t,r,i){if(!e.status||200===e.status||e.response&&e.response.byteLength){var s=e.width||Math.sqrt(e.response.byteLength/8),a=2*s;i.size=[s,a],i.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i.texture),e.response?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,s,a,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e.response)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),r&&r.render()}},T.getOrCreateEnvironment=function(e,t,r){if(void 0!==r.texture)return r.texture;if(r.texture=null,r.path.endsWith("png")){var i=new Image;return i.src=r.path,i.onload=T.onLoadEnvironment.bind(this,i,e,t,r),null}var s=new XMLHttpRequest;return s.open("GET",r.path,!0),s.responseType="arraybuffer",s.onload=T.onLoadEnvironment.bind(this,s,e,t,r),s.send(null),null};var y=l();T.updateUniforms=function(e,t){var r=e.getGL(),i=this.uniforms;c(y,t.getCamera().getView()),r.uniformMatrix3fv(i.uIblTransform,!1,h(y,y)),r.uniform3fv(i.uAlbedo,e.getAlbedo()),r.uniform1f(i.uRoughness,e.getRoughness()),r.uniform1f(i.uMetallic,e.getMetallic()),r.uniform1f(i.uExposure,T.exposure);var s=T.environments[T.idEnv];r.uniform3fv(i.uSPH,s.sph),s.size&&r.uniform2fv(i.uEnvSize,s.size),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,T.getOrCreateEnvironment(r,t,s)||this.getDummyTexture(r)),r.uniform1i(i.uTexture0,0),v.updateUniforms.call(this,e,t)};const E=T;var S=__webpack_require__(352),R=v.getCopy();R.vertexName=R.fragmentName="Matcap",R.textures={},R.createTexture=function(e,t,r){var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),R.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),R.textures[r]=i};var x=s.A.getResourcePath("matcaps/");R.matcaps=[{path:x+"matcapFV.jpg",name:"matcap FV"},{path:x+"redClay.jpg",name:"Red clay"},{path:x+"skinHazardousarts.jpg",name:"Skin hazardousarts"},{path:x+"skinHazardousarts2.jpg",name:"Skin Hazardousarts2"},{path:x+"pearl.jpg",name:(0,S.A)("matcapPearl")},{path:x+"clay.jpg",name:(0,S.A)("matcapClay")},{path:x+"skin.jpg",name:(0,S.A)("matcapSkin")},{path:x+"green.jpg",name:(0,S.A)("matcapGreen")},{path:x+"white.jpg",name:(0,S.A)("matcapWhite")}],R.uniforms={},R.attributes={},R.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(R.uniformNames,v.uniformNames.commonUniforms),R.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",v.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying float vMasking;","varying vec3 vVertexPres;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  vVertexPres = vVertex / max(1.0, abs(uMV[3][2]));","  gl_Position = uMVP * vertex4;","}"].join("\n"),R.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vVertexPres;","varying vec3 vNormal;","varying vec3 vColor;","uniform float uAlpha;",v.strings.fragColorUniforms,v.strings.fragColorFunction,"void main() {","  vec3 normal = getNormal();","  vec3 nm_z = normalize(vVertexPres);","  vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);","  vec3 nm_y = cross(nm_x, nm_z);","  vec2 texCoord = 0.5 + 0.5 * vec2(dot(normal, nm_x), dot(normal, nm_y));","  vec3 color = sRGBToLinear(texture2D(uTexture0, texCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),R.updateUniforms=function(e,t){var r=e.getGL(),i=this.uniforms;r.activeTexture(r.TEXTURE0),e.setTexture0(R.textures[e.getMatcap()]),r.bindTexture(r.TEXTURE_2D,e.getTexture0()||this.getDummyTexture(r)),r.uniform1i(i.uTexture0,0),r.uniform3fv(i.uAlbedo,e.getAlbedo()),v.updateUniforms.call(this,e,t)};const C=R;var w=v.getCopy();w.vertexName=w.fragmentName="ShowNormal",w.uniforms={},w.attributes={},w.activeAttributes={vertex:!0,normal:!0,material:!0},w.uniformNames=[],Array.prototype.push.apply(w.uniformNames,v.uniformNames.commonUniforms),w.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aMaterial;",v.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying float vMasking;","void main() {","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),w.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","uniform float uAlpha;",v.strings.fragColorUniforms,v.strings.fragColorFunction,"void main() {","  gl_FragColor = encodeFragColor(sRGBToLinear(getNormal() * 0.5 + 0.5), uAlpha);","}"].join("\n");const P=w;var D=v.getCopy();D.vertexName=D.fragmentName="ShowUV",D.texPath="uv.png",D.uniforms={},D.attributes={},D.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(D.uniformNames,v.uniformNames.commonUniforms),D.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec2 aTexCoord;","attribute vec3 aMaterial;",v.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","varying float vMasking;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vTexCoord = aTexCoord;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),D.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","uniform float uAlpha;",v.strings.fragColorUniforms,v.strings.fragColorFunction,"void main() {","  vec3 color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),D.draw=v.draw,D.drawBuffer=v.drawBuffer,D.getOrCreate=v.getOrCreate,D.initUniforms=v.initUniforms,D.initAttributes=function(e){v.initAttributes.call(this,e),D.attributes.aTexCoord=new _(e,D.program,"aTexCoord",2,e.FLOAT)},D.bindAttributes=function(e){v.bindAttributes.call(this,e),D.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},D.updateUniforms=function(e,t){var r=e.getGL(),i=this.uniforms;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.getOrCreateTexture0(r,s.A.getResourcePath(D.texPath),t)||this.getDummyTexture(r)),r.uniform1i(i.uTexture0,0),r.uniform3fv(i.uAlbedo,e.getAlbedo()),v.updateUniforms.call(this,e,t)};const k=D;var I=v.getCopy();I.vertexName=I.fragmentName="Wireframe",I.uniforms={},I.attributes={},I.activeAttributes={vertex:!0,material:!0},I.uniformNames=["uMVP","uEM"],I.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;","uniform mat4 uMVP;","uniform mat4 uEM;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  vec4 pos = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","  pos[3] += 0.0001;","  gl_Position = pos;","}"].join("\n"),I.fragment=["void main() {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.4);","}"].join("\n"),I.getOrCreate=v.getOrCreate,I.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),e.getWireframeBuffer().bind(),t.drawElements(t.LINES,2*e.getRenderNbEdges(),t.UNSIGNED_INT,0)},I.updateUniforms=function(e){var t=e.getGL();t.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getMVP()),t.uniformMatrix4fv(this.uniforms.uEM,!1,e.getEditMatrix())};const F=I;var L=v.getCopy();L.vertexName=L.fragmentName="FlatColor",L.uniforms={},L.attributes={},L.activeAttributes={vertex:!0,material:!0},L.uniformNames=["uColor"],Array.prototype.push.apply(L.uniformNames,v.uniformNames.commonUniforms),L.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;",v.strings.vertUniforms,"varying vec3 vVertex;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  gl_Position = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","}"].join("\n"),L.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),L.updateUniforms=function(e,t){e.getGL().uniform3fv(this.uniforms.uColor,e.getFlatColor()),v.updateUniforms.call(this,e,t)};const V=L;var N=v.getCopy();N.vertexName=N.fragmentName="ShowSelection",N.uniforms={},N.attributes={},N.activeAttributes={vertex:!0},N.uniformNames=["uMVP","uColor"],N.vertex=["attribute vec3 aVertex;","uniform mat4 uMVP;","void main() {","  gl_Position = uMVP * vec4(aVertex, 1.0);","}"].join("\n"),N.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),N.draw=function(e,t,r){var i=e.getGL();i.useProgram(this.program),i.uniform3fv(this.uniforms.uColor,e.getColor()),t&&(i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getCircleMVP()),N.attributes.aVertex.bindToBuffer(e.getCircleBuffer()),i.drawArrays(i.LINE_LOOP,0,e.getCircleBuffer()._size/3)),i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotMVP()),N.attributes.aVertex.bindToBuffer(e.getDotBuffer()),i.drawArrays(i.TRIANGLE_FAN,0,e.getDotBuffer()._size/3),r&&(i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotSymmetryMVP()),i.drawArrays(i.TRIANGLE_FAN,0,e.getDotBuffer()._size/3))};const O=N;var B=v.getCopy();B.vertexName=B.fragmentName="Background",B.uniforms={},B.attributes={},B.uniformNames=["uTexture0","uBackgroundType","uIblTransform","uSPH","uBlur","uEnvSize"],B.vertex=["attribute vec2 aVertex;","attribute vec2 aTexCoord;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aTexCoord;","  gl_Position = vec4(aVertex, 1.0, 1.0);","}"].join("\n"),B.fragment=["varying vec2 vTexCoord;",v.strings.colorSpaceGLSL,A,"uniform int uBackgroundType;\nuniform float uBlur;\n\nvoid main() {\n  vec3 color;\n  if (uBackgroundType == 0) {\n    color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb);\n  } else {\n    vec3 dir = uIblTransform * vec3(vTexCoord.xy * 2.0 - 1.0, -1.0);\n    dir = normalize(dir);\n    if (uBackgroundType == 1) {\n      color = texturePanoramaLod(dir, uBlur * uBlur);\n    } else {\n      color = sphericalHarmonics(dir);\n    }\n  }\n  gl_FragColor = encodeRGBM(color);\n}\n"].join("\n"),B.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},B.initAttributes=function(e){var t=B.program,r=B.attributes;r.aVertex=new _(e,t,"aVertex",2,e.FLOAT),r.aTexCoord=new _(e,t,"aTexCoord",2,e.FLOAT)},B.bindAttributes=function(e){var t=B.attributes;t.aVertex.bindToBuffer(e.getVertexBuffer()),t.aTexCoord.bindToBuffer(e.getTexCoordBuffer())};var U=l();B.updateUniforms=function(e){var t,r=this.uniforms,i=e._main,s=E.environments[E.idEnv],a=e.getGL();a.uniform1i(r.uBackgroundType,e.getType()),t=0===e.getType()?e.getTexture():E.getOrCreateEnvironment(a,i,s)||e.getTexture(),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,t),a.uniform1i(r.uTexture0,0),c(U,i.getCamera().getView()),a.uniformMatrix3fv(r.uIblTransform,!1,h(U,U)),a.uniform3fv(r.uSPH,s.sph),s.size&&a.uniform2fv(r.uEnvSize,s.size),a.uniform1f(r.uBlur,e.getBlur())};const G=B;var W=v.getCopy();W.vertexName=W.fragmentName="Merge",W.FILMIC=(0,n.A)().filmic,W.uniforms={},W.attributes={},W.uniformNames=["uTexture0","uTexture1","uFilmic"],W.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),W.fragment=["uniform sampler2D uTexture0;","uniform sampler2D uTexture1;","uniform int uFilmic;","varying vec2 vTexCoord;",v.strings.colorSpaceGLSL,"void main() {","  vec4 transparent = texture2D(uTexture1, vTexCoord);","  vec3 color = decodeRGBM(texture2D(uTexture0, vTexCoord))*(1.0-transparent.a) + transparent.rgb;","  if(uFilmic == 1){","    vec3 x = max(vec3(0.0), color - vec3(0.004));","    gl_FragColor = vec4((x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06), 1.0);","  }else{","    gl_FragColor = vec4(linearTosRGB(color), 1.0);","  }","}"].join("\n"),W.draw=function(e,t){var r=e.getGL();r.useProgram(this.program),W.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._rttOpaque.getTexture()),r.uniform1i(this.uniforms.uTexture0,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t._rttTransparent.getTexture()),r.uniform1i(this.uniforms.uTexture1,1),r.uniform1i(this.uniforms.uFilmic,W.FILMIC),r.drawArrays(r.TRIANGLES,0,3)},W.initAttributes=function(e){W.attributes.aVertex=new _(e,W.program,"aVertex",2,e.FLOAT)};const z=W;var X=v.getCopy();X.vertexName=X.fragmentName="Fxaa",X.FILMIC=(0,n.A)().filmic,X.uniforms={},X.attributes={},X.uniformNames=["uTexture0","uInvSize"],X.vertex=["attribute vec2 aVertex;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","void main() {","  vUVM = aVertex * 0.5 + 0.5;","  vUVNW = vUVM + vec2(-1.0, -1.0) * uInvSize;","  vUVNE = vUVM + vec2(1.0, -1.0) * uInvSize;","  vUVSW = vUVM + vec2(-1.0, 1.0) * uInvSize;","  vUVSE = vUVM + vec2(1.0, 1.0) * uInvSize;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),X.fragment=["uniform sampler2D uTexture0;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","// https://github.com/mattdesl/glsl-fxaa\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n\nvec3 fxaa(const in sampler2D tex, const in vec2 uvNW, const in vec2 uvNE, const in vec2 uvSW, const in vec2 uvSE, const in vec2 uvM, const in vec2 invRes) {\n    const vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(texture2D(tex, uvNW).xyz, luma);\n    float lumaNE = dot(texture2D(tex, uvNE).xyz, luma);\n    float lumaSW = dot(texture2D(tex, uvSW).xyz, luma);\n    float lumaSE = dot(texture2D(tex, uvSE).xyz, luma);\n    float lumaM  = dot(texture2D(tex, uvM).xyz,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * invRes;\n    \n    vec3 rgbA = 0.5 * ( texture2D(tex, uvM + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, uvM + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * ( texture2D(tex, uvM - dir * 0.5).xyz + texture2D(tex, uvM + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if((lumaB < lumaMin) || (lumaB > lumaMax))\n      return rgbA;\n    return rgbB;\n}",v.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = vec4(fxaa(uTexture0, vUVNW, vUVNE, vUVSW, vUVSE, vUVM, uInvSize), 1.0);","}"].join("\n"),X.draw=function(e,t){var r=e.getGL();r.useProgram(this.program),X.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._rttMerge.getTexture()),r.uniform1i(this.uniforms.uTexture0,0),r.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),r.drawArrays(r.TRIANGLES,0,3)},X.initAttributes=function(e){X.attributes.aVertex=new _(e,X.program,"aVertex",2,e.FLOAT)};const j=X;var Y=v.getCopy();Y.vertexName=Y.fragmentName="SobelContour",Y.color=(0,n.A)().outlinecolor,Y.uniforms={},Y.attributes={},Y.uniformNames=["uTexture0","uColor","uInvSize"],Y.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.0, 1.0);","}"].join("\n"),Y.fragment=["#extension GL_OES_standard_derivatives : enable","uniform sampler2D uTexture0;","uniform vec4 uColor;","varying vec2 vTexCoord;","uniform vec2 uInvSize;","\nfloat outlineDistance( const in vec2 uv, const in sampler2D tex, const in vec2 invSize ) {\n  float fac0 = 2.0;\n  float fac1 = 1.0;\n  float ox = invSize.x;\n  float oy = invSize.y;\n  vec4 texel0 = texture2D(tex, uv + vec2(ox, oy));\n  vec4 texel1 = texture2D(tex, uv + vec2(ox, 0.0));\n  vec4 texel2 = texture2D(tex, uv + vec2(ox, -oy));\n  vec4 texel3 = texture2D(tex, uv + vec2(0.0, -oy));\n  vec4 texel4 = texture2D(tex, uv + vec2(-ox, -oy));\n  vec4 texel5 = texture2D(tex, uv + vec2(-ox, 0.0));\n  vec4 texel6 = texture2D(tex, uv + vec2(-ox, oy));\n  vec4 texel7 = texture2D(tex, uv + vec2(0.0, oy));\n  vec4 rowx = -fac0 * texel5 + fac0 * texel1 + -fac1 * texel6 + fac1 * texel0 + -fac1 * texel4 + fac1 * texel2;\n  vec4 rowy = -fac0 * texel3 + fac0 * texel7 + -fac1 * texel4 + fac1 * texel6 + -fac1 * texel2 + fac1 * texel0;\n  return dot(rowy, rowy) + dot(rowx, rowx);\n}\n",v.strings.colorSpaceGLSL,"void main() {","  float mag = outlineDistance(vTexCoord, uTexture0, uInvSize);","  if (mag < 1.5) discard;","  gl_FragColor = vec4(sRGBToLinear(uColor.rgb) * uColor.a, uColor.a);","}"].join("\n"),Y.draw=function(e){var t=e.getGL();t.useProgram(this.program),Y.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform4fv(this.uniforms.uColor,Y.color),t.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},Y.initAttributes=function(e){Y.attributes.aVertex=new _(e,Y.program,"aVertex",2,e.FLOAT)};const K=Y;var H=v.getCopy();H.CHANNEL_VALUE=0,H.vertexName=H.fragmentName="PaintUV",H.uniforms={},H.attributes={},H.uniformNames=["uChannelPaint"],H.activeAttributes={color:!0,material:!0},H.vertex=["attribute vec2 aTexCoord;","attribute vec3 aColor;","attribute vec3 aMaterial;","varying vec3 vColor;","varying vec2 vMaterial;","void main() {","  vColor = aColor;","  vMaterial = aMaterial.xy;","  gl_Position = vec4((aTexCoord * 2.0 - 1.0) * vec2(1.0, -1.0), 0.5, 1.0);","}"].join("\n"),H.fragment=["varying vec3 vColor;","varying vec2 vMaterial;","uniform int uChannelPaint;","void main() {","  gl_FragColor = vec4(uChannelPaint == 0 ? vColor : uChannelPaint == 1 ? vMaterial.xxx : vMaterial.yyy, 1.0);","}"].join("\n"),H.initAttributes=function(e){v.initAttributes.call(this,e),H.attributes.aTexCoord=new _(e,H.program,"aTexCoord",2,e.FLOAT)},H.bindAttributes=function(e){v.bindAttributes.call(this,e),H.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},H.updateUniforms=function(e){e.getGL().uniform1i(this.uniforms.uChannelPaint,H.CHANNEL_VALUE)};const q=H;var Z=v.getCopy();Z.vertexName=Z.fragmentName="Blur",Z.INPUT_TEXTURE=null,Z.uniforms={},Z.attributes={},Z.uniformNames=["uTexture0","uInvSize"],Z.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),Z.fragment=["uniform sampler2D uTexture0;","varying vec2 vTexCoord;","uniform vec2 uInvSize;",v.strings.colorSpaceGLSL,"void main() {","    const int KER_SIZE = 8;","    vec4 avg = texture2D(uTexture0, vTexCoord);","    if (avg.a < 0.1) {","        for (int i = -KER_SIZE; i <= KER_SIZE; ++i) {","            for (int j = -KER_SIZE; j <= KER_SIZE; ++j) {","                if (i == 0 && j == 0) continue;","                vec4 fetch = texture2D(uTexture0, vTexCoord + vec2(i, j) * uInvSize);","                avg.rgb += sRGBToLinear(fetch.rgb) * fetch.a;","                avg.a += fetch.a;","            }","        }","        avg.rgb = avg.a == 0.0 ? vec3(0.0) : linearTosRGB(avg.rgb / avg.a);","    }","    gl_FragColor = vec4(avg.rgb, 1.0);","}"].join("\n"),Z.draw=function(e){var t=e.getGL();t.useProgram(this.program),Z.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,Z.INPUT_TEXTURE.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform2fv(this.uniforms.uInvSize,Z.INPUT_TEXTURE.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},Z.initAttributes=function(e){Z.attributes.aVertex=new _(e,Z.program,"aVertex",2,e.FLOAT)};const Q=Z;var J=[];J[i.A.Shader.PBR]=E,J[i.A.Shader.MATCAP]=C,J[i.A.Shader.NORMAL]=P,J[i.A.Shader.UV]=k,J[i.A.Shader.WIREFRAME]=F,J[i.A.Shader.FLAT]=V,J[i.A.Shader.SELECTION]=O,J[i.A.Shader.BACKGROUND]=G,J[i.A.Shader.MERGE]=z,J[i.A.Shader.FXAA]=j,J[i.A.Shader.CONTOUR]=K,J[i.A.Shader.PAINTUV]=q,J[i.A.Shader.BLUR]=Q;const $=J;var ee=a.vt(),te=a.vt(),re=[0,0,0],ie=[0,0,0],se=[0,0,1];const ae=class{constructor(e){this._gl=e,this._circleBuffer=new d(e,e.ARRAY_BUFFER,e.STATIC_DRAW),this._dotBuffer=new d(e,e.ARRAY_BUFFER,e.STATIC_DRAW),this._cacheDotMVP=a.vt(),this._cacheDotSymMVP=a.vt(),this._cacheCircleMVP=a.vt(),this._color=new Float32Array([.8,0,0]),this._offsetX=0,this._isEditMode=!1,this.init()}getGL(){return this._gl}getCircleBuffer(){return this._circleBuffer}getDotBuffer(){return this._dotBuffer}getCircleMVP(){return this._cacheCircleMVP}getDotMVP(){return this._cacheDotMVP}getDotSymmetryMVP(){return this._cacheDotSymMVP}getColor(){return this._color}setIsEditMode(e){this._isEditMode=e}getIsEditMode(){return this._isEditMode}setOffsetX(e){this._offsetX=e}getOffsetX(){return this._offsetX}init(){this.getCircleBuffer().update(this._getCircleVertices(1)),this.getDotBuffer().update(this._getDotVertices(.05,10))}release(){this.getCircleBuffer().release(),this.getDotBuffer().release()}_getCircleVertices(e=1,t=50,r=!1){for(var i=2*Math.PI,s=r?1:0,a=r?t+2:t,n=new Float32Array(3*a),o=s;o<a;++o){var l=3*o,c=i*o/t;n[l]=Math.cos(c)*e,n[l+1]=Math.sin(c)*e}return n}_getDotVertices(e,t){return this._getCircleVertices(e,t,!0)}_updateMatricesBackground(t,r){var i=r.getSculptManager().getCurrentTool().getScreenRadius(),s=.5*t._width,n=.5*t._height;a.v3(ee,-s,s,-n,n,-10,10),a.D_(te),a.Tl(te,te,e.hZ(re,-s+r._mouseX+this._offsetX,n-r._mouseY,0)),a.hs(this._cacheCircleMVP,te,e.hZ(re,i,i,i)),a.lK(this._cacheCircleMVP,ee,this._cacheCircleMVP),a.hs(this._cacheDotMVP,te,e.hZ(re,50,50,50)),a.lK(this._cacheDotMVP,ee,this._cacheDotMVP),a.hs(this._cacheDotSymMVP,this._cacheDotSymMVP,[0,0,0])}_updateMatricesMesh(t,r){var i=r.getPicking(),s=r.getPickingSymmetry(),n=Math.sqrt(i.computeWorldRadius2(!0)),o=r.getSculptManager().getCurrentTool().getScreenRadius(),l=i.getMesh(),c=n/o*50;i.polyLerp(l.getNormals(),ie),e.ei(ie,ie,u(te,l.getMatrix())),e.S8(ie,ie);var h=Math.acos(e.Om(se,ie));e.$A(ie,se,ie),a.D_(te),a.Tl(te,te,e.Z0(re,i.getIntersectionPoint(),l.getMatrix())),a.e$(te,te,h,ie),a.lK(ee,t.getProjection(),t.getView()),a.hs(this._cacheCircleMVP,te,e.hZ(re,n,n,n)),a.lK(this._cacheCircleMVP,ee,this._cacheCircleMVP),a.hs(this._cacheDotMVP,te,e.hZ(re,c,c,c)),a.lK(this._cacheDotMVP,ee,this._cacheDotMVP),e.Z0(re,s.getIntersectionPoint(),l.getMatrix()),a.D_(te),a.Tl(te,te,re),a.e$(te,te,h,ie),a.hs(te,te,e.hZ(re,c,c,c)),a.lK(this._cacheDotSymMVP,ee,te)}render(t){var r=t.getPicking().getMesh()&&!this._isEditMode;r?this._updateMatricesMesh(t.getCamera(),t):this._updateMatricesBackground(t.getCamera(),t);var s=t._action===i.A.Action.NOTHING;e.hZ(this._color,.8,s&&r?0:.4,0),$[i.A.Shader.SELECTION].getOrCreate(this._gl).draw(this,s,t.getSculptManager().getSymmetry()),this._isEditMode=!1}},ne=class{constructor(e){this._main=e,this._cbContinuous=this.updateContinuous.bind(this),this._lastMouseX=0,this._lastMouseY=0}setToolMesh(e){this._forceToolMesh=e}getMesh(){return this._forceToolMesh||this._main.getMesh()}start(e){var t=this._main,r=t.getPicking();if(!r.intersectionMouseMeshes())return!1;var i=t.setOrUnsetMesh(r.getMesh(),e);if(!i)return!1;r.initAlpha();var s=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null;return s&&(s.intersectionMouseMesh(i),s.initAlpha()),this.pushState(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,this.startSculpt(),!0}end(){this.getMesh()&&this.getMesh().balanceOctree()}pushState(){this._main.getStateManager().pushStateGeometry(this.getMesh())}startSculpt(){!0!==this._lockPosition&&this.sculptStroke()}preUpdate(e){var t=this._main,r=t.getPicking(),s=t._action===i.A.Action.SCULPT_EDIT;if(!s||e){s?r.intersectionMouseMesh():r.intersectionMouseMeshes();var a=r.getMesh();a&&t.getSculptManager().getSymmetry()&&t.getPickingSymmetry().intersectionMouseMesh(a)}}update(e){if(!0===this._lockPosition)return this.updateSculptLock(e);this.sculptStroke()}updateSculptLock(e){var t=this._main;e||this._main.getStateManager().getCurrentState().undo();var r=t.getPicking(),i=this._radius,s=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null,a=t._mouseX-this._lastMouseX,n=t._mouseY-this._lastMouseY;this._radius=Math.sqrt(a*a+n*n);var o=a/this._radius,l=n/this._radius;this.makeStroke(this._lastMouseX+.001*o,this._lastMouseY+.001*l,r,s),this._radius=i,this.updateRender(),t.setCanvasCursor("default")}sculptStroke(){var e=this._main,t=e.getPicking(),r=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null,i=e._mouseX-this._lastMouseX,s=e._mouseY-this._lastMouseY,a=Math.sqrt(i*i+s*s),n=.15*this._radius*e.getPixelRatio();if(!(a<=n)){var o=1/Math.floor(a/n);i*=o,s*=o;for(var l=this._lastMouseX+i,c=this._lastMouseY+s,h=o;h<=1&&this.makeStroke(l,c,t,r);h+=o)l+=i,c+=s;this.updateRender(),this._lastMouseX=e._mouseX,this._lastMouseY=e._mouseY}}updateRender(){this.updateMeshBuffers(),this._main.render()}makeStroke(e,t,r,i){var s=this.getMesh();r.intersectionMouseMesh(s,e,t);var a=r.getMesh();a&&(r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal());var n,o=s.isDynamic&&!this._lockPosition;return o&&a&&this.stroke(r,!1),i&&(i.intersectionMouseMesh(s,e,t),(n=i.getMesh())&&(i.setLocalRadius2(r.getLocalRadius2()),i.pickVerticesInSphere(i.getLocalRadius2()),i.computePickedNormal())),!o&&a&&this.stroke(r,!1),n&&this.stroke(i,!0),a||n}updateMeshBuffers(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateGeometryBuffers()}updateContinuous(){if(this._lockPosition)return this.update(!0);var e=this._main,t=e.getPicking(),r=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null;this.makeStroke(e._mouseX,e._mouseY,t,r),this.updateRender()}getFrontVertices(e,t){for(var r=e.length,i=new Uint32Array(s.A.getMemory(4*r),0,r),a=0,n=this.getMesh().getNormals(),o=t[0],l=t[1],c=t[2],h=0;h<r;++h){var u=e[h],d=3*u;n[d]*o+n[d+1]*l+n[d+2]*c<=0&&(i[a++]=u)}return new Uint32Array(i.subarray(0,a))}areaNormal(e){for(var t=this.getMesh(),r=t.getNormals(),i=t.getMaterials(),s=0,a=0,n=0,o=0,l=e.length;o<l;++o){var c=3*e[o],h=i[c+2];s+=r[c]*h,a+=r[c+1]*h,n+=r[c+2]*h}var u=Math.sqrt(s*s+a*a+n*n);if(0!==u)return[s*(u=1/u),a*u,n*u]}areaCenter(e){for(var t=this.getMesh(),r=t.getVertices(),i=t.getMaterials(),s=e.length,a=0,n=0,o=0,l=0,c=0;c<s;++c){var h=3*e[c],u=i[h+2];l+=u,a+=r[h]*u,n+=r[h+1]*u,o+=r[h+2]*u}return[a/l,n/l,o/l]}updateProxy(e){var t=this.getMesh(),r=t.getVertices(),i=t.getVerticesProxy();if(r!==i)for(var a=t.getVerticesStateFlags(),n=s.A.STATE_FLAG,o=0,l=e.length;o<l;++o){var c=e[o];if(a[c]!==n){var h=3*c;i[h]=r[h],i[h+1]=r[h+1],i[h+2]=r[h+2]}}}laplacianSmooth(e,t,r){for(var i=this.getMesh(),s=i.getVerticesRingVertStartCount(),a=i.getVerticesRingVert(),n=a instanceof Array?a:null,o=i.getVerticesOnEdge(),l=r||i.getVertices(),c=e.length,h=0;h<c;++h){var u,d,_=3*h,p=e[h];n?(u=0,d=(a=n[p]).length):d=(u=s[2*p])+s[2*p+1];var g=0,m=d-u;if(m<=2)g=3*p,t[_]=l[g],t[_+1]=l[g+1],t[_+2]=l[g+2];else{var f=0,v=0,A=0,T=0;if(1===o[p]){var b=0;for(T=u;T<d;++T)1===o[g=a[T]]&&(f+=l[g*=3],v+=l[g+1],A+=l[g+2],++b);if(b>=2){t[_]=f/b,t[_+1]=v/b,t[_+2]=A/b;continue}f=v=A=0}for(T=u;T<d;++T)f+=l[g=3*a[T]],v+=l[g+1],A+=l[g+2];t[_]=f/m,t[_+1]=v/m,t[_+2]=A/m}}}dynamicTopology(e){var t=this.getMesh(),r=e.getPickedVertices();if(!t.isDynamic)return r;var i=t.getSubdivisionFactor(),a=t.getDecimationFactor();if(0===i&&0===a)return r;0===r.length&&(r=t.getVerticesFromFaces([e.getPickedFace()]),this._main.getStateManager().pushVertices(r));var n=t.getFacesFromVertices(r),o=e.getLocalRadius2(),l=e.getIntersectionPoint(),c=o*(1.1-i)*.2,h=c/4.2025*a;this._main.getStateManager().pushFaces(n),i&&(n=t.subdivide(n,l,o,c,this._main.getStateManager())),a&&(n=t.decimate(n,l,o,h,this._main.getStateManager()));for(var u=(r=t.getVerticesFromFaces(n)).length,d=s.A.SCULPT_FLAG,_=t.getVerticesSculptFlags(),p=new Uint32Array(s.A.getMemory(4*u),0,u),g=0,m=0;m<u;++m){var f=r[m];_[f]===d&&(p[g++]=f)}return p=new Uint32Array(p.subarray(0,g)),t.updateTopology(n,r),t.updateGeometry(n,r),p}getUnmaskedVertices(){return this.filterMaskedVertices(0,1/0)}getMaskedVertices(){return this.filterMaskedVertices(-1/0,1)}filterMaskedVertices(e=-1/0,t=1/0){for(var r=this.getMesh(),i=r.getMaterials(),a=r.getNbVertices(),n=new Uint32Array(s.A.getMemory(4*a),0,a),o=0,l=0;l<a;++l){var c=i[3*l+2];c>e&&c<t&&(n[o++]=l)}return new Uint32Array(n.subarray(0,o))}postRender(e){e.render(this._main)}addSculptToScene(){}getScreenRadius(){return(this._radius||1)*this._main.getPixelRatio()}},oe=class extends ne{constructor(e){super(e),this._radius=50,this._intensity=.75,this._negative=!0,this._culling=!1,this._idAlpha=0,this._lockPosition=!1}stroke(e){var t=e.getPickedVertices(),i=this._intensity*r.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e);var s=this.getFrontVertices(t,e.getEyeDirection());this._culling&&(t=s);var a=this.areaNormal(s);if(a){var n=this.areaCenter(s);e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.flatten(t,a,n,e.getIntersectionPoint(),e.getLocalRadius2(),i,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(t),t)}}flatten(e,t,r,i,s,a,n){for(var o=this.getMesh(),l=o.getVertices(),c=o.getMaterials(),h=Math.sqrt(s),u=!1===this._accumulate&&!1===this._lockPosition?o.getVerticesProxy():l,d=i[0],_=i[1],p=i[2],g=r[0],m=r[1],f=r[2],v=t[0],A=t[1],T=t[2],b=this._negative?-1:1,M=0,y=e.length;M<y;++M){var E=3*e[M],S=l[E],R=l[E+1],x=l[E+2],C=(S-g)*v+(R-m)*A+(x-f)*T;if(!(C*b>0)){var w=u[E]-d,P=u[E+1]-_,D=u[E+2]-p,k=Math.sqrt(w*w+P*P+D*D)/h;if(!(k>=1)){var I=k*k;I=3*I*I-4*I*k+1,I*=C*a*c[E+2]*n.getAlpha(S,R,x),l[E]-=v*I,l[E+1]-=A*I,l[E+2]-=T*I}}}}};function le(e,t,r){return e[0]=t,e[1]=r,e}function ce(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function he(e,t){var r=t[0],i=t[1],s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e}function ue(e,t){return e[0]*t[0]+e[1]*t[1]}var de,_e=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},pe=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)};function ge(){var e=new o.tb(4);return o.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function me(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function fe(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function ve(e,t,r){r*=.5;var i=t[0],s=t[1],a=t[2],n=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=s*l+a*o,e[2]=a*l-s*o,e[3]=n*l-i*o,e}function Ae(e,t,r){r*=.5;var i=t[0],s=t[1],a=t[2],n=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*o,e[1]=s*l+n*o,e[2]=a*l+i*o,e[3]=n*l-s*o,e}de=new o.tb(2),o.tb!=Float32Array&&(de[0]=0,de[1]=0),function(){var e=new o.tb(4);o.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Te=function(e,t,r,i){var s=new o.tb(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},be=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*h+n*o+s*c-a*l,e[1]=s*h+n*l+a*o-i*c,e[2]=a*h+n*c+i*l-s*o,e[3]=n*h-i*o-s*l-a*c,e},Me=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ye=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=r*r+i*i+s*s+a*a;return n>0&&(n=1/Math.sqrt(n)),e[0]=r*n,e[1]=i*n,e[2]=s*n,e[3]=a*n,e};e.vt(),e.fA(1,0,0),e.fA(0,1,0),ge(),ge(),l();var Ee=__webpack_require__(622);const Se=class extends ne{constructor(e){super(e),this._radius=50,this._intensity=.75,this._culling=!1,this._tangent=!1,this._idAlpha=0,this._lockPosition=!1}stroke(e){var t=e.getPickedVertices(),i=this._intensity*r.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this._tangent?this.smoothTangent(t,i,e):this.smooth(t,i,e);var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t),t)}smooth(e,t,r){var i=this.getMesh(),a=i.getVertices(),n=i.getMaterials(),o=e.length,l=new Float32Array(s.A.getMemory(4*o*3),0,3*o);this.laplacianSmooth(e,l);for(var c=0;c<o;++c){var h=3*e[c],u=a[h],d=a[h+1],_=a[h+2],p=3*c,g=t*n[h+2];r&&(g*=r.getAlpha(u,d,_));var m=1-g;a[h]=u*m+l[p]*g,a[h+1]=d*m+l[p+1]*g,a[h+2]=_*m+l[p+2]*g}}smoothTangent(e,t,r){var i=this.getMesh(),a=i.getVertices(),n=i.getMaterials(),o=i.getNormals(),l=e.length,c=new Float32Array(s.A.getMemory(4*l*3),0,3*l);this.laplacianSmooth(e,c);for(var h=0;h<l;++h){var u=3*e[h],d=a[u],_=a[u+1],p=a[u+2],g=o[u],m=o[u+1],f=o[u+2],v=g*g+m*m+f*f;if(0!==v){g*=v=1/Math.sqrt(v),m*=v,f*=v;var A=3*h,T=c[A],b=c[A+1],M=c[A+2],y=g*(T-d)+m*(b-_)+f*(M-p),E=t*n[u+2];r&&(E*=r.getAlpha(d,_,p)),a[u]=d+(T-g*y-d)*E,a[u+1]=_+(b-m*y-_)*E,a[u+2]=p+(M-f*y-p)*E}}}smoothAlongNormals(e,t,r){var i=this.getMesh(),a=i.getVertices(),n=i.getMaterials(),o=i.getNormals(),l=e.length,c=new Float32Array(s.A.getMemory(4*l*3),0,3*l);this.laplacianSmooth(e,c);for(var h=0;h<l;++h){var u=3*e[h],d=a[u],_=a[u+1],p=a[u+2],g=o[u],m=o[u+1],f=o[u+2],v=3*h,A=1/(g*g+m*m+f*f),T=g*(c[v]-d)+m*(c[v+1]-_)+f*(c[v+2]-p);T*=A*t*n[u+2],r&&(T*=r.getAlpha(d,_,p)),a[u]=d+g*T,a[u+1]=_+m*T,a[u+2]=p+f*T}}},Re=class extends ne{constructor(t){super(t),this._radius=50,this._hardness=.75,this._intensity=.75,this._culling=!1,this._color=e.fA(1,.766,.336),this._material=e.fA(.3,.95,0),this._pickColor=!1,this._pickCallback=null,this._idAlpha=0,this._lockPosition=!1,this._writeAlbedo=!0,this._writeRoughness=!0,this._writeMetalness=!0}end(){this._pickColor=!1,super.end()}pushState(e){this._pickColor&&!e||this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}startSculpt(){if(this._pickColor)return this.pickColor(this._main.getPicking());super.startSculpt()}update(e){if(!0===this._pickColor)return this.updatePickColor();super.update(e)}updateContinuous(){if(!0===this._pickColor)return this.updatePickColor();super.updateContinuous()}updateMeshBuffers(){var e=this.getMesh();e.isDynamic?e.updateBuffers():(e.updateColorBuffer(),e.updateMaterialBuffer())}updatePickColor(){var e=this._main.getPicking();e.intersectionMouseMesh()&&this.pickColor(e)}setPickCallback(e){this._pickCallback=e}pickColor(e){var t=this.getMesh(),r=this._color;e.polyLerp(t.getMaterials(),r);var i=r[0],s=r[1];e.polyLerp(t.getColors(),r),this._pickCallback(r,i,s)}stroke(e){var t=e.getPickedVertices(),i=this._intensity*r.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.paint(t,e.getIntersectionPoint(),e.getLocalRadius2(),i,this._hardness,e);var s=this.getMesh();s.updateDuplicateColorsAndMaterials(t),s.isUsingDrawArrays()&&s.updateDrawArrays(s.getFacesFromVertices(t))}paint(e,t,r,i,s,a){for(var n=this.getMesh(),o=n.getVertices(),l=n.getColors(),c=n.getMaterials(),h=this._color,u=this._material[0],d=this._material[1],_=Math.sqrt(r),p=h[0],g=h[1],m=h[2],f=t[0],v=t[1],A=t[2],T=2*(1-s),b=0,M=e.length;b<M;++b){var y=3*e[b],E=o[y],S=o[y+1],R=o[y+2],x=E-f,C=S-v,w=R-A,P=Math.sqrt(x*x+C*C+w*w)/_;P>1&&(P=1);var D=Math.pow(1-P,T),k=1-(D*=i*c[y+2]*a.getAlpha(E,S,R));this._writeAlbedo&&(l[y]=l[y]*k+p*D,l[y+1]=l[y+1]*k+g*D,l[y+2]=l[y+2]*k+m*D),this._writeRoughness&&(c[y]=c[y]*k+u*D),this._writeMetalness&&(c[y+1]=c[y+1]*k+d*D)}}paintAll(){var e=this.getMesh(),t=this.getUnmaskedVertices();if(0!==t.length){this.pushState(!0),this._main.getStateManager().pushVertices(t);for(var r=e.getColors(),i=e.getMaterials(),s=this._color,a=this._material[0],n=this._material[1],o=s[0],l=s[1],c=s[2],h=0,u=t.length;h<u;++h){var d=3*t[h],_=i[d+2],p=1-_;this._writeAlbedo&&(r[d]=r[d]*p+o*_,r[d+1]=r[d+1]*p+l*_,r[d+2]=r[d+2]*p+c*_),this._writeRoughness&&(i[d]=i[d]*p+a*_),this._writeMetalness&&(i[d+1]=i[d+1]*p+n*_)}e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}}};class xe{constructor(e){this._parent=e||null,this._depth=e?e._depth+1:0,this._children=[],this._aabbLoose=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._aabbSplit=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._iFaces=[],this._flag=0}resetNbFaces(e){var t=this._iFaces;t.length=e;for(var r=0;r<e;++r)t[r]=r}build(e){var t=0,r=xe.STACK;r[0]=this;for(var i=1,s=[];i>0;){var a=r[--i],n=a._iFaces.length;if(n>xe.MAX_FACES&&a._depth<xe.MAX_DEPTH){a.constructChildren(e);var o=a._children;for(t=0;t<8;++t)r[i+t]=o[t];i+=8}else n>0&&s.push(a)}var l=s.length;for(t=0;t<l;++t)s[t].constructLeaf(e)}constructLeaf(e){for(var t=this._iFaces,r=t.length,i=1/0,s=1/0,a=1/0,n=-1/0,o=-1/0,l=-1/0,c=e.getFaceBoxes(),h=e.getFacePosInLeaf(),u=e.getFaceLeaf(),d=0;d<r;++d){var _=t[d];u[_]=this,h[_]=d;var p=c[_*=6],g=c[_+1],m=c[_+2],f=c[_+3],v=c[_+4],A=c[_+5];p<i&&(i=p),f>n&&(n=f),g<s&&(s=g),v>o&&(o=v),m<a&&(a=m),A>l&&(l=A)}this.expandsAabbLoose(i,s,a,n,o,l)}constructChildren(e){for(var t=this._aabbSplit,r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=.5*(a-r),c=.5*(n-i),h=.5*(o-s),u=.5*(a+r),d=.5*(n+i),_=.5*(o+s),p=new xe(this),g=new xe(this),m=new xe(this),f=new xe(this),v=new xe(this),A=new xe(this),T=new xe(this),b=new xe(this),M=p._iFaces,y=g._iFaces,E=m._iFaces,S=f._iFaces,R=v._iFaces,x=A._iFaces,C=T._iFaces,w=b._iFaces,P=e.getFaceCenters(),D=this._iFaces,k=D.length,I=0;I<k;++I){var F=D[I],L=3*F,V=P[L],N=P[L+1],O=P[L+2];V>u?N>d?O>_?C.push(F):x.push(F):O>_?E.push(F):y.push(F):N>d?O>_?w.push(F):R.push(F):O>_?S.push(F):M.push(F)}p.setAabbSplit(r,i,s,u,d,_),g.setAabbSplit(r+l,i,s,u+l,d,_),m.setAabbSplit(u,d-c,_,a,n-c,o),f.setAabbSplit(r,i,s+h,u,d,_+h),v.setAabbSplit(r,i+c,s,u,d+c,_),A.setAabbSplit(u,d,_-h,a,n,o-h),T.setAabbSplit(u,d,_,a,n,o),b.setAabbSplit(u-l,d,_,a-l,n,o),this._children.length=0,this._children.push(p,g,m,f,v,A,T,b),D.length=0}setAabbSplit(e,t,r,i,s,a){var n=this._aabbSplit;n[0]=e,n[1]=t,n[2]=r,n[3]=i,n[4]=s,n[5]=a}setAabbLoose(e,t,r,i,s,a){var n=this._aabbLoose;n[0]=e,n[1]=t,n[2]=r,n[3]=i,n[4]=s,n[5]=a}collectIntersectRay(e,t,r,i){var s=e[0],a=e[1],n=e[2],o=1/t[0],l=1/t[1],c=1/t[2],h=0,u=xe.STACK;u[0]=this;for(var d=1;d>0;){var _=u[--d],p=_._aabbLoose,g=(p[0]-s)*o,m=(p[3]-s)*o,f=(p[1]-a)*l,v=(p[4]-a)*l,A=(p[2]-n)*c,T=(p[5]-n)*c,b=Math.max(Math.min(g,m),Math.min(f,v),Math.min(A,T)),M=Math.min(Math.max(g,m),Math.max(f,v),Math.max(A,T));if(!(M<0||b>M)){var y=_._children;if(8===y.length){for(var E=0;E<8;++E)u[d+E]=y[E];d+=8}else{i&&i.push(_);var S=_._iFaces;r.set(S,h),h+=S.length}}}return new Uint32Array(r.subarray(0,h))}collectIntersectSphere(e,t,r,i){var s=e[0],a=e[1],n=e[2],o=0,l=xe.STACK;l[0]=this;for(var c=1;c>0;){var h,u,d,_=l[--c],p=_._aabbLoose;if(!((h=p[0]>s?p[0]-s:p[3]<s?p[3]-s:0)*h+(u=p[1]>a?p[1]-a:p[4]<a?p[4]-a:0)*u+(d=p[2]>n?p[2]-n:p[5]<n?p[5]-n:0)*d>t)){var g=_._children;if(8===g.length){for(var m=0;m<8;++m)l[c+m]=g[m];c+=8}else{i&&i.push(_);var f=_._iFaces;r.set(f,o),o+=f.length}}}return new Uint32Array(r.subarray(0,o))}addFace(e,t,r,i,s,a,n,o,l,c){var h=xe.STACK;h[0]=this;for(var u=1;u>0;){var d=h[--u],_=d._aabbSplit;if(!(o<=_[0]||l<=_[1]||c<=_[2]||o>_[3]||l>_[4]||c>_[5])){var p=d._aabbLoose;t<p[0]&&(p[0]=t),r<p[1]&&(p[1]=r),i<p[2]&&(p[2]=i),s>p[3]&&(p[3]=s),a>p[4]&&(p[4]=a),n>p[5]&&(p[5]=n);var g=d._children;if(8!==g.length)return d._iFaces.push(e),d;for(var m=0;m<8;++m)h[u+m]=g[m];u+=8}}}pruneIfPossible(){for(var e=this;e._parent;){var t=e._parent,r=t._children;if(0===r.length)return;for(var i=0;i<8;++i){var s=r[i];if(s._iFaces.length>0||8===s._children.length)return}r.length=0,e=t}}expandsAabbLoose(e,t,r,i,s,a){for(var n=this;n;){var o=n._aabbLoose,l=!1;e<o[0]&&(o[0]=e,l=!0),t<o[1]&&(o[1]=t,l=!0),r<o[2]&&(o[2]=r,l=!0),i>o[3]&&(o[3]=i,l=!0),s>o[4]&&(o[4]=s,l=!0),a>o[5]&&(o[5]=a,l=!0),n=l?n._parent:null}}}xe.FLAG=0,xe.MAX_DEPTH=8,xe.MAX_FACES=100,function(){for(var e=1+7*xe.MAX_DEPTH,t=xe.STACK=new Array(e),r=0;r<e;++r)t[r]=null}();const Ce=xe;var we=function(e){var t=(0,n.A)();return{_gl:e,_shaderType:t.shader,_flatShading:t.flatshading,_showWireframe:t.wireframe,_matcap:Math.min(t.matcap,C.matcaps.length-1),_curvature:Math.min(t.curvature,5),_texture0:null,_useDrawArrays:!1,_vertexBuffer:new d(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_normalBuffer:new d(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_colorBuffer:new d(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_materialBuffer:new d(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_texCoordBuffer:new d(e,e.ARRAY_BUFFER,e.STATIC_DRAW),_indexBuffer:new d(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_wireframeBuffer:new d(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_albedo:new Float32Array([-1,-1,-1]),_roughness:-.18,_metallic:-.78,_alpha:1,_flatColor:new Float32Array([1,0,0]),_mode:e.TRIANGLES}};we.ONLY_DRAW_ARRAYS=!1;const Pe=we;class De{constructor(){this._id=De.ID++,this._meshData=null,this._transformData=null,this._renderData=null,this._isVisible=!0}static sortFunction(e,t){var r=e.isTransparent(),i=t.isTransparent();return r&&!i?1:!r&&i?-1:(t.getDepth()-e.getDepth())*(r&&i?1:-1)}setID(e){this._id=e}isVisible(){return this._isVisible}setVisible(e){this._isVisible=e}setVertices(e){this._meshData._verticesXYZ=e,this._meshData._nbVertices=e.length/3}setFaces(e){this._meshData._facesABCD=e,this._meshData._nbFaces=e.length/4}setTexCoords(e){this._meshData._texCoordsST=e,this._meshData._nbTexCoords=e.length/2}setColors(e){this._meshData._colorsRGB=e}setMaterials(e){this._meshData._materialsPBR=e}setVerticesDuplicateStartCount(e){this._meshData._duplicateStartCount=e}setFacesTexCoord(e){this._meshData._UVfacesABCD=e}setMeshData(e){this._meshData=e}setRenderData(e){this._renderData=e}setTransformData(e){this._transformData=e}setNbVertices(e){this._meshData._nbVertices=e}setNbFaces(e){this._meshData._nbFaces=e}getID(){return this._id}getRenderData(){return this._renderData}getMeshData(){return this._meshData}getTransformData(){return this._transformData}getNbVertices(){return this._meshData._nbVertices}getNbFaces(){return this._meshData._nbFaces}getNbQuads(){return this.getNbTriangles()-this.getNbFaces()}getNbTriangles(){return this._meshData._trianglesABC.length/3}getNbTexCoords(){return this._meshData._nbTexCoords}hasUV(){return null!==this._meshData._texCoordsST}getVertices(){return this._meshData._verticesXYZ}getColors(){return this._meshData._colorsRGB}getNormals(){return this._meshData._normalsXYZ}getMaterials(){return this._meshData._materialsPBR}getVerticesTagFlags(){return this._meshData._vertTagFlags}getVerticesSculptFlags(){return this._meshData._vertSculptFlags}getVerticesStateFlags(){return this._meshData._vertStateFlags}getVerticesRingVertStartCount(){return this._meshData._vrvStartCount}getVerticesRingVert(){return this._meshData._vertRingVert}getVerticesRingFaceStartCount(){return this._meshData._vrfStartCount}getVerticesRingFace(){return this._meshData._vertRingFace}getVerticesOnEdge(){return this._meshData._vertOnEdge}getVerticesProxy(){return this._meshData._vertProxy}getFaces(){return this._meshData._facesABCD}hasOnlyTriangles(){return this.getNbTriangles()===this.getNbFaces()}hasOnlyQuads(){return this.getNbTriangles()===2*this.getNbFaces()}getFaceNormals(){return this._meshData._faceNormalsXYZ}getFaceBoxes(){return this._meshData._faceBoxes}getFaceCenters(){return this._meshData._faceCentersXYZ}getFacesTagFlags(){return this._meshData._facesTagFlags}getFaceEdges(){return this._meshData._faceEdges}getFacesToTriangles(){return this._meshData._facesToTriangles}getTrianglesTexCoord(){return this._meshData._UVtrianglesABC}getTriangles(){return this._meshData._trianglesABC}getEdges(){return this._meshData._edges}getNbEdges(){return this._meshData._edges.length}getTexCoords(){return this._meshData._texCoordsST}getVerticesDuplicateStartCount(){return this._meshData._duplicateStartCount}getFacesTexCoord(){return this._meshData._UVfacesABCD}getVerticesDrawArrays(){return this._meshData._DAverticesXYZ||this.updateDrawArrays(),this._meshData._DAverticesXYZ}getNormalsDrawArrays(){return this._meshData._DAnormalsXYZ}getColorsDrawArrays(){return this._meshData._DAcolorsRGB}getMaterialsDrawArrays(){return this._meshData._DAmaterialsPBR}getTexCoordsDrawArrays(){return this._meshData._DAtexCoordsST}getOctree(){return this._meshData._octree}getCenter(){return this._transformData._center}getMV(){return this._transformData._lastComputedMV}getMVP(){return this._transformData._lastComputedMVP}getN(){return this._transformData._lastComputedN}getEN(){return this._transformData._lastComputedEN}getDepth(){return this._transformData._lastComputedDepth}getMatrix(){return this._transformData._matrix}getYawPitchRoll(){return this._transformData._yawPitchRoll}setYawPitchRoll(t,r,i){e.hZ(this._transformData._yawPitchRoll,t,r,i),this._applyYawPitchRoll()}updateYawPitchRollFromMatrix(){!function(t,r){var i=r[0],s=r[1],a=r[2],n=r[4],o=r[5],l=r[6],c=r[8],h=r[9],u=r[10],d=Math.hypot(i,s,a),_=Math.hypot(n,o,l),p=Math.hypot(c,h,u);d>0&&(i/=d,s/=d,a/=d),_>0&&(n/=_,o/=_,l/=_),p>0&&(c/=p,h/=p,u/=p);var g=Math.asin(Math.max(-1,Math.min(1,-h))),m=Math.atan2(c,u),f=Math.atan2(s,o);e.hZ(t,m,g,f)}(this._transformData._yawPitchRoll,this._transformData._matrix)}_applyYawPitchRoll(){var e=this._transformData,t=e._matrix,r=this.getScale(),i=t[12],s=t[13],n=t[14];!function(e,t,r,i){a.D_(e),a.Z8(e,e,t),a.eL(e,e,r),a.Qr(e,e,i)}(t,e._yawPitchRoll[0],e._yawPitchRoll[1],e._yawPitchRoll[2]),a.hs(t,t,[r,r,r]),t[12]=i,t[13]=s,t[14]=n}getEditMatrix(){return this._transformData._editMatrix}getScale2(){var e=this._transformData._matrix;return e[0]*e[0]+e[4]*e[4]+e[8]*e[8]}getScale(){return Math.sqrt(this.getScale2())}getSymmetryOrigin(){var t=e.vt(),r=this._transformData,i=r._symmetryOffset*this.computeLocalRadius();return e.Ln(t,r._center,r._symmetryNormal,i)}getSymmetryOffset(){return this._transformData._symmetryOffset}setSymmetryOffset(e){this._transformData._symmetryOffset=e}getSymmetryNormal(){return this._transformData._symmetryNormal}getFacePosInLeaf(){return this._meshData._facePosInLeaf}getFaceLeaf(){return this._meshData._faceLeaf}getLeavesToUpdate(){return this._meshData._leavesToUpdate}getLocalBound(){return this._meshData._octree._aabbLoose}getRenderNbEdges(){return this.getNbEdges()}init(){this.initColorsAndMaterials(),this.allocateArrays(),this.initTopology(),this.updateGeometry(),this._renderData&&this.updateDuplicateColorsAndMaterials(),this.updateCenter()}initTopology(){this.initFaceRings(),this.optimize(),this.initEdges(),this.initVertexRings(),this.initRenderTriangles()}updateGeometry(e,t){this.updateFacesAabbAndNormal(e),this.updateVerticesNormal(t),this.updateOctree(e),this._renderData&&(this.updateDuplicateGeometry(t),this.updateDrawArrays(e))}allocateArrays(){var e=this.getNbVertices();if(this.hasUV()){var t=this._meshData._texCoordsST.length/2,r=new Float32Array(3*t);r.set(this._meshData._verticesXYZ),this._meshData._verticesXYZ=r,this._meshData._normalsXYZ=new Float32Array(3*t),r=new Float32Array(3*t),this._meshData._colorsRGB&&r.set(this._meshData._colorsRGB),this._meshData._colorsRGB=r,r=new Float32Array(3*t),this._meshData._materialsPBR&&r.set(this._meshData._materialsPBR),this._meshData._materialsPBR=r}else this._meshData._normalsXYZ=this._meshData._normalsXYZ||new Float32Array(3*e),this._meshData._colorsRGB=this._meshData._colorsRGB||new Float32Array(3*e),this._meshData._materialsPBR=this._meshData._materialsPBR||new Float32Array(3*e);this._meshData._vertOnEdge=new Uint8Array(e),this._meshData._vrvStartCount=new Uint32Array(2*e),this._meshData._vrfStartCount=new Uint32Array(2*e),this._meshData._vertTagFlags=new Int32Array(e),this._meshData._vertSculptFlags=new Int32Array(e),this._meshData._vertStateFlags=new Int32Array(e),this._meshData._vertProxy=new Float32Array(3*e);var i=this.getNbFaces();this._meshData._faceEdges=new Uint32Array(4*i),this._meshData._facesToTriangles=new Uint32Array(i),this._meshData._faceBoxes=new Float32Array(6*i),this._meshData._faceNormalsXYZ=new Float32Array(3*i),this._meshData._faceCentersXYZ=new Float32Array(3*i),this._meshData._facesTagFlags=new Int32Array(i),this._meshData._facePosInLeaf=new Uint32Array(i);var s=this._meshData._faceLeaf;s.length=i;for(var a=0;a<i;++a)s[a]=null}initColorsAndMaterials(){var e=this.getNbVertices(),t=0,r=3*e;if(!this._meshData._colorsRGB||this._meshData._colorsRGB.length!==r){var i=this._meshData._colorsRGB=new Float32Array(r);for(t=0;t<r;++t)i[t]=1}if(!this._meshData._materialsPBR||this._meshData._materialsPBR.length!==r){var s=this._meshData._materialsPBR=new Float32Array(r);for(t=0;t<e;++t){var a=3*t;s[a]=.18,s[a+1]=.08,s[a+2]=1}}}initFaceRings(){var e=this.getFaces(),t=this.getNbVertices(),r=this.getNbFaces(),i=0,a=0,n=new Uint32Array(t);for(i=0;i<r;++i){n[e[a=4*i]]++,n[e[a+1]]++,n[e[a+2]]++;var o=e[a+3];o!==s.A.TRI_INDEX&&n[o]++}var l=this.getVerticesRingFaceStartCount(),c=0;for(i=0;i<t;++i){var h=n[i];l[2*i]=c,l[2*i+1]=h,c+=h}var u=new Uint32Array(s.A.getMemory(4*r*6),0,6*r);for(c=0,i=0;i<r;++i){var d=e[a=4*i],_=e[a+1],p=e[a+2],g=e[a+3];u[l[2*d]+--n[d]]=i,u[l[2*_]+--n[_]]=i,u[l[2*p]+--n[p]]=i,g!==s.A.TRI_INDEX&&(u[l[2*g]+--n[g]]=i,++c)}this._meshData._vertRingFace=new Uint32Array(u.subarray(0,3*r+c))}updateVerticesNormal(e){for(var t=this.getVerticesRingFaceStartCount(),r=this.getVerticesRingFace(),i=r instanceof Array?r:null,s=this.getNormals(),a=this.getFaceNormals(),n=void 0===e,o=n?this.getNbVertices():e.length,l=0;l<o;++l){var c,h,u=n?l:e[l];i?(c=0,h=(r=i[u]).length):h=(c=t[2*u])+t[2*u+1];for(var d=0,_=0,p=0,g=c;g<h;++g){var m=3*r[g];d+=a[m],_+=a[m+1],p+=a[m+2]}var f=h-c;0!==f&&(f=1/f),s[u*=3]=d*f,s[u+1]=_*f,s[u+2]=p*f}}initVertexRings(){for(var e=this.getVerticesRingVertStartCount(),t=this._meshData._vertRingVert=new Uint32Array(2*this.getNbEdges()),r=this.getVerticesRingFaceStartCount(),i=this.getVerticesRingFace(),a=this.getVerticesTagFlags(),n=this.getVerticesOnEdge(),o=this.getFaces(),l=0,c=0,h=this.getNbVertices();c<h;++c){for(var u=++s.A.TAG_FLAG,d=r[2*c],_=d+r[2*c+1],p=0,g=d;g<_;++g){var m=4*i[g],f=o[m],v=o[m+1],A=o[m+2],T=o[m+3];f===c?f=T!==s.A.TRI_INDEX?T:A:v===c||T===c?v=A:A===c&&T!==s.A.TRI_INDEX&&(f=T),a[f]!==u&&(t[l+p++]=f,a[f]=u),a[v]!==u&&(t[l+p++]=v,a[v]=u)}e[2*c]=l,e[2*c+1]=p,l+=p,_-d!==p&&(n[c]=1)}}expandsVertices(e,t){var r=++s.A.TAG_FLAG,i=e.length,a=this.getVerticesRingVertStartCount(),n=this.getVerticesRingVert(),o=n instanceof Array?n:null,l=this.getVerticesTagFlags(),c=i,h=this.getNbVertices(),u=new Uint32Array(s.A.getMemory(4*h),0,h);u.set(e);var d=0;for(d=0;d<i;++d)l[u[d]]=r;for(var _=0;t;){for(--t,d=_;d<i;++d){var p,g,m=u[d];o?(p=0,g=(n=o[m]).length):g=(p=a[2*m])+a[2*m+1];for(var f=p;f<g;++f){var v=n[f];l[v]!==r&&(l[v]=r,u[c++]=v)}}_=i,i=c}return new Uint32Array(u.subarray(0,c))}getVerticesFromFaces(e){for(var t=++s.A.TAG_FLAG,r=e.length,i=this.getVerticesTagFlags(),a=this.getFaces(),n=0,o=new Uint32Array(s.A.getMemory(4*e.length*4),0,4*e.length),l=0;l<r;++l){var c=4*e[l],h=a[c],u=a[c+1],d=a[c+2],_=a[c+3];i[h]!==t&&(i[h]=t,o[n++]=h),i[u]!==t&&(i[u]=t,o[n++]=u),i[d]!==t&&(i[d]=t,o[n++]=d),_!==s.A.TRI_INDEX&&i[_]!==t&&(i[_]=t,o[n++]=_)}return new Uint32Array(o.subarray(0,n))}updateFacesAabbAndNormal(e){for(var t=this.getFaceNormals(),r=this.getFaceBoxes(),i=this.getFaceCenters(),a=this.getVertices(),n=this.getFaces(),o=void 0===e,l=o?this.getNbFaces():e.length,c=0;c<l;++c){var h=o?c:e[c],u=3*h,d=4*h,_=6*h,p=3*n[d],g=3*n[d+1],m=3*n[d+2],f=n[d+3],v=f!==s.A.TRI_INDEX;v&&(f*=3);var A=a[p],T=a[p+1],b=a[p+2],M=a[g],y=a[g+1],E=a[g+2],S=a[m],R=a[m+1],x=a[m+2],C=M-A,w=y-T,P=E-b,D=S-A,k=R-T,I=x-b,F=w*I-P*k,L=P*D-C*I,V=C*k-w*D,N=A<M?A<S?A:S:M<S?M:S,O=A>M?A>S?A:S:M>S?M:S,B=T<y?T<R?T:R:y<R?y:R,U=T>y?T>R?T:R:y>R?y:R,G=b<E?b<x?b:x:E<x?E:x,W=b>E?b>x?b:x:E>x?E:x;if(v){var z=a[f],X=a[f+1],j=a[f+2];z<N&&(N=z),z>O&&(O=z),X<B&&(B=X),X>U&&(U=X),j<G&&(G=j),j>W&&(W=j),F+=(w=R-X)*I-(P=x-j)*k,L+=P*D-(C=S-z)*I,V+=C*k-w*D}t[u]=F,t[u+1]=L,t[u+2]=V,r[_]=N,r[_+1]=B,r[_+2]=G,r[_+3]=O,r[_+4]=U,r[_+5]=W,i[u]=.5*(N+O),i[u+1]=.5*(B+U),i[u+2]=.5*(G+W)}}expandsFaces(e,t){var r=++s.A.TAG_FLAG,i=e.length,a=this.getVerticesRingFaceStartCount(),n=this.getVerticesRingFace(),o=n instanceof Array?n:null,l=this.getFacesTagFlags(),c=this.getFaces(),h=i,u=new Uint32Array(s.A.getMemory(4*this.getNbFaces()),0,this.getNbFaces());u.set(e);var d=0;for(d=0;d<i;++d)l[u[d]]=r;for(var _=0;t;){for(--t,d=_;d<i;++d)for(var p=4*u[d],g=0;g<4;++g){var m=c[p+g];if(m!==s.A.TRI_INDEX){var f,v;o?(f=0,v=(n=o[m]).length):v=(f=a[2*m])+a[2*m+1];for(var A=f;A<v;++A){var T=n[A];l[T]!==r&&(l[T]=r,u[h++]=T)}}}_=i,i=h}return new Uint32Array(u.subarray(0,h))}getFacesFromVertices(e){for(var t=++s.A.TAG_FLAG,r=e.length,i=this.getVerticesRingFaceStartCount(),a=this.getVerticesRingFace(),n=a instanceof Array?a:null,o=this.getFacesTagFlags(),l=0,c=new Uint32Array(s.A.getMemory(4*this.getNbFaces()),0,this.getNbFaces()),h=0;h<r;++h){var u,d,_=e[h];n?(u=0,d=(a=n[_]).length):d=(u=i[2*_])+i[2*_+1];for(var p=u;p<d;++p){var g=a[p];o[g]!==t&&(o[g]=t,c[l++]=g)}}return new Uint32Array(c.subarray(0,l))}initRenderTriangles(){this.hasUV()&&(this._meshData._UVtrianglesABC=this.computeTrianglesFromFaces(this.getFacesTexCoord())),this._meshData._trianglesABC=this.computeTrianglesFromFaces(this.getFaces())}computeTrianglesFromFaces(e){for(var t=this.getNbFaces(),r=this.getFacesToTriangles(),i=new Uint32Array(s.A.getMemory(4*t*6),0,6*t),a=0,n=0;n<t;++n){r[n]=a;var o=4*n,l=e[o],c=e[o+1],h=e[o+2],u=e[o+3],d=3*a;i[d]=l,i[d+1]=c,i[d+2]=h,++a,u!==s.A.TRI_INDEX&&(i[d=3*a]=l,i[d+1]=h,i[d+2]=u,++a)}return new Uint32Array(i.subarray(0,3*a))}initEdges(){for(var e=this.getFaces(),t=this.getFaceEdges(),r=0,i=new Uint32Array(this.getNbVertices()),a=this.getVerticesRingFaceStartCount(),n=this.getVerticesRingFace(),o=0,l=this.getNbVertices();o<l;++o)for(var c=a[2*o],h=c+a[2*o+1],u=r,d=c;d<h;++d){var _=4*n[d],p=e[_],g=e[_+1],m=e[_+2],f=e[_+3],v=0,A=0;f===s.A.TRI_INDEX?(o>p&&(A=_+(o===g?0:2),(v=i[p])<=u?(t[A]=r,i[p]=++r):t[A]=v-1),o>g&&(A=_+(o===p?0:1),(v=i[g])<=u?(t[A]=r,i[g]=++r):t[A]=v-1),o>m&&(A=_+(o===p?2:1),(v=i[m])<=u?(t[A]=r,i[m]=++r):t[A]=v-1),t[_+3]=s.A.TRI_INDEX):(o>p&&o!==m&&(A=_+(o===g?0:3),(v=i[p])<=u?(t[A]=r,i[p]=++r):t[A]=v-1),o>g&&o!==f&&(A=_+(o===p?0:1),(v=i[g])<=u?(t[A]=r,i[g]=++r):t[A]=v-1),o>m&&o!==p&&(A=_+(o===g?1:2),(v=i[m])<=u?(t[A]=r,i[m]=++r):t[A]=v-1),o>f&&o!==g&&(A=_+(o===p?3:2),(v=i[f])<=u?(t[A]=r,i[f]=++r):t[A]=v-1))}for(var T=this._meshData._edges=new Uint8ClampedArray(r),b=0,M=this.getNbFaces();b<M;++b){var y=4*b;T[t[y]]++,T[t[y+1]]++,T[t[y+2]]++;var E=t[y+3];E!==s.A.TRI_INDEX&&T[E]++}}getWireframe(){var e,t=this.getNbEdges(),r=this.isUsingDrawArrays();if(r){if(this._meshData._drawArraysWireframe&&this._meshData._drawArraysWireframe.length===2*t)return this._meshData._drawArraysWireframe;e=this._meshData._drawArraysWireframe=new Uint32Array(2*t)}else{if(this._meshData._drawElementsWireframe&&this._meshData._drawElementsWireframe.length===2*t)return this._meshData._drawElementsWireframe;e=this._meshData._drawElementsWireframe=new Uint32Array(2*t)}for(var i=this.getFaces(),a=this.getFaceEdges(),n=this.getNbFaces(),o=this.getFacesToTriangles(),l=0,c=new Uint8Array(t),h=0;h<n;++h){var u,d,_,p=4*h,g=i[p+3],m=g!==s.A.TRI_INDEX;if(r){var f=3*o[h];u=f,d=f+1,_=f+2,m&&(g=f+5)}else u=i[p],d=i[p+1],_=i[p+2];var v=a[p],A=a[p+1],T=a[p+2],b=a[p+3];0===c[v]&&(c[v]=1,e[2*l]=u,e[2*l+1]=d,l++),0===c[A]&&(c[A]=1,e[2*l]=d,e[2*l+1]=_,l++),0===c[T]&&(c[T]=1,e[2*l]=_,e[2*l+1]=m?g:u,l++),m&&0===c[b]&&(c[b]=1,e[2*l]=g,e[2*l+1]=u,l++)}return r?this._meshData._drawArraysWireframe:this._meshData._drawElementsWireframe}updateDuplicateGeometry(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getVertices(),r=this.getColors(),i=this.getMaterials(),s=this.getNormals(),a=this.getVerticesDuplicateStartCount(),n=void 0===e,o=n?this.getNbVertices():e.length,l=0;l<o;++l){var c=n?l:e[l],h=a[2*c];if(0!==h)for(var u=h+a[2*c+1],d=3*c,_=t[d],p=t[d+1],g=t[d+2],m=s[d],f=s[d+1],v=s[d+2],A=r[d],T=r[d+1],b=r[d+2],M=i[d],y=i[d+1],E=i[d+2],S=h;S<u;++S){var R=3*S;t[R]=_,t[R+1]=p,t[R+2]=g,s[R]=m,s[R+1]=f,s[R+2]=v,r[R]=A,r[R+1]=T,r[R+2]=b,i[R]=M,i[R+1]=y,i[R+2]=E}}}updateDuplicateColorsAndMaterials(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getColors(),r=this.getMaterials(),i=this.getVerticesDuplicateStartCount(),s=void 0===e,a=s?this.getNbVertices():e.length,n=0;n<a;++n){var o=s?n:e[n],l=i[2*o];if(0!==l)for(var c=l+i[2*o+1],h=3*o,u=t[h],d=t[h+1],_=t[h+2],p=r[h],g=r[h+1],m=r[h+2],f=l;f<c;++f){var v=3*f;t[v]=u,t[v+1]=d,t[v+2]=_,r[v]=p,r[v+1]=g,r[v+2]=m}}}initTexCoordsDataFromOBJData(e,t){var r=this.getFaces(),i=r.length;if(i==t.length){var a=e.length/2;for(o=0;o<i;++o)t[o]>=a&&(t[o]=r[o]);var n=this.getNbVertices(),o=0,l=0,c=0,h=0,u=new Int32Array(n),d=new Float32Array(s.A.getMemory(4*n*2),0,2*n),_=[],p=0,g=0;for(o=0;o<i;++o)if((c=r[o])!==s.A.TRI_INDEX){var m=t[o];if((h=u[c])!==m+1)if(0!==h)if(h>0)u[c]=--p,_.push([m]),++g;else{var f=_[-h-1],v=f.length;for(l=0;l<v&&f[l]!==m;++l);l===v&&(++g,f.push(m))}else u[c]=m+1,d[2*c]=e[2*m],d[2*c+1]=e[2*m+1]}var A=new Float32Array(2*(n+g));A.set(d);var T=this._meshData._duplicateStartCount=new Uint32Array(2*n);for(p=0,o=0;o<n;++o)if(!((h=u[o])>=0)){var b=_[-h-1],M=b.length,y=n+p;for(T[2*o]=y,T[2*o+1]=M,p+=M,l=0;l<M;++l){var E=2*b[l],S=2*(y+l);A[S]=e[E],A[S+1]=e[E+1]}}var R=new Uint32Array(r);for(i=r.length,o=0;o<i;++o)if((c=R[o])!==s.A.TRI_INDEX&&!((h=u[c])>0)){var x=t[o],C=_[-h-1],w=C.length;for(l=0;l<w;++l)if(x===C[l]){R[o]=T[2*c]+l;break}}this.setTexCoords(A),this.setFacesTexCoord(R)}}setAlreadyDrawArrays(){this._meshData._DAverticesXYZ=this.getVertices(),this._meshData._DAnormalsXYZ=this.getNormals(),this._meshData._DAcolorsRGB=this.getColors(),this._meshData._DAmaterialsPBR=this.getMaterials()}updateDrawArrays(e){if(this.isUsingDrawArrays()){var t=this.getVertices(),r=this.getNormals(),i=this.getColors(),a=this.getMaterials(),n=this.getFaces(),o=this.getNbTriangles(),l=this.hasOnlyTriangles()?null:this.getFacesToTriangles(),c=void 0===e,h=this._meshData._DAverticesXYZ,u=this._meshData._DAnormalsXYZ,d=this._meshData._DAcolorsRGB,_=this._meshData._DAmaterialsPBR;(!h||h.length<9*o)&&(h=this._meshData._DAverticesXYZ=new Float32Array(9*o),u=this._meshData._DAnormalsXYZ=new Float32Array(9*o),d=this._meshData._DAcolorsRGB=new Float32Array(9*o),_=this._meshData._DAmaterialsPBR=new Float32Array(9*o));for(var p=c?this.getNbFaces():e.length,g=0;g<p;++g){var m=c?g:e[g],f=9*(l?l[m]:m),v=3*n[m*=4],A=3*n[m+1],T=3*n[m+2];h[f]=t[v],h[f+1]=t[v+1],h[f+2]=t[v+2],h[f+3]=t[A],h[f+4]=t[A+1],h[f+5]=t[A+2],h[f+6]=t[T],h[f+7]=t[T+1],h[f+8]=t[T+2],d[f]=i[v],d[f+1]=i[v+1],d[f+2]=i[v+2],d[f+3]=i[A],d[f+4]=i[A+1],d[f+5]=i[A+2],d[f+6]=i[T],d[f+7]=i[T+1],d[f+8]=i[T+2],_[f]=a[v],_[f+1]=a[v+1],_[f+2]=a[v+2],_[f+3]=a[A],_[f+4]=a[A+1],_[f+5]=a[A+2],_[f+6]=a[T],_[f+7]=a[T+1],_[f+8]=a[T+2],u[f]=r[v],u[f+1]=r[v+1],u[f+2]=r[v+2],u[f+3]=r[A],u[f+4]=r[A+1],u[f+5]=r[A+2],u[f+6]=r[T],u[f+7]=r[T+1],u[f+8]=r[T+2];var b=n[m+3];b!==s.A.TRI_INDEX&&(b*=3,h[f+=9]=t[v],h[f+1]=t[v+1],h[f+2]=t[v+2],h[f+3]=t[T],h[f+4]=t[T+1],h[f+5]=t[T+2],h[f+6]=t[b],h[f+7]=t[b+1],h[f+8]=t[b+2],d[f]=i[v],d[f+1]=i[v+1],d[f+2]=i[v+2],d[f+3]=i[T],d[f+4]=i[T+1],d[f+5]=i[T+2],d[f+6]=i[b],d[f+7]=i[b+1],d[f+8]=i[b+2],_[f]=a[v],_[f+1]=a[v+1],_[f+2]=a[v+2],_[f+3]=a[T],_[f+4]=a[T+1],_[f+5]=a[T+2],_[f+6]=a[b],_[f+7]=a[b+1],_[f+8]=a[b+2],u[f]=r[v],u[f+1]=r[v+1],u[f+2]=r[v+2],u[f+3]=r[T],u[f+4]=r[T+1],u[f+5]=r[T+2],u[f+6]=r[b],u[f+7]=r[b+1],u[f+8]=r[b+2])}this.isUsingTexCoords()&&this.updateDrawArraysTexCoord(e)}}updateDrawArraysTexCoord(e){var t=this.getNbTriangles(),r=this.getFacesToTriangles(),i=void 0===e,a=this._meshData._DAtexCoordsST;a&&a.length===6*t||(a=this._meshData._DAtexCoordsST=new Float32Array(6*t));for(var n=this.getTexCoords(),o=this.getFacesTexCoord(),l=i?this.getNbFaces():e.length,c=0;c<l;++c){var h=i?c:e[c],u=6*r[h],d=2*o[h*=4],_=2*o[h+1],p=2*o[h+2];a[u]=n[d],a[u+1]=n[d+1],a[u+2]=n[_],a[u+3]=n[_+1],a[u+4]=n[p],a[u+5]=n[p+1];var g=o[h+3];g!==s.A.TRI_INDEX&&(g*=3,a[u+=6]=n[d],a[u+1]=n[d+1],a[u+2]=n[p],a[u+3]=n[p+1],a[u+4]=n[g],a[u+5]=n[g+1])}}updateCenter(){var t=this.getLocalBound();e.hZ(this._transformData._center,.5*(t[0]+t[3]),.5*(t[1]+t[4]),.5*(t[2]+t[5]))}updateMatrices(e){u(this._transformData._lastComputedEN,this._transformData._editMatrix),a.lK(this._transformData._lastComputedMV,e.getView(),this._transformData._matrix),u(this._transformData._lastComputedN,this._transformData._lastComputedMV),a.lK(this._transformData._lastComputedMVP,e.getProjection(),this._transformData._lastComputedMV);var t=this._transformData._center,r=this._transformData._lastComputedMVP;this._transformData._lastComputedDepth=r[2]*t[0]+r[6]*t[1]+r[10]*t[2]+r[14]}computeLocalRadius(){var t=this.getLocalBound();return.5*e.xg([t[0],t[1],t[2]],[t[3],t[4],t[5]])}normalizeSize(){var e=s.A.SCALE/(2*this.computeLocalRadius());a.hs(this._transformData._matrix,this._transformData._matrix,[e,e,e])}computeWorldBound(){var e=this._meshData._worldBound,t=this.getLocalBound(),r=this.getMatrix();e[0]=e[3]=r[12],e[1]=e[4]=r[13],e[2]=e[5]=r[14];for(var i=0;i<3;++i)for(var s=4*i,a=t[i],n=t[i+3],o=0;o<3;++o){var l=r[s+o],c=l*n,h=l*a;c<h?(e[o]+=c,e[o+3]+=h):(e[o]+=h,e[o+3]+=c)}return e}intersectRay(e,t,r){var i=this.getNbFaces(),a=new Uint32Array(s.A.getMemory(4*i),0,i);return this._meshData._octree.collectIntersectRay(e,t,a,r?this._meshData._leavesToUpdate:void 0)}intersectSphere(e,t,r){var i=this.getNbFaces(),a=new Uint32Array(s.A.getMemory(4*i),0,i);return this._meshData._octree.collectIntersectSphere(e,t,a,r?this._meshData._leavesToUpdate:void 0)}updateOctree(e){e?this.updateOctreeAdd(this.updateOctreeRemove(e)):this.computeOctree()}computeAabb(){for(var e=this.getNbVertices(),t=this.getVertices(),r=1/0,i=1/0,s=1/0,a=-1/0,n=-1/0,o=-1/0,l=0;l<e;++l){var c=3*l,h=t[c],u=t[c+1],d=t[c+2];h<r&&(r=h),h>a&&(a=h),u<i&&(i=u),u>n&&(n=u),d<s&&(s=d),d>o&&(o=d)}return[r,i,s,a,n,o]}computeOctree(){var e=this.computeAabb(),t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],n=e[5],o=s-t,l=a-r,c=n-i,h=.2*Math.sqrt(o*o+l*l+c*c),u=1e-16;s-t<u&&(t-=h,s+=h),a-r<u&&(r-=h,a+=h),n-i<u&&(i-=h,n+=h);var d=.3*o,_=.3*l,p=.3*c,g=t-d,m=s+d,f=r-_,v=a+_,A=i-p,T=n+p,b=this._meshData._octree=new Ce;b.resetNbFaces(this.getNbFaces()),b.setAabbLoose(t,r,i,s,a,n),b.setAabbSplit(g,f,A,m,v,T),b.build(this)}updateOctreeRemove(e){for(var t=this.getFaceCenters(),r=this.getFaceBoxes(),i=this._meshData._facePosInLeaf,a=this._meshData._faceLeaf,n=e.length,o=0,l=new Uint32Array(s.A.getMemory(4*n),0,n),c=0;c<n;++c){var h=e[c],u=6*h,d=3*h,_=a[h],p=_._aabbSplit,g=t[d],m=t[d+1],f=t[d+2];if(g<=p[0]||m<=p[1]||f<=p[2]||g>p[3]||m>p[4]||f>p[5]){l[o++]=e[c];var v=_._iFaces;if(v.length>0){var A=v[v.length-1],T=i[h];v[T]=A,i[A]=T,v.pop()}}else _.expandsAabbLoose(r[u],r[u+1],r[u+2],r[u+3],r[u+4],r[u+5])}return new Uint32Array(l.subarray(0,o))}updateOctreeAdd(e){for(var t=this.getFaceCenters(),r=this.getFaceBoxes(),i=this._meshData._facePosInLeaf,s=this._meshData._faceLeaf,a=e.length,n=this._meshData._octree,o=n._aabbSplit,l=o[0],c=o[1],h=o[2],u=o[3],d=o[4],_=o[5],p=0;p<a;++p){var g=e[p],m=6*g,f=r[m],v=r[m+1],A=r[m+2],T=r[m+3],b=r[m+4],M=r[m+5];if(f>u||T<l||v>d||b<c||A>_||M<h){this.computeOctree(),this._meshData._leavesToUpdate.length=0;break}var y=3*g,E=n.addFace(g,f,v,A,T,b,M,t[y],t[y+1],t[y+2]);if(E)i[g]=E._iFaces.length-1,s[g]=E;else{var S=s[g]._iFaces;i[g]=S.length,S.push(e[p])}}}balanceOctree(){++Ce.FLAG;for(var e=this._meshData._leavesToUpdate,t=e.length,r=0;r<t;++r){var i=e[r];i._flag!==Ce.FLAG&&(0===i._iFaces.length?i.pruneIfPossible():i._iFaces.length>Ce.MAX_FACES&&i._depth<Ce.MAX_DEPTH&&i.build(this),i._flag=Ce.FLAG)}e.length=0}setFlatColor(e){this.getFlatColor().set(e)}setAlbedo(e){this.getAlbedo().set(e)}setMode(e){this._renderData._mode=e}setRoughness(e){this._renderData._roughness=e}setMetallic(e){this._renderData._metallic=e}setOpacity(e){this._renderData._alpha=e}setTexture0(e){this._renderData._texture0=e}setMatcap(e){this._renderData._matcap=e}setCurvature(e){this._renderData._curvature=e}setFlatShading(e){this._renderData._flatShading=e}setShowWireframe(e){this._renderData._showWireframe=!Pe.ONLY_DRAW_ARRAYS&&e,this.updateWireframeBuffer()}setUseDrawArrays(e){this._renderData._useDrawArrays=e}getGL(){return this._renderData._gl}getCount(){var e=this.getGL();return this.getMode()===e.TRIANGLES?3*this.getNbTriangles():this.getMode()===e.LINES?this.getNbVertices():0}getVertexBuffer(){return this._renderData._vertexBuffer}getNormalBuffer(){return this._renderData._normalBuffer}getColorBuffer(){return this._renderData._colorBuffer}getMaterialBuffer(){return this._renderData._materialBuffer}getTexCoordBuffer(){return this._renderData._texCoordBuffer}getIndexBuffer(){return this._renderData._indexBuffer}getWireframeBuffer(){return this._renderData._wireframeBuffer}getRoughness(){return this._renderData._roughness}getMetallic(){return this._renderData._metallic}getOpacity(){return this._renderData._alpha}getFlatColor(){return this._renderData._flatColor}getMode(){return this._renderData._mode}getAlbedo(){return this._renderData._albedo}getTexture0(){return this._renderData._texture0}getMatcap(){return this._renderData._matcap}getCurvature(){return this._renderData._curvature}getFlatShading(){return this._renderData._flatShading}getShowWireframe(){return this._renderData._showWireframe}isUsingDrawArrays(){return this._renderData._useDrawArrays||Pe.ONLY_DRAW_ARRAYS}isUsingTexCoords(){var e=this._renderData._shaderType;return e===i.A.Shader.UV||e===i.A.Shader.PAINTUV}isTransparent(){return this._renderData._alpha<.99}getShaderType(){return this._renderData._shaderType}setShaderType(e){var t=this.hasUV();if(e===i.A.Shader.UV&&!t){if(this._renderData._shaderType!==i.A.Shader.UV)return;e=i.A.Shader.MATCAP}this._renderData._shaderType=e,t&&(this.updateDuplicateGeometry(),this.updateDrawArrays()),this.updateBuffers()}initRender(){this.setShaderType(this._renderData._shaderType),this.setShowWireframe(this.getShowWireframe())}render(e){this.isVisible()&&$[this.getShaderType()].getOrCreate(this.getGL()).draw(this,e)}renderWireframe(e){this.isVisible()&&$[i.A.Shader.WIREFRAME].getOrCreate(this.getGL()).draw(this,e)}renderFlatColor(e){this.isVisible()&&$[i.A.Shader.FLAT].getOrCreate(this.getGL()).draw(this,e)}getRenderNbVertices(){return this.isUsingDrawArrays()?this.getCount():this.isUsingTexCoords()?this.getNbTexCoords():this.getNbVertices()}updateVertexBuffer(){var e=this.isUsingDrawArrays()?this.getVerticesDrawArrays():this.getVertices();this.getVertexBuffer().update(e,3*this.getRenderNbVertices())}updateNormalBuffer(){var e=this.isUsingDrawArrays()?this.getNormalsDrawArrays():this.getNormals();this.getNormalBuffer().update(e,3*this.getRenderNbVertices())}updateColorBuffer(){var e=this.isUsingDrawArrays()?this.getColorsDrawArrays():this.getColors();this.getColorBuffer().update(e,3*this.getRenderNbVertices())}updateMaterialBuffer(){var e=this.isUsingDrawArrays()?this.getMaterialsDrawArrays():this.getMaterials();this.getMaterialBuffer().update(e,3*this.getRenderNbVertices())}updateTexCoordBuffer(){if(this.isUsingTexCoords()){var e=this.isUsingDrawArrays()?this.getTexCoordsDrawArrays():this.getTexCoords();this.getTexCoordBuffer().update(e,2*this.getRenderNbVertices())}}updateIndexBuffer(){if(!this.isUsingDrawArrays()){var e=this.isUsingTexCoords()?this.getTrianglesTexCoord():this.getTriangles();this.getIndexBuffer().update(e,3*this.getNbTriangles())}}updateWireframeBuffer(){this.getShowWireframe()&&this.getWireframeBuffer().update(this.getWireframe(),2*this.getNbEdges())}updateGeometryBuffers(){this.updateVertexBuffer(),this.updateNormalBuffer()}updateBuffers(){this.updateGeometryBuffers(),this.updateColorBuffer(),this.updateMaterialBuffer(),this.updateTexCoordBuffer(),this.updateIndexBuffer(),this.updateWireframeBuffer()}release(){this.getTexture0()&&this.getGL().deleteTexture(this.getTexture0()),this.getVertexBuffer().release(),this.getNormalBuffer().release(),this.getColorBuffer().release(),this.getMaterialBuffer().release(),this.getIndexBuffer().release(),this.getWireframeBuffer().release()}copyRenderConfig(e){this.setFlatShading(e.getFlatShading()),this.setShowWireframe(e.getShowWireframe()),this.setShaderType(e.getShaderType()),this.setMatcap(e.getMatcap()),this.setTexture0(e.getTexture0()),this.setCurvature(e.getCurvature()),this.setOpacity(e.getOpacity())}copyTransformData(t){e.C(this.getCenter(),t.getCenter()),a.C(this.getMatrix(),t.getMatrix()),a.C(this.getEditMatrix(),t.getEditMatrix()),e.C(this.getSymmetryNormal(),t.getSymmetryNormal())}copyData(e){this.setVertices(e.getVertices().slice()),this.setFaces(e.getFaces().slice()),this.setColors(e.getColors().slice()),this.setMaterials(e.getMaterials().slice()),e.hasUV()&&this.initTexCoordsDataFromOBJData(e.getTexCoords(),e.getFacesTexCoord()),this.init(),this.initRender(),this.copyTransformData(e),this.copyRenderConfig(e)}optimize(){0!==this.getNbFaces()&&De.OPTIMIZE&&(this.optimizePostTransform(),this.optimizePreTransform(),this.initFaceRings())}computeCacheScore(){var e=this.getFaces(),t=this.getNbFaces(),r=[];r.length=32;for(var i=0,a=0,n=0;n<t;++n)for(var o=3*n,l=e[o+3]!==s.A.TRI_INDEX?4:3,c=0;c<l;++c){var h=e[o+c];for(a=0;a<32;++a){if(void 0===r[a]){r[a]=h,i++;break}if(r[a]===h)break}32===a&&(i++,r.shift(),r.push(h))}return{ACMR:i/t,ACTVR:i/this.getNbVertices()}}optimizePostTransform(){var e=0,t=this.hasUV(),r=this.getFaces(),i=t?this.getFacesTexCoord():r,a=this.getNbFaces(),n=this.getNbVertices(),o=t?this.getNbTexCoords():n,l=this.getVerticesDuplicateStartCount(),c=new Uint32Array(o-n);if(t)for(e=0;e<o;++e)for(var h=l[2*e],u=h+l[2*e+1],d=h;d<u;++d)c[d-n]=e;var _=this.getVerticesRingFaceStartCount(),p=this.getVerticesRingFace(),g=new Int32Array(o);for(e=0;e<n;++e)g[e]=_[2*e+1];for(e=n;e<o;++e)g[e]=_[2*c[e-n]+1];for(var m=new Uint32Array(o),f=33,v=0,A=new Uint32Array(s.A.getMemory(4*a*4),0,4*a),T=0,b=new Uint8Array(a),M=new Uint32Array(4*a),y=t?new Uint32Array(4*a):M,E=0,S=0;S>=0;){var R=[],x=S>=n?c[S-n]:S,C=_[2*x],w=C+_[2*x+1];for(e=C;e<w;++e){var P=p[e];if(!b[P]){b[P]=1;var D=4*P,k=A[T++]=M[E++]=i[D],I=A[T++]=M[E++]=i[D+1],F=A[T++]=M[E++]=i[D+2],L=M[E++]=i[D+3],V=L!==s.A.TRI_INDEX;t&&(y[E-4]=r[D],y[E-3]=r[D+1],y[E-2]=r[D+2],y[E-1]=r[D+3]),R.push(k,I,F),--g[k],--g[I],--g[F],f-m[k]>32&&(m[k]=f++),f-m[I]>32&&(m[I]=f++),f-m[F]>32&&(m[F]=f++),V&&(A[T++]=L,R.push(L),--g[L],f-m[L]>32&&(m[L]=f++))}}S=-1;var N=-1,O=R.length;for(e=0;e<O;++e){var B=R[e],U=g[B];if(!(U<=0)){var G=0,W=f-m[B];W+2*U<=32&&(G=W),G>N&&(N=G,S=B)}}if(-1===S){for(;T>0;){var z=A[--T];if(g[z]>0){S=z;break}}if(-1===S)for(;v<o;)if(g[v++]>0){S=v-1;break}}}i.set(M.subarray(0,4*a)),t&&r.set(y.subarray(0,4*a))}optimizePreTransform(){var e=this.getVertices(),t=this.getColors(),r=this.getMaterials(),i=this.getNbVertices(),a=this.getFaces(),n=4*this.getNbFaces(),o=new Float32Array(3*i),l=new Float32Array(3*i),c=new Float32Array(3*i),h=new Uint32Array(i),u=0,d=0;for(d=0;d<n;++d){var _=a[d];if(_!==s.A.TRI_INDEX){var p=h[_]-1;if(-1===p){var g=3*u,m=3*_;o[g]=e[m],o[g+1]=e[m+1],o[g+2]=e[m+2],l[g]=t[m],l[g+1]=t[m+1],l[g+2]=t[m+2],c[g]=r[m],c[g+1]=r[m+1],c[g+2]=r[m+2],p=u++,h[_]=p+1}a[d]=p}}var f=i-u;if(f>0&&this.setNbVertices(u),this.hasUV()){var v=this.getFacesTexCoord();for(d=0;d<n;++d){var A=v[d];A<i?v[d]=h[A]-1:A!==s.A.TRI_INDEX&&(v[d]-=f)}var T=this.getNbTexCoords(),b=this.getNbTexCoords()-f,M=this.getTexCoords(),y=new Float32Array(2*b),E=new Uint32Array(2*u),S=this.getVerticesDuplicateStartCount();for(d=0;d<i;++d){var R=2*d,x=S[R],C=2*(h[d]-1);C<0||(x>0&&(E[C]=x-f,E[C+1]=S[R+1]),y[C]=M[R],y[C+1]=M[R+1])}for(d=i;d<T;++d){var w=2*d,P=2*(d-f);y[P]=M[w],y[P+1]=M[w+1]}this.setVerticesDuplicateStartCount(E),this.setTexCoords(y)}e.set(o),t.set(l),r.set(c)}}De.OPTIMIZE=!0,De.ID=0;const ke=De,Ie=function(){return{_center:e.vt(),_matrix:a.vt(),_editMatrix:a.vt(),_yawPitchRoll:e.vt(),_symmetryNormal:[1,0,0],_symmetryOffset:0,_lastComputedMV:a.vt(),_lastComputedMVP:a.vt(),_lastComputedN:l(),_lastComputedEN:l(),_lastComputedDepth:0,_lastWorldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}},Fe=function(){return{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}},Le=class extends ke{constructor(e){super(),this._id=ke.ID++,e&&(this._renderData=new Pe(e,this)),this._meshData=new Fe,this._transformData=new Ie}};var Ve=function(e,t){this.previous=null,this.next=null,this.v1=e,this.v2=t},Ne=function(e){if(!(e.length<=2)){var t=e.length,r=e[0].v1,i=e[0].v2,s=e[0],a=s;e[0]=e[--t];for(var n=0;n<t;){var o=e[n];if(o.v1===i){if(o.previous=a,a.next=o,a=o,i=e[n].v2,e[n]=e[--t],i===r)break;n=0}else n++}if(e.length=t,i===r)return s.previous=a,a.next=s,s}},Oe=function(e,t,r,i,a,n){var o=e.getVertices(),l=e.getColors(),c=e.getMaterials(),h=e.getNbVertices()+i.length/3,u=t,d=0,_=0,p=0,g=0,m=0,f=0,v=0,A=0,T=0,b=0;do{var M=u.next,y=u.v1,E=u.v2,S=M.v2;r.push(y,E,h,s.A.TRI_INDEX),E*=3,S*=3,b++,d+=o[y*=3],_+=o[y+1],p+=o[y+2],g+=l[y],m+=l[y+1],f+=l[y+2],v+=c[y],A+=c[y+1],T+=c[y+2];var R=o[E],x=o[E+1],C=o[E+2],w=o[y]-R,P=o[y+1]-x,D=o[y+2]-C,k=o[S]-R,I=o[S+1]-x,F=o[S+2]-C,L=w*w+P*P+D*D,V=k*k+I*I+F*F;u.angle=Math.acos((w*k+P*I+D*F)/Math.sqrt(L*V)),u=M}while(u!==t);i.push(d/b,_/b,p/b),a.push(g/b,m/b,f/b),n.push(v/b,A/b,T/b)},Be=function(e,t,r,i,s){var a=new Le;return a.setID(e.getID()),a.setVertices(t),i&&a.setColors(i),s&&a.setMaterials(s),a.setFaces(r),a.setTransformData(e.getTransformData()),a.setRenderData(e.getRenderData()),ke.OPTIMIZE=!1,a.init(),ke.OPTIMIZE=!0,a},Ue={createClosedMesh:function(e){var t=function(e){var t=function(e){for(var t=e.getEdges(),r=e.getFaces(),i=e.getFaceEdges(),a=[],n=0,o=e.getNbFaces();n<o;++n){var l=4*n,c=i[l+3],h=c!==s.A.TRI_INDEX;1===t[i[l]]&&a.push(new Ve(r[l],r[l+1])),1===t[i[l+1]]&&a.push(new Ve(r[l+1],r[l+2])),1===t[i[l+2]]&&a.push(new Ve(r[l+2],r[h?l+3:l])),h&&1===t[c]&&a.push(new Ve(r[l+3],r[l]))}for(var u=[];;){var d=Ne(a);if(!d)break;u.push(d)}return u}(e);if(0===t.length)return e;for(var r=[],i=[],a=[],n=[],o=0,l=t.length;o<l;++o)Oe(e,t[o],r,i,a,n);var c=3*e.getNbVertices(),h=c+i.length,u=new Float32Array(h);u.set(e.getVertices().subarray(0,c));var d=new Float32Array(h);d.set(e.getColors().subarray(0,c));var _=new Float32Array(h);_.set(e.getMaterials().subarray(0,c)),h>c&&(u.set(i,c),d.set(a,c),_.set(n,c));var p=new Uint32Array(4*e.getNbFaces()+r.length);return p.set(e.getFaces()),r.length>0&&p.set(r,4*e.getNbFaces()),Be(e,u,p,d,_)}(e);if(t===e){var r=3*e.getNbVertices(),i=4*e.getNbFaces(),a=new Uint32Array(e.getFaces().subarray(0,i)),n=new Float32Array(e.getVertices().subarray(0,r)),o=new Float32Array(e.getColors().subarray(0,r)),l=new Float32Array(e.getMaterials().subarray(0,r));t=Be(e,n,a,o,l)}return t}};const Ge=Ue;var We={BLOCK:!1},ze=function(){for(var e=new Uint32Array(24),t=0,r=0;r<8;++r)for(var i=1;i<=4;i<<=1){var s=r^i;r<=s&&(e[t++]=r,e[t++]=s)}return e}(),Xe=function(e){for(var t=new Uint32Array(256),r=0;r<256;++r){for(var i=0,s=0;s<24;s+=2)i|=!!(r&1<<e[s])!=!!(r&1<<e[s+1])?1<<(s>>1):0;t[r]=i}return t}(ze),je=function(e,t,r,i,s,a){for(var n=e.colorField,o=e.materialField,l=e.distanceField,c=0,h=0,u=0,d=0,_=0,p=0,g=0,m=0,f=0,v=r[0],A=r[0]*r[1],T=0;T<2;++T)for(var b=0;b<2;++b)for(var M=0;M<2;++M){var y=i+M+b*v+T*A,E=3*y,S=l[y];t[f]=S,m|=S<0?1<<f:0,f++,S!==1/0&&(g+=S=Math.min(1/Math.abs(S),1e15),c+=n[E]*S,h+=n[E+1]*S,u+=n[E+2]*S,d+=o[E]*S,_+=o[E+1]*S,p+=o[E+2]*S)}return 0!==m&&255!==m&&(g>0&&(g=1/g),s.push(c*g,h*g,u*g),a.push(d*g,_*g,p*g)),m},Ye=[0,0,0],Ke=function(e,t,r,i,s){Ye[0]=Ye[1]=Ye[2]=0;for(var a=0,n=0;n<12;++n)if(e&1<<n&&(++a,!We.BLOCK)){var o=t[n<<1],l=t[1+(n<<1)],c=r[o],h=c-r[l];if(!(Math.abs(h)<1e-7)){h=c/h;for(var u=0,d=1;u<3;++u,d<<=1){var _=o&d;Ye[u]+=_!==(l&d)?_?1-h:h:_?1:0}}}for(var p=1/a,g=0;g<3;++g)Ye[g]=i[g]+p*Ye[g];s.push(Ye[0],Ye[1],Ye[2])},He=function(e,t,r,i,s,a,n){for(var o=0;o<3;++o)if(e&1<<o){var l=(o+1)%3,c=(o+2)%3;if(0!==a[l]&&0!==a[c]){var h=i[l],u=i[c];1&t?n.push(r[s],r[s-h],r[s-h-u],r[s-u]):n.push(r[s],r[s-u],r[s-h-u],r[s-h])}}};We.computeSurface=function(e){var t=e.dims,r=[],i=[],s=[],a=[],n=0,o=new Int32Array(3),l=new Int32Array([1,t[0]+1,(t[0]+1)*(t[1]+1)]),c=new Float32Array(8),h=1,u=new Int32Array(2*l[2]);for(o[2]=0;o[2]<t[2]-1;++o[2],n+=t[0],h^=1,l[2]=-l[2]){var d=1+(t[0]+1)*(1+h*(t[1]+1));for(o[1]=0;o[1]<t[1]-1;++o[1],++n,d+=2)for(o[0]=0;o[0]<t[0]-1;++o[0],++n,++d){var _=je(e,c,t,n,i,s);if(0!==_&&255!==_){var p=Xe[_];u[d]=r.length/3,Ke(p,ze,c,o,r),He(p,_,u,l,d,o,a)}}}return{colors:new Float32Array(i),materials:new Float32Array(s),vertices:new Float32Array(r),faces:new Uint32Array(a)}};const qe=We;var Ze={BLOCK:!1},Qe=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),Je=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],$e=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],et=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],tt=function(e,t,r,i,s,a){for(var n=e.colorField,o=e.materialField,l=e.distanceField,c=0,h=0,u=0,d=0,_=0,p=0,g=0,m=0,f=r[0],v=r[0]*r[1],A=0;A<8;++A){var T=$e[A],b=i+T[0]+T[1]*f+T[2]*v,M=3*b,y=l[b];t[A]=y,m|=y>0?1<<A:0,y!==1/0&&(g+=y=Math.min(1/Math.abs(y),1e15),c+=n[M]*y,h+=n[M+1]*y,u+=n[M+2]*y,d+=o[M]*y,_+=o[M+1]*y,p+=o[M+2]*y)}return 0!==Qe[m]&&(g>0&&(g=1/g),s[0]=c*g,s[1]=h*g,s[2]=u*g,a[0]=d*g,a[1]=_*g,a[2]=p*g),m};Ze.computeSurface=function(e){var t=e.dims,r=new Map,i=[],a=[],n=[],o=[],l=0,c=new Int32Array(3),h=new Float32Array(8),u=new Array(12),d=new Float32Array(3),_=new Float32Array(3),p=new Float32Array(3);for(c[2]=0;c[2]<t[2]-1;++c[2],l+=t[0])for(c[1]=0;c[1]<t[1]-1;++c[1],++l)for(c[0]=0;c[0]<t[0]-1;++c[0],++l){var g=tt(e,h,t,l,_,p),m=Qe[g];if(0!==m){for(var f=0;f<12;++f)if(m&1<<f){var v=et[f],A=$e[v[0]],T=$e[v[1]],b=h[v[0]],M=b-h[v[1]],y=0;Math.abs(M)>1e-6&&(y=b/M);for(var E=0;E<3;++E)d[E]=c[E]+A[E]+y*(T[E]-A[E]);var S=d[0]+"+"+d[1]+"+"+d[2],R=r.get(S);R>=0?u[f]=R:(u[f]=i.length/3,r.set(S,u[f]),i.push(d[0],d[1],d[2]),a.push(_[0],_[1],_[2]),n.push(p[0],p[1],p[2]))}for(var x=Je[g],C=0;C<x.length;C+=3)o.push(u[x[C]],u[x[C+1]],u[x[C+2]],s.A.TRI_INDEX)}}return{colors:new Float32Array(a),materials:new Float32Array(n),vertices:new Float32Array(i),faces:new Uint32Array(o)}};const rt=Ze;var it={RESOLUTION:150,BLOCK:!1,SMOOTHING:!0},st=function(e,t){for(var r=t.min,i=t.step,s=t.dims,a=1/i,n=r[0],o=r[1],l=r[2],c=s[0],h=c*s[1],u=t.distanceField,d=t.crossedEdges,_=t.colorField,p=t.materialField,g=e.getTriangles(),m=e.getVertices(),f=e.getColors(),v=e.getMaterials(),A=e.getNbTriangles(),T=[0,0,0],b=[0,0,0],M=[0,0,0],y=[0,0,0],E=[0,0,0],S=[0,0,0],R=[0,0,0,0],x=[[1,0,0],[0,1,0],[0,0,1]],C=1/3,w=0;w<A;++w)for(var P=3*w,D=3*g[P],k=3*g[P+1],I=3*g[P+2],F=T[0]=m[D],L=T[1]=m[D+1],V=T[2]=m[D+2],N=b[0]=m[k],O=b[1]=m[k+1],B=b[2]=m[k+2],U=M[0]=m[I],G=M[1]=m[I+1],W=M[2]=m[I+2],z=(f[D]+f[k]+f[I])*C,X=(f[D+1]+f[k+1]+f[I+1])*C,j=(f[D+2]+f[k+2]+f[I+2])*C,Y=(v[D]+v[k]+v[I])*C,K=(v[D+1]+v[k+1]+v[I+1])*C,H=(v[D+2]+v[k+2]+v[I+2])*C,q=F<N?F<U?F:U:N<U?N:U,Z=F>N?F>U?F:U:N>U?N:U,Q=L<O?L<G?L:G:O<G?O:G,J=L>O?L>G?L:G:O>G?O:G,$=V<B?V<W?V:W:B<W?B:W,ee=V>B?V>W?V:W:B>W?B:W,te=y[0]=N-F,re=y[1]=O-L,ie=y[2]=B-V,se=E[0]=U-F,ae=E[1]=G-L,ne=E[2]=W-V,oe=te*te+re*re+ie*ie,le=te*se+re*ae+ie*ne,ce=se*se+ae*ae+ne*ne,he=Math.floor((q-n)*a),ue=Math.floor((Q-o)*a),de=Math.floor(($-l)*a),_e=Math.ceil((Z-n)*a),pe=Math.ceil((J-o)*a),ge=Math.ceil((ee-l)*a),me=de;me<=ge;++me)for(var fe=ue;fe<=pe;++fe)for(var ve=he;ve<=_e;++ve){var Ae=n+ve*i,Te=o+fe*i,be=l+me*i,Me=ve+fe*c+me*h;S[0]=Ae,S[1]=Te,S[2]=be;var ye=Ee.A.distance2PointTriangleEdges(S,y,E,T,oe,le,ce,R);if((ye=Math.sqrt(ye))<u[Me]){u[Me]=ye;var Se=3*Me;_[Se]=z,_[Se+1]=X,_[Se+2]=j,p[Se]=Y,p[Se+1]=K,p[Se+2]=H}if(!(ye>i))for(var Re=0;Re<3;++Re){var xe=R[Re]-S[Re];if(!(xe<0||xe>i)){var Ce=3*Me+Re;if(1!==d[Ce]){var we=Ee.A.intersectionRayTriangleEdges(S,x[Re],y,E,T);we<0||we>i||(d[Ce]=1)}}}}},at=function(e,t,r,i,s){var a=new Le(e.getGL());return a.setID(e.getID()),a.setFaces(t),a.setVertices(r),i&&a.setColors(i),s&&a.setMaterials(s),a.setRenderData(e.getRenderData()),a.init(),a.initRender(),a};it.remesh=function(t,r,n){console.time("remesh total"),console.time("1. prepareMeshes");var o=function(t){for(var r=[1/0,1/0,1/0,-1/0,-1/0,-1/0],s=[0,0,0],a=0,n=t.length;a<n;++a){var o=t[a];o.isUsingTexCoords()&&o.setShaderType(i.A.Shader.MATCAP);for(var l=o.getMatrix(),c=(o=t[a]=Ge.createClosedMesh(o)).getVertices(),h=0,u=o.getNbVertices();h<u;++h){var d=3*h;s[0]=c[d],s[1]=c[d+1],s[2]=c[d+2],e.Z0(s,s,l);var _=c[d]=s[0],p=c[d+1]=s[1],g=c[d+2]=s[2];_<r[0]&&(r[0]=_),p<r[1]&&(r[1]=p),g<r[2]&&(r[2]=g),_>r[3]&&(r[3]=_),p>r[4]&&(r[4]=p),g>r[5]&&(r[5]=g)}}return r}(t=t.slice());console.timeEnd("1. prepareMeshes"),console.time("2. voxelization");for(var l,c=function(e){for(var t=Math.max(e[3]-e[0],e[4]-e[1],e[5]-e[2])/it.RESOLUTION,r=1.51*t,i=1.51*t,a=[e[0]-r,e[1]-r,e[2]-r],n=[e[3]+i,e[4]+i,e[5]+i],o=Math.ceil((n[0]-a[0])/t),l=Math.ceil((n[1]-a[1])/t),c=Math.ceil((n[2]-a[2])/t),h=o*l*c,u=s.A.getMemory(31*h),d=new Float32Array(u,0,h),_=new Float32Array(u,4*h,3*h),p=new Float32Array(u,16*h,3*h),g=new Uint8Array(u,28*h,3*h),m=0;m<h;++m)d[m]=1/0;for(var f=0,v=3*h;f<v;++f)g[f]=0;for(var A=0,T=3*h;A<T;++A)_[A]=p[A]=-1;var b={};return b.dims=[o,l,c],b.step=t,b.min=a,b.max=n,b.crossedEdges=g,b.distanceField=d,b.colorField=_,b.materialField=p,b}(o),h=0,u=t.length;h<u;++h)st(t[h],c);console.timeEnd("2. voxelization"),console.time("3. flood"),function(e){var t=e.step,r=e.dims,i=r[0],s=i*r[1],a=e.crossedEdges,n=e.distanceField,o=n.length,l=new Uint8Array(o),c=new Int32Array(o);c[0]=0;for(var h=1,u=[-1,1,-i,i,-s,s],d=[0,0,1,1,2,2],_=u.length,p=0,g=0;h>0;){var m=c[--h];if(n[m]<t)for(p=0;p<_;++p){var f=u[p];(g=m+f)>=o||g<0||1!==l[g]&&n[g]!==1/0&&0===a[3*(f>=0?m:g)+d[p]]&&(l[g]=1,c[h++]=g)}else for(p=0;p<_;++p)(g=m+u[p])>=o||g<0||1!==l[g]&&(l[g]=1,c[h++]=g)}for(var v=0;v<o;++v)0===n[v]&&console.log("hit"),0===l[v]&&(n[v]=-n[v])}(c),console.timeEnd("3. flood"),n?(console.time("4. marchingCubes"),rt.BLOCK=it.BLOCK,l=rt.computeSurface(c),console.timeEnd("4. marchingCubes")):(console.time("4. surfaceNets"),qe.BLOCK=it.BLOCK,l=qe.computeSurface(c),console.timeEnd("4. surfaceNets")),console.time("5. createMesh");var d=at(r,l.faces,l.vertices,l.colors,l.materials);return console.timeEnd("5. createMesh"),function(t,r){var i=[r[0],r[1],r[2]],s=[r[3],r[4],r[5]],n=e.xg(i,s),o=e.WQ([],i,s);e.hs(o,o,.5);var l=t.getLocalBound(),c=[l[0],l[1],l[2]],h=[l[3],l[4],l[5]],u=e.xg(c,h),d=e.WQ([],c,h);e.hs(d,d,.5);var _=n/u,p=e.hs([],o,1/_);e.jb(p,p,d);var g=t.getMatrix();a.D_(g),a.hs(g,g,[_,_,_]),a.Tl(g,g,p)}(d,o),n&&it.SMOOTHING&&(console.time("6. tangential smoothing"),function(e){for(var t=e.getNbVertices(),r=new Uint32Array(t),i=0;i<t;++i)r[i]=i;var s=new Se;s.setToolMesh(e),s.smoothTangent(r,1),e.updateGeometry(),e.updateGeometryBuffers()}(d),console.timeEnd("6. tangential smoothing")),console.timeEnd("remesh total"),console.log("\n"),d},it.mergeArrays=function(t,r){var i,a,n=0,o=0,l=0,c=0,h=t.length,u=0;for(i=0;i<h;++i)n+=t[i].getNbVertices(),o+=t[i].getNbFaces(),l+=t[i].getNbQuads(),c+=t[i].getNbTriangles();r.nbVertices=n,r.nbFaces=o,r.nbQuads=l,r.nbTriangles=c;var d=r.vertices=void 0!==r.vertices?new Float32Array(3*n):null,_=r.colors=void 0!==r.colors?new Float32Array(3*n):null,p=r.materials=void 0!==r.materials?new Float32Array(3*n):null,g=r.faces=void 0!==r.faces?new Uint32Array(4*o):null,m=r.triangles=void 0!==r.triangles?new Uint32Array(3*c):null,f=[0,0,0],v=0,A=0,T=0,b=0;for(i=0;i<h;++i){var M=t[i],y=M.getVertices(),E=M.getColors(),S=M.getMaterials(),R=M.getFaces(),x=M.getTriangles(),C=M.getNbVertices(),w=M.getNbFaces(),P=M.getNbTriangles(),D=M.getMatrix();for(a=0;a<C;++a)u=3*a,f[0]=y[u],f[1]=y[u+1],f[2]=y[u+2],e.Z0(f,f,D),d[v+u]=f[0],d[v+u+1]=f[1],d[v+u+2]=f[2],_&&(_[v+u]=E[u],_[v+u+1]=E[u+1],_[v+u+2]=E[u+2]),p&&(p[v+u]=S[u],p[v+u+1]=S[u+1],p[v+u+2]=S[u+2]);if(v+=3*C,g)for(a=0;a<w;++a)g[A+(u=4*a)]=R[u]+b,g[A+u+1]=R[u+1]+b,g[A+u+2]=R[u+2]+b,g[A+u+3]=R[u+3]===s.A.TRI_INDEX?s.A.TRI_INDEX:R[u+3]+b;if(m)for(a=0;a<P;++a)m[T+(u=3*a)]=x[u]+b,m[T+u+1]=x[u+1]+b,m[T+u+2]=x[u+2]+b;b+=C,A+=4*w,T+=3*P}return r},it.mergeMeshes=function(e,t){var r={vertices:null,colors:null,materials:null,faces:null};return it.mergeArrays(e,r),at(t,r.faces,r.vertices,r.colors,r.materials)};const nt=it;var ot={},lt=function(e=-.5,t=0,r=-.5,i=1,s=0,a=0,n=0,o=0,l=1){var c=new Float32Array(4);c[0]=0,c[1]=1,c[2]=2,c[3]=3;var h=new Float32Array(12);return h[0]=e,h[1]=t,h[2]=r,h[3]=e+i,h[4]=t+s,h[5]=r+a,h[6]=e+i+n,h[7]=t+s+o,h[8]=r+a+l,h[9]=e+n,h[10]=t+o,h[11]=r+l,{faces:c,vertices:h}},ct=function(e=1){var t=new Float32Array(24);t[1]=t[2]=t[4]=t[6]=t[7]=t[9]=t[10]=t[11]=t[14]=t[18]=t[21]=t[23]=.5*-e,t[0]=t[3]=t[5]=t[8]=t[12]=t[13]=t[15]=t[16]=t[17]=t[19]=t[20]=t[22]=.5*e;var r=new Float32Array(28);r[0]=r[6]=r[8]=r[10]=r[11]=r[13]=r[16]=r[23]=r[25]=.5,r[1]=r[3]=1,r[2]=r[4]=r[9]=r[12]=r[14]=r[15]=r[18]=.25,r[5]=r[7]=r[21]=r[24]=r[26]=r[27]=.75,r[17]=r[19]=r[20]=r[22]=0;var i=new Uint32Array(24),s=new Uint32Array(24);return i[0]=i[8]=i[21]=s[0]=0,i[1]=i[11]=i[12]=s[1]=1,i[2]=i[15]=i[16]=s[2]=s[15]=s[16]=2,i[3]=i[19]=i[22]=s[3]=s[19]=s[22]=3,i[4]=i[9]=i[20]=s[4]=s[9]=4,i[7]=i[10]=i[13]=s[5]=s[18]=s[23]=5,i[6]=i[14]=i[17]=s[6]=s[14]=s[17]=6,i[5]=i[18]=i[23]=s[7]=s[10]=7,s[8]=8,s[11]=9,s[12]=10,s[13]=11,s[20]=12,s[21]=13,{vertices:t,uv:r,faces:i,facesUV:s}},ht=function(e=.5,t=.5,r=2,i=64,a=64,n=!0,o=!0){var l=n&&0===e,c=o&&0===t,h=.5*r,u=(a+1)*i,d=a*i;n&&(u+=1,d+=i),o&&(u+=1,d+=i),(l||c)&&(u-=i,d-=i);var _,p=new Float32Array(3*u),g=new Uint32Array(4*d),m=0,f=0,v=0,A=0,T=l?1:0,b=c?a-1:a;for(v=T;v<=b;v++){var M=v/a,y=M*(t-e)+e;for(A=0;A<i;A++){var E=2*Math.PI*A/i;p[f=3*m++]=y*Math.sin(E),p[f+1]=-M*r+h,p[f+2]=y*Math.cos(E)}}for(m=0,A=0;A<i;A++){var S=A===i-1?0:A+1;for(v=T;v<b;v++)g[f=4*m++]=i*v+A,g[f+1]=i*(v+1)+A,g[f+2]=i*(v+1)+S,g[f+3]=i*v+S}if(n)for(p[3*(_=(o?p.length-6:p.length-3)/3)+1]=h,A=0;A<i;A++)g[f=4*m++]=A,g[f+1]=A===i-1?0:A+1,g[f+2]=_,g[f+3]=s.A.TRI_INDEX;if(o){p[3*(_=(p.length-3)/3)+1]=-h,l&&--v;var R=i*v;for(A=0;A<i;A++)g[f=4*m++]=A===i-1?R:R+A+1,g[f+1]=R+A,g[f+2]=_,g[f+3]=s.A.TRI_INDEX}return{vertices:p,faces:g}},ut=function(e=.5,t=.1,r=2*Math.PI,i=32,a=128){var n=2*Math.PI-r<.01,o=i*a,l=o;n||(o+=2,l+=i);var c=n?a:a-1,h=new Float32Array(3*o),u=new Uint32Array(4*l),d=0,_=0,p=0,g=0;for(p=0;p<a;++p)for(g=0;g<i;++g){var m=p/c*r,f=g/i*Math.PI*2;h[_=3*d++]=(e+t*Math.cos(f))*Math.cos(m),h[_+1]=t*Math.sin(f),h[_+2]=(e+t*Math.cos(f))*Math.sin(m)}for(d=0,p=0;p<c;++p){var v=p===a-1?0:p+1;for(g=0;g<i;++g){u[_=4*d++]=i*p+g;var A=g===i-1?0:g+1;u[_+1]=i*p+A,u[_+2]=i*v+A,u[_+3]=i*v+g}}if(!n){var T=(h.length-6)/3;for(h[3*T]=e,g=0;g<i;g++)u[_=4*d++]=T,u[_+1]=g===i-1?0:g+1,u[_+2]=g,u[_+3]=s.A.TRI_INDEX;h[3*++T]=e*Math.cos(r),h[3*T+2]=e*Math.sin(r);var b=i*p;for(g=0;g<i;g++)u[_=4*d++]=T,u[_+1]=b+g,u[_+2]=g===i-1?b:b+g+1,u[_+3]=s.A.TRI_INDEX}return{vertices:h,faces:u}},dt=function(e=-.5,t=0,r=-.5,i=1,s=0,a=0,n=0,o=0,l=1,c=20,h=c){c+=2,h+=2;var u=new Float32Array(2*(c+h)*3),d=0,_=0,p=i/(c-1),g=s/(c-1),m=a/(c-1),f=e+i+n,v=t+s+o,A=r+a+l;for(d=0;d<c;++d)u[_=6*d]=e+p*d,u[_+1]=t+g*d,u[_+2]=r+m*d,u[_+3]=f-p*(c-d-1),u[_+4]=v-g*(c-d-1),u[_+5]=A-m*(c-d-1);for(p=n/(h-1),g=o/(h-1),m=l/(h-1),d=0;d<h;++d)u[_=6*(c+d)]=e+p*d,u[_+1]=t+g*d,u[_+2]=r+m*d,u[_+3]=f-p*(h-d-1),u[_+4]=v-g*(h-d-1),u[_+5]=A-m*(h-d-1);return{vertices:u}},_t=function(e,t){var r=new Le(e);return r.setVertices(t.vertices),t.faces&&r.setFaces(t.faces),t.uv&&t.facesUV&&r.initTexCoordsDataFromOBJData(t.uv,t.facesUV),r.init(),e&&r.initRender(),r},pt=Array.prototype.slice;ot.createGrid=function(e){var t=_t(e,dt.apply(this,pt.call(arguments,1)));return e&&(t.setMode(e.LINES),t.setUseDrawArrays(!0),t.setAlreadyDrawArrays()),t},ot.createCube=function(e){return _t(e,ct.apply(this,pt.call(arguments,1)))},ot.createCylinder=function(e){return _t(e,ht.apply(this,pt.call(arguments,1)))},ot.createTorus=function(e){return _t(e,ut.apply(this,pt.call(arguments,1)))},ot.createPlane=function(e){return _t(e,lt.apply(this,pt.call(arguments,1)))},ot.createArrow=function(e,t=.5,r=2,i=5,s=.2,a=4,n=1){var o=_t(null,ht(t,t,r,a,n)),l=_t(null,ht(0,t*i,r*s,a,n));l.getMatrix()[13]=.5*r;var c={vertices:null,faces:null};return nt.mergeArrays([o,l],c),_t(e,c)},ot.createLine2D=function(e,t=0,r=0,i=0,s=0){var a=_t(e,{vertices:new Float32Array([t,r,0,i,s,0])});return e&&(a.setMode(e.LINES),a.setUseDrawArrays(!0),a.setAlreadyDrawArrays()),a};const gt=ot;var mt=e.fA(.7,.2,.2),ft=e.fA(.2,.7,.2),vt=e.fA(.2,.2,.7),At=e.fA(.4,.4,.4),Tt=e.fA(.8,.4,.2),bt=1.5*1.3,Mt=ge(),yt=function(t,r=-1){return{_finalMatrix:a.vt(),_baseMatrix:a.vt(),_color:e.vt(),_colorSelect:e.fA(1,1,0),_drawGeo:null,_pickGeo:null,_isSelected:!1,_type:t,_nbAxis:r,_lastInter:[0,0,0],updateMatrix(){a.C(this._drawGeo.getMatrix(),this._finalMatrix),a.C(this._pickGeo.getMatrix(),this._finalMatrix)},updateFinalMatrix(e){a.lK(this._finalMatrix,e,this._baseMatrix)}}},Et=1024,St=2048,Rt=4096,xt=8192,Ct=15360;class wt{static get TRANS_X(){return 1}static get TRANS_Y(){return 2}static get TRANS_Z(){return 4}static get ROT_X(){return 8}static get ROT_Y(){return 16}static get ROT_Z(){return 32}static get ROT_W(){return 64}static get PLANE_X(){return 128}static get PLANE_Y(){return 256}static get PLANE_Z(){return 512}static get SCALE_X(){return Et}static get SCALE_Y(){return St}static get SCALE_Z(){return Rt}static get SCALE_W(){return xt}static get TRANS_XYZ(){return 7}static get ROT_XYZ(){return 56}static get PLANE_XYZ(){return 896}static get SCALE_XYZW(){return Ct}static get COORD_GLOBAL(){return 0}static get COORD_LOCAL(){return 1}constructor(e){this._main=e,this._gl=e._gl,this._activatedType=wt.TRANS_XYZ|wt.ROT_XYZ|wt.PLANE_XYZ|wt.SCALE_XYZW|wt.ROT_W,this._coordSpace=wt.COORD_GLOBAL,this._transX=yt(wt.TRANS_X,0),this._transY=yt(wt.TRANS_Y,1),this._transZ=yt(wt.TRANS_Z,2),this._planeX=yt(wt.PLANE_X,0),this._planeY=yt(wt.PLANE_Y,1),this._planeZ=yt(wt.PLANE_Z,2),this._scaleX=yt(wt.SCALE_X,0),this._scaleY=yt(wt.SCALE_Y,1),this._scaleZ=yt(wt.SCALE_Z,2),this._scaleW=yt(wt.SCALE_W),this._rotX=yt(wt.ROT_X,0),this._rotY=yt(wt.ROT_Y,1),this._rotZ=yt(wt.ROT_Z,2),this._rotW=yt(wt.ROT_W),this._lineHelper=gt.createLine2D(this._gl),this._lineHelper.setShaderType(i.A.Shader.FLAT),this._lastDistToEye=0,this._isEditing=!1,this._selected=null,this._pickables=[],this._editLineOrigin=[0,0,0],this._editLineDirection=[0,0,0],this._editOffset=[0,0,0],this._editAxis=a.vt(),this._editAxisInv=a.vt(),this._editLocal=[],this._editTrans=a.vt(),this._editScaleRot=[],this._editLocalInv=[],this._editTransInv=a.vt(),this._editScaleRotInv=[],this._initTranslate(),this._initRotate(),this._initScale(),this._initPickables()}_normalizeRotationColumns(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),i=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);t>0&&(e[0]/=t,e[1]/=t,e[2]/=t),r>0&&(e[4]/=r,e[5]/=r,e[6]/=r),i>0&&(e[8]/=i,e[9]/=i,e[10]/=i)}_computeLocalAxisMatrix(e,t){a.C(t,e.getMatrix()),t[12]=t[13]=t[14]=0,this._normalizeRotationColumns(t);var r=a.vt();a.C(r,e.getEditMatrix()),r[12]=r[13]=r[14]=0,this._normalizeRotationColumns(r),a.lK(t,t,r)}setActivatedType(e){this._activatedType=e,this._initPickables()}setCoordSpace(e){this._coordSpace=e}getCoordSpace(){return this._coordSpace}_initPickables(){var e=this._pickables;e.length=0;var t=this._activatedType;1&t&&e.push(this._transX._pickGeo),2&t&&e.push(this._transY._pickGeo),4&t&&e.push(this._transZ._pickGeo),128&t&&e.push(this._planeX._pickGeo),256&t&&e.push(this._planeY._pickGeo),512&t&&e.push(this._planeZ._pickGeo),8&t&&e.push(this._rotX._pickGeo),16&t&&e.push(this._rotY._pickGeo),32&t&&e.push(this._rotZ._pickGeo),t&Et&&e.push(this._scaleX._pickGeo),t&St&&e.push(this._scaleY._pickGeo),t&Rt&&e.push(this._scaleZ._pickGeo),t&xt&&e.push(this._scaleW._pickGeo)}_createArrow(t,r,s){var n=t._baseMatrix;a.e$(n,n,.5*Math.PI,r),a.Tl(n,n,[0,1.25,0]),e.C(t._color,s),t._pickGeo=gt.createArrow(this._gl,.125,2.5,3),t._pickGeo._gizmo=t,t._drawGeo=gt.createArrow(this._gl,.025,2.5,7.5,.25),t._drawGeo.setShaderType(i.A.Shader.FLAT)}_createPlane(t,r,s,a,n,o,l,c){e.C(t._color,r),t._pickGeo=gt.createPlane(this._gl,0,0,0,s,a,n,o,l,c),t._pickGeo._gizmo=t,t._drawGeo=gt.createPlane(this._gl,0,0,0,s,a,n,o,l,c),t._drawGeo.setShaderType(i.A.Shader.FLAT)}_initTranslate(){var t=[0,0,0];this._createArrow(this._transX,e.hZ(t,0,0,-1),mt),this._createArrow(this._transY,e.hZ(t,0,1,0),ft),this._createArrow(this._transZ,e.hZ(t,1,0,0),vt);var r=.5;this._createPlane(this._planeX,mt,0,r,0,0,0,r),this._createPlane(this._planeY,ft,r,0,0,0,0,r),this._createPlane(this._planeZ,vt,r,0,0,0,r,0)}_createCircle(t,r,s,a=1.5,n=1){e.C(t._color,s),t._pickGeo=gt.createTorus(this._gl,a,.125*n,r,6,64),t._pickGeo._gizmo=t,t._drawGeo=gt.createTorus(this._gl,a,.025*n,r,6,64),t._drawGeo.setShaderType(i.A.Shader.FLAT)}_initRotate(){this._createCircle(this._rotX,Math.PI,mt),this._createCircle(this._rotY,Math.PI,ft),this._createCircle(this._rotZ,Math.PI,vt),this._createCircle(this._rotW,2*Math.PI,At)}_createCube(t,r,s){var n=t._baseMatrix;a.e$(n,n,.5*Math.PI,r),a.Tl(n,n,[0,1.5,0]),e.C(t._color,s),t._pickGeo=gt.createCube(this._gl,.42),t._pickGeo._gizmo=t,t._drawGeo=gt.createCube(this._gl,.35),t._drawGeo.setShaderType(i.A.Shader.FLAT)}_initScale(){var t=[0,0,0];this._createCube(this._scaleX,e.hZ(t,0,0,-1),mt),this._createCube(this._scaleY,e.hZ(t,0,1,0),ft),this._createCube(this._scaleZ,e.hZ(t,1,0,0),vt),this._createCircle(this._scaleW,2*Math.PI,Tt,bt,2)}_updateArcRotation(e){Mt[0]=e[2],Mt[1]=0,Mt[2]=-e[0],Mt[3]=1+e[1],ye(Mt,Mt),a.I0(this._rotW._baseMatrix,Mt),a.I0(this._scaleW._baseMatrix,Mt),function(e,t,r){r*=.5;var i=t[0],s=t[1],a=t[2],n=t[3],o=Math.sin(r),l=Math.cos(r);e[0]=i*l+s*o,e[1]=s*l-i*o,e[2]=a*l+n*o,e[3]=n*l-a*o}(Mt,me(Mt),.5*Math.PI),Ae(Mt,Mt,Math.atan2(-e[1],-e[2])),a.I0(this._rotX._baseMatrix,Mt),Ae(Mt,me(Mt),Math.atan2(-e[0],-e[2])),a.I0(this._rotY._baseMatrix,Mt),ve(Mt,me(Mt),.5*Math.PI),Ae(Mt,Mt,Math.atan2(-e[0],e[1])),a.I0(this._rotZ._baseMatrix,Mt)}_computeCenterGizmo(t=[0,0,0]){for(var r=this._main.getSelectedMeshes(),i=[0,0,0],s=[0,0,0],a=0;a<r.length;++a){var n=r[a];e.Z0(s,n.getCenter(),n.getEditMatrix()),e.Z0(s,s,n.getMatrix()),e.WQ(i,i,s)}return e.hs(t,i,1/r.length),t}_updateMatrices(){var t=this._main.getCamera(),r=this._computeCenterGizmo(),i=t.computePosition();this._lastDistToEye=this._isEditing?this._lastDistToEye:e.xg(i,r);var s=80*this._lastDistToEye/t.getConstantScreen(),n=a.vt();if(a.Tl(n,n,r),1===this._coordSpace){var o=this._main.getSelectedMeshes();if(o.length>0){var l=o[0],c=a.vt();this._computeLocalAxisMatrix(l,c),a.lK(n,n,c)}}a.hs(n,n,[s,s,s]),this._updateArcRotation(e.S8(i,e.jb(i,r,i))),this._transX.updateFinalMatrix(n),this._transY.updateFinalMatrix(n),this._transZ.updateFinalMatrix(n),this._planeX.updateFinalMatrix(n),this._planeY.updateFinalMatrix(n),this._planeZ.updateFinalMatrix(n),this._rotX.updateFinalMatrix(n),this._rotY.updateFinalMatrix(n),this._rotZ.updateFinalMatrix(n),this._rotW.updateFinalMatrix(n),this._scaleX.updateFinalMatrix(n),this._scaleY.updateFinalMatrix(n),this._scaleZ.updateFinalMatrix(n),this._scaleW.updateFinalMatrix(n)}_drawGizmo(e){e.updateMatrix();var t=e._drawGeo;t.setFlatColor(e._isSelected?e._colorSelect:e._color),t.updateMatrices(this._main.getCamera()),t.render(this._main)}_updateLineHelper(e,t,r,i){var s=this._lineHelper.getVertices(),a=this._main,n=a.getCanvasWidth(),o=a.getCanvasHeight();s[0]=e/n*2-1,s[1]=(o-t)/o*2-1,s[3]=r/n*2-1,s[4]=(o-i)/o*2-1,this._lineHelper.updateVertexBuffer()}_saveEditMatrices(){var e=this._main.getSelectedMeshes(),t=this._computeCenterGizmo();a.Tl(this._editTrans,a.D_(this._editTrans),t),a.B8(this._editTransInv,this._editTrans);for(var r=0;r<e.length;++r)this._editLocal[r]=a.vt(),this._editScaleRot[r]=a.vt(),this._editLocalInv[r]=a.vt(),this._editScaleRotInv[r]=a.vt(),a.C(this._editLocal[r],e[r].getMatrix()),a.C(this._editScaleRot[r],this._editLocal[r]),this._editScaleRot[r][12]=this._editScaleRot[r][13]=this._editScaleRot[r][14]=0,a.B8(this._editLocalInv[r],this._editLocal[r]),a.B8(this._editScaleRotInv[r],this._editScaleRot[r]);a.D_(this._editAxis),a.D_(this._editAxisInv),1===this._coordSpace&&e.length>0&&(this._computeLocalAxisMatrix(e[0],this._editAxis),a.B8(this._editAxisInv,this._editAxis))}_startRotateEdit(){var t=this._main,r=t.getCamera(),i=[0,0,0];this._computeCenterGizmo(i),e.C(i,r.project(i));var s=this._editLineDirection,a=0===this._selected._nbAxis?-1:1,n=this._selected._lastInter;e.hZ(s,-a*n[2],-a*n[1],a*n[0]),e.Z0(s,s,this._selected._finalMatrix),e.C(s,r.project(s)),he(s,_e(s,s,i)),le(this._editLineOrigin,t._mouseX,t._mouseY)}_startTranslateEdit(){var t=this._main,r=t.getCamera(),i=this._editLineOrigin,s=this._editLineDirection;this._computeCenterGizmo(i);var a=this._selected._nbAxis;-1!==a&&(e.hZ(s,0,0,0)[a]=1),1===this._coordSpace&&e.Z0(s,s,this._editAxis),e.WQ(s,i,s),e.C(i,r.project(i)),e.C(s,r.project(s)),he(s,_e(s,s,i));var n=this._editOffset;n[0]=t._mouseX-i[0],n[1]=t._mouseY-i[1]}_startPlaneEdit(){var t=this._main,r=t.getCamera(),i=this._editLineOrigin;this._computeCenterGizmo(i),e.C(i,r.project(i));var s=this._editOffset;s[0]=t._mouseX-i[0],s[1]=t._mouseY-i[1],le(this._editLineOrigin,t._mouseX,t._mouseY)}_startScaleEdit(){this._startTranslateEdit()}_updateRotateEdit(){var e=this._main,t=this._editLineOrigin,r=this._editLineDirection,i=[e._mouseX,e._mouseY,0];_e(i,i,t);var s=ue(i,r);this._updateLineHelper(t[0],t[1],t[0]+r[0]*s,t[1]+r[1]*s);var n=2.5*s/Math.min(e.getCanvasWidth(),e.getCanvasHeight());n%=2*Math.PI;for(var o=this._selected._nbAxis,l=this._main.getSelectedMeshes(),c=0;c<l.length;++c){var h=l[c].getEditMatrix();a.D_(h),0===o?a.eL(h,h,-n):1===o?a.Z8(h,h,-n):2===o&&a.Qr(h,h,-n),this._scaleRotateEditMatrix(h,c)}e.render()}_updateTranslateEdit(){var t=this._main,r=t.getCamera(),i=this._editLineOrigin,s=this._editLineDirection,a=[t._mouseX,t._mouseY,0];_e(a,a,i),_e(a,a,this._editOffset),ce(a,i,s,ue(a,s)),this._updateLineHelper(i[0],i[1],a[0],a[1]);var n=r.unproject(a[0],a[1],0),o=r.unproject(a[0],a[1],.1);e.Z0(n,n,this._editTransInv),e.Z0(o,o,this._editTransInv),1===this._coordSpace&&(e.Z0(n,n,this._editAxisInv),e.Z0(o,o,this._editAxisInv)),e.S8(a,e.jb(a,o,n));var l=[0,0,0];l[this._selected._nbAxis]=1;var c=-e.Om(a,l),h=e.Om(n,a),u=Math.abs(1-c*c),d=-e.Om(n,l);l[this._selected._nbAxis]=(c*h-d)/u,this._updateMatrixTranslate(l),t.render()}_updatePlaneEdit(){var t=this._main,r=t.getCamera(),i=[t._mouseX,t._mouseY,0];_e(i,i,this._editOffset),this._updateLineHelper(this._editLineOrigin[0],this._editLineOrigin[1],t._mouseX,t._mouseY);var s=r.unproject(i[0],i[1],0),a=r.unproject(i[0],i[1],.1);e.Z0(s,s,this._editTransInv),e.Z0(a,a,this._editTransInv),1===this._coordSpace&&(e.Z0(s,s,this._editAxisInv),e.Z0(a,a,this._editAxisInv));var n=[0,0,0];n[this._selected._nbAxis]=1;var o=e.Om(s,n),l=e.Om(a,n);if(o===l)return!1;var c=-o/(l-o);n[0]=s[0]+(a[0]-s[0])*c,n[1]=s[1]+(a[1]-s[1])*c,n[2]=s[2]+(a[2]-s[2])*c,this._updateMatrixTranslate(n),t.render()}_updateMatrixTranslate(t){for(var r=[0,0,0],i=this._main.getSelectedMeshes(),s=0;s<i.length;++s){1===this._coordSpace?e.C(r,t):e.Z0(r,t,this._editScaleRotInv[s]);var n=i[s].getEditMatrix();a.D_(n),a.Tl(n,n,r)}}_updateScaleEdit(){var t=this._main,r=(t.getMesh(),this._editLineOrigin),i=this._editLineDirection,s=this._selected._nbAxis,n=[t._mouseX,t._mouseY,0];-1!==s&&(_e(n,n,r),ce(n,r,i,ue(n,i))),this._updateLineHelper(r[0],r[1],n[0],n[1]);var o=e.Il(this._editOffset),l=[1,1,1],c=Math.max(-.99,(pe(r,n)-o)/o);-1===s?(l[0]+=c,l[1]+=c,l[2]+=c):l[s]+=c;for(var h=this._main.getSelectedMeshes(),u=0;u<h.length;++u){var d=h[u].getEditMatrix();a.D_(d),a.hs(d,d,l),this._scaleRotateEditMatrix(d,u)}t.render()}_scaleRotateEditMatrix(e,t){a.lK(e,this._editTrans,e),a.lK(e,e,this._editTransInv),0===this._coordSpace&&(a.lK(e,this._editLocalInv[t],e),a.lK(e,e,this._editLocal[t]))}addGizmoToScene(e){return e.push(this._transX._drawGeo),e.push(this._transY._drawGeo),e.push(this._transZ._drawGeo),e.push(this._planeX._drawGeo),e.push(this._planeY._drawGeo),e.push(this._planeZ._drawGeo),e.push(this._rotX._drawGeo),e.push(this._rotY._drawGeo),e.push(this._rotZ._drawGeo),e.push(this._rotW._drawGeo),e.push(this._scaleX._drawGeo),e.push(this._scaleY._drawGeo),e.push(this._scaleZ._drawGeo),e.push(this._scaleW._drawGeo),e}render(){this._updateMatrices();var e=this._isEditing&&this._selected?this._selected._type:this._activatedType;64&e&&this._drawGizmo(this._rotW),1&e&&this._drawGizmo(this._transX),2&e&&this._drawGizmo(this._transY),4&e&&this._drawGizmo(this._transZ),128&e&&this._drawGizmo(this._planeX),256&e&&this._drawGizmo(this._planeY),512&e&&this._drawGizmo(this._planeZ),8&e&&this._drawGizmo(this._rotX),16&e&&this._drawGizmo(this._rotY),32&e&&this._drawGizmo(this._rotZ),e&Et&&this._drawGizmo(this._scaleX),e&St&&this._drawGizmo(this._scaleY),e&Rt&&this._drawGizmo(this._scaleZ),e&xt&&this._drawGizmo(this._scaleW),this._isEditing&&this._lineHelper.render(this._main)}onMouseOver(){if(this._isEditing){var t=this._selected._type;return 56&t?this._updateRotateEdit():7&t?this._updateTranslateEdit():896&t?this._updatePlaneEdit():t&Ct&&this._updateScaleEdit(),!0}var r=this._main,i=r.getPicking(),s=r._mouseX,a=r._mouseY,n=this._pickables;i.intersectionMouseMeshes(n,s,a),this._selected&&(this._selected._isSelected=!1);var o=i.getMesh();return o?(this._selected=o._gizmo,this._selected._isSelected=!0,e.C(this._selected._lastInter,i.getIntersectionPoint()),!0):(this._selected=null,!1)}onMouseDown(){var e=this._selected;if(!e)return!1;this._isEditing=!0;var t=e._type;return this._saveEditMatrices(),56&t?this._startRotateEdit():7&t?this._startTranslateEdit():896&t?this._startPlaneEdit():t&Ct&&this._startScaleEdit(),!0}onMouseUp(){this._isEditing=!1}}const Pt=wt;var Dt=[0,0,0];class kt extends ne{constructor(e){super(e),this._selectionMode=kt.Mode.FACE,this._selectionAction=kt.Action.REPLACE}start(e){var t=this._main,r=t.getPicking();if(!r.intersectionMouseMeshes())return!1;var i=t.setOrUnsetMesh(r.getMesh(),e);return!!i&&-1!==r.getPickedFace()&&(this._main.getStateManager().pushStateColorAndMaterial(i),this.applySelection(i,r),this.updateRender(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!0)}update(){}updateMeshBuffers(){var e=this.getMesh();e&&(e.isDynamic?e.updateBuffers():(e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateMaterialBuffer()))}applySelection(e,t){var r=this.getSelectionVertices(e,t);if(r.length){var i=e.getMaterials(),s=e.getNbVertices();if(this._selectionAction===kt.Action.REPLACE)for(var a=0;a<s;++a)i[3*a+2]=0;for(var n=this._selectionAction===kt.Action.REMOVE?0:1,o=0,l=r.length;o<l;++o)i[3*r[o]+2]=n}}getSelectionVertices(e,t){var r=t.getPickedFace(),i=e.getFaces(),a=4*r,n=i[a],o=i[a+1],l=i[a+2],c=i[a+3],h=[n,o,l];if(c!==s.A.TRI_INDEX&&h.push(c),this._selectionMode===kt.Mode.FACE)return h;var u=t.getIntersectionPoint();return Dt[0]=u[0],Dt[1]=u[1],Dt[2]=u[2],this._selectionMode===kt.Mode.VERTEX?[this.getClosestVertex(e,h,Dt)]:this._selectionMode===kt.Mode.EDGE?this.getClosestEdge(e,h,Dt):h}getClosestVertex(e,t,r){for(var i=e.getVertices(),s=t[0],a=1/0,n=0,o=t.length;n<o;++n){var l=3*t[n],c=i[l]-r[0],h=i[l+1]-r[1],u=i[l+2]-r[2],d=c*c+h*h+u*u;d<a&&(a=d,s=t[n])}return s}getClosestEdge(e,t,r){var i=[[t[0],t[1]],[t[1],t[2]],[t[2],t[0]]];4===t.length&&(i.push([t[2],t[3]]),i.push([t[3],t[0]]));for(var s=e.getVertices(),a=i[0],n=1/0,o=0,l=i.length;o<l;++o){var c=i[o],h=this.distanceToSegmentSquared(s,c[0],c[1],r);h<n&&(n=h,a=c)}return a}distanceToSegmentSquared(e,t,r,i){var s=3*t,a=3*r,n=e[s],o=e[s+1],l=e[s+2],c=e[a]-n,h=e[a+1]-o,u=e[a+2]-l,d=i[0]-n,_=i[1]-o,p=i[2]-l,g=c*c+h*h+u*u;if(0===g)return d*d+_*_+p*p;var m=(d*c+_*h+p*u)/g;m<0?m=0:m>1&&(m=1);var f=n+c*m-i[0],v=o+h*m-i[1],A=l+u*m-i[2];return f*f+v*v+A*A}selectAll(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),r=e.getNbVertices(),i=0;i<r;++i)t[3*i+2]=1;this.updateRender()}}clearSelection(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),r=e.getNbVertices(),i=0;i<r;++i)t[3*i+2]=0;this.updateRender()}}invertSelection(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),r=e.getNbVertices(),i=0;i<r;++i){var s=3*i+2;t[s]=t[s]>.5?0:1}this.updateRender()}}}kt.Mode={VERTEX:0,EDGE:1,FACE:2},kt.Action={REPLACE:0,ADD:1,REMOVE:2};const It=kt;var Ft=[];Ft[i.A.Tools.BRUSH]=class extends ne{constructor(e){super(e),this._radius=50,this._intensity=.5,this._negative=!1,this._clay=!0,this._culling=!1,this._accumulate=!0,this._idAlpha=0,this._lockPosition=!1}stroke(t){var i=t.getPickedVertices(),s=this._intensity*r.A.getPressureIntensity();this._accumulate||this._lockPosition||this.updateProxy(i),this._main.getStateManager().pushVertices(i),this._lockPosition||(i=this.dynamicTopology(t));var a=this.getFrontVertices(i,t.getEyeDirection());this._culling&&(i=a);var n=t.getLocalRadius2();if(t.updateAlpha(this._lockPosition),t.setIdAlpha(this._idAlpha),this._clay){var o=this.areaNormal(a);if(!o)return;var l=this._lockPosition?t.getIntersectionPoint():this.areaCenter(a),c=.1*Math.sqrt(n);e.Ln(l,l,o,this._negative?-c:c),oe.prototype.flatten.call(this,i,o,l,t.getIntersectionPoint(),n,s,t)}else this.brush(i,t.getPickedNormal(),t.getIntersectionPoint(),n,s,t);var h=this.getMesh();h.updateGeometry(h.getFacesFromVertices(i),i)}brush(e,t,r,i,s,a){var n=this.getMesh(),o=n.getVertices(),l=n.getMaterials(),c=this._accumulate||this._lockPosition?o:n.getVerticesProxy(),h=Math.sqrt(i),u=s*h*.1;this._negative&&(u=-u);for(var d=r[0],_=r[1],p=r[2],g=t[0],m=t[1],f=t[2],v=0,A=e.length;v<A;++v){var T=3*e[v],b=c[T]-d,M=c[T+1]-_,y=c[T+2]-p,E=Math.sqrt(b*b+M*M+y*y)/h;if(!(E>=1)){var S=o[T],R=o[T+1],x=o[T+2],C=E*E;C=3*C*C-4*C*E+1,C*=l[T+2]*u*a.getAlpha(S,R,x),o[T]=S+g*C,o[T+1]=R+m*C,o[T+2]=x+f*C}}}},Ft[i.A.Tools.INFLATE]=class extends ne{constructor(e){super(e),this._radius=50,this._intensity=.3,this._negative=!1,this._culling=!1,this._idAlpha=0,this._lockPosition=!1}stroke(e){var t=e.getPickedVertices(),i=this._intensity*r.A.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.inflate(t,e.getIntersectionPoint(),e.getLocalRadius2(),i,e);var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t),t)}inflate(e,t,r,i,s){var a=this.getMesh(),n=a.getVertices(),o=a.getMaterials(),l=a.getVerticesProxy(),c=a.getNormals(),h=Math.sqrt(r),u=i*h*.1;this._negative&&(u=-u);for(var d=t[0],_=t[1],p=t[2],g=0,m=e.length;g<m;++g){var f=3*e[g],v=l[f]-d,A=l[f+1]-_,T=l[f+2]-p,b=Math.sqrt(v*v+A*A+T*T)/h;if(!(b>=1)){var M=b*b;M=3*M*M-4*M*b+1,M*=u;var y=n[f],E=n[f+1],S=n[f+2],R=c[f],x=c[f+1],C=c[f+2];M/=Math.sqrt(R*R+x*x+C*C),M*=o[f+2]*s.getAlpha(y,E,S),n[f]=y+R*M,n[f+1]=E+x*M,n[f+2]=S+C*M}}}},Ft[i.A.Tools.TWIST]=class extends ne{constructor(e){super(e),this._radius=75,this._culling=!1,this._twistData={normal:[0,0,0],center:[0,0]},this._twistDataSym={normal:[0,0,0],center:[0,0]},this._idAlpha=0}startSculpt(){var e=this._main,t=e._mouseX,r=e._mouseY,i=e.getPicking();if(this.initTwistData(i,t,r,this._twistData),e.getSculptManager().getSymmetry()){var s=e.getPickingSymmetry();s.intersectionMouseMesh(),s.setLocalRadius2(i.getLocalRadius2()),s.getMesh()&&this.initTwistData(s,t,r,this._twistDataSym)}}initTwistData(t,r,i,s){t.pickVerticesInSphere(t.getLocalRadius2()),e.ze(s.normal,t.getEyeDirection()),le(s.center,r,i)}sculptStroke(){var e=this._main,t=e._mouseX,r=e._mouseY,i=e._lastMouseX,s=e._lastMouseY,a=e.getPicking(),n=a.getLocalRadius2();if(a.pickVerticesInSphere(n),this.stroke(a,t,r,i,s,this._twistData),e.getSculptManager().getSymmetry()){var o=e.getPickingSymmetry();o.getMesh()&&(o.pickVerticesInSphere(n),this.stroke(o,i,s,t,r,this._twistDataSym))}this.updateRender(),e.setCanvasCursor("default")}stroke(e,t,r,i,s,a){var n=e.getPickedVertices();this._main.getStateManager().pushVertices(n),n=this.dynamicTopology(e),this._culling&&(n=this.getFrontVertices(n,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.twist(n,e.getIntersectionPoint(),e.getLocalRadius2(),t,r,i,s,a,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(n),n)}twist(t,r,i,s,a,n,o,l,c){var h,u,d,_=this.getMesh(),p=l.center,g=[s-p[0],a-p[1]];if(u=(h=g)[0],d=h[1],!(Math.sqrt(u*u+d*d)<30)){he(g,g);var m=l.normal,f=[0,0,0,0],v=[n-p[0],o-p[1]];he(v,v);for(var A=Ee.A.signedAngle2d(g,v),T=_.getVertices(),b=_.getMaterials(),M=1/Math.sqrt(i),y=r[0],E=r[1],S=r[2],R=[0,0,0],x=0,C=t.length;x<C;++x){var w=3*t[x],P=T[w],D=T[w+1],k=T[w+2],I=P-y,F=D-E,L=k-S,V=Math.sqrt(I*I+F*F+L*L)*M,N=V*V;N=3*N*N-4*N*V+1,fe(f,m,N*=A*b[w+2]*c.getAlpha(P,D,k)),e.hZ(R,P,D,k),e.jb(R,R,r),e.gL(R,R,f),e.WQ(R,R,r),T[w]=R[0],T[w+1]=R[1],T[w+2]=R[2]}}}},Ft[i.A.Tools.SMOOTH]=Se,Ft[i.A.Tools.FLATTEN]=oe,Ft[i.A.Tools.PINCH]=class extends ne{constructor(e){super(e),this._radius=50,this._intensity=.75,this._negative=!1,this._culling=!1,this._idAlpha=0,this._lockPosition=!1}stroke(e){var t=e.getPickedVertices(),i=this._intensity*r.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.pinch(t,e.getIntersectionPoint(),e.getLocalRadius2(),i,e);var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t),t)}pinch(e,t,r,i,s){var a=this.getMesh(),n=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(r),c=t[0],h=t[1],u=t[2],d=.05*i;this._negative&&(d=-d);for(var _=0,p=e.length;_<p;++_){var g=3*e[_],m=n[g],f=n[g+1],v=n[g+2],A=c-m,T=h-f,b=u-v,M=Math.sqrt(A*A+T*T+b*b)/l,y=M*M;y=3*y*y-4*y*M+1,y*=d*o[g+2]*s.getAlpha(m,f,v),n[g]=m+A*y,n[g+1]=f+T*y,n[g+2]=v+b*y}}},Ft[i.A.Tools.CREASE]=class extends ne{constructor(e){super(e),this._radius=25,this._intensity=.75,this._negative=!0,this._culling=!1,this._idAlpha=0,this._lockPosition=!1}stroke(e){var t=e.getPickedVertices(),i=this._intensity*r.A.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.crease(t,e.getPickedNormal(),e.getIntersectionPoint(),e.getLocalRadius2(),i,e);var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t),t)}crease(e,t,r,i,s,a){var n=this.getMesh(),o=n.getVertices(),l=n.getMaterials(),c=n.getVerticesProxy(),h=Math.sqrt(i),u=r[0],d=r[1],_=r[2],p=t[0],g=t[1],m=t[2],f=.07*s,v=f*h;this._negative&&(v=-v);for(var A=0,T=e.length;A<T;++A){var b=3*e[A],M=u-c[b],y=d-c[b+1],E=_-c[b+2],S=Math.sqrt(M*M+y*y+E*E)/h;if(!(S>=1)){var R=o[b],x=o[b+1],C=o[b+2],w=S*S;w=3*w*w-4*w*S+1,w*=l[b+2]*a.getAlpha(R,x,C);var P=Math.pow(w,5)*v;w*=f,o[b]=R+M*w+p*P,o[b+1]=x+y*w+g*P,o[b+2]=C+E*w+m*P}}}},Ft[i.A.Tools.DRAG]=class extends ne{constructor(e){super(e),this._radius=150,this._dragDir=[0,0,0],this._dragDirSym=[0,0,0],this._idAlpha=0}sculptStroke(){var t=this._main,r=this.getMesh(),i=t.getPicking(),s=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null,a=t._mouseX-this._lastMouseX,n=t._mouseY-this._lastMouseY,o=Math.sqrt(a*a+n*n),l=.15*this._radius,c=1/Math.floor(o/l);a*=c,n*=c;var h=this._lastMouseX,u=this._lastMouseY;if(i.getMesh()){i._mesh=r,s&&(s._mesh=r,e.C(s.getIntersectionPoint(),i.getIntersectionPoint()),Ee.A.mirrorPoint(s.getIntersectionPoint(),r.getSymmetryOrigin(),r.getSymmetryNormal()));for(var d=0;d<1&&this.makeStroke(h,u,i,s);d+=c)h+=a,u+=n;this.updateRender(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY}}makeStroke(e,t,r,i){var s=this.getMesh();return this.updateDragDir(r,e,t),r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal(),s.isDynamic&&this.stroke(r,!1),i&&(this.updateDragDir(i,e,t,!0),i.setLocalRadius2(r.getLocalRadius2()),i.pickVerticesInSphere(i.getLocalRadius2())),s.isDynamic||this.stroke(r,!1),i&&this.stroke(i,!0),!0}stroke(e,t){var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r),r=this.dynamicTopology(e),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.drag(r,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(r),r)}drag(e,t,r,i,s){for(var a=this.getMesh(),n=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(r),c=t[0],h=t[1],u=t[2],d=i?this._dragDirSym:this._dragDir,_=d[0],p=d[1],g=d[2],m=0,f=e.length;m<f;++m){var v=3*e[m],A=n[v],T=n[v+1],b=n[v+2],M=A-c,y=T-h,E=b-u,S=Math.sqrt(M*M+y*y+E*E)/l,R=S*S;R=3*R*R-4*R*S+1,R*=o[v+2]*s.getAlpha(A,T,b),n[v]=A+_*R,n[v+1]=T+p*R,n[v+2]=b+g*R}}updateDragDir(t,r,i,s){var n=this.getMesh(),o=t.unproject(r,i,0),l=t.unproject(r,i,.1),c=a.vt();a.B8(c,n.getMatrix()),e.Z0(o,o,c),e.Z0(l,l,c);var h=this._dragDir;if(s){h=this._dragDirSym;var u=n.getSymmetryOrigin(),d=n.getSymmetryNormal();Ee.A.mirrorPoint(o,u,d),Ee.A.mirrorPoint(l,u,d)}var _=t.getIntersectionPoint();t.setIntersectionPoint(Ee.A.vertexOnLine(_,o,l)),e.jb(h,t.getIntersectionPoint(),_),t._mesh=n,t.updateLocalAndWorldRadius2();var p=t.getEyeDirection();e.jb(p,l,o),e.S8(p,p)}},Ft[i.A.Tools.PAINT]=Re,Ft[i.A.Tools.MOVE]=class extends ne{constructor(e){super(e),this._radius=150,this._intensity=1,this._topoCheck=!0,this._negative=!1,this._moveData={center:[0,0,0],dir:[0,0],vProxy:null},this._moveDataSym={center:[0,0,0],dir:[0,0],vProxy:null},this._idAlpha=0}startSculpt(){var e=this._main,t=e.getPicking();if(this.initMoveData(t,this._moveData),e.getSculptManager().getSymmetry()){var r=e.getPickingSymmetry();r.intersectionMouseMesh(),r.setLocalRadius2(t.getLocalRadius2()),r.getMesh()&&this.initMoveData(r,this._moveDataSym)}}initMoveData(t,r){this._topoCheck?t.pickVerticesInSphereTopological(t.getLocalRadius2()):t.pickVerticesInSphere(t.getLocalRadius2()),e.C(r.center,t.getIntersectionPoint());var i=t.getPickedVertices();this._main.getStateManager().pushVertices(i);for(var s=t.getMesh().getVertices(),a=i.length,n=r.vProxy=new Float32Array(3*a),o=0;o<a;++o){var l=3*i[o],c=3*o;n[c]=s[l],n[c+1]=s[l+1],n[c+2]=s[l+2]}}copyVerticesProxy(e,t){for(var r=e.getPickedVertices(),i=this.getMesh().getVertices(),s=t.vProxy,a=0,n=r.length;a<n;++a){var o=3*r[a],l=3*a;i[o]=s[l],i[o+1]=s[l+1],i[o+2]=s[l+2]}}sculptStroke(){var e=this._main,t=e.getPicking(),r=e.getPickingSymmetry(),i=e.getSculptManager().getSymmetry()&&r.getMesh();t.updateAlpha(this._lockPosition),t.setIdAlpha(this._idAlpha),i&&(r.updateAlpha(!1),r.setIdAlpha(this._idAlpha)),this.copyVerticesProxy(t,this._moveData),i&&this.copyVerticesProxy(r,this._moveDataSym);var s=e._mouseX,a=e._mouseY;this.updateMoveDir(t,s,a),this.move(t.getPickedVertices(),t.getIntersectionPoint(),t.getLocalRadius2(),this._moveData,t),i&&(this.updateMoveDir(r,s,a,!0),this.move(r.getPickedVertices(),r.getIntersectionPoint(),r.getLocalRadius2(),this._moveDataSym,r));var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t.getPickedVertices()),t.getPickedVertices()),i&&n.updateGeometry(n.getFacesFromVertices(r.getPickedVertices()),r.getPickedVertices()),this.updateRender(),e.setCanvasCursor("default")}move(e,t,r,i,s){for(var a=this.getMesh(),n=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(r),c=i.vProxy,h=t[0],u=t[1],d=t[2],_=i.dir,p=_[0],g=_[1],m=_[2],f=0,v=e.length;f<v;++f){var A=3*e[f],T=3*f,b=c[T],M=c[T+1],y=c[T+2],E=b-h,S=M-u,R=y-d,x=Math.sqrt(E*E+S*S+R*R)/l,C=x*x;C=3*C*C-4*C*x+1,C*=o[A+2]*s.getAlpha(b,M,y),n[A]+=p*C,n[A+1]+=g*C,n[A+2]+=m*C}}updateMoveDir(t,r,i,s){var n=this.getMesh(),o=t.unproject(r,i,0),l=t.unproject(r,i,.1),c=a.vt();a.B8(c,n.getMatrix()),e.Z0(o,o,c),e.Z0(l,l,c);var h=s?this._moveDataSym:this._moveData;if(s){var u=n.getSymmetryOrigin(),d=n.getSymmetryNormal();Ee.A.mirrorPoint(o,u,d),Ee.A.mirrorPoint(l,u,d)}if(this._negative){var _=e.xg(Ee.A.vertexOnLine(h.center,o,l),h.center);e.S8(h.dir,t.computePickedNormal()),e.hs(h.dir,h.dir,r<this._lastMouseX?-_:_)}else e.jb(h.dir,Ee.A.vertexOnLine(h.center,o,l),h.center);e.hs(h.dir,h.dir,this._intensity);var p=t.getEyeDirection();e.jb(p,l,o),e.S8(p,p)}},Ft[i.A.Tools.MASKING]=class extends ne{constructor(e){super(e),this._radius=50,this._hardness=.25,this._intensity=1,this._negative=!0,this._culling=!1,this._idAlpha=0,this._lockPosition=!1,this._thickness=1}pushState(){this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}updateMeshBuffers(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateMaterialBuffer()}stroke(e){Re.prototype.stroke.call(this,e)}dynamicTopology(e){return e.getPickedVertices()}paint(e,t,r,i,s,a){for(var n=this.getMesh(),o=n.getVertices(),l=n.getMaterials(),c=Math.sqrt(r),h=t[0],u=t[1],d=t[2],_=2*(1-s),p=this._negative?-i:i,g=0,m=e.length;g<m;++g){var f=3*e[g],v=o[f],A=o[f+1],T=o[f+2],b=v-h,M=A-u,y=T-d,E=Math.sqrt(b*b+M*M+y*y)/c;E>1&&(E=1);var S=Math.pow(1-E,_);S*=p*a.getAlpha(v,A,T),l[f+2]=Math.min(Math.max(l[f+2]+S,0),1)}}updateAndRenderMask(){var e=this.getMesh();e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}blur(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){t=e.expandsVertices(t,1),this.pushState(),this._main.getStateManager().pushVertices(t);var r=e.getMaterials(),i=t.length,s=new Float32Array(3*i);this.laplacianSmooth(t,s,r);for(var a=0;a<i;++a)r[3*t[a]+2]=s[3*a+2];this.updateAndRenderMask()}}sharpen(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var r=e.getMaterials(),i=t.length,s=0;s<i;++s){var a=3*t[s]+2,n=r[a];r[a]=n>.5?Math.min(n+.1,1):Math.max(n-1,0)}this.updateAndRenderMask()}}clear(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var r=e.getMaterials(),i=0,s=t.length;i<s;++i)r[3*t[i]+2]=1;this.updateAndRenderMask()}}invert(e,t){var r=t;r||(r=this.getMesh()),e||this._main.getStateManager().pushStateCustom(this.invert.bind(this,!0,r));for(var i=r.getMaterials(),s=0,a=r.getNbVertices();s<a;++s)i[3*s+2]=1-i[3*s+2];this.updateAndRenderMask()}remapAndMirrorIndices(e,t,r){var i=this.getMesh().getNbVertices(),a=new Uint32Array(s.A.getMemory(4*i),0,i),n=0,o=0,l=r.length;for(n=0;n<l;++n)a[r[n]]=n;var c=2*t;for(n=0;n<c;++n){var h=n<t?0:l;e[o=4*n]=a[e[o]]+h,e[o+1]=a[e[o+1]]+h,e[o+2]=a[e[o+2]]+h;var u=e[o+3];u!==s.A.TRI_INDEX&&(e[o+3]=a[u]+h)}var d=e.length/4;for(n=c;n<d;++n)e[o=4*n]=a[e[o]],e[o+1]=a[e[o+1]],e[o+2]=a[e[o+2]]+l,e[o+3]=a[e[o+3]]+l}invertFaces(e){for(var t=0,r=e.length/4;t<r;++t){var i=4*t,s=e[i];e[i]=e[i+2],e[i+2]=s}}extractFaces(e,t,r){for(var i=this.getMesh(),a=i.getFaces(),n=i.getMaterials(),o=i.getVerticesOnEdge(),l=0===this._thickness,c=e.length,h=new Uint32Array(s.A.getMemory(4*c*4*3),0,4*c*3),u=l?c:2*c,d=0;d<c;++d){var _=4*d,p=4*e[d],g=h[_]=a[p],m=h[_+1]=a[p+1],f=h[_+2]=a[p+2],v=h[_+3]=a[p+3];if(!l){var A=v!==s.A.TRI_INDEX,T=n[3*g+2]>=r||o[g]>=1,b=n[3*m+2]>=r||o[m]>=1,M=n[3*f+2]>=r||o[f]>=1,y=!!A&&(n[3*v+2]>=r||o[v]>=1);h[_+=4*c]=f,h[_+1]=m,h[_+2]=g,h[_+3]=v,b&&(T&&(h[_=4*u++]=h[_+3]=m,h[_+1]=h[_+2]=g),M&&(h[_=4*u++]=h[_+3]=f,h[_+1]=h[_+2]=m)),A?y&&(T&&(h[_=4*u++]=h[_+3]=g,h[_+1]=h[_+2]=v),M&&(h[_=4*u++]=h[_+3]=v,h[_+1]=h[_+2]=f)):T&&M&&(h[_=4*u++]=h[_+3]=g,h[_+1]=h[_+2]=f)}}var E=new Uint32Array(h.subarray(0,4*u));return this.remapAndMirrorIndices(E,c,t),this._thickness>0&&this.invertFaces(E),E}extractVertices(t){var r=this.getMesh(),i=r.getVertices(),s=r.getNormals(),a=r.getMatrix(),n=u(l(),a),o=t.length,c=new Float32Array(2*o*3),h=[0,0,0],d=[0,0,0],_=3*o,p=this._thickness,g=.01;p<0&&(g=-g);for(var m=0;m<o;++m){var f=3*m,v=3*t[m];h[0]=i[v],h[1]=i[v+1],h[2]=i[v+2],d[0]=s[v],d[1]=s[v+1],d[2]=s[v+2],e.ei(d,d,n),e.S8(d,d),e.Z0(h,h,a),e.Ln(h,h,d,g),c[f]=h[0],c[f+1]=h[1],c[f+2]=h[2],e.Ln(h,h,d,p),c[f+=_]=h[0],c[f+1]=h[1],c[f+2]=h[2]}return c}smoothBorder(e,t){for(var r=2*t.length,i=new Uint32Array(e.getNbFaces()-r),s=0,a=i.length;s<a;++s)i[s]=r+s;var n=e.expandsVertices(e.getVerticesFromFaces(i),1),o=new Se;o.setToolMesh(e),o.smooth(n,1),o.smooth(n,1),o.smooth(n,1)}extract(){var e=this.getMesh(),t=this.filterMaskedVertices(-1/0,.5);if(0!==t.length){var r=e.getFacesFromVertices(t);t=e.getVerticesFromFaces(r);var i=this.extractFaces(r,t,.5),s=this.extractVertices(t),a=new Le(e.getGL());a.setVertices(s),a.setFaces(i),a.initColorsAndMaterials(),a.allocateArrays(),a.initTopology(),0!==this._thickness&&this.smoothBorder(a,r),a.updateGeometry(),a.updateDuplicateColorsAndMaterials(),a.copyRenderConfig(e),a.initRender();var n=this._main;n.addNewMesh(a),n.setMesh(e)}}},Ft[i.A.Tools.LOCALSCALE]=class extends ne{constructor(e){super(e),this._radius=50,this._culling=!1,this._idAlpha=0}startSculpt(){var e=this._main;if(e.getSculptManager().getSymmetry()){var t=e.getPickingSymmetry();t.intersectionMouseMesh(),t.setLocalRadius2(e.getPicking().getLocalRadius2())}}sculptStroke(){var e=this._main,t=e._mouseX-e._lastMouseX,r=e.getPicking(),i=r.getLocalRadius2();if(r.pickVerticesInSphere(i),this.stroke(r,t),e.getSculptManager().getSymmetry()){var s=e.getPickingSymmetry();s.getMesh()&&(s.pickVerticesInSphere(i),this.stroke(s,t))}this.updateRender()}stroke(e,t){var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r),r=this.dynamicTopology(e),this._culling&&(r=this.getFrontVertices(r,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.scale(r,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(r),r)}scale(e,t,r,i,s){for(var a=this.getMesh(),n=a.getVertices(),o=a.getMaterials(),l=.01*i,c=Math.sqrt(r),h=t[0],u=t[1],d=t[2],_=0,p=e.length;_<p;++_){var g=3*e[_],m=n[g],f=n[g+1],v=n[g+2],A=m-h,T=f-u,b=v-d,M=Math.sqrt(A*A+T*T+b*b)/c,y=M*M;y=3*y*y-4*y*M+1,y*=l*o[g+2]*s.getAlpha(m,f,v),n[g]=m+A*y,n[g+1]=f+T*y,n[g+2]=v+b*y}}},Ft[i.A.Tools.TRANSFORM]=class extends ne{constructor(e){super(e),this._gizmo=new Pt(e)}isIdentity(e){return 1===e[0]&&1===e[5]&&1===e[10]&&1===e[15]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]}preUpdate(){var e=this._main.getPicking(),t=e.getMesh();this._gizmo.onMouseOver(),e._mesh=t,this._main.setCanvasCursor("default")}start(e){var t=this._main,r=this.getMesh(),i=t.getPicking();return r&&this._gizmo.onMouseDown()?(i._mesh=r,!0):!!i.intersectionMouseMeshes(t.getMeshes(),t._mouseX,t._mouseY)&&!!t.setOrUnsetMesh(i.getMesh(),e)&&(this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!1)}end(){if(this._gizmo.onMouseUp(),this.getMesh()&&!this.isIdentity(this.getMesh().getEditMatrix())){for(var e=this._main.getSelectedMeshes(),t=0;t<e.length;++t){this._forceToolMesh=e[t],this.pushState(),t>0&&(this._main.getStateManager().getCurrentState().squash=!0);var r=this.getUnmaskedVertices();this._main.getStateManager().pushVertices(r),this.applyEditMatrix(r),0!==r.length&&this.updateMeshBuffers()}this._forceToolMesh=null}}applyEditMatrix(t){var r=this.getMesh(),i=r.getEditMatrix(),s=r.getMaterials(),n=r.getVertices(),o=[0,0,0],l=r.getNbVertices(),c=t.length===l;if(c)for(var h=2;h<3*l;h+=3)if(Math.abs(s[h]-1)>1e-6){c=!1;break}if(c)return a.lK(r.getMatrix(),r.getMatrix(),i),r.updateYawPitchRollFromMatrix(),void a.D_(i);for(var u=0,d=t.length;u<d;++u){var _=3*t[u],p=s[_+2],g=o[0]=n[_],m=o[1]=n[_+1],f=o[2]=n[_+2];e.Z0(o,o,i);var v=1-p;n[_]=g*v+o[0]*p,n[_+1]=m*v+o[1]*p,n[_+2]=f*v+o[2]*p}e.Z0(r.getCenter(),r.getCenter(),i),a.D_(i),t.length===r.getNbVertices()?r.updateGeometry():r.updateGeometry(r.getFacesFromVertices(t),t)}update(){}postRender(){this.getMesh()&&this._gizmo.render()}addSculptToScene(e){this.getMesh()&&this._gizmo.addGizmoToScene(e)}},Ft[i.A.Tools.ELEMENTSELECT]=It,Ft[i.A.Tools.BRUSH].uiName="sculptBrush",Ft[i.A.Tools.INFLATE].uiName="sculptInflate",Ft[i.A.Tools.TWIST].uiName="sculptTwist",Ft[i.A.Tools.SMOOTH].uiName="sculptSmooth",Ft[i.A.Tools.FLATTEN].uiName="sculptFlatten",Ft[i.A.Tools.PINCH].uiName="sculptPinch",Ft[i.A.Tools.CREASE].uiName="sculptCrease",Ft[i.A.Tools.DRAG].uiName="sculptDrag",Ft[i.A.Tools.PAINT].uiName="sculptPaint",Ft[i.A.Tools.MOVE].uiName="sculptMove",Ft[i.A.Tools.MASKING].uiName="sculptMasking",Ft[i.A.Tools.LOCALSCALE].uiName="sculptLocalScale",Ft[i.A.Tools.TRANSFORM].uiName="sculptTransform",Ft[i.A.Tools.ELEMENTSELECT].uiName="sculptElementSelect";const Lt=Ft,Vt=class{constructor(e){this._main=e,this._toolIndex=i.A.Tools.BRUSH,this._tools=[],this._symmetry=!0,this._continuous=!1,this._sculptTimer=-1,this._selection=new ae(e._gl),this.init()}setToolIndex(e){this._toolIndex=e}getToolIndex(){return this._toolIndex}getCurrentTool(){return this._tools[this._toolIndex]}getSymmetry(){return this._symmetry}getTool(e){return this._tools[e]}getSelection(){return this._selection}init(){for(var e=this._main,t=this._tools,r=0,i=Lt.length;r<i;++r)Lt[r]&&(t[r]=new Lt[r](e))}canBeContinuous(){switch(this._toolIndex){case i.A.Tools.TWIST:case i.A.Tools.MOVE:case i.A.Tools.DRAG:case i.A.Tools.LOCALSCALE:case i.A.Tools.TRANSFORM:case i.A.Tools.ELEMENTSELECT:return!1;default:return!0}}isUsingContinuous(){return this._continuous&&this.canBeContinuous()}start(e){var t=this.getCurrentTool(),r=t.start(e);return this._main.getPicking().getMesh()&&this.isUsingContinuous()&&(this._sculptTimer=window.setInterval(t._cbContinuous,16.6)),r}end(){this.getCurrentTool().end(),-1!==this._sculptTimer&&(clearInterval(this._sculptTimer),this._sculptTimer=-1)}preUpdate(){this.getCurrentTool().preUpdate(this.canBeContinuous())}update(){this.isUsingContinuous()||this.getCurrentTool().update()}postRender(){this.getCurrentTool().postRender(this._selection)}addSculptToScene(e){return this.getCurrentTool().addSculptToScene(e)}};var Nt={LINEAR:!1};class Ot{constructor(e,t,r,i){this._vArOut=t,this._cArOut=r,this._mArOut=i,this._vAr=e.getVertices(),this._cAr=e.getColors(),this._mAr=e.getMaterials(),this._eAr=e.getEdges(),this._nbVertices=e.getNbVertices(),this._tagEdges=new Int32Array(e.getNbEdges())}computeTriangleEdgeVertex(e,t,r,i){var s=this._vAr,a=this._cAr,n=this._mAr,o=this._eAr,l=this._vArOut,c=this._cArOut,h=this._mArOut,u=this._tagEdges,d=3*e,_=3*t,p=3*r,g=u[i]-1,m=-1===g?this._nbVertices++:g,f=3*m,v=o[i];if(1===v||v>=3||Nt.LINEAR){if(-1!==g)return m;u[i]=m+1,l[f]=.5*(s[d]+s[_]),l[f+1]=.5*(s[d+1]+s[_+1]),l[f+2]=.5*(s[d+2]+s[_+2]),c[f]=.5*(a[d]+a[_]),c[f+1]=.5*(a[d+1]+a[_+1]),c[f+2]=.5*(a[d+2]+a[_+2]),h[f]=.5*(n[d]+n[_]),h[f+1]=.5*(n[d+1]+n[_+1]),h[f+2]=.5*(n[d+2]+n[_+2])}else-1===g?(u[i]=m+1,l[f]=.125*s[p]+.375*(s[d]+s[_]),l[f+1]=.125*s[p+1]+.375*(s[d+1]+s[_+1]),l[f+2]=.125*s[p+2]+.375*(s[d+2]+s[_+2]),c[f]=.125*a[p]+.375*(a[d]+a[_]),c[f+1]=.125*a[p+1]+.375*(a[d+1]+a[_+1]),c[f+2]=.125*a[p+2]+.375*(a[d+2]+a[_+2]),h[f]=.125*n[p]+.375*(n[d]+n[_]),h[f+1]=.125*n[p+1]+.375*(n[d+1]+n[_+1]),h[f+2]=.125*n[p+2]+.375*(n[d+2]+n[_+2])):(l[f]+=.125*s[p],l[f+1]+=.125*s[p+1],l[f+2]+=.125*s[p+2],c[f]+=.125*a[p],c[f+1]+=.125*a[p+1],c[f+2]+=.125*a[p+2],h[f]+=.125*n[p],h[f+1]+=.125*n[p+1],h[f+2]+=.125*n[p+2]);return m}computeQuadEdgeVertex(e,t,r,i,s){var a=this._vAr,n=this._cAr,o=this._mAr,l=this._eAr,c=this._vArOut,h=this._cArOut,u=this._mArOut,d=this._tagEdges,_=3*e,p=3*t,g=3*r,m=3*i,f=d[s]-1,v=-1===f?this._nbVertices++:f,A=3*v,T=l[s];if(1===T||T>=3||Nt.LINEAR){if(-1!==f)return v;d[s]=v+1,c[A]=.5*(a[_]+a[p]),c[A+1]=.5*(a[_+1]+a[p+1]),c[A+2]=.5*(a[_+2]+a[p+2]),h[A]=.5*(n[_]+n[p]),h[A+1]=.5*(n[_+1]+n[p+1]),h[A+2]=.5*(n[_+2]+n[p+2]),u[A]=.5*(o[_]+o[p]),u[A+1]=.5*(o[_+1]+o[p+1]),u[A+2]=.5*(o[_+2]+o[p+2])}else-1===f?(d[s]=v+1,c[A]=.0625*(a[g]+a[m])+.375*(a[_]+a[p]),c[A+1]=.0625*(a[g+1]+a[m+1])+.375*(a[_+1]+a[p+1]),c[A+2]=.0625*(a[g+2]+a[m+2])+.375*(a[_+2]+a[p+2]),h[A]=.0625*(n[g]+n[m])+.375*(n[_]+n[p]),h[A+1]=.0625*(n[g+1]+n[m+1])+.375*(n[_+1]+n[p+1]),h[A+2]=.0625*(n[g+2]+n[m+2])+.375*(n[_+2]+n[p+2]),u[A]=.0625*(o[g]+o[m])+.375*(o[_]+o[p]),u[A+1]=.0625*(o[g+1]+o[m+1])+.375*(o[_+1]+o[p+1]),u[A+2]=.0625*(o[g+2]+o[m+2])+.375*(o[_+2]+o[p+2])):(c[A]+=.0625*(a[g]+a[m]),c[A+1]+=.0625*(a[g+1]+a[m+1]),c[A+2]+=.0625*(a[g+2]+a[m+2]),h[A]+=.0625*(n[g]+n[m]),h[A+1]+=.0625*(n[g+1]+n[m+1]),h[A+2]+=.0625*(n[g+2]+n[m+2]),u[A]+=.0625*(o[g]+o[m]),u[A+1]+=.0625*(o[g+1]+o[m+1]),u[A+2]+=.0625*(o[g+2]+o[m+2]));return v}computeFaceVertex(e,t,r,i){var s=3*e,a=3*t,n=3*r,o=3*i,l=this._vAr,c=this._cAr,h=this._mAr,u=this._vArOut,d=this._cArOut,_=this._mArOut,p=this._nbVertices++,g=3*p;return u[g]=.25*(l[s]+l[a]+l[n]+l[o]),u[g+1]=.25*(l[s+1]+l[a+1]+l[n+1]+l[o+1]),u[g+2]=.25*(l[s+2]+l[a+2]+l[n+2]+l[o+2]),d[g]=.25*(c[s]+c[a]+c[n]+c[o]),d[g+1]=.25*(c[s+1]+c[a+1]+c[n+1]+c[o+1]),d[g+2]=.25*(c[s+2]+c[a+2]+c[n+2]+c[o+2]),_[g]=.25*(h[s]+h[a]+h[n]+h[o]),_[g+1]=.25*(h[s+1]+h[a+1]+h[n+1]+h[o+1]),_[g+2]=.25*(h[s+2]+h[a+2]+h[n+2]+h[o+2]),p}}var Bt=function(e,t,r,i){var a=e.getNbVertices();r.set(e.getColors().subarray(0,3*a)),i.set(e.getMaterials().subarray(0,3*a));for(var n=e.getVertices(),o=e.getFaces(),l=e.getEdges(),c=e.getFaceEdges(),h=e.getVerticesOnEdge(),u=e.getVerticesRingVertStartCount(),d=e.getVerticesRingVert(),_=e.getVerticesRingFaceStartCount(),p=e.getVerticesRingFace(),g=e.hasOnlyTriangles(),m=0;m<a;++m){var f=3*m,v=0,A=0,T=0,b=0,M=0,y=0,E=0;if(h[m]||Nt.LINEAR){var S=_[2*m],R=S+_[2*m+1];for(y=S;y<R;++y){var x=4*p[y],C=o[x],w=o[x+1],P=o[x+2],D=o[x+3],k=D===s.A.TRI_INDEX;E=s.A.TRI_INDEX,C===m?1===l[c[x]]?E=w:1===l[c[k?x+2:x+3]]&&(E=k?P:D):w===m?1===l[c[x]]?E=C:1===l[c[x+1]]&&(E=P):P===m?1===l[c[x+1]]?E=w:1===l[c[x+2]]&&(E=k?C:D):D===m&&(1===l[c[x+2]]?E=P:1===l[c[x+3]]&&(E=C)),E!==s.A.TRI_INDEX&&(v+=n[E*=3],A+=n[E+1],T+=n[E+2],b++)}b<2?(t[f]=n[f],t[f+1]=n[f+1],t[f+2]=n[f+2]):(b=.25/b,M=.75,t[f]=n[f]*M+v*b,t[f+1]=n[f+1]*M+A*b,t[f+2]=n[f+2]*M+T*b)}else{var I=u[2*m],F=u[2*m+1],L=I+F;for(y=I;y<L;++y)v+=n[E=3*d[y]],A+=n[E+1],T+=n[E+2];if(g)6===F?(b=.0625,M=.625):3===F?(b=.1875,M=.4375):(b=.375/F,M=.625),t[f]=n[f]*M+v*b,t[f+1]=n[f+1]*M+A*b,t[f+2]=n[f+2]*M+T*b;else{var V=0,N=0,O=0,B=0,U=_[2*m],G=U+_[2*m+1],W=0;for(y=U;y<G;++y){var z=o[3+(E=4*p[y])];if(z!==s.A.TRI_INDEX){W++;var X,j=o[E],Y=o[E+1],K=o[E+2];V+=n[X=j===m?3*K:Y===m?3*z:K===m?3*j:3*Y],N+=n[X+1],O+=n[X+2]}}W!==G-U?0!==W?(b=.5*(M=1/(1+.5*F+.25*W)),B=.25*M,t[f]=n[f]*M+v*b+V*B,t[f+1]=n[f+1]*M+A*b+N*B,t[f+2]=n[f+2]*M+T*b+O*B):(6===F?(b=.0625,M=.625):3===F?(b=.1875,M=.4375):(b=.375/F,M=.625),t[f]=n[f]*M+v*b,t[f+1]=n[f+1]*M+A*b,t[f+2]=n[f+2]*M+T*b):(4===F?(M=.5625,b=.09375,B=.015625):M=1-((b=1.5/(F*F))+(B=.25/(F*F)))*F,t[f]=n[f]*M+v*b+V*B,t[f+1]=n[f+1]*M+A*b+N*B,t[f+2]=n[f+2]*M+T*b+O*B)}}}},Ut=function(e,t,r,i,a){for(var n=e.getFaces(),o=e.getFaceEdges(),l=new Ot(e,t,r,i),c=0,h=e.getNbFaces();c<h;++c){var u,d,_,p,g,m=4*c,f=n[m],v=n[m+1],A=n[m+2],T=n[m+3],b=T!==s.A.TRI_INDEX;b?(u=l.computeQuadEdgeVertex(f,v,A,T,o[m]),d=l.computeQuadEdgeVertex(v,A,T,f,o[m+1]),_=l.computeQuadEdgeVertex(A,T,f,v,o[m+2]),p=l.computeQuadEdgeVertex(T,f,v,A,o[m+3]),g=l.computeFaceVertex(f,v,A,T)):(u=l.computeTriangleEdgeVertex(f,v,A,o[m]),d=l.computeTriangleEdgeVertex(v,A,f,o[m+1]),_=l.computeTriangleEdgeVertex(A,f,v,o[m+2])),a&&(m*=4,b?(a[m+1]=a[m+4]=u,a[m+6]=a[m+9]=d,a[m+11]=a[m+14]=_,a[m+3]=a[m+12]=p,a[m+2]=a[m+7]=a[m+8]=a[m+13]=g,a[m]=f,a[m+5]=v,a[m+10]=A,a[m+15]=T):(a[m]=a[m+5]=a[m+8]=u,a[m+1]=a[m+10]=a[m+12]=d,a[m+2]=a[m+6]=a[m+14]=_,a[m+3]=a[m+7]=a[m+11]=a[m+15]=s.A.TRI_INDEX,a[m+4]=f,a[m+9]=v,a[m+13]=A))}return l._tagEdges};Nt.fullSubdivision=function(e,t){var r=e.getNbVertices()+e.getNbEdges()+e.getNbQuads();t.setVertices(new Float32Array(3*r)),t.setColors(new Float32Array(3*r)),t.setMaterials(new Float32Array(3*r)),t.setFaces(new Uint32Array(4*e.getNbFaces()*4)),Bt(e,t.getVertices(),t.getColors(),t.getMaterials());var i=Ut(e,t.getVertices(),t.getColors(),t.getMaterials(),t.getFaces());e.hasUV()&&function(e,t,r){var i=t.getNbVertices(),a=new Uint32Array(2*i);a.set(e.getVerticesDuplicateStartCount());var n=e.getFaces(),o=e.getFacesTexCoord(),l=3*t.getNbFaces(),c=e.getTexCoords(),h=new Float32Array(s.A.getMemory(4*l*2),0,2*l),u=0,d=e.getNbVertices(),_=i-d;for(u=0;u<d;++u){var p=a[2*u];p>0&&(a[2*u]=p+_)}h.set(c),h.set(c.subarray(2*d),2*(d+_));var g=_+e.getNbTexCoords(),m=e.getFaceEdges(),f=new Uint32Array(r.length),v=new Uint32Array(r.length);for(d=n.length,u=0;u<d;++u){var A=m[u];if(A!==s.A.TRI_INDEX){var T=(u+1)%4==0?u-3:u+1,b=o[u],M=o[T];M===s.A.TRI_INDEX&&(M=o[u-2]);var y=r[A]-1,E=v[A],S=b>M?b:M,R=b<M?b:M;0!==E?E===S&&f[A]===R||(h[2*g]=.5*(c[2*b]+c[2*M]),h[2*g+1]=.5*(c[2*b+1]+c[2*M+1]),a[2*y]=g++,a[2*y+1]=1):(h[2*y]=.5*(c[2*b]+c[2*M]),h[2*y+1]=.5*(c[2*b+1]+c[2*M+1]),f[A]=R,v[A]=S)}}var x=new Float32Array(2*g);x.set(h.subarray(0,2*g)),t.setTexCoords(x),t.setVerticesDuplicateStartCount(a),function(e,t,r){for(var i=e.getFacesTexCoord(),a=t.getFaces(),n=new Uint32Array(a.length),o=e.getFaceEdges(),l=e.getNbVertices(),c=t.getNbVertices()-l,h=t.getVerticesDuplicateStartCount(),u=t.getTexCoords(),d=0,_=e.getNbFaces();d<_;++d){var p=4*d,g=i[p],m=i[p+1],f=i[p+2],v=i[p+3];g>=l&&(g+=c),m>=l&&(m+=c),f>=l&&(f+=c),v!==s.A.TRI_INDEX&&v>=l&&(v+=c);var A=o[p],T=r[A]-1;T<0?T=h[2*(-T-1)]:h[2*T]>0&&(r[A]=-T);var b=r[A=o[p+1]]-1;b<0?b=h[2*(-b-1)]:h[2*b]>0&&(r[A]=-b);var M=r[A=o[p+2]]-1;if(M<0?M=h[2*(-M-1)]:h[2*M]>0&&(r[A]=-M),p*=4,v!==s.A.TRI_INDEX){var y=r[A=o[4*d+3]]-1;y<0?y=h[2*(-y-1)]:h[2*y]>0&&(r[A]=-y),n[p+1]=n[p+4]=T,n[p+6]=n[p+9]=b,n[p+11]=n[p+14]=M,n[p+3]=n[p+12]=y,n[p+2]=n[p+7]=n[p+8]=n[p+13]=a[p+2],n[p]=g,n[p+5]=m,n[p+10]=f,n[p+15]=v;var E=2*a[p+2];u[E]=.25*(u[2*g]+u[2*m]+u[2*f]+u[2*v]),u[E+1]=.25*(u[2*g+1]+u[2*m+1]+u[2*f+1]+u[2*v+1])}else n[p]=n[p+5]=n[p+8]=T,n[p+1]=n[p+10]=n[p+12]=b,n[p+2]=n[p+6]=n[p+14]=M,n[p+3]=n[p+7]=n[p+11]=n[p+15]=s.A.TRI_INDEX,n[p+4]=g,n[p+9]=m,n[p+13]=f}t.setFacesTexCoord(n)}(e,t,r)}(e,t,i),t.allocateArrays()},Nt.partialSubdivision=function(e,t,r,i){Bt(e,t,r,i),Ut(e,t,r,i)};const Gt=Nt;var Wt={importOBJ:function(e,t){for(var r=[],i=[],a=[],n=[],o=[],l=[],c=[],h=[],u=[],d=0,_=0,p=0,g=0,m=e.split("\n"),f=[],v=1/255,A=m.length,T=0;T<A;++T){var b=m[T].trim();if(0!==b.length){var M,y=b[0];if("v"===y)" "===(M=b[1])?(f=b.split(/\s+/),i.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f[4]&&a.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])),++p):"t"===M&&(f=b.split(/\s+/),c.push(parseFloat(f[1]),parseFloat(f[2])),++g);else if("f"===y){var E=(f=b.split(/\s+/)).length-1;if(E<3)continue;for(var S=Math.ceil(E/2)-1,R=0;R<S;++R){var x=R+1,C=R+2,w=E-x,P=E-R;w===C&&(w=P,P=s.A.TRI_INDEX);var D,k=f[x].split("/"),I=f[C].split("/"),F=f[w].split("/"),L=P!==s.A.TRI_INDEX;L&&(D=f[P].split("/"));var V=parseInt(k[0],10),N=parseInt(I[0],10),O=parseInt(F[0],10),B=L?parseInt(D[0],10):void 0;if((!L||B!==V&&B!==N&&B!==O)&&V!==N&&V!==O&&N!==O)if(V=(V<0?V+p:V-1)-d,N=(N<0?N+p:N-1)-d,O=(O<0?O+p:O-1)-d,L&&(B=(B<0?B+p:B-1)-d),h.push(V,N,O,L?B:s.A.TRI_INDEX),k[1]){var U=parseInt(k[1],10),G=parseInt(I[1],10),W=parseInt(F[1],10),z=L?parseInt(D[1],10):void 0;U=(U<0?U+g:U-1)-_,G=(G<0?G+g:G-1)-_,W=(W<0?W+g:W-1)-_,L&&(z=(z<0?z+g:z-1)-_),u.push(U,G,W,L?z:s.A.TRI_INDEX)}else u.length>0&&u.push(V,N,O,L?B:s.A.TRI_INDEX)}}else if("#"===y){if("M"!==b[1])continue;if(b.startsWith("#MRGB "))for(var X=(f=b.split(/\s+/))[1],j=2,Y=X.length;j<Y;j+=8){var K=parseInt(X.substr(j,6),16);n.push((K>>16)*v,(K>>8&255)*v,(255&K)*v)}else if(b.startsWith("#MAT "))for(var H=(f=b.split(/\s+/))[1],q=0,Z=H.length;q<Z;q+=6){var Q=parseInt(H.substr(q,6),16);l.push((Q>>16)*v,(Q>>8&255)*v,(255&Q)*v)}}else b.startsWith("o ")&&(r.length>0&&(Wt.initMeshOBJ(r[r.length-1],i,h,a,o,c,u,n,l),d=p,_=g),r.push(new Le(t)))}}return 0===r.length&&(r[0]=new Le(t)),Wt.initMeshOBJ(r[r.length-1],i,h,a,o,c,u,n,l),r},initMeshOBJ:function(e,t,r,i,s,a,n,o,l){e.setVertices(new Float32Array(t)),e.setFaces(new Uint32Array(r)),o.length===t.length?e.setColors(new Float32Array(o)):i.length===t.length&&e.setColors(new Float32Array(i)),l.length===t.length?e.setMaterials(new Float32Array(l)):s.length===t.length&&e.setMaterials(new Float32Array(s)),a.length>0&&n.length===r.length&&e.initTexCoordsDataFromOBJData(a,n),t.length=r.length=0,o.length=i.length=0,l.length=s.length=0,a.length=n.length=0}};const zt=Wt;var Xt={VERSION:3,exportSGL:function(e,t){var r,i=e.length,s=4*(9+31*i),a=0;for(a=0;a<i;++a)s+=4*(r=e[a]).getNbVertices()*3,r.getColors()&&(s+=4*r.getNbVertices()*3),r.getMaterials()&&(s+=4*r.getNbVertices()*3),s+=4*r.getNbFaces()*4,r.hasUV()&&(s+=4*r.getNbTexCoords()*2,s+=4*r.getNbFaces()*4);var n=new ArrayBuffer(s),o=new Float32Array(n),l=new Uint32Array(n),c=0;l[c++]=Xt.VERSION,l[c++]=t._showGrid,l[c++]=v.showSymmetryLine,l[c++]=t._showContour;var h=t.getCamera();for(l[c++]=h.getProjectionType(),l[c++]=h.getMode(),o[c++]=h.getFov(),l[c++]=h.getUsePivot(),l[c++]=i,a=0;a<i;++a){r=e[a],l[c++]=r.getShaderType(),l[c++]=r.getMatcap(),l[c++]=r.getShowWireframe(),l[c++]=r.getFlatShading(),o[c++]=r.getOpacity(),o.set(r.getCenter(),c),c+=3,o.set(r.getMatrix(),c),c+=16,o[c++]=r.getScale();var u=r.getNbVertices();l[c++]=u,o.set(r.getVertices().subarray(0,3*u),c),c+=3*u;var d=r.getColors()?u:0;l[c++]=d,d>0&&o.set(r.getColors().subarray(0,3*u),c),c+=3*d;var _=r.getMaterials()?u:0;l[c++]=_,_>0&&o.set(r.getMaterials().subarray(0,3*u),c),c+=3*_;var p=r.getNbFaces();l[c++]=p,l.set(r.getFaces().subarray(0,4*p),c),c+=4*p;var g=r.hasUV(),m=r.getNbTexCoords();l[c++]=g?m:0,g&&(o.set(r.getTexCoords().subarray(0,2*m),c),c+=2*m),l[c++]=g?p:0,g&&(l.set(r.getFacesTexCoord().subarray(0,4*p),c),c+=4*p)}var f=new DataView(n,0,4*c);return new Blob([f])}};const jt=Xt;var Yt={},Kt=function(e){for(var t=new Uint32Array(e),r=t.length/4,i=0;i<r;++i){var a=4*i+3;e[a]<0&&(t[a]=s.A.TRI_INDEX)}return t};Yt.importSGL=function(e,t,r){var i=new Float32Array(e),s=new Uint32Array(e),a=new Int32Array(e),n=0,o=s[n++];if(o>jt.VERSION)return[];if(o>=2){r._showGrid=s[n++],v.showSymmetryLine=s[n++],r._showContour=s[n++];var l=r.getCamera();l.setProjectionType(s[n++]),l.setMode(s[n++]),l.setFov(i[n++]),l.setUsePivot(s[n++])}for(var c=s[n++],h=new Array(c),u=0;u<c;++u){var d=h[u]=new Le(t);if(o>=2){var _=d.getRenderData();_._shaderType=s[n++],_._matcap=s[n++],_._showWireframe=s[n++],_._flatShading=s[n++],_._alpha=i[n++]}d.getCenter().set(i.subarray(n,n+3)),n+=3,d.getMatrix().set(i.subarray(n,n+16)),n+=16,n++;var p=s[n++];d.setVertices(i.subarray(n,n+3*p)),n+=3*p,(p=s[n++])>0&&d.setColors(i.subarray(n,n+3*p)),n+=3*p,(p=s[n++])>0&&d.setMaterials(i.subarray(n,n+3*p)),n+=3*p,p=s[n++],o<=2?d.setFaces(Kt(a.subarray(n,n+4*p))):d.setFaces(s.subarray(n,n+4*p)),n+=4*p;var g=null;(p=s[n++])&&(g=i.subarray(n,n+2*p)),n+=2*p;var m=null;(p=s[n++])&&(m=o<=2?Kt(a.subarray(n,n+4*p)):s.subarray(n,n+4*p)),n+=4*p,g&&m&&d.initTexCoordsDataFromOBJData(g,m)}return h};const Ht=Yt;var qt={},Zt=function(e){switch(e){case"uchar":case"char":case"int8":case"uint8":return 1;case"ushort":case"short":case"int16":case"uint16":return 2;case"uint":case"int":case"float":case"int32":case"uint32":case"float32":return 4;case"double":case"float64":return 8;default:return 0}},Qt=function(e,t){var r=t?1/255:1;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return function(e){return parseInt(e,10)*r};case"float":case"double":case"float32":case"float64":return parseFloat;default:return function(e){return e}}},Jt=function(e,t,r){var i=r?1/255:1,s=t.offsetOctet;switch(t.type){case"int8":case"char":return function(t){return e.getInt8(t+s)*i};case"uint8":case"uchar":return function(t){return e.getUint8(t+s)*i};case"int16":case"short":return function(t){return e.getInt16(t+s,!0)*i};case"uint16":case"ushort":return function(t){return e.getUint16(t+s,!0)*i};case"int32":case"int":return function(t){return e.getInt32(t+s,!0)*i};case"uint32":case"uint":return function(t){return e.getUint32(t+s,!0)*i};case"float32":case"float":return function(t){return e.getFloat32(t+s,!0)};case"float64":case"double":return function(t){return e.getFloat64(t+s,!0)}}},$t=function(e,t){var r=e.properties,i=e.objProperties={};e.offsetOctet=0;for(var s=0,a=r.length;s<a;++s){var n=r[s],o=i[n.name]={};o.type=n.type,o.type2=n.type2,t.isBinary?(o.offsetOctet=e.offsetOctet,e.offsetOctet+=Zt(n.type)):o.id=s}},er=function(e,t){$t(e,t);var r,i=t.vertices=new Float32Array(3*e.count),s=e.objProperties;(s.red||s.green||s.blue)&&(r=t.colors=new Float32Array(3*e.count)),t.isBinary?function(e,t,r,i){var s,a,n,o=e.count,l=e.objProperties,c=e.offsetOctet,h=c*o,u=new DataView(t.buffer,t.offsetOctet,h),d=Jt(u,l.x,!0),_=Jt(u,l.y,!0),p=Jt(u,l.z,!0);l.red&&(s=Jt(u,l.red,!0)),l.green&&(a=Jt(u,l.green,!0)),l.blue&&(n=Jt(u,l.blue,!0));for(var g=0;g<o;++g){var m=3*g,f=g*c;r[m]=d(f),r[m+1]=_(f),r[m+2]=p(f),s&&(i[m]=s(f)),a&&(i[m+1]=a(f)),n&&(i[m+2]=n(f))}t.offsetOctet+=h}(e,t,i,r):function(e,t,r,i){var s,a,n,o,l,c,h=e.count,u=t.lines,d=e.objProperties,_=t.offsetLine,p=Qt(d.x.type,!0),g=Qt(d.y.type,!0),m=Qt(d.z.type,!0),f=d.x.id,v=d.y.id,A=d.z.id;d.red&&(s=Qt(d.red.type,!0)),d.green&&(a=Qt(d.green.type,!0)),d.blue&&(n=Qt(d.blue.type,!0)),d.red&&(o=d.red.id),d.green&&(l=d.green.id),d.blue&&(c=d.blue.id);for(var T=0;T<h;++T){var b=3*T,M=u[_+T].trim().split(/\s+/);r[b]=p(M[f]),r[b+1]=g(M[v]),r[b+2]=m(M[A]),s&&(i[b]=s(M[o])),a&&(i[b+1]=a(M[l])),n&&(i[b+2]=n(M[c]))}t.offsetLine+=h}(e,t,i,r)},tr=function(e,t,r,i){for(var a=e.count,n=e.objProperties,o=n&&(n.vertex_index||n.vertex_indices)||e.properties[0],l=new DataView(t.buffer,t.offsetOctet),c=Jt(l,o),h=Jt(l,{type:o.type2,offsetOctet:o.offsetOctet+Zt(o.type)}),u=Zt(o.type2),d=e.offsetOctet,_=0,p=0,g=0;g<a;++g){var m=c(_);3!==m&&4!==m||(r[p++]=h(_),r[p++]=h(_+u),r[p++]=h(_+2*u),r[p++]=3===m?s.A.TRI_INDEX:h(_+3*u)),_+=m*u+d}i||(t.faces=r.subarray(0,p)),t.offsetOctet+=_},rr=function(e,t){$t(e,t);var r=t.faces=new Uint32Array(4*e.count);t.isBinary?tr(e,t,r):function(e,t,r){for(var i=e.count,a=t.lines,n=e.objProperties,o=t.offsetLine,l=n.vertex_index||n.vertex_indices,c=Qt(l.type),h=Qt(l.type2),u=l.id,d=0,_=0;_<i;++_){var p=a[o+_].trim().split(/\s+/),g=c(p[0]);3!==g&&4!==g||(r[d]=h(p[u+1]),r[d+1]=h(p[u+2]),r[d+2]=h(p[u+3]),r[d+3]=4===g?h(p[u+4]):s.A.TRI_INDEX,d+=4)}t.offsetLine+=i}(e,t,r)},ir=function(e,t){var r=e.count;t.isBinary?tr(e,t,[],!0):t.offsetLine+=r};qt.importPLY=function(e,t){for(var r=function(e){for(var t,r=s.A.ab2str(e).split("\n"),i={isBinary:!1,start:0,elements:[],lines:r,buffer:e,vertices:null,faces:null,colors:null,offsetLine:0,offsetOctet:0},a=0;;){var n=r[a++];if(i.offsetOctet+=n.length+1,i.offsetLine=a,(n=n.trim()).startsWith("format binary"))i.isBinary=!0;else if(n.startsWith("element"))t=n.split(/\s+/),i.elements.push({name:t[1],count:parseInt(t[2],10),properties:[]});else if(n.startsWith("property")){var o="list"===(t=n.split(/\s+/))[1];i.elements[i.elements.length-1].properties.push({type:t[o?2:1],type2:o?t[3]:void 0,name:t[o?4:2]})}else if(n.startsWith("end_header"))break}return i}(e),i=r.elements,a=0,n=i.length;a<n;++a){var o=i[a];"vertex"===o.name?er(o,r):"face"===o.name?rr(o,r):ir(o,r)}var l=new Le(t);return l.setVertices(r.vertices),l.setFaces(r.faces),l.setColors(r.colors),[l]};const sr=qt;var ar={importSTL:function(e,t){var r,i=new Uint32Array(e,80,1)[0]||0,a=84+50*i===e.byteLength,n=a?ar.importBinarySTL(e,i):ar.importAsciiSTL(s.A.ab2str(e));a&&(r=n[1],n=n[0]),i=n.length/9;for(var o=new Map,l=[0],c=new Uint32Array(4*i),h=0;h<i;++h){var u=4*h,d=9*h;c[u]=ar.detectNewVertex(o,n,r,d,l),c[u+1]=ar.detectNewVertex(o,n,r,d+3,l),c[u+2]=ar.detectNewVertex(o,n,r,d+6,l),c[u+3]=s.A.TRI_INDEX}var _=new Le(t);return _.setVertices(n.subarray(0,3*l[0])),r&&_.setColors(r.subarray(0,3*l[0])),_.setFaces(c),[_]},detectNewVertex:function(e,t,r,i,s){var a=t[i],n=t[i+1],o=t[i+2],l=a+"+"+n+"+"+o,c=e.get(l);if(void 0===c){c=s[0],e.set(l,c);var h=3*c;t[h]=a,t[h+1]=n,t[h+2]=o,r&&(r[h]=r[i],r[h+1]=r[i+1],r[h+2]=r[i+2]),s[0]++}return c},importAsciiSTL:function(e){for(var t=e.split("\n"),r=t.length,i=new Float32Array(Math.ceil(9*r/7)),s=0,a=0;a<r;++a)if(t[a].trim().startsWith("facet")){var n=t[a+2].trim().split(/\s+/);i[s++]=parseFloat(n[1]),i[s++]=parseFloat(n[2]),i[s++]=parseFloat(n[3]),n=t[a+3].trim().split(/\s+/),i[s++]=parseFloat(n[1]),i[s++]=parseFloat(n[2]),i[s++]=parseFloat(n[3]),n=t[a+4].trim().split(/\s+/),i[s++]=parseFloat(n[1]),i[s++]=parseFloat(n[2]),i[s++]=parseFloat(n[3])}return i.subarray(0,s)},importBinarySTL:function(e,t){var r=new Uint8Array(e),i=r.subarray(0,80),s=-1!==String.fromCharCode.apply(null,i).indexOf("COLOR="),a=0,n=new Uint8Array(36*t),o=new Uint8Array(2*t),l=96,c=0,h=0;for(a=0;a<t;a++){for(var u=0;u<36;++u)n[c++]=r[l++];o[h++]=r[l++],o[h++]=r[l++],l+=12}var d=new Uint16Array(o.buffer);o=new Float32Array(9*t);var _=1/31;for(a=0;a<t;++a){c=9*a;var p=d[a],g=1,m=1,f=1,v=32768&p;s?v||(g=(31&p)*_,m=(p>>5&31)*_,f=(p>>10&31)*_):v&&(g=(p>>10&31)*_,m=(p>>5&31)*_,f=(31&p)*_),o[c]=o[c+3]=o[c+6]=g,o[c+1]=o[c+4]=o[c+7]=m,o[c+2]=o[c+5]=o[c+8]=f}return[new Float32Array(n.buffer),o]}};const nr=ar,or={importOBJ:zt.importOBJ,importSGL:Ht.importSGL,importPLY:sr.importPLY,importSTL:nr.importSTL};var lr=__webpack_require__(377),cr=__webpack_require__.n(lr);const hr=class{constructor(e,t){this._main=t._main,this._menu=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("backgroundTitle"));this._bg=this._main.getBackground(),t.addCombobox("Type",this._bg._type,this.onBackgroundType.bind(this),["Image","Environment","Ambient env"]),this._ctrlBlur=t.addSlider("Blur",this._bg._blur,this.onEnvBlur.bind(this),0,1,.01),this._ctrlBlur.setVisibility(1===this._bg._type),t.addTitle("Image"),t.addButton((0,S.A)("backgroundReset"),this,"resetBackground"),t.addButton((0,S.A)("backgroundImport"),this,"importBackground"),t.addCheckbox((0,S.A)("backgroundFill"),this._main.getBackground()._fill,this.updateFill.bind(this))}updateFill(e){this._bg._fill=e,this._main.onCanvasResize()}resetBackground(){this._bg.deleteTexture(),this._main.render()}onEnvBlur(e){this._bg._blur=e,this._main.render()}onBackgroundType(e){this._bg.setType(e),this._main.onCanvasResize(),this._main.render(),this._ctrlBlur.setVisibility(1===e)}importBackground(){document.getElementById("backgroundopen").click()}},ur=class{constructor(e,t){this._main=t._main,this._menu=null,this._camera=this._main.getCamera(),this._cameraTimer=-1,this._cbTranslation=this.cbOnTranslation.bind(this),this.init(e)}init(e){var t=this._camera,r=this._menu=e.addMenu((0,S.A)("cameraTitle"));r.addTitle((0,S.A)("cameraReset")),r.addDualButton((0,S.A)("cameraCenter"),(0,S.A)("cameraFront"),this.resetCamera.bind(this),this.resetFront.bind(this)),r.addDualButton((0,S.A)("cameraLeft"),(0,S.A)("cameraTop"),this.resetLeft.bind(this),this.resetTop.bind(this)),this._ctrlProjectionTitle=r.addTitle((0,S.A)("cameraProjection"));var s=[];s[i.A.Projection.PERSPECTIVE]=(0,S.A)("cameraPerspective"),s[i.A.Projection.ORTHOGRAPHIC]=(0,S.A)("cameraOrthographic"),this._ctrlProjection=r.addCombobox("",t.getProjectionType(),this.onCameraTypeChange.bind(this),s),this._ctrlFov=r.addSlider((0,S.A)("cameraFov"),t.getFov(),this.onFovChange.bind(this),10,90,1),this._ctrlFov.setVisibility(t.getProjectionType()===i.A.Projection.PERSPECTIVE),r.addTitle((0,S.A)("cameraMode"));var a=[];a[i.A.CameraMode.ORBIT]=(0,S.A)("cameraOrbit"),a[i.A.CameraMode.SPHERICAL]=(0,S.A)("cameraSpherical"),a[i.A.CameraMode.PLANE]=(0,S.A)("cameraPlane"),r.addCombobox("",t.getMode(),this.onCameraModeChange.bind(this),a),this._ctrlPivot=r.addCheckbox((0,S.A)("cameraPivot"),t.getUsePivot(),this.onPivotChange.bind(this)),r.addSlider("speed",this._main,"_cameraSpeed",.05,1,.001)}onCameraModeChange(e){this._camera.setMode(e),this._main.render()}onCameraTypeChange(e){this._camera.setProjectionType(e),this._ctrlFov.setVisibility(e===i.A.Projection.PERSPECTIVE),this._main.render()}onFovChange(e){this._camera.setFov(e),this._main.render()}onKeyDown(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault();var t=this._main,r=t.getCamera();switch(e.handled=!0,e.shiftKey&&t._action===i.A.Action.CAMERA_ROTATE&&(r.snapClosestRotation(),t.render()),n.A.getShortKey(e.which)){case i.A.KeyAction.STRIFE_LEFT:r._moveX=-1;break;case i.A.KeyAction.STRIFE_RIGHT:r._moveX=1;break;case i.A.KeyAction.STRIFE_UP:r._moveZ=-1;break;case i.A.KeyAction.STRIFE_DOWN:r._moveZ=1;break;default:e.handled=!1}!0===e.handled&&-1===this._cameraTimer&&(this._cameraTimer=window.setInterval(this._cbTranslation,16.6))}}cbOnTranslation(){var e=this._main;e.getCamera().updateTranslation(),e.render()}onKeyUp(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault(),e.handled=!0;var t=this._camera;switch(n.A.getShortKey(e.which)){case i.A.KeyAction.STRIFE_LEFT:case i.A.KeyAction.STRIFE_RIGHT:t._moveX=0;break;case i.A.KeyAction.STRIFE_UP:case i.A.KeyAction.STRIFE_DOWN:t._moveZ=0;break;case i.A.KeyAction.CAMERA_RESET:this.resetCamera();break;case i.A.KeyAction.CAMERA_FRONT:this.resetFront();break;case i.A.KeyAction.CAMERA_TOP:this.resetTop();break;case i.A.KeyAction.CAMERA_LEFT:this.resetLeft();break;default:e.handled=!1}-1!==this._cameraTimer&&0===t._moveX&&0===t._moveZ&&(clearInterval(this._cameraTimer),this._cameraTimer=-1)}}resetCamera(){this._camera.resetView(),this._main.render()}resetFront(){this._camera.toggleViewFront(),this._main.render()}resetLeft(){this._camera.toggleViewLeft(),this._main.render()}resetTop(){this._camera.toggleViewTop(),this._main.render()}onPivotChange(){this._camera.toggleUsePivot(),this._main.render()}},dr=class{constructor(e,t){this._ctrlGui=t,this._menu=null,this.init(e)}init(e){this._langs=Object.keys(S.A.languages),this._menu=e.addMenu("Language"),this._menu.addCombobox("",this._langs.indexOf(S.A.select),this.onLangChange.bind(this),this._langs)}onLangChange(e){S.A.select=this._langs[parseInt(e,10)],this._ctrlGui.initGui()}};var _r=__webpack_require__(972),pr=__webpack_require__(846),gr={exportOBJ:function(e,t=!0,r=!1){for(var i="s 0\n",s=[1,1],a=0,n=e.length;a<n;++a)i+="o mesh_"+a+"\n",i=gr.addMesh(e[a],i,s,t,r);return new Blob([i])}},mr=function(e,t,r){for(var i=0,s=t.length;i<s;i++)e[r++]=t.charCodeAt(i);return r};gr.addMesh=function(t,r,i,a,n){var o=t.getVertices(),l=t.getColors(),c=t.getMaterials(),h=t.getFaces(),u=t.getNbVertices(),d=t.getNbFaces(),_=t.getNbTexCoords(),p=t.getMatrix(),g=0,m=0,f="",v=0;v=n?128*u:79*u,v+=45*_+66*d;var A=new Uint8Array(Math.max(1e3,v)),T=0,b=[0,0,0];for(g=0;g<u;++g)m=3*g,b[0]=o[m],b[1]=o[m+1],b[2]=o[m+2],e.Z0(b,b,p),f="v "+b[0]+" "+b[1]+" "+b[2],f+=n?" "+l[m]+" "+l[m+1]+" "+l[m+2]+"\n":"\n",T=mr(A,f,T);if(a){var M=Math.ceil(u/64);for(g=0;g<M;++g){f="#MRGB ",m=64*g;for(var y=g===M-1?u:m+64;m<y;++m){f+="ff";var E=3*m,S=Math.round(255*l[E]).toString(16),R=Math.round(255*l[E+1]).toString(16),x=Math.round(255*l[E+2]).toString(16);f+=1===S.length?"0"+S:S,f+=1===R.length?"0"+R:R,f+=1===x.length?"0"+x:x}T=mr(A,f+="\n",T)}for(M=Math.ceil(u/46),g=0;g<M;++g){f="#MAT ",m=46*g;for(var C=g===M-1?u:m+46;m<C;++m){var w=3*m,P=Math.round(255*c[w]).toString(16),D=Math.round(255*c[w+1]).toString(16),k=Math.round(255*c[w+2]).toString(16);f+=1===P.length?"0"+P:P,f+=1===D.length?"0"+D:D,f+=1===k.length?"0"+k:k}T=mr(A,f+="\n",T)}}var I=t.getFacesTexCoord(),F=t.getTexCoords(),L=t.hasUV();if(L)for(g=0;g<_;++g)f="vt "+F[m=2*g]+" "+F[m+1]+"\n",T=mr(A,f,T);var V=i[0],N=i[1];for(i[0]+=u,i[1]+=_,g=0;g<d;++g){var O=h[3+(m=4*g)];L?(f="f "+(V+h[m])+"/"+(N+I[m]),f+=" "+(V+h[m+1])+"/"+(N+I[m+1]),f+=" "+(V+h[m+2])+"/"+(N+I[m+2]),f+=O!==s.A.TRI_INDEX?" "+(V+O)+"/"+(N+I[m+3])+"\n":"\n"):(f="f "+(V+h[m]),f+=" "+(V+h[m+1]),f+=" "+(V+h[m+2]),f+=O!==s.A.TRI_INDEX?" "+(V+O)+"\n":"\n"),T=mr(A,f,T)}if(A=A.subarray(0,T),window.TextDecoder)return r+(new TextDecoder).decode(A);for(g=0;g<T;++g)r+=String.fromCharCode(A[g]);return r};const fr=gr;var vr={},Ar=function(e){return nt.mergeArrays(e,{vertices:null,colors:null,faces:null})};vr.exportAsciiPLY=function(e){var t=Ar(e),r=t.nbVertices,i=t.nbFaces,a=t.vertices,n=t.colors,o=t.faces,l=0,c=0,h="ply\nformat ascii 1.0\ncomment created by SculptGL\n";for(h+="element vertex "+r+"\n",h+="property float x\nproperty float y\nproperty float z\n",h+="property uchar red\nproperty uchar green\nproperty uchar blue\n",h+="element face "+i+"\n",h+="property list uchar uint vertex_indices\nend_header\n",l=0;l<r;++l)h+=a[c=3*l]+" "+a[c+1]+" "+a[c+2]+" "+(255*n[c]|0)+" "+(255*n[c+1]|0)+" "+(255*n[c+2]|0)+"\n";for(l=0;l<i;++l){var u=o[3+(c=4*l)],d=u!==s.A.TRI_INDEX;h+=(d?"4 ":"3 ")+o[c]+" "+o[c+1]+" "+o[c+2]+(d?" "+u+"\n":"\n")}return new Blob([h])},vr.exportBinaryPLY=function(e,t){var r=Ar(e),i=r.nbVertices,a=r.nbFaces,n=r.nbQuads,o=r.nbTriangles,l=r.vertices,c=r.colors,h=r.faces,u=0,d=0,_=0;if(t&&t.swapXY)for(u=0;u<i;++u){var p=l[1+(_=3*u)];l[_+1]=-l[_+2],l[_+2]=p}var g="ply\nformat binary_"+(s.A.littleEndian?"little":"big")+"_endian 1.0\ncomment created by SculptGL\n";g+="element vertex "+i+"\n",g+="property float x\nproperty float y\nproperty float z\n",g+="property uchar red\nproperty uchar green\nproperty uchar blue\n",g+="element face "+a+"\n",g+="property list uchar uint vertex_indices\nend_header\n";var m=4*l.length+c.length,f=4*(4*n+3*o)+a,v=g.length+m+2*f,A=new Uint8Array(v),T=new DataView(A.buffer);d=g.length;var b=0;for(b=0;b<d;++b)A[b]=g.charCodeAt(b);for(u=0;u<i;++u)d=3*u,T.setFloat32(b,l[d],!0),b+=4,T.setFloat32(b,l[d+1],!0),b+=4,T.setFloat32(b,l[d+2],!0),b+=4,T.setUint8(b,Math.round(255*c[d])),b+=1,T.setUint8(b,Math.round(255*c[d+1])),b+=1,T.setUint8(b,Math.round(255*c[d+2])),b+=1;for(u=0;u<a;++u){var M=h[3+(d=4*u)]!==s.A.TRI_INDEX;T.setUint8(b,M?4:3),b+=1,T.setUint32(b,h[d],!0),b+=4,T.setUint32(b,h[d+1],!0),b+=4,T.setUint32(b,h[d+2],!0),b+=4,M&&(T.setUint32(b,h[d+3],!0),b+=4)}return new Blob([A])};const Tr=vr;var br={},Mr=function(t){for(var r=nt.mergeArrays(t,{vertices:null,colors:null,triangles:null}),i=r.vertices,s=r.triangles,a=e.vt(),n=e.vt(),o=e.vt(),l=r.faceNormals=new Float32Array(3*r.nbTriangles),c=0;c<r.nbTriangles;++c){var h=3*c,u=3*s[h],d=3*s[h+1],_=3*s[h+2];e.hZ(a,i[u],i[u+1],i[u+2]),e.hZ(n,i[d],i[d+1],i[d+2]),e.hZ(o,i[_],i[_+1],i[_+2]),e.jb(n,n,a),e.jb(o,o,n),e.$A(a,n,o),e.S8(a,a),l[h]=a[0],l[h+1]=a[1],l[h+2]=a[2]}return r};br.exportAsciiSTL=function(e){for(var t=Mr(e),r=t.nbTriangles,i=t.vertices,s=t.triangles,a=t.faceNormals,n="solid mesh\n",o=0;o<r;++o){var l=3*o;n+=" facet normal "+a[l]+" "+a[l+1]+" "+a[l+2]+"\n",n+="  outer loop\n";var c=3*s[l],h=3*s[l+1],u=3*s[l+2];n+="   vertex "+i[c]+" "+i[c+1]+" "+i[c+2]+"\n",n+="   vertex "+i[h]+" "+i[h+1]+" "+i[h+2]+"\n",n+="   vertex "+i[u]+" "+i[u+1]+" "+i[u+2]+"\n",n+="  endloop\n",n+=" endfacet\n"}return n+="endsolid mesh\n",new Blob([n])},br.exportBinarySTL=function(e,t){var r,i,s=Mr(e),a=s.nbTriangles,n=s.vertices,o=s.colors,l=s.triangles,c=s.faceNormals;if(t&&t.swapXY){var h=s.nbVertices;for(r=0;r<h;++r){var u=n[1+(i=3*r)];n[i+1]=-n[i+2],n[i+2]=u}}var d=new Uint8Array(84+50*a),_=t&&t.colorMagic;if(_){var p=[67,79,76,79,82,61,255,255,255,255];for(r=0;r<p.length;++r)d[r]=p[r]}new DataView(d.buffer).setUint32(80,a,!0);var g=new Uint8Array(n.buffer),m=new Uint8Array(c.buffer),f=84,v=0,A=_?0:32768,T=31/3;for(r=0;r<a;++r){for(i=12*r,v=0;v<12;++v)d[f++]=m[i++];var b=3*l[i=3*r],M=3*l[i+1],y=3*l[i+2],E=4*b;for(v=0;v<12;++v)d[f++]=g[E++];var S=4*M;for(v=0;v<12;++v)d[f++]=g[S++];var R=4*y;for(v=0;v<12;++v)d[f++]=g[R++];var x=Math.round((o[b]+o[M]+o[y])*T),C=Math.round((o[b+1]+o[M+1]+o[y+1])*T)<<5,w=Math.round((o[b+2]+o[M+2]+o[y+2])*T);_?w<<=10:x<<=10;var P=x+C+w+A;d[f++]=255&P,d[f++]=P>>8}return new Blob([d])};const yr=br;var Er=__webpack_require__(910),Sr=__webpack_require__.n(Er),Rr={exportSketchfab:function(e,t){if(window.sketchfabOAuth2Config){var r=new XMLHttpRequest;return new(Sr())(window.sketchfabOAuth2Config).connect().then(function(i){!function(e,t,r,i){e.open("POST","https://api.sketchfab.com/v2/models",!0),e.onprogress=function(e){if(e.lengthComputable&&e.total){var t=Math.round(100*e.loaded/e.total);i.setVisibility("Sketchfab upload: "+t+"%")}};var s=function(){i.setMessage("")};e.onerror=s,e.onabort=s,e.onload=function(){s();var t=JSON.parse(e.responseText),i=t.uid;if(i){window.prompt((0,S.A)("sketchfabUploadProcessing"),"https://sketchfab.com/models/"+i);var a=function(){var e=new XMLHttpRequest,t="https://api.sketchfab.com/v2/models/"+i+"/status";"object"==typeof r&&r.hasOwnProperty("token_type")&&"Bearer"===r.token_type?(e.open("GET",t,!0),e.setRequestHeader("Authorization","Bearer "+r.access_token)):e.open("GET",t+"?token="+r,!0),e.onload=function(){var t=JSON.parse(e.responseText);"FAILED"===t.processing?window.alert((0,S.A)("sketchfabUploadError",t.warning.generic.join("\n"))):"SUCCEEDED"===t.processing?window.prompt((0,S.A)("sketchfabUploadSuccess"),"https://sketchfab.com/models/"+i):window.setTimeout(a,5e3)},e.send()};a()}else window.alert((0,S.A)("sketchfabUploadError",t.detail))},i.setMessage("Creating zip..."),pr.zip.useWebWorkers=!0,pr.zip.workerScriptsPath="worker/",pr.zip.createWriter(new pr.zip.BlobWriter("application/zip"),function(s){var a=Tr.exportBinaryPLY(t.getMeshes(),{swapXY:!0});s.add("yourMesh.ply",new pr.zip.BlobReader(a),function(){s.close(Rr.exportFileSketchfab.bind(this,r,e,i))})},onerror)}(r,e,i,t)}).catch(function(e){console.error(e)}),r}},exportFileSketchfab:function(e,t,r,i){if(!t.isAborted){var s=new FormData;s.append("modelFile",i,"sculptglModel.zip"),s.append("name","My model"),s.append("tags","sculptgl"),"object"==typeof e&&e.hasOwnProperty("token_type")&&"Bearer"===e.token_type?t.setRequestHeader("Authorization","Bearer "+e.access_token):s.append("token",e),r.setMessage("Sketchfab upload..."),t.send(s)}}};const xr=Rr;var Cr={exportSculpteo:function(e,t){var r=new XMLHttpRequest;r.open("POST","uploadSculpteo.php",!0),r.onprogress=function(e){if(e.lengthComputable&&e.total){var r=Math.round(100*e.loaded/e.total);t.setMessage("Sculpteo upload: "+r+"%")}};var i=function(){t.setMessage("")};r.onerror=i,r.onabort=i,r.onload=function(){if(i(),200===this.status){var e=r.responseText.match(/\/print\/(.+?)(?=")/);e&&window.open("https://www.sculpteo.com/en"+e[0],"_blank")}};var s=e.getMeshes(),a=e.computeBoundingBoxMeshes(s),n=e.computeRadiusFromBoundingBox(a),o=Tr.exportBinaryPLY(s,{swapXY:!0});return t.setMessage("Creating zip..."),pr.zip.useWebWorkers=!0,pr.zip.workerScriptsPath="worker/",pr.zip.createWriter(new pr.zip.BlobWriter("application/zip"),function(e){e.add("yourMesh.ply",new pr.zip.BlobReader(o),function(){e.close(Cr.exportFileSculpteo.bind(this,n,r,t))})},onerror),r},exportFileSculpteo:function(e,t,r,i){if(!t.isAborted){var s=new FormData;s.append("file",i),s.append("name","fromSculptgl"),s.append("scale",4/e),r.setMessage("Sculpteo upload..."),t.send(s)}}};const wr=Cr;var Pr={exportMaterialise:function(e,t){var r=new XMLHttpRequest;r.open("POST","https://i.materialise.com/web-api/tool/20cc0fd6-3cef-4111-a201-0b87026d892c/model",!0),r.onprogress=function(e){if(e.lengthComputable&&e.total){var r=Math.round(100*e.loaded/e.total);t.setMessage("Materialise upload: "+r+"%")}};var i=function(){t.setMessage("")};r.onerror=i,r.onabort=i,r.onload=function(){if(i(),200===r.status){var e=JSON.parse(r.responseText);window.open("https://i.materialise.com/en/3dprint#modelId="+e.modelID,"_blank")}};var s=e.getMeshes(),a=e.computeBoundingBoxMeshes(s),n=e.computeRadiusFromBoundingBox(a),o=yr.exportBinarySTL(s,{colorMagic:!0,swapXY:!0});return t.setMessage("Creating zip..."),pr.zip.useWebWorkers=!0,pr.zip.workerScriptsPath="worker/",pr.zip.createWriter(new pr.zip.BlobWriter("application/zip"),function(e){e.add("yourMesh.stl",new pr.zip.BlobReader(o),function(){e.close(Pr.exportFileMaterialise.bind(this,n,r,t))})},onerror),r},exportFileMaterialise:function(e,t,r,i){if(!t.isAborted){var s=new FormData;s.append("file",i,"yourMesh.zip"),r.setMessage("Materialise upload..."),t.send(s)}}};const Dr=Pr;var kr={};kr.exportOBJ=fr.exportOBJ,kr.exportSGL=jt.exportSGL,kr.exportAsciiPLY=Tr.exportAsciiPLY,kr.exportBinaryPLY=Tr.exportBinaryPLY,kr.exportAsciiSTL=yr.exportAsciiSTL,kr.exportBinarySTL=yr.exportBinarySTL,kr.exportSketchfab=xr.exportSketchfab,kr.exportSculpteo=wr.exportSculpteo,kr.exportMaterialise=Dr.exportMaterialise;const Ir=kr;var Fr={_gl:null,_checkRTT:{},_webGLExtensions:{}};Fr.HALF_FLOAT=Fr.HALF_FLOAT_OES=36193,Fr.checkRTTSupport=function(e,t){var r=Fr._gl;if(void 0===r)return!1;var i=e+","+t;if(void 0!==Fr._checkRTT[i])return Fr._checkRTT[i];var s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,2,2,0,r.RGBA,e,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var n=Fr._checkRTT[i]=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(s),r.deleteFramebuffer(a),r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),n},Fr.hasRTTLinearHalfFloat=function(){return Fr._webGLExtensions.OES_texture_half_float_linear&&Fr.checkRTTSupport(Fr.HALF_FLOAT,Fr._gl.LINEAR)},Fr.hasRTTLinearFloat=function(){return Fr._webGLExtensions.OES_texture_float_linear&&Fr.checkRTTSupport(Fr._gl.FLOAT,Fr._gl.LINEAR)},Fr.hasRTTHalfFloat=function(){return Fr._webGLExtensions.OES_texture_half_float&&Fr.checkRTTSupport(Fr.HALF_FLOAT,Fr._gl.NEAREST)},Fr.hasRTTFloat=function(){return Fr._webGLExtensions.OES_texture_float&&Fr.checkRTTSupport(Fr._gl.FLOAT,Fr._gl.NEAREST)},Fr.getWebGLExtension=function(e){return Fr._webGLExtensions[e]},Fr.getWebGLExtensions=function(){return Fr._webGLExtensions},Fr.initWebGLExtensions=function(e){Fr._gl=e;for(var t=e.getSupportedExtensions(),r=Fr._webGLExtensions,i=0,s=t.length;i<s;++i){var a=t[i];r[a]=e.getExtension(a)}};const Lr=Fr;var Vr;const Nr=class{constructor(e,t=null,r=e.createRenderbuffer(),i=!1){this._gl=e,this._texture=e.createTexture(),this._depth=r,this._framebuffer=e.createFramebuffer(),this._shaderType=t,this._invSize=new Float32Array(2),this._vertexBuffer=null,i&&Lr.hasRTTHalfFloat()?this._type=Lr.HALF_FLOAT_OES:i&&Lr.hasRTTFloat()?this._type=e.FLOAT:this._type=e.UNSIGNED_BYTE,this.setWrapRepeat(!1),this.setFilterNearest(!1),this.init()}getGL(){return this._gl}getVertexBuffer(){return this._vertexBuffer}getFramebuffer(){return this._framebuffer}getTexture(){return this._texture}getDepth(){return this._depth}getInverseSize(){return this._invSize}init(){var e=this._gl;Vr||(Vr=new d(e,e.ARRAY_BUFFER,e.STATIC_DRAW)).update(new Float32Array([-1,-1,4,-1,-1,4])),this._vertexBuffer=Vr}setWrapRepeat(e){this._wrapRepeat=e}setFilterNearest(e){this._filterNearest=e}onResize(e,t){var r=this._gl;this._invSize[0]=1/e,this._invSize[1]=1/t,r.bindTexture(r.TEXTURE_2D,this._texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,this._type,null);var i=this._filterNearest?r.NEAREST:r.LINEAR;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i);var s=this._wrapRepeat?r.REPEAT:r.CLAMP_TO_EDGE;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,s),this._depth&&(r.bindRenderbuffer(r.RENDERBUFFER,this._depth),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,t)),r.bindFramebuffer(r.FRAMEBUFFER,this._framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this._texture,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this._depth),r.bindTexture(r.TEXTURE_2D,null)}release(){this._texture&&this._gl.deleteTexture(this._texture),this.getVertexBuffer().release()}render(e){$[this._shaderType].getOrCreate(this._gl).draw(this,e)}},Or=class{constructor(e,t){this._main=t._main,this._ctrlGui=t,this._menu=null,this._parent=e,this._exportAll=!0,this._objColorZbrush=!0,this._objColorAppended=!1,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("fileTitle"));t.addTitle((0,S.A)("fileImportTitle")),t.addButton((0,S.A)("fileAdd"),this,"addFile"),t.addCheckbox((0,S.A)("fileAutoMatrix"),this._main,"_autoMatrix"),t.addCheckbox((0,S.A)("fileVertexSRGB"),this._main,"_vertexSRGB"),t.addTitle((0,S.A)("fileExportSceneTitle")),t.addCheckbox((0,S.A)("fileExportAll"),this,"_exportAll"),t.addButton((0,S.A)("fileExportSGL"),this,"saveFileAsSGL"),t.addButton((0,S.A)("fileExportOBJ"),this,"saveFileAsOBJ"),t.addButton((0,S.A)("fileExportPLY"),this,"saveFileAsPLY"),t.addButton((0,S.A)("fileExportSTL"),this,"saveFileAsSTL"),t.addCheckbox("OBJ color zbrush",this,"_objColorZbrush"),t.addCheckbox("OBJ color append",this,"_objColorAppended"),t.addButton((0,S.A)("sketchfabTitle"),this._ctrlGui,"exportSketchfab"),t.addTitle((0,S.A)("fileExportTextureTitle")),this._guiTexSize=t.addSlider((0,S.A)("fileExportTextureSize"),10,this.onTextureSize.bind(this),8,12,1),this._guiTexSize.setValue(10),t.addButton((0,S.A)("fileExportColor"),this,"saveColor"),t.addButton((0,S.A)("fileExportRoughness"),this,"saveRoughness"),t.addButton((0,S.A)("fileExportMetalness"),this,"saveMetalness")}addFile(){document.getElementById("fileopen").click()}onTextureSize(e){this._texSize=1<<e,this._guiTexSize.domInputText.value=this._texSize}_getExportMeshes(){if(this._exportAll)return this._main.getMeshes();var e=this._main.getSelectedMeshes();return e.length?e:void 0}_extractTexture(e,t,r){var i=document.createElement("canvas");i.width=t,i.height=r;var s=new Uint8Array(4*t*r);if(e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return console.error("FRAMEBUFFER not complete"),i;e.flush(),e.finish(),e.readPixels(0,0,t,r,e.RGBA,e.UNSIGNED_BYTE,s);var a=i.getContext("2d"),n=a.getImageData(0,0,t,r);return n.data.set(s),a.putImageData(n,0,0),i}_getRttPaint(e){return this._rttPaint||(this._rttPaint=new Nr(e,i.A.Shader.PAINTUV,null),this._rttPaint.setWrapRepeat(!0),this._rttPaint.setFilterNearest(!0),Q.INPUT_TEXTURE=this._getRttPaint()),this._rttPaint}_getRttBlur(e){return this._rttBlur||(this._rttBlur=new Nr(e,i.A.Shader.BLUR,null)),this._rttBlur}_saveTexture(e){var t=this._main.getMesh();if(t)if(t.getTexCoords()){var r=t.getGL(),s=this._texSize,a=this._texSize,n=t.getShaderType();t.setShaderType(i.A.Shader.PAINTUV);var o=this._getRttPaint(r);o.onResize(s,a),r.bindFramebuffer(r.FRAMEBUFFER,o.getFramebuffer()),r.clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,s,a),t.render(),t.setShaderType(n),this._blurImage(r,s,a),this._extractTexture(r,s,a).toBlob(function(t){(0,_r.saveAs)(t,e+".png")}.bind(this)),this._main.onCanvasResize()}else window.alert("The selected mesh has no UV!")}_blurImage(e,t,r){var i=this._getRttBlur(e);i.onResize(t,r),e.bindFramebuffer(e.FRAMEBUFFER,i.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),i.render(this._main)}saveColor(){q.CHANNEL_VALUE=0,this._saveTexture("diffuse")}saveRoughness(){q.CHANNEL_VALUE=1,this._saveTexture("roughness")}saveMetalness(){q.CHANNEL_VALUE=2,this._saveTexture("metalness")}saveFileAsSGL(){var e=this._getExportMeshes();e&&this._save(Ir.exportSGL(e,this._main),"yourMesh.sgl")}saveFileAsOBJ(){var e=this._getExportMeshes();e&&this._save(Ir.exportOBJ(e,this._objColorZbrush,this._objColorAppended),"yourMesh.obj")}saveFileAsPLY(){var e=this._getExportMeshes();e&&this._save(Ir.exportBinaryPLY(e),"yourMesh.ply")}saveFileAsSTL(){var e=this._getExportMeshes();e&&this._save(Ir.exportBinarySTL(e),"yourMesh.stl")}_save(e,t,r){if(!r)return(0,_r.saveAs)(e,t);pr.zip.useWebWorkers=!0,pr.zip.workerScriptsPath="worker/",pr.zip.createWriter(new pr.zip.BlobWriter("application/zip"),function(r){r.add(t,new pr.zip.BlobReader(e),function(){r.close(function(e){(0,_r.saveAs)(e,"yourMesh.zip")})})},onerror)}onKeyDown(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&e.altKey&&78===t?(this._main.clearScene(),e.handled=!0):!e.ctrlKey||79!==t&&73!==t?e.ctrlKey&&69===t&&(this.saveFileAsOBJ(),e.handled=!0):(this.addFile(),e.handled=!0)}}},Br=class{constructor(e,t){this._main=t._main,this.domVerts=null,this.domFaces=null,this.domUl=null,this.init(e)}init(e){this.domVerts=document.createElement("ul"),this.domVerts.innerHTML=(0,S.A)("meshNbVertices"),this.domFaces=document.createElement("ul"),this.domFaces.innerHTML=(0,S.A)("meshNbFaces"),this.domUl=document.createElement("span"),this.domUl.appendChild(this.domVerts),this.domUl.appendChild(this.domFaces);var t=this.domUl.style;t.cursor="default",void 0===t.float?t.cssFloat="right":t.float="right",e.domTopbar.appendChild(this.domUl)}updateMeshInfo(){var e=this._main.getMesh();this.domVerts.innerHTML=(0,S.A)("meshNbVertices")+(e?e.getNbVertices():0),this.domFaces.innerHTML=(0,S.A)("meshNbFaces")+(e?e.getNbFaces():0)}},Ur=class{constructor(e,t){this._main=t._main,this._menu=null,this._copyPatternType=0,this._copyPatternCount=3,this._copyPatternSpacing=10,this._copyPatternAngle=30,this._copyPatternRadius=20,this._copyPatternAxis=2,this._isPatternOperationInProgress=!1,this._ctrlCopyPatternSpacing=null,this._ctrlCopyPatternAngle=null,this._ctrlCopyPatternRadius=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("sceneCopyPattern"));t.addCombobox((0,S.A)("sceneCopyPatternType"),this._copyPatternType,this.onCopyPatternType.bind(this),[(0,S.A)("sceneCopyPatternLinear"),(0,S.A)("sceneCopyPatternPolar")]),t.addSlider((0,S.A)("sceneCopyPatternCount"),this._copyPatternCount,this.onCopyPatternCount.bind(this),1,20,1),this._ctrlCopyPatternSpacing=t.addSlider((0,S.A)("sceneCopyPatternSpacing"),this._copyPatternSpacing,this.onCopyPatternSpacing.bind(this),0,100,1),this._ctrlCopyPatternAngle=t.addSlider((0,S.A)("sceneCopyPatternAngle"),this._copyPatternAngle,this.onCopyPatternAngle.bind(this),0,360,1),this._ctrlCopyPatternRadius=t.addSlider((0,S.A)("sceneCopyPatternRadius"),this._copyPatternRadius,this.onCopyPatternRadius.bind(this),0,100,1),t.addCombobox((0,S.A)("sceneCopyPatternAxis"),this._copyPatternAxis,this.onCopyPatternAxis.bind(this),["X","Y","Z"]),t.addButton((0,S.A)("sceneCopyPatternApply"),this,"applyCopyPattern"),this.updateCopyPatternControls()}onCopyPatternType(e){this._copyPatternType=e,this.updateCopyPatternControls()}onCopyPatternCount(e){this._copyPatternCount=e}onCopyPatternSpacing(e){this._copyPatternSpacing=e}onCopyPatternAngle(e){this._copyPatternAngle=e}onCopyPatternRadius(e){this._copyPatternRadius=e}onCopyPatternAxis(e){this._copyPatternAxis=e}updateCopyPatternControls(){var e=0===this._copyPatternType;this._ctrlCopyPatternSpacing.setVisibility(e),this._ctrlCopyPatternAngle.setVisibility(!e),this._ctrlCopyPatternRadius.setVisibility(!e)}applyCopyPattern(){if(this._isPatternOperationInProgress)console.warn("Pattern operation already in progress, ignoring duplicate request");else{var e=this._main.getSelectedMeshes();if(e.length)if(e.length>1)window.alert("Please select a single mesh before applying a pattern.");else{this._isPatternOperationInProgress=!0;try{0===this._copyPatternType?this._main.duplicateSelectionLinear(this._copyPatternCount,this._copyPatternSpacing,this._copyPatternAxis):this._main.duplicateSelectionPolar(this._copyPatternCount,this._copyPatternAngle,this._copyPatternRadius,this._copyPatternAxis)}finally{this._isPatternOperationInProgress=!1}}else window.alert("Please select at least one mesh before applying a pattern.")}}};var Gr={RESOLUTION:150,RELAX_ITERATIONS:6,RELAX_INTENSITY:.4,TANGENT:!0,remesh:function(e,t){var r=nt.RESOLUTION;nt.RESOLUTION=Gr.RESOLUTION;var i=nt.remesh(e,t,!1);return nt.RESOLUTION=r,Gr.relax(i),i},relax:function(e){if(e&&!(Gr.RELAX_ITERATIONS<=0)){for(var t=e.getNbVertices(),r=new Uint32Array(t),i=0;i<t;++i)r[i]=i;var s=new Se(null);s.setToolMesh(e);for(var a=0;a<Gr.RELAX_ITERATIONS;++a)Gr.TANGENT?s.smoothTangent(r,Gr.RELAX_INTENSITY):s.smooth(r,Gr.RELAX_INTENSITY),e.updateGeometry();e.updateGeometryBuffers()}}};const Wr=Gr,zr=class extends ke{constructor(e,t){super(),this.setID(e.getID()),this.setMeshData(t?e.getMeshData():{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}),this.setRenderData(e.getRenderData()),this.setTransformData(e.getTransformData()),this._detailsXYZ=null,this._detailsRGB=null,this._detailsPBR=null,this._vertMapping=null,this._evenMapping=!1}optimize(){}getEvenMapping(){return this._evenMapping}getVerticesMapping(){return this._vertMapping}setVerticesMapping(e){this._vertMapping=e}setEvenMapping(e){this._evenMapping=e}higherSynthesis(e){e.computePartialSubdivision(this.getVertices(),this.getColors(),this.getMaterials(),this.getNbVertices()),this.applyDetails()}lowerAnalysis(e){this.copyDataFromHigherRes(e);var t=e.getNbVertices(),r=new Float32Array(3*t),i=new Float32Array(3*t),s=new Float32Array(3*t);this.computePartialSubdivision(r,i,s,t),e.computeDetails(r,i,s,t)}copyDataFromHigherRes(e){var t=this.getVertices(),r=this.getColors(),i=this.getMaterials(),s=this.getNbVertices(),a=e.getVertices(),n=e.getColors(),o=e.getMaterials();if(!1===this.getEvenMapping())t.set(a.subarray(0,3*s)),r.set(n.subarray(0,3*s)),i.set(o.subarray(0,3*s));else for(var l=this.getVerticesMapping(),c=0;c<s;++c){var h=3*c,u=3*l[c];t[h]=a[u],t[h+1]=a[u+1],t[h+2]=a[u+2],r[h]=n[u],r[h+1]=n[u+1],r[h+2]=n[u+2],i[h]=o[u],i[h+1]=o[u+1],i[h+2]=o[u+2]}}computePartialSubdivision(e,t,r,i){var s=this.getVerticesMapping();if(s){var a=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(3*i);Gt.partialSubdivision(this,a,n,o);var l=!0===this.getEvenMapping()?0:this.getNbVertices();l>0&&(e.set(a.subarray(0,3*l)),t.set(n.subarray(0,3*l)),r.set(o.subarray(0,3*l)));for(var c=l;c<i;++c){var h=3*c,u=3*s[c];e[u]=a[h],e[u+1]=a[h+1],e[u+2]=a[h+2],t[u]=n[h],t[u+1]=n[h+1],t[u+2]=n[h+2],r[u]=o[h],r[u+1]=o[h+1],r[u+2]=o[h+2]}}else Gt.partialSubdivision(this,e,t,r)}applyDetails(){var e=this.getVerticesRingVertStartCount(),t=this.getVerticesRingVert(),r=this.getVertices(),i=this.getNormals(),a=this.getColors(),n=this.getMaterials(),o=this.getNbVertices(),l=new Float32Array(s.A.getMemory(3*o*4),0,3*o);l.set(r.subarray(0,3*o));for(var c=this._detailsXYZ,h=this._detailsRGB,u=this._detailsPBR,d=Math.min,_=Math.max,p=0;p<o;++p){var g=3*p;a[g]=d(1,_(0,a[g]+h[g])),a[g+1]=d(1,_(0,a[g+1]+h[g+1])),a[g+2]=d(1,_(0,a[g+2]+h[g+2])),n[g]=d(1,_(0,n[g]+u[g])),n[g+1]=d(1,_(0,n[g+1]+u[g+1])),n[g+2]=d(1,_(0,n[g+2]+u[g+2]));var m=l[g],f=l[g+1],v=l[g+2],A=i[g],T=i[g+1],b=i[g+2],M=A*A+T*T+b*b;if(0!==M){A*=M=1/Math.sqrt(M),T*=M,b*=M;var y=3*t[e[2*p]],E=l[y]-m,S=l[y+1]-f,R=l[y+2]-v;if(0!==(M=(E-=A*(M=E*A+S*T+R*b))*E+(S-=T*M)*S+(R-=b*M)*R)){var x=T*(R*=M=1/Math.sqrt(M))-b*(S*=M),C=b*(E*=M)-A*R,w=A*S-T*E,P=c[g],D=c[g+1],k=c[g+2];r[g]=m+A*P+E*D+x*k,r[g+1]=f+T*P+S*D+C*k,r[g+2]=v+b*P+R*D+w*k}}}}computeDetails(e,t,r,i){for(var s=this.getVerticesRingVertStartCount(),a=this.getVerticesRingVert(),n=this.getVertices(),o=this.getNormals(),l=this.getColors(),c=this.getMaterials(),h=this.getNbVertices(),u=this._detailsXYZ=new Float32Array(3*i),d=this._detailsRGB=new Float32Array(3*i),_=this._detailsPBR=new Float32Array(3*i),p=0;p<h;++p){var g=3*p;d[g]=l[g]-t[g],d[g+1]=l[g+1]-t[g+1],d[g+2]=l[g+2]-t[g+2],_[g]=c[g]-r[g],_[g+1]=c[g+1]-r[g+1],_[g+2]=c[g+2]-r[g+2];var m=o[g],f=o[g+1],v=o[g+2],A=m*m+f*f+v*v;if(0!==A){m*=A=1/Math.sqrt(A),f*=A,v*=A;var T=3*a[s[2*p]],b=e[T]-e[g],M=e[T+1]-e[g+1],y=e[T+2]-e[g+2];if(0!==(A=(b-=m*(A=b*m+M*f+y*v))*b+(M-=f*A)*M+(y-=v*A)*y)){var E=f*(y*=A=1/Math.sqrt(A))-v*(M*=A),S=v*(b*=A)-m*y,R=m*M-f*b,x=n[g]-e[g],C=n[g+1]-e[g+1],w=n[g+2]-e[g+2];u[g]=m*x+f*C+v*w,u[g+1]=b*x+M*C+y*w,u[g+2]=E*x+S*C+R*w}}}}};var Xr={},jr=function(e,t,r){var i=++s.A.TAG_FLAG,a=e.getVerticesTagFlags(),n=e.getVerticesRingVertStartCount(),o=e.getVerticesRingVert(),l=e.getVerticesOnEdge(),c=function(e,t,r){var i=0,s=e.getNbVertices();for(i=0;i<s;++i)if(0===t[i]&&1===r[i])return i;var a=e.getVerticesOnEdge();for(i=0;i<s&&(0!==t[i]||1===a[i]);++i);if(i===s)return-1;for(i=0;i<s;++i)if(0===t[i])return i;return-1}(e,r,t);if(c<0)return!1;r[c]=1;var h=new Uint32Array(s.A.getMemory(4*e.getNbVertices()),0,e.getNbVertices());h[0]=c;for(var u=1;u>0;){var d=h[--u],_=n[2*d],p=_+n[2*d+1],g=0,m=++i;for(g=_;g<p;++g){var f=o[g];if(a[f]=m,1===r[f])return s.A.TAG_FLAG=i,!1;r[f]=-1,a[f]=m}for(m=++i,g=_;g<p;++g){var v=o[g];if(0!==t[v]&&!l[v])return s.A.TAG_FLAG=i,!1;for(var A=n[2*v],T=A+n[2*v+1],b=A;b<T;++b){var M=o[b];if(M!==d&&!(a[M]>=m-1)&&(a[M]=m,0===r[M])){for(var y=n[2*M],E=y+n[2*M+1],S=0,R=y;R<E;++R)a[o[R]]===m-1&&S++;2===S?r[M]=-1:(r[M]=1,h[u++]=M)}}}}return s.A.TAG_FLAG=i,!0};Xr.computeReverse=function(e,t){var r=e.getNbFaces();if(r%4!=0)return!1;var i=new Int8Array(e.getNbVertices());if(!function(e,t){for(var r=e.getNbVertices(),i=function(e){for(var t=e.getNbVertices(),r=e.getFaces(),i=e.getVerticesOnEdge(),a=e.getVerticesRingVertStartCount(),n=e.getVerticesRingFace(),o=e.getVerticesRingFaceStartCount(),l=new Int8Array(t),c=0;c<t;++c){for(var h=2*c,u=a[h+1],d=o[h],_=o[h+1],p=i[c],g=0,m=d,f=d+_;m<f;++m)g+=r[4*n[m]+3]===s.A.TRI_INDEX?0:1;0===g?(!p&&6!==u||p&&4!==u)&&(l[c]=1):g===_?(!p&&4!==u||p&&3!==u)&&(l[c]=1):(p||5!==u)&&(l[c]=1)}return l}(e),a=!0;a;){if(!jr(e,i,t))return!1;a=!1;for(var n=0;n<r;++n)if(0===t[n]){a=!0;break}}return!0}(e,i))return!1;var a=new Int32Array(r/4);return!!function(e,t,r,i){var a=e.getFaceEdges(),n=e.getFaces(),o=new Int32Array(e.getNbEdges()),l=0,c=e.getNbFaces(),h=0,u=new Uint32Array(e.getNbVertices()),d=new Uint32Array(c);for(l=0;l<c;++l)d[l]=s.A.TRI_INDEX;for(l=0;l<c;++l){var _=4*l,p=n[_],g=n[_+1],m=n[_+2],f=n[_+3],v=r[p],A=r[g],T=r[m];if(f!==s.A.TRI_INDEX){var b=0,M=0,y=0;1===v?(b=p,M=m,y=o[a[_+1]]-1,o[a[_+2]]=p+1):1===A?(b=g,M=f,y=o[a[_+2]]-1,o[a[_+3]]=g+1):1===T?(b=m,M=p,y=o[a[_+3]]-1,o[a[_]]=m+1):(b=f,M=g,y=o[a[_]]-1,o[a[_+1]]=f+1);var E=u[M]-1;if(E<0)i[h]=-M-1,d[4*h+3]=b,u[M]=++h;else{var S=4*E;y<0?d[S+2]>=s.A.TRI_INDEX-1?(d[S+2]=b,d[S]=s.A.TRI_INDEX-1):d[S]===s.A.TRI_INDEX?d[S+1]=b:(d[S+1]=d[S+2],d[S+2]=b):d[S+1]===y?d[S]=b:(d[S]=d[S+1],d[S+2]===y?d[S+1]=b:(d[S+1]=d[S+2],d[S+2]=b))}}else{if(v+A+T===-3){i[h++]=l;continue}1===v?o[a[_+1]]=p+1:1===A?o[a[_+2]]=g+1:1===T&&(o[a[_]]=m+1)}}for(c/=4,l=0;l<c;++l){var R=i[l],x=4*l;if(R<0){var C=s.A.TRI_INDEX-1;if(d[x]>=C||d[x+1]>=s.A.TRI_INDEX||d[x+2]>=s.A.TRI_INDEX)return!1}else{var w=4*R;d[x]=o[a[w]]-1,d[x+1]=o[a[w+1]]-1,d[x+2]=o[a[w+2]]-1}}return t.setFaces(d),!0}(e,t,i,a)&&(function(e,t,r){var i=0,a=new Uint32Array(e.getNbVertices());t.setVerticesMapping(a);var n=t.getFaces(),o=new Int32Array(e.getNbVertices()),l=0,c=4*t.getNbFaces();for(l=0;l<c;++l){var h=n[l];if(h!==s.A.TRI_INDEX){var u=o[h]-1;-1===u&&(u=i++,o[h]=u+1,a[u]=h),n[l]=u}}t.setVertices(new Float32Array(3*i));var d=e.getFaces(),_=e.getVerticesRingFace(),p=e.getVerticesRingFaceStartCount(),g=new Uint8Array(e.getNbVertices());for(c/=4,l=0;l<c;++l){var m,f,v,A,T,b,M,y,E,S,R=r[l];if(R>=0){var x=4*R;m=d[x+1],f=d[x+2],v=d[x],A=s.A.TRI_INDEX,T=s.A.TRI_INDEX}else{T=-R-1;for(var C=4*l,w=a[n[C]],P=a[n[C+1]],D=a[n[C+2]],k=a[n[C+3]],I=p[2*T],F=I+4,L=I;L<F;++L){var V=4*_[L],N=d[V],O=d[V+1],B=d[V+2],U=d[V+3];N===w?m=O:O===w?m=B:B===w?m=U:U===w&&(m=N),N===P?f=O:O===P?f=B:B===P?f=U:U===P&&(f=N),N===D?v=O:O===D?v=B:B===D?v=U:U===D&&(v=N),N===k?A=O:O===k?A=B:B===k?A=U:U===k&&(A=N)}}b=g[m],M=g[f],y=g[v],E=A!==s.A.TRI_INDEX?g[A]:-1,S=T!==s.A.TRI_INDEX?g[T]:-1,0===b&&(g[m]=1,a[i++]=m),0===M&&(g[f]=1,a[i++]=f),0===y&&(g[v]=1,a[i++]=v),0===E&&(g[A]=1,a[i++]=A),0===S&&(g[T]=1,a[i++]=T)}}(e,t,a),function(e,t){var r=e.getVertices(),i=e.getColors(),a=e.getMaterials(),n=t.getVertices(),o=new Float32Array(n.length),l=new Float32Array(n.length);t.setColors(o),t.setMaterials(l);var c=t.getVerticesMapping(),h=0,u=t.getNbVertices();for(h=0;h<u&&!(c[h]>=u);++h);if(h===u){var d=t.getFaces(),_=d.length;for(h=0;h<_;++h){var p=d[h];p!==s.A.TRI_INDEX&&(d[h]=c[p])}for(h=0;h<u;++h)c[h]=h;n.set(r.subarray(0,3*u)),o.set(i.subarray(0,3*u)),l.set(a.subarray(0,3*u))}else for(t.setEvenMapping(!0),h=0;h<u;++h){var g=3*h,m=3*c[h];n[g]=r[m],n[g+1]=r[m+1],n[g+2]=r[m+2],o[g]=i[m],o[g+1]=i[m+1],o[g+2]=i[m+2],l[g]=a[m],l[g+1]=a[m+1],l[g+2]=a[m+2]}}(e,t),e.hasUV()&&function(e,t,r){for(var i=e.getVerticesDuplicateStartCount(),a=t.getNbVertices(),n=new Uint32Array(2*a),o=t.getVerticesMapping(),l=e.getTexCoords(),c=new Float32Array(s.A.getMemory(4*e.getNbTexCoords()*2),0,2*e.getNbTexCoords()),h=new Uint32Array(a),u=a,d=0;d<a;++d){var _=o[d],p=i[2*_];if(c[2*d]=l[2*_],c[2*d+1]=l[2*_+1],0!==p){for(var g=h[d]=p-u,m=i[2*_+1],f=u,v=u+m;f<v;++f)c[2*f]=l[2*(g+f)],c[2*f+1]=l[2*(g+f)+1];n[2*d]=u,n[2*d+1]=m,u+=m}}t.setTexCoords(new Float32Array(c.subarray(0,2*u))),t.setVerticesDuplicateStartCount(n),function(e,t,r,i){for(var a=e.getFaces(),n=e.getFacesTexCoord(),o=e.getVerticesRingFaceStartCount(),l=e.getVerticesRingFace(),c=e.getVerticesDuplicateStartCount(),h=t.getFaces(),u=new Uint32Array(h),d=t.getVerticesMapping(),_=0,p=h.length;_<p;++_){var g=h[_];if(g!==s.A.TRI_INDEX){var m=d[g];if(0!==c[2*m]){var f=_%4,v=r[(_-f)/4],A=s.A.TRI_INDEX;if(v>=0){var T,b,M=4*v;0===f?(T=a[M+1],b=a[M]):1===f?(T=a[M+2],b=a[M+1]):(T=a[M],b=a[M+2]);for(var y=o[2*m],E=y+o[2*m+1],S=y;S<E;++S){var R=4*l[S],x=a[R],C=a[R+1],w=a[R+2];if(x===T?C===b&&(A=n[R+2]):C===T?w===b&&(A=n[R]):w===T&&x===b&&(A=n[R+1]),A!==s.A.TRI_INDEX)break}}else for(var P=o[2*(v=-v-1)],D=P+4,k=P;k<D;++k){var I=4*l[k];if(a[I]===m?A=n[I]:a[I+1]===m?A=n[I+1]:a[I+2]===m?A=n[I+2]:a[I+3]===m&&(A=n[I+3]),A!==s.A.TRI_INDEX)break}u[_]=A===m?A:A-i[g]}}}t.setFacesTexCoord(u)}(e,t,r,h)}(e,t,a),t.allocateArrays(),!0)};const Yr=Xr;class Kr extends ke{static get NONE(){return 0}static get SCULPT(){return 1}static get CAMERA(){return 2}static get PICKING(){return 3}constructor(e){super(),this.setID(e.getID()),this.setRenderData(e.getRenderData()),this.setTransformData(e.getTransformData()),this._meshes=[new zr(e,!0)],this.setSelection(0);var t=e.getGL();this._indexBuffer=new d(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW),this._wireframeBuffer=new d(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW)}getCurrentMesh(){return this._meshes[this._sel]}setSelection(e){this._sel=e,this.setMeshData(this.getCurrentMesh().getMeshData())}addLevel(){if(this._meshes.length-1!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh().getNbFaces(),t="addLevel : "+e+" -> "+4*e;console.time(t);var r=this.getCurrentMesh(),i=new zr(r);return r.setVerticesMapping(void 0),Gt.fullSubdivision(r,i),i.initTopology(),this.pushMesh(i),this.initRender(),console.timeEnd(t),i}computeReverse(){if(0!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh(),t=new zr(e);return Yr.computeReverse(e,t)?(t.initTopology(),this.unshiftMesh(t),this.initRender(),t):void 0}lowerLevel(){return 0===this._sel?this._meshes[0]:(this._meshes[this._sel-1].lowerAnalysis(this.getCurrentMesh()),this.setSelection(this._sel-1),this.updateResolution(),this.getCurrentMesh())}higherLevel(){return this._sel===this._meshes.length-1||(this._meshes[this._sel+1].higherSynthesis(this.getCurrentMesh()),this.setSelection(this._sel+1),this.updateResolution()),this.getCurrentMesh()}updateResolution(){this.updateGeometry(),this.updateDuplicateColorsAndMaterials(),this.updateBuffers();var e=this._meshes[this.getLowIndexRender()];this._indexBuffer.update(e.getTriangles()),this._wireframeBuffer.update(e.getWireframe())}selectResolution(e){for(;this._sel>e;)this.lowerLevel();for(;this._sel<e;)this.higherLevel()}findIndexFromMesh(e){for(var t=this._meshes,r=0,i=t.length;r<i;++r)if(e===t[r])return r}selectMesh(e){var t=this.findIndexFromMesh(e);this.selectResolution(t)}pushMesh(e){this._meshes.push(e),this.setSelection(this._meshes.length-1),this.updateResolution()}unshiftMesh(e){this._meshes.unshift(e),this.setSelection(1),this.lowerLevel()}popMesh(){this._meshes.pop(),this.setSelection(this._meshes.length-1),this.updateResolution()}shiftMesh(){this._meshes.shift(),this.setSelection(0),this.updateResolution()}deleteLower(){this._meshes.splice(0,this._sel),this.setSelection(0)}deleteHigher(){this._meshes.splice(this._sel+1)}getLowIndexRender(){for(var e=this._sel;e>=0;){var t=this._meshes[e];if(!0===t.getEvenMapping())return e===this._sel?e:e+1;if(t.getNbTriangles()<5e5)return e;--e}return 0}_renderLow(e){var t=this.getRenderData(),r=this._sel,i=this.getIndexBuffer();this.setSelection(this.getLowIndexRender()),t._indexBuffer=this._indexBuffer,super.render(e),t._indexBuffer=i,this.setSelection(r)}_renderWireframeLow(e){var t=this.getRenderData(),r=this._sel,i=this.getWireframeBuffer();this.setSelection(this.getLowIndexRender()),t._wireframeBuffer=this._wireframeBuffer,super.renderWireframe(e),t._wireframeBuffer=i,this.setSelection(r)}_canUseLowRender(e){return!(this.isUsingTexCoords()||this.isUsingDrawArrays()||Kr.RENDER_HINT===Kr.PICKING||Kr.RENDER_HINT===Kr.NONE||e.getMesh()===this&&Kr.RENDER_HINT!==Kr.CAMERA||this.getLowIndexRender()===this._sel)}render(e){return this._canUseLowRender(e)?this._renderLow(e):super.render(e)}renderWireframe(e){return this._canUseLowRender(e)?this._renderWireframeLow(e):super.renderWireframe(e)}}Kr.RENDER_HINT=0;const Hr=Kr;var qr,Zr,Qr,Jr,$r,ei={_mesh:null,_linear:!1,_verticesMap:new Map,_states:null,_center:[0,0,0],_radius2:0,_edgeMax2:0},ti=function(e,t,r,i,a){var n=ei._mesh,o=n.getVerticesRingVert(),l=n.getVerticesRingFace(),c=n.getFacePosInLeaf(),h=n.getFaceLeaf(),u=n.getFacesStateFlags(),d=n.getFaces(),_=4*e;d[_]=t,d[_+1]=a,d[_+2]=i,d[_+3]=s.A.TRI_INDEX;var p=h[e],g=p._iFaces;o[a].push(i),o[i].push(a);var m=n.getNbTriangles();l[a].push(e,m),d[_=4*m]=a,d[_+1]=r,d[_+2]=i,d[_+3]=s.A.TRI_INDEX,u[m]=s.A.STATE_FLAG,h[m]=p,c[m]=g.length,l[i].push(m),s.A.replaceElement(l[r],e,m),g.push(m),n.addNbFace(1)},ri=function(e){for(var t=ei._mesh,r=t.getVerticesRingVert(),i=t.getFaces(),a=e.length,n=new Uint32Array(s.A.getMemory(8*a),0,2*a),o=0,l=ei._verticesMap,c=0;c<a;++c){var h=e[c],u=4*h,d=i[u],_=i[u+1],p=i[u+2],g=l.get(Math.min(d,_)+"+"+Math.max(d,_)),m=l.get(Math.min(_,p)+"+"+Math.max(_,p)),f=l.get(Math.min(d,p)+"+"+Math.max(d,p)),v=r[d].length,A=r[_].length,T=r[p].length,b=0;if(g?b=m?f?v<A&&v<T?2:A<T?3:1:v<T?2:1:f&&A<T?3:1:m?b=f&&A<v?3:2:f&&(b=3),1===b)ti(h,d,_,p,g);else if(2===b)ti(h,_,p,d,m);else{if(3!==b)continue;ti(h,p,d,_,f)}n[o++]=h,n[o++]=t.getNbTriangles()-1}return new Uint32Array(n.subarray(0,o))},ii=function(e,t,r,i){var a=ei._mesh,n=a.getVertices(),o=a.getNormals(),l=a.getColors(),c=a.getMaterials(),h=a.getFaces(),u=a.getFacePosInLeaf(),d=a.getFaceLeaf(),_=a.getVerticesRingVert(),p=a.getVerticesRingFace(),g=a.getFacesStateFlags(),m=a.getVerticesStateFlags(),f=ei._verticesMap,v=Math.min(t,r)+"+"+Math.max(t,r),A=!1,T=f.get(v);void 0===T&&(T=a.getNbVertices(),A=!0,f.set(v,T)),_[i].push(T);var b=4*e;h[b]=t,h[b+1]=T,h[b+2]=i,h[b+3]=s.A.TRI_INDEX;var M=a.getNbTriangles();h[b=4*M]=T,h[b+1]=r,h[b+2]=i,h[b+3]=s.A.TRI_INDEX,g[M]=s.A.STATE_FLAG,p[i].push(M),s.A.replaceElement(p[r],e,M);var y=d[e],E=y._iFaces;if(d[M]=y,u[M]=E.length,E.push(M),!A)return _[T].push(i),p[T].push(e,M),void a.addNbFace(1);var S=3*t,R=n[S],x=n[S+1],C=n[S+2],w=o[S],P=o[S+1],D=o[S+2],k=3*r,I=n[k],F=n[k+1],L=n[k+2],V=o[k],N=o[k+1],O=o[k+2],B=w+V,U=P+N,G=D+O;if(o[b=3*T]=.5*B,o[b+1]=.5*U,o[b+2]=.5*G,l[b]=.5*(l[S]+l[k]),l[b+1]=.5*(l[S+1]+l[k+1]),l[b+2]=.5*(l[S+2]+l[k+2]),c[b]=.5*(c[S]+c[k]),c[b+1]=.5*(c[S+1]+c[k+1]),c[b+2]=.5*(c[S+2]+c[k+2]),ei._linear)n[b]=.5*(R+I),n[b+1]=.5*(x+F),n[b+2]=.5*(C+L);else{var W=w*w+P*P+D*D;0===W?w=1:(w*=W=1/Math.sqrt(W),P*=W,D*=W),0===(W=V*V+N*N+O*O)?V=1:(V*=W=1/Math.sqrt(W),N*=W,O*=W);var z=w*V+P*N+D*O,X=R-I,j=x-F,Y=C-L,K=.12*(z<=-1?Math.PI:z>=1?0:Math.acos(z));K*=Math.sqrt(X*X+j*j+Y*Y),(W=B*B+U*U+G*G)>0&&(K/=Math.sqrt(W)),X*(w-V)+j*(P-N)+Y*(D-O)<0&&(K=-K),n[b]=.5*(R+I)+B*K,n[b+1]=.5*(x+F)+U*K,n[b+2]=.5*(C+L)+G*K}m[T]=s.A.STATE_FLAG,_[T]=[t,r,i],p[T]=[e,M],s.A.replaceElement(_[t],r,T),s.A.replaceElement(_[r],t,T),a.addNbVertice(1),a.addNbFace(1)},si=(qr=[0,0,0],Zr=[0,0,0],Qr=[0,0,0],Jr=Ee.A.triangleInsideSphere,$r=Ee.A.pointInsideTriangle,function(t,r){var i=ei._mesh,s=i.getVertices(),a=i.getFaces(),n=4*t,o=3*a[n],l=3*a[n+1],c=3*a[n+2];if(qr[0]=s[o],qr[1]=s[o+1],qr[2]=s[o+2],Zr[0]=s[l],Zr[1]=s[l+1],Zr[2]=s[l+2],Qr[0]=s[c],Qr[1]=s[c+1],Qr[2]=s[c+2],r&&!Jr(ei._center,ei._radius2,qr,Zr,Qr)&&!$r(ei._center,qr,Zr,Qr))return 0;var h=i.getMaterials(),u=h[o+2],d=h[l+2],_=h[c+2],p=e.lo(qr,Zr),g=e.lo(Zr,Qr),m=e.lo(qr,Qr);return p>g&&p>m?.5*(u+d)*p>ei._edgeMax2?1:0:g>m?.5*(d+_)*g>ei._edgeMax2?2:0:.5*(u+_)*m>ei._edgeMax2?3:0}),ai=function(e){var t=ei._mesh,r=t.getNbVertices(),i=t.getNbTriangles();ei._verticesMap=new Map;var a=function(e){for(var t=e.length,r=s.A.getMemory(5*t),i=new Uint32Array(r,0,t),a=new Uint8Array(r,4*t,t),n=0,o=0;o<t;++o){var l=e[o],c=si(l,!0);0!==c&&(a[n]=c,i[n++]=l)}return[new Uint32Array(i.subarray(0,n)),new Uint8Array(a.subarray(0,n))]}(e),n=a[0],o=a[1];n.length>5&&(n=t.expandsFaces(n,3),(o=new Uint8Array(n.length)).set(a[1])),ei._states.pushVertices(t.getVerticesFromFaces(n)),ei._states.pushFaces(n),t.reAllocateArrays(o.length),function(e,t){for(var r=ei._mesh.getFaces(),i=e.length,s=0;s<i;++s){var a=e[s],n=t[s];0===n&&(n=si(a));var o=4*a;1===n?ii(a,r[o],r[o+1],r[o+2]):2===n?ii(a,r[o+1],r[o+2],r[o]):3===n&&ii(a,r[o+2],r[o],r[o+1])}}(n,o);var l=0,c=t.getNbTriangles()-i,h=new Uint32Array(c);for(l=0;l<c;++l)h[l]=i+l;n=(h=t.expandsFaces(h,1)).subarray(c),ei._states.pushVertices(t.getVerticesFromFaces(n)),ei._states.pushFaces(n);var u=e,d=e.length;(e=new Uint32Array(d+h.length)).set(u),e.set(h,d);var _=t.getFacesTagFlags(),p=e.length,g=new Uint32Array(s.A.getMemory(4*p),0,p),m=0,f=++s.A.TAG_FLAG;for(l=0;l<p;++l){var v=e[l];_[v]!==f&&(_[v]=f,g[m++]=v)}g=new Uint32Array(g.subarray(0,m));for(var A=t.getNbTriangles();h.length>0;)t.reAllocateArrays(h.length),h=ri(h);for(c=t.getNbTriangles()-A,u=g,(g=new Uint32Array(m+c)).set(u),l=0;l<c;++l)g[m+l]=A+l;var T=t.getNbVertices()-r,b=new Uint32Array(T);for(l=0;l<T;++l)b[l]=r+l;if(b=t.expandsVertices(b,1),!ei._linear){var M=b.subarray(T),y=new Se;y.setToolMesh(t),y.smoothTangent(M,1)}var E=t.getVertices(),S=t.getVerticesSculptFlags(),R=ei._center,x=R[0],C=R[1],w=R[2],P=s.A.SCULPT_FLAG;for(T=b.length,l=0;l<T;++l){var D=b[l],k=3*D,I=E[k]-x,F=E[k+1]-C,L=E[k+2]-w;S[D]=I*I+F*F+L*L<ei._radius2?P:P-1}return g};const ni={subdivision:function(t,r,i,s,a,n,o){ei._mesh=t,ei._linear=o,e.C(ei._center,i),ei._radius2=s,ei._edgeMax2=a,ei._states=n;for(var l=0;l!==t.getNbTriangles();)l=t.getNbTriangles(),r=ai(r);return r}};var oi={_mesh:null,_states:null,_iTrisToDelete:[],_iVertsToDelete:[],_iVertsDecimated:[]},li=function(e,t){return e-t},ci=function(e){var t=oi._mesh,r=t.getVerticesRingFace(),i=t.getFacesTagFlags(),a=t.getFaces(),n=t.getFacePosInLeaf(),o=t.getFaceLeaf(),l=t.getFacesStateFlags(),c=n[e],h=o[e]._iFaces,u=h[h.length-1];e!==u&&(h[c]=u,n[u]=c),h.pop();var d=t.getNbTriangles()-1;if(d!==e){var _=4*d,p=a[_],g=a[_+1],m=a[_+2];oi._states.pushVertices([p,g,m]),oi._states.pushFaces([d]),s.A.replaceElement(r[p],d,e),s.A.replaceElement(r[g],d,e),s.A.replaceElement(r[m],d,e);var f=o[d],v=n[d];f._iFaces[v]=e,o[e]=f,n[e]=v,i[e]=i[d],l[e]=l[d],a[e*=4]=p,a[e+1]=g,a[e+2]=m,a[e+3]=s.A.TRI_INDEX,oi._iVertsDecimated.push(p,g,m),t.addNbFace(-1)}else t.addNbFace(-1)},hi=function(e){var t=oi._mesh,r=t.getVerticesRingVert(),i=t.getVerticesRingFace(),a=t.getVertices(),n=t.getNormals(),o=t.getColors(),l=t.getMaterials(),c=t.getFaces(),h=t.getVerticesTagFlags(),u=t.getVerticesStateFlags(),d=t.getVerticesSculptFlags(),_=t.getNbVertices()-1;if(e!==_){var p=0,g=oi._states;g.pushVertices([_]);var m=i[_],f=r[_],v=m.length,A=f.length,T=0;for(T=0;T<v;++T)p=m[T],g.pushFaces([p]),c[p*=4]===_?c[p]=e:c[p+1]===_?c[p+1]=e:c[p+2]=e;for(T=0;T<A;++T)p=f[T],g.pushVertices([p]),s.A.replaceElement(r[p],_,e);r[e]=r[_].slice(),i[e]=i[_].slice(),h[e]=h[_],u[e]=u[_],d[e]=d[_];var b=3*_;a[p=3*e]=a[b],a[p+1]=a[b+1],a[p+2]=a[b+2],n[p]=n[b],n[p+1]=n[b+1],n[p+2]=n[b+2],o[p]=o[b],o[p+1]=o[b+1],o[p+2]=o[b+2],l[p]=l[b],l[p+1]=l[b+1],l[p+2]=l[b+2],t.addNbVertice(-1)}else t.addNbVertice(-1)},ui=function(e,t,r,i,a,n,o){var l=oi._mesh,c=l.getVertices(),h=l.getNormals(),u=l.getColors(),d=l.getMaterials(),_=l.getFaces(),p=l.getVerticesTagFlags(),g=l.getFacesTagFlags(),m=l.getVerticesRingVert(),f=l.getVerticesRingFace(),v=m[r],A=m[i],T=f[r],b=f[i];if(v.length===T.length&&A.length===b.length){var M=m[a],y=m[n],E=f[a],S=f[n];if(M.length===E.length&&y.length===S.length){oi._iVertsDecimated.push(r,i),oi._states.pushVertices(v),oi._states.pushVertices(A),oi._states.pushFaces(T),oi._states.pushFaces(b),v.sort(li),A.sort(li);var R=0;if(s.A.intersectionArrays(v,A).length>=3)return s.A.removeElement(T,t),s.A.removeElement(b,e),E.push(t),S.push(e),_[R=4*e]===i?_[R]=n:_[R+1]===i?_[R+1]=n:_[R+2]=n,_[R=4*t]===r?_[R]=a:_[R+1]===r?_[R+1]=a:_[R+2]=a,l.computeRingVertices(r),l.computeRingVertices(i),l.computeRingVertices(a),void l.computeRingVertices(n);var x=3*i,C=h[R=3*r]+h[x],w=h[R+1]+h[x+1],P=h[R+2]+h[x+2],D=C*C+w*w+P*P;0===D?C=1:(C*=D=1/Math.sqrt(D),w*=D,P*=D),h[R]=C,h[R+1]=w,h[R+2]=P,u[R]=.5*(u[R]+u[x]),u[R+1]=.5*(u[R+1]+u[x+1]),u[R+2]=.5*(u[R+2]+u[x+2]),d[R]=.5*(d[R]+d[x]),d[R+1]=.5*(d[R+1]+d[x+1]),d[R+2]=.5*(d[R+2]+d[x+2]),s.A.removeElement(T,e),s.A.removeElement(T,t),s.A.removeElement(b,e),s.A.removeElement(b,t),s.A.removeElement(E,e),s.A.removeElement(S,t);var k=b.length,I=0;for(I=0;I<k;++I){var F=b[I];T.push(F);var L=4*F;_[L]===i?_[L]=r:_[L+1]===i?_[L+1]=r:_[L+2]=r}for(k=A.length,I=0;I<k;++I)v.push(A[I]);l.computeRingVertices(r);var V=0,N=0,O=0,B=v.length;for(I=0;I<B;++I){var U=v[I];l.computeRingVertices(U),V+=c[U*=3],N+=c[U+1],O+=c[U+2]}N/=B,O/=B;var G=C*((V/=B)-c[R])+w*(N-c[R+1])+P*(O-c[R+2]);for(c[R]=V-C*G,c[R+1]=N-w*G,c[R+2]=O-P*G,p[i]=g[e]=g[t]=-1,oi._iVertsToDelete.push(i),oi._iTrisToDelete.push(e,t),k=T.length,I=0;I<k;++I)o.push(T[I])}}},di=function(e,t,r){if(-1!==t){var i=oi._mesh.getFaces(),s=4*e,a=i[s],n=i[s+1],o=i[s+2],l=i[s=4*t],c=i[s+1],h=i[s+2];a===l?n===h?ui(e,t,a,n,o,c,r):ui(e,t,a,o,n,h,r):a===c?n===l?ui(e,t,a,n,o,h,r):ui(e,t,a,o,n,l,r):a===h?n===c?ui(e,t,a,n,o,l,r):ui(e,t,a,o,n,c,r):ui(e,t,o,n,a,n===l?c:n===c?h:l,r)}},_i=function(e,t,r){var i=oi._mesh.getVerticesRingFace(),a=i[t],n=i[r];a.sort(li),n.sort(li);var o=s.A.intersectionArrays(a,n);return 2!==o.length?-1:o[0]===e?o[1]:o[0]},pi={decimation:function(e,t,r,i,a,n){oi._mesh=e,oi._states=n,oi._iVertsDecimated.length=0,oi._iTrisToDelete.length=0,oi._iVertsToDelete.length=0;var o=Math.sqrt(i),l=e.getFacesTagFlags(),c=e.getVertices(),h=e.getMaterials(),u=e.getFaces(),d=r[0],_=r[1],p=r[2],g=0,m=t.length,f=new Array(m);for(g=0;g<m;++g)f[g]=t[g];for(g=0;g<f.length;++g){var v=f[g];if(!(l[v]<0)){var A=4*v,T=u[A],b=u[A+1],M=u[A+2],y=3*T,E=3*b,S=3*M,R=c[y],x=c[y+1],C=c[y+2],w=c[E],P=c[E+1],D=c[E+2],k=c[S],I=c[S+1],F=c[S+2],L=(R+w+k)/3-d,V=(x+P+I)/3-_,N=(C+D+F)/3-p,O=L*L+V*V+N*N;if(O<i)O=1;else{if(!(O<2*i))continue;var B=(O=(Math.sqrt(O)-o)/(o*Math.SQRT2-o))*O;O=3*B*B-4*B*O+1}var U=(L=w-R)*L+(V=P-x)*V+(N=D-C)*N,G=(L=w-k)*L+(V=P-I)*V+(N=D-F)*N,W=(L=R-k)*L+(V=x-I)*V+(N=C-F)*N,z=h[y+2],X=h[E+2],j=h[S+2];U<G&&U<W?U<a*O*(z+X)*.5&&di(v,_i(v,T,b),f):G<W?G<a*O*(X+j)*.5&&di(v,_i(v,b,M),f):W<a*O*(z+j)*.5&&di(v,_i(v,T,M),f)}}return function(){var e=oi._iTrisToDelete;s.A.tidy(e);var t=0;for(t=e.length-1;t>=0;--t)ci(e[t]);var r=oi._iVertsToDelete;for(s.A.tidy(r),t=r.length-1;t>=0;--t)hi(r[t])}(),t=function(e,t){var r=oi._mesh,i=r.getFacesTagFlags(),a=r.getNbTriangles(),n=r.getFacesFromVertices(e),o=t,l=t.length;(t=new Uint32Array(l+n.length)).set(o),t.set(n,l);var c=++s.A.TAG_FLAG;l=t.length;for(var h=new Uint32Array(s.A.getMemory(4*l),0,l),u=0,d=0;d<l;++d){var _=t[d];_>=a||i[_]!==c&&(i[_]=c,h[u++]=_)}return new Uint32Array(h.subarray(0,u))}(function(){for(var e=oi._mesh,t=e.getVerticesTagFlags(),r=e.getNbVertices(),i=++s.A.TAG_FLAG,a=oi._iVertsDecimated,n=a.length,o=new Uint32Array(s.A.getMemory(4*n),0,n),l=0,c=0;c<n;++c){var h=a[c];h>=r||t[h]!==i&&(t[h]=i,o[l++]=h)}return new Uint32Array(o.subarray(0,l))}(),f),t}};const gi=pi;class mi extends ke{constructor(e){super(),this.setID(e.getID()),this._meshData={_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]},this.setRenderData(e.getRenderData()),this.setTransformData(e.getTransformData()),this._facesStateFlags=null,this._wireframe=null,this.initFromMesh(e),this.initRender(),this.isDynamic=!0}subdivide(e,t,r,i,s){return ni.subdivision(this,e,t,r,i,s,mi.LINEAR)}decimate(e,t,r,i,s){return gi.decimation(this,e,t,r,i,s)}getSubdivisionFactor(){return.01*mi.SUBDIVISION_FACTOR}getDecimationFactor(){return.01*mi.DECIMATION_FACTOR}getVerticesProxy(){return this.getVertices()}addNbVertice(e){this._meshData._nbVertices+=e}getNbTriangles(){return this.getNbFaces()}addNbFace(e){this._meshData._nbFaces+=e}getNbEdges(){return 3*this.getNbTriangles()}getFacesStateFlags(){return this._facesStateFlags}allocateArrays(){super.allocateArrays(),this._meshData._vertRingVert=[],this._meshData._vertRingFace=[],this._facesStateFlags=new Int32Array(this.getNbFaces())}initFromMesh(e){var t=e.getNbVertices();this.setVertices(new Float32Array(e.getVertices().subarray(0,3*t))),this.setColors(new Float32Array(e.getColors().subarray(0,3*t))),this.setMaterials(new Float32Array(e.getMaterials().subarray(0,3*t))),this.setNbVertices(t),this.setFacesFromMesh(e),this.init(),e.isUsingTexCoords()&&this.setShaderType(i.A.Shader.MATCAP)}setFacesFromMesh(e){this.setFaces(new Uint32Array(4*e.getNbTriangles())),this.setNbFaces(e.getNbTriangles());var t=e.getTriangles(),r=this.getNbTriangles(),i=this.getFaces();this._meshData._trianglesABC=new Uint32Array(t.subarray(0,3*r));for(var a=0;a<r;++a){var n=3*a,o=4*a;i[o]=t[n],i[o+1]=t[n+1],i[o+2]=t[n+2],i[o+3]=s.A.TRI_INDEX}}updateTopology(e,t){this.updateRenderTriangles(e),this.updateVerticesOnEdge(t),this.getShowWireframe()&&this.updateWireframe(e),this.isUsingDrawArrays()&&this.updateDrawArrays(e)}getWireframe(){return this._wireframe||(this._wireframe=new Uint32Array(2*this.getTriangles().length),this.updateWireframe()),this._wireframe}setShowWireframe(e){this._wireframe=null,super.setShowWireframe(e)}updateWireframe(e){for(var t=this._wireframe,r=this.getTriangles(),i=void 0===e,s=this.isUsingDrawArrays(),a=i?this.getNbTriangles():e.length,n=0;n<a;++n){var o=i?n:e[n],l=6*o,c=3*o;s?(t[l]=t[l+5]=c,t[l+1]=t[l+2]=c+2,t[l+3]=t[l+4]=c+1):(t[l]=t[l+5]=r[c],t[l+1]=t[l+2]=r[c+1],t[l+3]=t[l+4]=r[c+2])}}updateRenderTriangles(e){for(var t=this.getTriangles(),r=this.getFaces(),i=void 0===e,s=i?this.getNbFaces():e.length,a=0;a<s;++a){var n=i?a:e[a],o=3*n,l=4*n;t[o]=r[l],t[o+1]=r[l+1],t[o+2]=r[l+2]}}updateVerticesOnEdge(e){for(var t=this.getVerticesOnEdge(),r=this.getVerticesRingVert(),i=this.getVerticesRingFace(),s=void 0===e,a=s?this.getNbVertices():e.length,n=0;n<a;++n){var o=s?n:e[n];t[o]=r[o].length!==i[o].length?1:0}}resizeArray(e,t){if(!e)return null;if(e.length>=t)return e.subarray(0,2*t);var r=new e.constructor(2*t);return r.set(e),r}reAllocateArrays(e){var t=this._meshData,r=this._facesStateFlags.length,i=this.getNbTriangles(),s=i+e;(r<s||r>4*s)&&(this._facesStateFlags=this.resizeArray(this._facesStateFlags,s),this.getShowWireframe()&&(this._wireframe=this.resizeArray(this._wireframe,6*s)),t._facesABCD=this.resizeArray(t._facesABCD,4*s),t._trianglesABC=this.resizeArray(t._trianglesABC,3*s),t._faceBoxes=this.resizeArray(t._faceBoxes,6*s),t._faceNormalsXYZ=this.resizeArray(t._faceNormalsXYZ,3*s),t._faceCentersXYZ=this.resizeArray(t._faceCentersXYZ,3*s),t._facesTagFlags=this.resizeArray(t._facesTagFlags,s),t._facePosInLeaf=this.resizeArray(t._facePosInLeaf,s)),((r=t._verticesXYZ.length/3)<(s=this.getNbVertices()+e)||r>4*s)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,3*s),t._normalsXYZ=this.resizeArray(t._normalsXYZ,3*s),t._colorsRGB=this.resizeArray(t._colorsRGB,3*s),t._materialsPBR=this.resizeArray(t._materialsPBR,3*s),t._vertOnEdge=this.resizeArray(t._vertOnEdge,s),t._vertTagFlags=this.resizeArray(t._vertTagFlags,s),t._vertSculptFlags=this.resizeArray(t._vertSculptFlags,s),t._vertStateFlags=this.resizeArray(t._vertStateFlags,s)),this.isUsingDrawArrays()&&((r=t._verticesXYZ.length/9)<(s=i+10*e)||r>4*s)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,9*s),t._normalsXYZ=this.resizeArray(t._normalsXYZ,9*s),t._colorsRGB=this.resizeArray(t._colorsRGB,9*s),t._materialsPBR=this.resizeArray(t._materialsPBR,9*s))}initTopology(){var e=this.getVerticesRingVert(),t=this.getVerticesRingFace(),r=0,i=this.getNbVertices();for(e.length=t.length=i,r=0;r<i;++r)e[r]=[],t[r]=[];var s=this.getNbTriangles(),a=this.getTriangles();for(r=0;r<s;++r){var n=3*r;t[a[n]].push(r),t[a[n+1]].push(r),t[a[n+2]].push(r)}var o=this.getVerticesOnEdge();for(r=0;r<i;++r)this.computeRingVertices(r),o[r]=t[r].length!==e[r].length?1:0}computeRingVertices(e){var t=++s.A.TAG_FLAG,r=this.getFaces(),i=this.getVerticesTagFlags(),a=this._meshData._vertRingVert[e],n=this._meshData._vertRingFace[e];a.length=0;for(var o=n.length,l=0;l<o;++l){var c=4*n[l],h=r[c],u=r[c+1];h===e?h=r[c+2]:u===e&&(u=r[c+2]),i[h]!==t&&(i[h]=t,a.push(h)),i[u]!==t&&(i[u]=t,a.push(u))}}}mi.SUBDIVISION_FACTOR=75,mi.DECIMATION_FACTOR=0,mi.LINEAR=!1;const fi=mi;class vi{static get SUBDIVISION(){return 0}static get REVERSION(){return 1}static get SELECTION(){return 2}static get DELETE_LOWER(){return 3}static get DELETE_HIGHER(){return 4}constructor(e,t,r,i){switch(this._main=e,this._multimesh=t,this._mesh=t.getCurrentMesh(),this._type=r,r){case vi.DELETE_LOWER:this._deletedMeshes=t._meshes.slice(0,t._sel);break;case vi.DELETE_HIGHER:this._deletedMeshes=t._meshes.slice(t._sel+1),i||(this._vMappingState=this._mesh.getVerticesMapping());break;case vi.SUBDIVISION:case vi.REVERSION:i||(this._vArState=new Float32Array(this._mesh.getVertices()),this._cArState=new Float32Array(this._mesh.getColors()),this._mArState=new Float32Array(this._mesh.getMaterials()))}}isNoop(){return!1}undo(){var e=this._multimesh;switch(this._type){case vi.SELECTION:e.selectMesh(this._mesh);break;case vi.DELETE_LOWER:Array.prototype.unshift.apply(e._meshes,this._deletedMeshes);break;case vi.DELETE_HIGHER:Array.prototype.push.apply(e._meshes,this._deletedMeshes),this._mesh.setVerticesMapping(this._vMappingState);break;case vi.SUBDIVISION:case vi.REVERSION:var t=this._mesh.getNbVertices();this._mesh.setVertices(new Float32Array(this._vArState)),this._mesh.setColors(new Float32Array(this._cArState)),this._mesh.setMaterials(new Float32Array(this._mArState)),this._mesh.setNbVertices(t),this._type===vi.SUBDIVISION?e.popMesh():e.shiftMesh()}e.setSelection(e.findIndexFromMesh(this._mesh)),this._main.setMesh(e)}redo(){var e=this._multimesh;switch(this._type){case vi.SELECTION:e.selectMesh(this._mesh);break;case vi.DELETE_LOWER:e.deleteLower();break;case vi.DELETE_HIGHER:e.deleteHigher();break;case vi.SUBDIVISION:e.pushMesh(this._mesh);break;case vi.REVERSION:e.unshiftMesh(this._mesh)}e.setSelection(e.findIndexFromMesh(this._mesh)),this._main.setMesh(e)}createRedo(){return new vi(this._main,this._multimesh,this._type,!0)}}const Ai=vi,Ti=class{constructor(e,t){this._ctrlGui=t,this._main=t._main,this._menu=null,this._ctrlResolution=null,this._ctrlDynamic=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("topologyTitle"));t.close(),t.addTitle((0,S.A)("multiresTitle")),this._ctrlResolution=t.addSlider((0,S.A)("multiresResolution"),1,this.onResolutionChanged.bind(this),1,1,1);var r=t.addDualButton((0,S.A)("multiresReverse"),(0,S.A)("multiresSubdivide"),this,this,"reverse","subdivide");this._ctrlReverse=r[0],this._ctrlSubdivide=r[1],r=this._dualButtonDel=t.addDualButton((0,S.A)("multiresDelLower"),(0,S.A)("multiresDelHigher"),this,this,"deleteLower","deleteHigher"),this._ctrlDelLower=r[0],this._ctrlDelHigher=r[1],this._ctrlDelLower.domButton.style.background=this._ctrlDelHigher.domButton.style.background="rgba(230,53,59,0.35)";var i=this.remeshResolution.bind(this);t.addTitle((0,S.A)("remeshTitle")),this._ctrlRes1=t.addSlider((0,S.A)("remeshResolution"),nt.RESOLUTION,i,8,400,1),t.addCheckbox((0,S.A)("remeshBlock"),nt,"BLOCK"),t.addButton((0,S.A)("remeshRemesh"),this,"remesh"),t.addTitle((0,S.A)("remeshTitleMC")),this._ctrlRes2=t.addSlider((0,S.A)("remeshResolution"),nt.RESOLUTION,i,8,400,1),t.addCheckbox((0,S.A)("remeshSmoothingMC"),nt,"SMOOTHING"),t.addButton((0,S.A)("remeshRemeshMC"),this,"remeshMC"),t.addTitle((0,S.A)("retopoQuadTitle")),this._ctrlQuadRes=t.addSlider((0,S.A)("retopoQuadResolution"),Wr.RESOLUTION,this.retopoQuadResolution.bind(this),8,400,1),this._ctrlQuadRelax=t.addSlider((0,S.A)("retopoQuadRelax"),Wr.RELAX_ITERATIONS,this.retopoQuadRelax.bind(this),0,20,1),this._ctrlQuadIntensity=t.addSlider((0,S.A)("retopoQuadIntensity"),100*Wr.RELAX_INTENSITY,this.retopoQuadIntensity.bind(this),0,100,1),t.addCheckbox((0,S.A)("retopoQuadTangent"),Wr,"TANGENT"),t.addButton((0,S.A)("retopoQuadAction"),this,"retopoQuad"),t.addTitle((0,S.A)("dynamicTitle")),this._ctrlDynamic=t.addCheckbox((0,S.A)("dynamicActivated"),!1,this.dynamicToggleActivate.bind(this)),this._ctrlDynSubd=t.addSlider((0,S.A)("dynamicSubdivision"),fi,"SUBDIVISION_FACTOR",0,100,1),this._ctrlDynDec=t.addSlider((0,S.A)("dynamicDecimation"),fi,"DECIMATION_FACTOR",0,100,1),this._ctrlDynLin=t.addCheckbox((0,S.A)("dynamicLinear"),fi,"LINEAR"),this.updateDynamicVisibility(!1)}onKeyUp(e){if(!0!==e.handled){var t=n.A.getShortKey(e.which);e.stopPropagation(),t===i.A.KeyAction.REMESH&&this.remesh()}}updateDynamicVisibility(e){this._ctrlDynSubd.setVisibility(e),this._ctrlDynDec.setVisibility(e),this._ctrlDynLin.setVisibility(e)}dynamicToggleActivate(){var e=this._main,t=e.getMesh();if(t){var r=t.isDynamic?this.convertToStaticMesh(t):new fi(t);this.updateDynamicVisibility(!t.isDynamic),e.getStateManager().pushStateAddRemove(r,t),e.replaceMesh(t,r)}}remeshResolution(e){nt.RESOLUTION=e,this._ctrlRes1.setValue(e,!0),this._ctrlRes2.setValue(e,!0)}retopoQuadResolution(e){Wr.RESOLUTION=e,this._ctrlQuadRes.setValue(e,!0)}retopoQuadRelax(e){Wr.RELAX_ITERATIONS=e,this._ctrlQuadRelax.setValue(e,!0)}retopoQuadIntensity(e){Wr.RELAX_INTENSITY=e/100,this._ctrlQuadIntensity.setValue(e,!0)}remesh(e){var t=this._main,r=t.getMesh();if(r){for(var i=r.isDynamic,s=t.getMeshes(),a=t.getSelectedMeshes().slice(),n=0,o=a.length;n<o;++n){var l=a[n];s.splice(t.getIndexMesh(l),1),a[n]=this.convertToStaticMesh(l),l===r&&(r=a[n])}var c=nt.remesh(a,r,e);i&&(c=new fi(c)),t.getStateManager().pushStateAddRemove(c,t.getSelectedMeshes().slice()),t.getMeshes().push(c),t.setMesh(c)}}retopoQuad(){var e=this._main,t=e.getMesh();if(t){for(var r=t.isDynamic,i=e.getMeshes(),s=e.getSelectedMeshes().slice(),a=0,n=s.length;a<n;++a){var o=s[a];i.splice(e.getIndexMesh(o),1),s[a]=this.convertToStaticMesh(o),o===t&&(t=s[a])}var l=Wr.remesh(s,t);r&&(l=new fi(l)),e.getStateManager().pushStateAddRemove(l,e.getSelectedMeshes().slice()),e.getMeshes().push(l),e.setMesh(l)}}remeshMC(){this.remesh(!0)}isMultimesh(e){return!(!e||!e._meshes)}convertToStaticMesh(e){if(!e.isDynamic)return e;var t=new Le(e.getGL());return t.setID(e.getID()),t.setTransformData(e.getTransformData()),t.setVertices(e.getVertices().subarray(0,3*e.getNbVertices())),t.setColors(e.getColors().subarray(0,3*e.getNbVertices())),t.setMaterials(e.getMaterials().subarray(0,3*e.getNbVertices())),t.setFaces(e.getFaces().subarray(0,4*e.getNbFaces())),ke.OPTIMIZE=!1,t.init(),ke.OPTIMIZE=!0,t.setRenderData(e.getRenderData()),t.initRender(),t}convertToMultimesh(e){return this.isMultimesh(e)?e:new Hr(this.convertToStaticMesh(e))}subdivide(){var e=this._main,t=e.getMesh();if(t){var r=this.convertToMultimesh(t);r._sel===r._meshes.length-1?r.getNbTriangles()>4e5&&!window.confirm((0,S.A)("multiresWarnBigMesh",4*r.getNbFaces()))||(t!==r&&(e.replaceMesh(t,r),e.getStateManager().pushStateAddRemove(r,t,!0)),e.getStateManager().pushState(new Ai(e,r,Ai.SUBDIVISION)),r.addLevel(),e.setMesh(r),e.render()):window.alert((0,S.A)("multiresSelectHighest"))}}reverse(){var e=this._main,t=e.getMesh();if(t){var r=this.convertToMultimesh(t);if(0===r._sel){var i=new Ai(e,r,Ai.REVERSION);r.computeReverse()?(t!==r&&(e.replaceMesh(t,r),e.getStateManager().pushStateAddRemove(r,t,!0)),e.getStateManager().pushState(i),e.setMesh(r),e.render()):window.alert((0,S.A)("multiresNotReversible"))}else window.alert((0,S.A)("multiresSelectLowest"))}}deleteLower(){var e=this._main,t=e._mesh;this.isMultimesh(t)&&0!==t._sel?(e.getStateManager().pushState(new Ai(e,t,Ai.DELETE_LOWER)),t.deleteLower(),this.updateMeshResolution()):window.alert((0,S.A)("multiresNoLower"))}deleteHigher(){var e=this._main,t=e.getMesh();this.isMultimesh(t)&&t._sel!==t._meshes.length-1?(e.getStateManager().pushState(new Ai(e,t,Ai.DELETE_HIGHER)),t.deleteHigher(),this.updateMeshResolution()):window.alert((0,S.A)("multiresNoHigher"))}onResolutionChanged(e){var t=e-1,r=this._main,i=r.getMesh();if(i){var s=this.isMultimesh(i),a=s&&i._meshes.length-1===t;this._ctrlReverse.setEnable(!s||0===t),this._ctrlSubdivide.setEnable(!s||a),this._ctrlDelLower.setEnable(s&&0!==t),this._ctrlDelHigher.setEnable(s&&!a),s&&i._sel!==t&&(r.getStateManager().pushState(new Ai(r,i,Ai.SELECTION)),i.selectResolution(t),this._ctrlGui.updateMeshInfo(),r.render())}}updateMeshResolution(){var e=this._main.getMesh();if(!e||!this.isMultimesh(e))return this._ctrlResolution.setMax(1),void this._ctrlResolution.setValue(0);this._ctrlResolution.setMax(e._meshes.length),this._ctrlResolution.setValue(e._sel+1)}updateMesh(){if(this._main.getMesh()){this._menu.setVisibility(!0),this.updateMeshResolution();var e=this._main.getMesh().isDynamic;this.updateDynamicVisibility(e),this._ctrlDynamic.setValue(e,!0)}else this._menu.setVisibility(!1)}};var bi=$[i.A.Shader.MERGE],Mi=$[i.A.Shader.UV],yi=$[i.A.Shader.PBR],Ei=$[i.A.Shader.MATCAP];const Si=class{constructor(e,t){this._main=t._main,this._menu=null,this._ctrlFlatShadizfng=null,this._ctrlShowWireframe=null,this._ctrlShaders=null,this._ctrlMatcap=null,this._ctrlUV=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("renderingTitle"));t.close();var r=[];r[i.A.Shader.MATCAP]=(0,S.A)("renderingMatcap"),r[i.A.Shader.PBR]=(0,S.A)("renderingPBR"),r[i.A.Shader.NORMAL]=(0,S.A)("renderingNormal"),r[i.A.Shader.UV]=(0,S.A)("renderingUV"),t.addTitle((0,S.A)("renderingShader")),this._ctrlShaders=t.addCombobox("",i.A.Shader.MATCAP,this.onShaderChanged.bind(this),r),this._ctrlCurvature=t.addSlider((0,S.A)("renderingCurvature"),20,this.onCurvatureChanged.bind(this),0,100,1),this._ctrlFilmic=t.addCheckbox((0,S.A)("renderingFilmic"),bi.FILMIC,this.onFilmic.bind(this));for(var s={},a=0,n=yi.environments,o=n.length;a<o;++a)s[a]=n[a].name;this._ctrlEnvTitle=t.addTitle((0,S.A)("renderingEnvironment")),this._ctrlEnv=t.addCombobox("",yi.idEnv,this.onEnvironmentChanged.bind(this),s);for(var l={},c=0,h=Ei.matcaps,u=h.length;c<u;++c)l[c]=h[c].name;this._ctrlMatcapTitle=t.addTitle((0,S.A)("renderingMaterial")),this._ctrlMatcap=t.addCombobox((0,S.A)("renderingMatcap"),0,this.onMatcapChanged.bind(this),l),this._ctrlImportMatcap=t.addButton((0,S.A)("renderingImportMatcap"),this,"importMatcap"),this._ctrlUV=t.addButton((0,S.A)("renderingImportUV"),this,"importTexture"),this._ctrlExposure=t.addSlider((0,S.A)("renderingExposure"),1,this.onExposureChanged.bind(this),0,5,.001),this.onUpdateCtrlExposure(),t.addTitle((0,S.A)("renderingExtra")),this._ctrlTransparency=t.addSlider((0,S.A)("renderingTransparency"),0,this.onTransparencyChanged.bind(this),0,100,1),this._ctrlFlatShading=t.addCheckbox((0,S.A)("renderingFlat"),!1,this.onFlatShading.bind(this)),this._ctrlShowWireframe=t.addCheckbox((0,S.A)("renderingWireframe"),!1,this.onShowWireframe.bind(this)),Pe.ONLY_DRAW_ARRAYS&&this._ctrlShowWireframe.setVisibility(!1),this.addEvents()}onFilmic(e){bi.FILMIC=e,this._main.render()}onCurvatureChanged(e){this._main.getMesh()&&(this._main.getMesh().setCurvature(e/20),this._main.render())}onEnvironmentChanged(e){yi.idEnv=e,this.onUpdateCtrlExposure(),this._main.render()}onUpdateCtrlExposure(){this._ctrlExposure.setValue(yi.environments[yi.idEnv].exposure)}onExposureChanged(e){yi.exposure=e,this._main.render()}onTransparencyChanged(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r)t[r].setOpacity(1-e/100);this._main.render()}onShaderChanged(e){for(var t=this._main,r=!1,s=this._main.getSelectedMeshes(),a=0,n=s.length;a<n;++a){var o=s[a];o&&(e!==i.A.Shader.UV||o.hasUV()?(o.setShaderType(e),t.render()):(r||window.alert("No UV on the mesh."),r=!0),r&&this.updateMesh())}this.updateVisibility()}onMatcapChanged(e){for(var t=this._main.getSelectedMeshes(),r=0,s=t.length;r<s;++r){var a=t[r];a.getShaderType()!==i.A.Shader.MATCAP&&a.setShaderType(i.A.Shader.MATCAP),a.setMatcap(e)}this._main.render()}onFlatShading(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r)t[r].setFlatShading(e);this._main.render()}onShowWireframe(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r)t[r].setShowWireframe(e);this._main.render()}addEvents(){var e=this.loadTextureUV.bind(this),t=this.loadMatcap.bind(this);document.getElementById("textureopen").addEventListener("change",e,!1),document.getElementById("matcapopen").addEventListener("change",t,!1),this.removeCallback=function(){document.getElementById("textureopen").removeEventListener("change",e,!1),document.getElementById("matcapopen").removeEventListener("change",t,!1)}}removeEvents(){this.removeCallback&&this.removeCallback()}updateMesh(){var e=this._main.getMesh();e?(this._menu.setVisibility(!0),this._ctrlShaders.setValue(e.getShaderType(),!0),this._ctrlFlatShading.setValue(e.getFlatShading(),!0),this._ctrlShowWireframe.setValue(e.getShowWireframe(),!0),this._ctrlMatcap.setValue(e.getMatcap(),!0),this._ctrlTransparency.setValue(100-100*e.getOpacity(),!0),this._ctrlCurvature.setValue(20*e.getCurvature(),!0),this.updateVisibility()):this._menu.setVisibility(!1)}updateVisibility(){var e=this._main.getMesh();if(e){var t=e.getShaderType();this._ctrlMatcapTitle.setVisibility(t===i.A.Shader.MATCAP),this._ctrlMatcap.setVisibility(t===i.A.Shader.MATCAP),this._ctrlImportMatcap.setVisibility(t===i.A.Shader.MATCAP),this._ctrlExposure.setVisibility(t===i.A.Shader.PBR),this._ctrlEnvTitle.setVisibility(t===i.A.Shader.PBR),this._ctrlEnv.setVisibility(t===i.A.Shader.PBR),this._ctrlUV.setVisibility(t===i.A.Shader.UV)}}getFlatShading(){return this._ctrlFlatShading.getValue()}getWireframe(){return this._ctrlShowWireframe.getValue()}getShaderName(){return this._ctrlShaders.getValue()}importTexture(){document.getElementById("textureopen").click()}loadTextureUV(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,i=this._main;r.onload=function(e){Mi.texture0=void 0,Mi.texPath=e.target.result,i.render()},document.getElementById("textureopen").value="",r.readAsDataURL(t)}}}loadMatcap(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,i=this._main,s=this._ctrlMatcap;r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e=Ei.matcaps.length;Ei.matcaps.push({name:t.name}),Ei.createTexture(i._gl,r,e);var a={};a[e]=t.name,s.addOptions(a),s.setValue(e),i.render()}},document.getElementById("matcapopen").value="",r.readAsDataURL(t)}}}importMatcap(){document.getElementById("matcapopen").click()}onKeyUp(e){n.A.getShortKey(e.which)!==i.A.KeyAction.WIREFRAME||e.ctrlKey||this._ctrlShowWireframe.setValue(!this._ctrlShowWireframe.getValue())}},Ri=class{constructor(e,t){this._main=t._main,this._menu=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("sceneTitle"));t.addButton((0,S.A)("sceneReset"),this,"clearScene"),t.addButton((0,S.A)("sceneAddSphere"),this._main,"addSphere"),t.addButton((0,S.A)("sceneAddCube"),this._main,"addCube"),t.addButton((0,S.A)("sceneAddPlane"),this._main,"addPlane"),t.addButton((0,S.A)("sceneAddCylinder"),this._main,"addCylinder"),t.addButton((0,S.A)("sceneAddTorus"),this._main,"addTorus"),t.addTitle((0,S.A)("sceneSelection")),t.addButton((0,S.A)("sceneSelectAll"),this,"selectAll"),t.addButton((0,S.A)("sceneSelectMore"),this,"selectMore"),t.addButton((0,S.A)("sceneSelectLess"),this,"selectLess"),this._ctrlIsolate=t.addCheckbox((0,S.A)("renderingIsolate"),!1,this.showHide.bind(this)),this._ctrlIsolate.setVisibility(!1),this._ctrlMerge=t.addButton((0,S.A)("sceneMerge"),this,"merge"),this._ctrlMerge.setVisibility(!1),t.addButton((0,S.A)("sceneDuplicate"),this,"duplicateSelection"),t.addButton((0,S.A)("sceneDelete"),this,"deleteSelection"),t.addTitle((0,S.A)("renderingExtra")),t.addCheckbox((0,S.A)("darkenUnselected"),v.darkenUnselected,this.onDarkenUnselected.bind(this)),t.addCheckbox((0,S.A)("contourShow"),this._main._showContour,this.onShowContour.bind(this)),t.addCheckbox((0,S.A)("renderingGrid"),this._main._showGrid,this.onShowGrid.bind(this)),t.addCheckbox((0,S.A)("renderingSymmetryLine"),v.showSymmetryLine,this.onShowSymmetryLine.bind(this)),this._ctrlOffSym=t.addSlider("SymOffset",0,this.onOffsetSymmetry.bind(this),-1,1,.001)}clearScene(){window.confirm((0,S.A)("sceneResetConfirm"))&&this._main.clearScene()}onOffsetSymmetry(e){var t=this._main.getMesh();t&&(t.setSymmetryOffset(e),this._main.render())}duplicateSelection(){this._main.duplicateSelection()}deleteSelection(){this._main.deleteCurrentSelection()}selectAll(){this._main.selectAllMeshes()}selectMore(){this._main.selectMoreMeshes()}selectLess(){this._main.selectLessMeshes()}validatePreview(){this._main._meshPreview||this._main.addTorus(!0),this._main._meshPreview.setShowWireframe(!1),this._main.addNewMesh(this._main._meshPreview),this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}discardPreview(){this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}updateTorusRadius(e){this._main._torusRadius=e,this.updateTorus()}updateTorusRadial(e){this._main._torusRadial=e,this.updateTorus()}updateTorusTubular(e){this._main._torusTubular=e,this.updateTorus()}updateTorusWidth(e){this._main._torusWidth=e,this._main._torusLength<this._main._torusWidth?this.ctrlLE.setValue(e):this.updateTorus()}updateTorusLength(e){this._main._torusLength=e,this._main._torusLength<this._main._torusWidth?this.ctrlWI.setValue(e):this.updateTorus()}updateTorus(){this._main.addTorus(!0),this.ctrlDiscard.setVisibility(!0),this.ctrlValidate.setVisibility(!0),this._main.render()}hasHiddenMeshes(){for(var e=this._main.getMeshes(),t=0;t<e.length;++t)if(!e[t].isVisible())return!0;return!1}updateMesh(){var e=this._main.getMeshes().length,t=this._main.getSelectedMeshes().length;this._ctrlIsolate.setVisibility(this.hasHiddenMeshes()||e!==t&&t>=1),this._ctrlMerge.setVisibility(t>1);var r=this._main.getMesh();this._ctrlOffSym.setValue(r?r.getSymmetryOffset():0)}merge(){var e=this._main,t=e.getSelectedMeshes();if(!(t.length<2)){var r=nt.mergeMeshes(t,e.getMesh()||t[0]);e.removeMeshes(t),e.getStateManager().pushStateAddRemove(r,t.slice()),e.getMeshes().push(r),e.setMesh(r)}}toggleShowHide(e){this._ctrlIsolate.setValue(!this._ctrlIsolate.getValue(),!!e)}showHide(e){e?this.isolate():this.showAll(),this.updateMesh()}setMeshesVisible(e,t){for(var r=0;r<e.length;++r)e[r].setVisible(t);this._ctrlIsolate.setValue(!t,!0)}pushSetMeshesVisible(e,t){this.setMeshesVisible(e,t);var r=this.setMeshesVisible.bind(this,e,!t),i=this.setMeshesVisible.bind(this,e,t);this._main.getStateManager().pushStateCustom(r,i)}isolate(){var e=this._main,t=e.getSelectedMeshes(),r=e.getMeshes();if(r.length===t.length||r.length<2)this._ctrlIsolate.setValue(!1,!0);else{for(var i=[],s=0;s<r.length;++s)e.getIndexSelectMesh(r[s])<0&&i.push(r[s]);this.pushSetMeshesVisible(i,!1),e.render()}}showAll(){for(var e=this._main,t=e.getMeshes(),r=[],i=0;i<t.length;++i)t[i].isVisible()||r.push(t[i]);this.pushSetMeshesVisible(r,!0),e.render()}onDarkenUnselected(e){v.darkenUnselected=e,this._main.render()}onShowSymmetryLine(e){v.showSymmetryLine=e,this._main.render()}onShowGrid(e){var t=this._main;t._showGrid=e,t.render()}onShowContour(e){var t=this._main;t._showContour=e,t.render()}onKeyDown(e){!0!==e.handled&&(e.stopPropagation(),this._main._focusGui||e.preventDefault(),73===e.which?(this.toggleShowHide(),e.handled=!0):68===e.which&&e.ctrlKey&&(this._main.duplicateSelection(),e.handled=!0))}};var xi=__webpack_require__(75),Ci={tools:[]},wi=Ci.tools;Ci.initGuiTools=function(e,t,r){for(var i=0,s=Lt.length;i<s;++i)if(Lt[i]){var a=wi[i];a||(console.error("No gui for tool index : "+i),Ci[i]={_ctrls:[],init:function(){}}),a.init(e.getTool(i),t,r),Ci.hide(i)}},Ci.hide=function(e){for(var t=0,r=wi[e]._ctrls,i=r.length;t<i;++t)r[t].setVisibility(!1)},Ci.show=function(e){for(var t=0,r=wi[e]._ctrls,i=r.length;t<i;++t)r[t].setVisibility(!0);wi[e].onShow&&wi[e].onShow()};var Pi=function(e,t,r){this[e]=t?r/t:r},Di=function(e,t,r,i){var s=t.addSlider((0,S.A)("sculptRadius"),e._radius,function(t){Pi.call(e,"_radius",1,t),i.getSculptManager().getSelection().setIsEditMode(!0),i.renderSelectOverRtt()},5,500,1);return r._ctrlRadius=s,s},ki=function(e,t,r){var i=t.addSlider((0,S.A)("sculptIntensity"),100*e._intensity,Pi.bind(e,"_intensity",100),0,100,1);return r._ctrlIntensity=i,i},Ii=function(e,t){return t.addSlider((0,S.A)("sculptHardness"),100*e._hardness,Pi.bind(e,"_hardness",100),0,100,1)},Fi=function(e,t){return t.addCheckbox((0,S.A)("sculptCulling"),e,"_culling")},Li=function(e,t,r,i){var s=t.addCheckbox(i||(0,S.A)("sculptNegative"),e,"_negative");return r.toggleNegative=function(){s.setValue(!s.getValue())},s},Vi=function(){document.getElementById("alphaopen").click()},Ni=function(e,t,r,i){e.push(t.addTitle((0,S.A)("sculptAlphaTitle"))),void 0!==r._lockPosition&&e.push(t.addCheckbox((0,S.A)("sculptLockPositon"),r,"_lockPosition")),i._ctrlAlpha=t.addCombobox((0,S.A)("sculptAlphaTex"),r,"_idAlpha",xi.A.ALPHAS_NAMES),e.push(i._ctrlAlpha),e.push(t.addButton((0,S.A)("sculptImportAlpha"),Vi))};wi[i.A.Tools.BRUSH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Li(e,t,this)),this._ctrls.push(t.addCheckbox((0,S.A)("sculptClay"),e,"_clay")),this._ctrls.push(t.addCheckbox((0,S.A)("sculptAccumulate"),e,"_accumulate")),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.CREASE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Li(e,t,this)),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.DRAG]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.FLATTEN]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Li(e,t,this)),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.INFLATE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Li(e,t,this)),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.PAINT]={_ctrls:[],onMaterialChanged:function(t,r,i){e.C(r._color,i[0].getValue()),r._material[0]=i[1].getValue()/100,r._material[1]=i[2].getValue()/100;var s=t.getMesh();s&&(r._writeAlbedo&&s.setAlbedo(r._color),r._writeRoughness&&s.setRoughness(r._material[0]),r._writeMetalness&&s.setMetallic(r._material[1]),t.render())},resetMaterialOverride:function(e,t){this._ctrlPicker.getValue()!==t._pickColor&&this._ctrlPicker.setValue(t._pickColor);var r=e.getMesh();r&&r.getAlbedo&&(r.getAlbedo()[0]=-1,r.setRoughness(-1),r.setMetallic(-1),e.render())},onPickedMaterial:function(t,r,i,a,n,o){i.setCanvasCursor(s.A.cursors.dropper),t[0].setValue(a,!0),t[1].setValue(100*n,!0),t[2].setValue(100*o,!0),e.C(r._color,a),r._material[0]=n,r._material[1]=o},onColorPick:function(e,t,r){e._pickColor=r,t.setCanvasCursor(r?s.A.cursors.dropper:"default"),t._action=r?i.A.Action.SCULPT_EDIT:i.A.Action.NOTHING,t.renderSelectOverRtt()},init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Ii(e,t)),this._ctrls.push(Fi(e,t)),this._ctrls.push(t.addTitle((0,S.A)("sculptPBRTitle"))),this._ctrls.push(t.addButton((0,S.A)("sculptPaintAll"),e,"paintAll")),this._ctrlPicker=t.addCheckbox((0,S.A)("sculptPickColor"),e._pickColor,this.onColorPick.bind(this,e,r)),this._ctrls.push(this._ctrlPicker);var i=[],s=this.onMaterialChanged.bind(this,r,e,i),a=t.addColor((0,S.A)("sculptColor"),e._color,s),n=t.addSlider((0,S.A)("sculptRoughness"),100*e._material[0],s,0,100,1),o=t.addSlider((0,S.A)("sculptMetallic"),100*e._material[1],s,0,100,1);i.push(a,n,o),this._ctrls.push(a,n,o),e.setPickCallback(this.onPickedMaterial.bind(this,i,e,r)),this._ctrls.push(t.addTitle("Write channel")),this._ctrls.push(t.addCheckbox((0,S.A)("sculptColor"),e,"_writeAlbedo")),this._ctrls.push(t.addCheckbox((0,S.A)("sculptRoughness"),e,"_writeRoughness")),this._ctrls.push(t.addCheckbox((0,S.A)("sculptMetallic"),e,"_writeMetalness")),window.addEventListener("keyup",this.resetMaterialOverride.bind(this,r,e)),window.addEventListener("mouseup",this.resetMaterialOverride.bind(this,r,e)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.PINCH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Li(e,t,this)),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.TWIST]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.LOCALSCALE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.MOVE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(t.addCheckbox((0,S.A)("sculptTopologicalCheck"),e,"_topoCheck")),this._ctrls.push(Li(e,t,this,(0,S.A)("sculptMoveAlongNormal"))),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.SMOOTH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(t.addCheckbox((0,S.A)("sculptTangentialSmoothing"),e,"_tangent")),this._ctrls.push(Fi(e,t)),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.MASKING]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Di(e,t,this,r)),this._ctrls.push(ki(e,t,this)),this._ctrls.push(Ii(e,t)),this._ctrls.push(Li(e,t,this)),this._ctrls.push(Fi(e,t)),this._main=r,this._tool=e;var i=t.addDualButton((0,S.A)("sculptMaskingClear"),(0,S.A)("sculptMaskingInvert"),e,e,"clear","invert"),s=t.addDualButton((0,S.A)("sculptMaskingBlur"),(0,S.A)("sculptMaskingSharpen"),e,e,"blur","sharpen");this._ctrls.push(i[0],i[1],s[0],s[1]),this._ctrls.push(t.addTitle((0,S.A)("sculptExtractTitle"))),this._ctrls.push(t.addSlider((0,S.A)("sculptExtractThickness"),e,"_thickness",-5,5,.001)),this._ctrls.push(t.addButton((0,S.A)("sculptExtractAction"),e,"extract")),Ni(this._ctrls,t,e,this)}},wi[i.A.Tools.TRANSFORM]={_ctrls:[],_ctrlCoordSpace:null,_ctrlOpFilter:null,_ctrlAxisFilter:null,_main:null,_tool:null,_opFilter:0,_axisFilter:0,_getOperationMask:function(){switch(this._opFilter){case 1:return Pt.TRANS_XYZ|Pt.PLANE_XYZ;case 2:return Pt.ROT_XYZ|Pt.ROT_W;case 3:return Pt.SCALE_XYZW;default:return Pt.TRANS_XYZ|Pt.PLANE_XYZ|Pt.ROT_XYZ|Pt.ROT_W|Pt.SCALE_XYZW}},_getAxisMask:function(){switch(this._axisFilter){case 1:return{trans:Pt.TRANS_X,rot:Pt.ROT_X,scale:Pt.SCALE_X};case 2:return{trans:Pt.TRANS_Y,rot:Pt.ROT_Y,scale:Pt.SCALE_Y};case 3:return{trans:Pt.TRANS_Z,rot:Pt.ROT_Z,scale:Pt.SCALE_Z};default:return null}},_applyGizmoFilters:function(){var e=this._getOperationMask(),t=this._getAxisMask();if(t){var r=0;e&Pt.TRANS_XYZ&&(r|=t.trans),e&Pt.PLANE_XYZ&&(r|=t.trans),e&Pt.ROT_XYZ&&(r|=t.rot),e&Pt.ROT_W&&(r|=t.rot),e&Pt.SCALE_XYZW&&(r|=t.scale),e=r}this._tool._gizmo.setActivatedType(e),this._main.render()},_onCoordSpaceChanged:function(e){this._tool._gizmo.setCoordSpace(e),this._main.render()},_onOpFilterChanged:function(e){this._opFilter=e,this._applyGizmoFilters()},_onAxisFilterChanged:function(e){this._axisFilter=e,this._applyGizmoFilters()},init:function(e,t,r){this._main=r,this._tool=e,this._ctrls.push(t.addTitle((0,S.A)("sculptGizmoTransform"))),this._ctrlCoordSpace=t.addCombobox((0,S.A)("sculptCoordSpace"),e._gizmo.getCoordSpace(),this._onCoordSpaceChanged.bind(this),[(0,S.A)("sculptGlobal"),(0,S.A)("sculptLocal")]),this._ctrls.push(this._ctrlCoordSpace),this._ctrls.push(t.addTitle((0,S.A)("sculptGizmoFilters"))),this._ctrlOpFilter=t.addCombobox((0,S.A)("sculptGizmoOperation"),this._opFilter,this._onOpFilterChanged.bind(this),[(0,S.A)("sculptGizmoAll"),(0,S.A)("sculptGizmoMove"),(0,S.A)("sculptGizmoRotate"),(0,S.A)("sculptGizmoScale")]),this._ctrlAxisFilter=t.addCombobox((0,S.A)("sculptGizmoAxis"),this._axisFilter,this._onAxisFilterChanged.bind(this),[(0,S.A)("sculptGizmoAll"),(0,S.A)("sculptGizmoAxisX"),(0,S.A)("sculptGizmoAxisY"),(0,S.A)("sculptGizmoAxisZ")]),this._ctrls.push(this._ctrlOpFilter,this._ctrlAxisFilter),this._applyGizmoFilters()}},wi[i.A.Tools.ELEMENTSELECT]={_ctrls:[],init:function(e,t){var r=[];r[e.constructor.Mode.VERTEX]=(0,S.A)("sculptElementSelectVertex"),r[e.constructor.Mode.EDGE]=(0,S.A)("sculptElementSelectEdge"),r[e.constructor.Mode.FACE]=(0,S.A)("sculptElementSelectFace");var i=[];i[e.constructor.Action.REPLACE]=(0,S.A)("sculptElementSelectReplace"),i[e.constructor.Action.ADD]=(0,S.A)("sculptElementSelectAdd"),i[e.constructor.Action.REMOVE]=(0,S.A)("sculptElementSelectRemove"),this._ctrls.push(t.addTitle((0,S.A)("sculptElementSelect"))),this._ctrls.push(t.addCombobox((0,S.A)("sculptElementSelectMode"),e._selectionMode,function(t){e._selectionMode=t},r)),this._ctrls.push(t.addCombobox((0,S.A)("sculptElementSelectAction"),e._selectionAction,function(t){e._selectionAction=t},i)),this._ctrls.push(t.addButton((0,S.A)("sculptElementSelectAll"),e,"selectAll")),this._ctrls.push(t.addButton((0,S.A)("sculptElementSelectClear"),e,"clearSelection")),this._ctrls.push(t.addButton((0,S.A)("sculptElementSelectInvert"),e,"invertSelection"))}};const Oi=Ci;var Bi=Oi.tools;const Ui=class{constructor(e,t){this._main=t._main,this._ctrlGui=t,this._sculptManager=t._main.getSculptManager(),this._toolOnRelease=-1,this._invertSign=!1,this._modalBrushRadius=!1,this._modalBrushIntensity=!1,this._lastPageX=0,this._lastPageY=0,this._refX=0,this._refY=0,this._menu=null,this._ctrlSculpt=null,this._ctrlSymmetry=null,this._ctrlContinuous=null,this._ctrlTitleCommon=null,this._ctrlRotomold=null,this._ctrlRotomoldSpeed=null,this._ctrlRotomoldAxis=null,this._ctrlRotomoldPivot=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("sculptTitle"));t.open(),t.addTitle((0,S.A)("sculptTool"));for(var r=[],i=0,s=Lt.length;i<s;++i)Lt[i]&&(r[i]=(0,S.A)(Lt[i].uiName));this._ctrlSculpt=t.addCombobox((0,S.A)("sculptTool"),this._sculptManager.getToolIndex(),this.onChangeTool.bind(this),r),Oi.initGuiTools(this._sculptManager,this._menu,this._main),this._ctrlTitleCommon=t.addTitle((0,S.A)("sculptCommon")),this._ctrlSymmetry=t.addCheckbox((0,S.A)("sculptSymmetry"),this._sculptManager._symmetry,this.onSymmetryChange.bind(this)),this._ctrlContinuous=t.addCheckbox((0,S.A)("sculptContinuous"),this._sculptManager,"_continuous"),t.addTitle((0,S.A)("sculptRotomoldTitle")),this._ctrlRotomold=t.addCheckbox((0,S.A)("sculptRotomoldEnable"),this._main._autoRotateEnabled,function(e){this._main.setAutoRotateEnabled(e)}.bind(this)),this._ctrlRotomoldSpeed=t.addSlider((0,S.A)("sculptRotomoldSpeed"),180*this._main._autoRotateSpeed/Math.PI,function(e){this._main.setAutoRotateSpeed(e*Math.PI/180)}.bind(this),0,180,1),this._ctrlRotomoldAxis=t.addCombobox((0,S.A)("sculptRotomoldAxis"),this._main._autoRotateAxis,function(e){this._main.setAutoRotateAxis(e)}.bind(this),[(0,S.A)("sculptRotomoldAxisX"),(0,S.A)("sculptRotomoldAxisY"),(0,S.A)("sculptRotomoldAxisZ")]),this._ctrlRotomoldPivot=t.addCombobox((0,S.A)("sculptRotomoldPivot"),this._main._autoRotatePivot,function(e){this._main.setAutoRotatePivot(e)}.bind(this),[(0,S.A)("sculptRotomoldPivotMesh"),(0,S.A)("sculptRotomoldPivotWorld")]),Oi.show(this._sculptManager.getToolIndex()),this.addEvents(),this.onChangeTool(this._sculptManager.getToolIndex())}onSymmetryChange(e){this._sculptManager._symmetry=e,this._main.render()}addEvents(){var e=this.loadAlpha.bind(this);document.getElementById("alphaopen").addEventListener("change",e,!1),this.removeCallback=function(){document.getElementById("alphaopen").removeEventListener("change",e,!1)}}removeEvents(){this.removeCallback&&this.removeCallback()}getSelectedTool(){return this._ctrlSculpt.getValue()}releaseInvertSign(){if(this._invertSign){this._invertSign=!1;var e=Bi[this.getSelectedTool()];e.toggleNegative&&e.toggleNegative()}}onChangeTool(e){Oi.hide(this._sculptManager.getToolIndex()),this._sculptManager.setToolIndex(e),Oi.show(e);var t=!0===this._sculptManager.canBeContinuous();this._ctrlContinuous.setVisibility(t);var r=e!==i.A.Tools.TRANSFORM&&e!==i.A.Tools.ELEMENTSELECT;this._ctrlSymmetry.setVisibility(r),this._ctrlTitleCommon.setVisibility(t||r),this._main.getPicking().updateLocalAndWorldRadius2()}loadAlpha(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,i=this._main,s=Bi[this._sculptManager.getToolIndex()];r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=i.onLoadAlphaImage.bind(i,r,t.name||"new alpha",s)},document.getElementById("alphaopen").value="",r.readAsDataURL(t)}}}addAlphaOptions(e){for(var t=0,r=Bi.length;t<r;++t){var i=Bi[t];i&&i._ctrlAlpha&&i._ctrlAlpha.addOptions(e)}}updateMesh(){this._menu.setVisibility(!!this._main.getMesh())}_startModalBrushRadius(e,t){this._refX=e,this._refY=t;var r=Bi[this.getSelectedTool()];if(r._ctrlRadius){var i=r._ctrlRadius.getValue();this._refX-=i,this._main.getSculptManager().getSelection().setOffsetX(-i*this._main.getPixelRatio()),this._main.renderSelectOverRtt()}}_checkModifierKey(e){var t=this.getSelectedTool();if(this._main._action===i.A.Action.NOTHING&&(!e.shiftKey||e.altKey||e.ctrlKey||t!==i.A.Tools.SMOOTH&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(i.A.Tools.SMOOTH)),!e.ctrlKey||e.shiftKey||e.altKey||t!==i.A.Tools.MASKING&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(i.A.Tools.MASKING))),e.altKey){if(this._invertSign||e.shiftKey)return!0;this._invertSign=!0;var r=Bi[t];return r.toggleNegative&&r.toggleNegative(),!0}return!1}onKeyDown(e){if(!0!==e.handled){var t=this._main,r=n.A.getShortKey(e.which);if(e.stopPropagation(),t._focusGui&&r!==i.A.KeyAction.RADIUS&&r!==i.A.KeyAction.INTENSITY||e.preventDefault(),e.handled=!0,!this._checkModifierKey(e)&&t._action===i.A.Action.NOTHING){if(void 0!==r&&Lt[r])return this._ctrlSculpt.setValue(r);var s=Bi[this.getSelectedTool()];switch(r){case i.A.KeyAction.DELETE:t.deleteCurrentSelection();break;case i.A.KeyAction.INTENSITY:this._modalBrushIntensity=t._focusGui=!0;break;case i.A.KeyAction.RADIUS:this._modalBrushRadius||this._startModalBrushRadius(this._lastPageX,this._lastPageY),this._modalBrushRadius=t._focusGui=!0;break;case i.A.KeyAction.NEGATIVE:s.toggleNegative&&s.toggleNegative();break;case i.A.KeyAction.PICKER:var a=s._ctrlPicker;a&&!a.getValue()&&a.setValue(!0);break;default:e.handled=!1}}}}onKeyUp(e){var t=this._main._action===i.A.Action.NOTHING&&-1!==this._toolOnRelease&&!e.ctrlKey&&!e.shiftKey;e.altKey&&!t||this.releaseInvertSign(),t&&(this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1);var r=this._main;switch(n.A.getShortKey(e.which)){case i.A.KeyAction.RADIUS:this._modalBrushRadius=r._focusGui=!1,this._main.getSculptManager().getSelection().setOffsetX(0),e.pageX=this._lastPageX,e.pageY=this._lastPageY,r.setMousePosition(e),r.getPicking().intersectionMouseMeshes(),r.renderSelectOverRtt();break;case i.A.KeyAction.PICKER:var s=Bi[this.getSelectedTool()]._ctrlPicker;s&&s.getValue()&&s.setValue(!1);break;case i.A.KeyAction.INTENSITY:this._modalBrushIntensity=r._focusGui=!1}}onMouseUp(e){-1===this._toolOnRelease||e.ctrlKey||e.shiftKey||(this.releaseInvertSign(),this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1)}onMouseMove(e){var t=Bi[this.getSelectedTool()];if(this._modalBrushRadius&&t._ctrlRadius){var r=e.pageX-this._refX,i=e.pageY-this._refY;t._ctrlRadius.setValue(Math.sqrt(r*r+i*i)),this._main.renderSelectOverRtt()}this._modalBrushIntensity&&t._ctrlIntensity&&t._ctrlIntensity.setValue(t._ctrlIntensity.getValue()+e.pageX-this._lastPageX),this._lastPageX=e.pageX,this._lastPageY=e.pageY}onMouseOver(e){this._modalBrushRadius&&this._startModalBrushRadius(e.pageX,e.pageY)}};class Gi{constructor(e,t,r){this._main=e,this._addedMeshes=void 0!==t.length?t:[t],this._removedMeshes=void 0!==r.length?r:[r],this._selectMeshes=e.getSelectedMeshes().slice()}isNoop(){return 0===this._addedMeshes.length&&0===this._removedMeshes.length}undo(){var e,t,r=this._main,i=r.getMeshes(),s=this._addedMeshes;for(e=0,t=s.length;e<t;++e)i.splice(r.getIndexMesh(s[e]),1);var a=this._removedMeshes;for(e=0,t=a.length;e<t;++e)i.push(a[e]);for(e=0,t=i.length;e<t;++e)i[e].initRender();var n=this._selectMeshes;r.setMesh(n[0]?n[0]:null);var o=r.getSelectedMeshes();for(o.length=0,e=0,t=n.length;e<t;++e)o.push(n[e])}redo(){this.undo()}createRedo(){return new Gi(this._main,this._removedMeshes,this._addedMeshes)}}const Wi=Gi;class zi{constructor(e,t){this._main=e,this._mesh=t,this._idVertState=[],this._cArState=[],this._mArState=[]}isNoop(){return 0===this._idVertState.length}undo(){this.pullVertices();var e=this._mesh;e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateColorBuffer(),e.updateMaterialBuffer(),this._main.setMesh(e)}redo(){this.undo()}createRedo(){var e=new zi(this._main,this._mesh);return this.pushRedoVertices(e),e}pushVertices(e){for(var t=this._idVertState,r=this._cArState,i=this._mArState,a=this._mesh,n=a.getColors(),o=a.getMaterials(),l=a.getVerticesStateFlags(),c=s.A.STATE_FLAG,h=e.length,u=0;u<h;++u){var d=e[u];l[d]!==c&&(l[d]=c,t.push(d),d*=3,r.push(n[d],n[d+1],n[d+2]),i.push(o[d],o[d+1],o[d+2]))}}pushRedoVertices(e){for(var t=e._mesh,r=t.getColors(),i=t.getMaterials(),s=this._idVertState,a=s.length,n=e._cArState=new Float32Array(3*a),o=e._mArState=new Float32Array(3*a),l=e._idVertState=new Uint32Array(a),c=0;c<a;++c){var h=l[c]=s[c];h*=3;var u=3*c;n[u]=r[h],n[u+1]=r[h+1],n[u+2]=r[h+2],o[u]=i[h],o[u+1]=i[h+1],o[u+2]=i[h+2]}}pullVertices(){for(var e=this._cArState,t=this._mArState,r=this._idVertState,i=r.length,s=this._mesh,a=s.getColors(),n=s.getMaterials(),o=0;o<i;++o){var l=3*r[o],c=3*o;a[l]=e[c],a[l+1]=e[c+1],a[l+2]=e[c+2],n[l]=t[c],n[l+1]=t[c+1],n[l+2]=t[c+2]}}}const Xi=zi;class ji{constructor(t,r){this._main=t,this._mesh=r,this._center=e.C([0,0,0],r.getCenter()),this._idVertState=[],this._vArState=[]}isNoop(){return 0===this._idVertState.length}undo(){this.pullVertices();var t=this._mesh;t.updateGeometry(t.getFacesFromVertices(this._idVertState),this._idVertState),t.updateGeometryBuffers(),e.C(t.getCenter(),this._center),this._main.setMesh(t)}redo(){this.undo()}createRedo(){var e=new ji(this._main,this._mesh);return this.pushRedoVertices(e),e}pushVertices(e){for(var t=this._idVertState,r=this._vArState,i=this._mesh,a=i.getVertices(),n=i.getVerticesStateFlags(),o=s.A.STATE_FLAG,l=e.length,c=0;c<l;++c){var h=e[c];n[h]!==o&&(n[h]=o,t.push(h),h*=3,r.push(a[h],a[h+1],a[h+2]))}}pushRedoVertices(e){for(var t=e._mesh.getVertices(),r=this._idVertState,i=r.length,s=e._vArState=new Float32Array(3*i),a=e._idVertState=new Uint32Array(i),n=0;n<i;++n){var o=a[n]=r[n];o*=3;var l=3*n;s[l]=t[o],s[l+1]=t[o+1],s[l+2]=t[o+2]}}pullVertices(){for(var e=this._vArState,t=this._idVertState,r=t.length,i=this._mesh.getVertices(),s=0;s<r;++s){var a=3*t[s],n=3*s;i[a]=e[n],i[a+1]=e[n+1],i[a+2]=e[n+2]}}}const Yi=ji;class Ki{constructor(t,r){this._main=t,this._mesh=r,this._center=e.C([0,0,0],r.getCenter()),this._nbFacesState=r.getNbFaces(),this._nbVerticesState=r.getNbVertices(),this._idVertState=[],this._fRingState=[],this._vRingState=[],this._vArState=[],this._cArState=[],this._mArState=[],this._idFaceState=[],this._fArState=[]}isNoop(){return 0===this._idVertState.length&&0===this._idFaceState.length}undo(){this.pullVertices(),this.pullFaces();var t=this._mesh;t.setNbVertices(this._nbVerticesState),t.setNbFaces(this._nbFacesState),t.updateTopology(),t.updateGeometry(),t.updateDuplicateColorsAndMaterials(),t.updateDrawArrays(),t.updateColorBuffer(),t.updateMaterialBuffer(),t.updateBuffers(),e.C(t.getCenter(),this._center),this._main.setMesh(t)}redo(){this.undo()}createRedo(){var e=new Ki(this._main,this._mesh);return this.pushRedoVertices(e),this.pushRedoFaces(e),e}pushVertices(e){for(var t=this._idVertState,r=this._fRingState,i=this._vRingState,a=this._vArState,n=this._cArState,o=this._mArState,l=this._mesh,c=l.getVerticesRingFace(),h=l.getVerticesRingVert(),u=l.getVertices(),d=l.getColors(),_=l.getMaterials(),p=l.getVerticesStateFlags(),g=s.A.STATE_FLAG,m=e.length,f=0;f<m;++f){var v=e[f];p[v]!==g&&(p[v]=g,r.push(c[v].slice()),i.push(h[v].slice()),t.push(v),v*=3,a.push(u[v],u[v+1],u[v+2]),n.push(d[v],d[v+1],d[v+2]),o.push(_[v],_[v+1],_[v+2]))}}pushFaces(e){for(var t=this._idFaceState,r=this._fArState,i=this._mesh,a=i.getFaces(),n=i.getFacesStateFlags(),o=s.A.STATE_FLAG,l=e.length,c=0;c<l;++c){var h=e[c];n[h]!==o&&(n[h]=o,t.push(h),h*=4,r.push(a[h],a[h+1],a[h+2],a[h+3]))}}pushRedoVertices(e){var t=e._mesh,r=t.getNbVertices(),i=t.getVerticesRingFace(),a=t.getVerticesRingVert(),n=t.getVertices(),o=t.getColors(),l=t.getMaterials(),c=0,h=0,u=0,d=this._idVertState,_=d.length,p=this._nbVerticesState,g=Math.min(p,r),m=new Uint32Array(s.A.getMemory(4*r),0,r);for(c=0;c<_;++c)(h=d[c])<g&&(m[u++]=h);for(c=p;c<r;++c)m[u++]=c;_=u,m=e._idVertState=new Uint32Array(m.subarray(0,_));var f=e._fRingState=new Array(_),v=e._vRingState=new Array(_),A=e._vArState=new Float32Array(3*_),T=e._cArState=new Float32Array(3*_),b=e._mArState=new Float32Array(3*_);for(c=0;c<_;++c){h=m[c],f[c]=i[h].slice(),v[c]=a[h].slice(),h*=3;var M=3*c;A[M]=n[h],A[M+1]=n[h+1],A[M+2]=n[h+2],T[M]=o[h],T[M+1]=o[h+1],T[M+2]=o[h+2],b[M]=l[h],b[M+1]=l[h+1],b[M+2]=l[h+2]}}pushRedoFaces(e){var t=e._mesh,r=t.getNbFaces(),i=t.getFaces(),a=0,n=0,o=0,l=this._idFaceState,c=l.length,h=this._nbFacesState,u=Math.min(h,r),d=new Uint32Array(s.A.getMemory(4*r),0,r);for(a=0;a<c;++a)(n=l[a])<u&&(d[o++]=n);for(a=h;a<r;++a)d[o++]=a;c=o,d=e._idFaceState=new Uint32Array(d.subarray(0,c));var _=e._fArState=new Int32Array(4*c);for(a=0;a<c;++a){n=d[a],n*=4;var p=4*a;_[p]=i[n],_[p+1]=i[n+1],_[p+2]=i[n+2],_[p+3]=i[n+3]}}pullVertices(){for(var e=this._nbVerticesState,t=this._fRingState,r=this._vRingState,i=this._vArState,s=this._cArState,a=this._mArState,n=this._idVertState,o=n.length,l=this._mesh,c=l.getVerticesRingFace(),h=l.getVerticesRingVert(),u=l.getVertices(),d=l.getColors(),_=l.getMaterials(),p=0;p<o;++p){var g=n[p];if(!(g>=e)){c[g]=t[p].slice(),h[g]=r[p].slice();var m=3*p;u[g*=3]=i[m],u[g+1]=i[m+1],u[g+2]=i[m+2],d[g]=s[m],d[g+1]=s[m+1],d[g+2]=s[m+2],_[g]=a[m],_[g+1]=a[m+1],_[g+2]=a[m+2]}}}pullFaces(){for(var e=this._nbFacesState,t=this._fArState,r=this._idFaceState,i=r.length,s=this._mesh.getFaces(),a=0;a<i;++a){var n=r[a];if(!(n>=e)){var o=4*a;s[n*=4]=t[o],s[n+1]=t[o+1],s[n+2]=t[o+2],s[n+3]=t[o+3]}}}}const Hi=Ki;class qi{constructor(e,t){this._undocb=e,this._redocb=t||e}isNoop(){return!this._undocb}undo(){this._undocb()}redo(){this._redocb()}createRedo(){return new qi(this._undocb,this._redocb)}}const Zi=qi;class Qi{constructor(e){this._main=e,this._undos=[],this._redos=[],this._curUndoIndex=-1}pushStateCustom(e,t,r){var i=new Zi(e,t);i.squash=r,this.pushState(i)}pushStateAddRemove(e,t,r){var i=new Wi(this._main,e,t);i.squash=r,this.pushState(i)}pushStateRemove(e){this.pushState(new Wi(this._main,[],e))}pushStateAdd(e){this.pushState(new Wi(this._main,e,[]))}pushStateColorAndMaterial(e){e.isDynamic?this.pushState(new Hi(this._main,e)):this.pushState(new Xi(this._main,e))}pushStateGeometry(e){e.isDynamic?this.pushState(new Hi(this._main,e)):this.pushState(new Yi(this._main,e))}pushStateMultiresolution(e,t){this.pushState(new Ai(this._main,e,t))}setNewMaxStack(e){Qi.STACK_LENGTH=e;for(var t=this._undos,r=this._redos;this._curUndoIndex>=e;)t.shift(),--this._curUndoIndex;for(;t.length>e;)t.pop(),r.shift()}pushState(e){++s.A.STATE_FLAG;var t=this._undos;-1===this._curUndoIndex?t.length=0:t.length>=Qi.STACK_LENGTH&&(t.shift(),--this._curUndoIndex),this._redos.length=0,++this._curUndoIndex,t.length>0&&(t.length=this._curUndoIndex),t.push(e)}getCurrentState(){return this._undos[this._curUndoIndex]}pushVertices(e){e&&e.length>0&&this.getCurrentState().pushVertices(e)}pushFaces(e){e&&e.length>0&&this.getCurrentState().pushFaces(e)}undo(){if(this._undos.length&&!(this._curUndoIndex<0)){var e=this.getCurrentState(),t=e.createRedo();t.squash=e.squash,this._redos.push(t),e.undo(),this._curUndoIndex--,!0===e.squash&&this.undo()}}redo(){this._redos.length&&(this._redos[this._redos.length-1].redo(),this._curUndoIndex++,this._redos.pop(),this._redos.length&&!0===this._redos[this._redos.length-1].squash&&this.redo())}reset(){this._undos.length=0,this._redos.length=0,this._curUndoIndex=-1}cleanNoop(){for(;this._curUndoIndex>=0&&this.getCurrentState().isNoop();)this._undos.length--,this._curUndoIndex--,this._redos.length=0}}Qi.STACK_LENGTH=15;const Ji=Qi,$i=class{constructor(e,t){this._ctrlGui=t,this._main=t._main,this._menu=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("stateTitle"));t.addButton((0,S.A)("stateUndo"),this,"onUndo","CTRL+Z"),t.addButton((0,S.A)("stateRedo"),this,"onRedo","CTRL+Y"),t.addTitle((0,S.A)("stateMaxStack"));var r=this._main.getStateManager();t.addSlider("",Ji.STACK_LENGTH,r.setNewMaxStack.bind(r),3,50,1)}onUndo(){this._main._action=i.A.Action.NOTHING,this._main.getSculptManager().end(),this._main.getStateManager().undo(),this._main.render(),this._ctrlGui.updateMesh()}onRedo(){this._main.getStateManager().redo(),this._main.render(),this._ctrlGui.updateMesh()}onKeyDown(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&90===t?(this.onUndo(),e.handled=!0):e.ctrlKey&&89===t&&(this.onRedo(),e.handled=!0)}}},es=class{constructor(e){this._menu=null,this.init(e)}init(e){var t=this._menu=e.addMenu((0,S.A)("pressureTitle"));t.addTitle((0,S.A)("pressureRadius")),t.addSlider("",r.A,"radiusFactor",0,1,.01),t.addTitle((0,S.A)("pressureIntensity")),t.addSlider("",r.A,"intensityFactor",0,1,.01)}},ts=class{constructor(e){this._main=e,this._guiMain=null,this._sidebar=null,this._topbar=null,this._ctrlTablet=null,this._ctrlFiles=null,this._ctrlScene=null,this._ctrlStates=null,this._ctrlCamera=null,this._ctrlBackground=null,this._ctrlSculpting=null,this._ctrlTopology=null,this._ctrlRendering=null,this._ctrlPattern=null,this._ctrlNotification=null,this._ctrls=[],this._notifications={},this._xhrs={}}initGui(){this.deleteGui(),this._guiMain=new(cr().GuiMain)(this._main.getViewport(),this._main.onCanvasResize.bind(this._main));var e=this._ctrls;e.length=0;var t=0;this._topbar=this._guiMain.addTopbar(),e[t++]=this._ctrlFiles=new Or(this._topbar,this),e[t++]=this._ctrlScene=new Ri(this._topbar,this),e[t++]=this._ctrlStates=new $i(this._topbar,this),e[t++]=this._ctrlBackground=new hr(this._topbar,this),e[t++]=this._ctrlCamera=new ur(this._topbar,this),e[t++]=this._ctrlTablet=new es(this._topbar,this),e[t++]=this._ctrlConfig=new dr(this._topbar,this),e[t++]=this._ctrlMesh=new Br(this._topbar,this),this._sidebar=this._guiMain.addRightSidebar(),e[t++]=this._ctrlRendering=new Si(this._sidebar,this),e[t++]=this._ctrlTopology=new Ti(this._sidebar,this),e[t++]=this._ctrlSculpting=new Ui(this._sidebar,this),e[t++]=this._ctrlPattern=new Ur(this._sidebar,this);var r=this._topbar.addExtra();r.addTitle((0,S.A)("contour")),r.addColor((0,S.A)("contourColor"),K.color,this.onContourColor.bind(this)),r.addTitle((0,S.A)("resolution")),r.addSlider("",this._main._pixelRatio,this.onPixelRatio.bind(this),.5,2,.02),this.addAboutButton(),this.updateMesh(),this.setVisibility(!0),window.postprocessGui&&window.postprocessGui()}getNotification(e){var t=this._notifications[e];return t?this._xhrs[e]&&t.isVisible()?void(window.confirm("Abort "+e+" previous upload?")&&(this._xhrs[e].abort(),this._xhrs[e].isAborted=!0,t.setMessage(null))):t:((t=this._topbar.addMenu()).isVisible=function(){return!this.domContainer.hidden},t.setMessage=function(e){this.domContainer.innerHTML=e,this.setVisibility(!!e)},t.domContainer.style.color="red",t.setMessage(""),this._notifications[e]=t,t)}initPrint(e){e.addMenu("Print it!").addButton("Go to Materialise!",this,"exportMaterialise")}exportSculpteo(){this._export("sculpteo")}exportMaterialise(){window.confirm("A new webpage will be opened. Start upload?")&&this._export("materialise")}exportSketchfab(){this._export("sketchfab")}_export(e){if(this._main.getMesh()){var t=this.getNotification(e);if(t){var r="export"+e.charAt(0).toUpperCase()+e.slice(1);this._xhrs[e]=Ir[r](this._main,t)}}}onPixelRatio(e){this._main._pixelRatio=e,this._main.onCanvasResize()}onContourColor(e){K.color[0]=e[0],K.color[1]=e[1],K.color[2]=e[2],K.color[3]=e[3],this._main.render()}addAboutButton(){var e=this._topbar.addMenu();e.domContainer.innerHTML=(0,S.A)("about"),e.domContainer.addEventListener("mousedown",function(){window.open("http://stephaneginier.com","_blank")})}updateMesh(){this._ctrlRendering.updateMesh(),this._ctrlTopology.updateMesh(),this._ctrlSculpting.updateMesh(),this._ctrlScene.updateMesh(),this.updateMeshInfo()}updateMeshInfo(){this._ctrlMesh.updateMeshInfo()}getFlatShading(){return this._ctrlRendering.getFlatShading()}getWireframe(){return this._ctrlRendering.getWireframe()}getShaderType(){return this._ctrlRendering.getShaderType()}addAlphaOptions(e){this._ctrlSculpting.addAlphaOptions(e)}deleteGui(){this._guiMain&&this._guiMain.domMain.parentNode&&(this.callFunc("removeEvents"),this.setVisibility(!1),this._guiMain.domMain.parentNode.removeChild(this._guiMain.domMain))}setVisibility(e){this._guiMain.setVisibility(e)}callFunc(e,t){for(var r=0,i=this._ctrls,s=i.length;r<s;++r){var a=i[r];a&&a[e]&&a[e](t)}}};var rs=200,is=200,ss=[0,0],as=[0,0,0],ns=[0,0,0],os=[0,1,0],ls=[0,0,0,1],cs=a.vt(),hs=Math.SQRT1_2,us=.5,ds=[Te(1,0,0,0),Te(0,1,0,0),Te(0,0,1,0),Te(0,0,0,1),Te(hs,hs,0,0),Te(hs,-hs,0,0),Te(hs,0,hs,0),Te(hs,0,-hs,0),Te(hs,0,0,hs),Te(hs,0,0,-hs),Te(0,hs,hs,0),Te(0,hs,-hs,0),Te(0,hs,0,hs),Te(0,hs,0,-hs),Te(0,0,hs,hs),Te(0,0,hs,-hs),Te(us,us,us,us),Te(us,us,us,-us),Te(us,us,-us,us),Te(us,us,-us,-us),Te(us,-us,us,us),Te(us,-us,us,-us),Te(us,-us,-us,us),Te(-us,us,us,us)];const _s=class{constructor(e){this._main=e;var t=(0,n.A)();this._mode=t.cameramode||i.A.CameraMode.ORBIT,this._projectionType=t.projection||i.A.Projection.PERSPECTIVE,this._quatRot=[0,0,0,1],this._view=a.vt(),this._proj=a.vt(),this._viewport=a.vt(),this._lastNormalizedMouseXY=[0,0],this._width=0,this._height=0,this._speed=0,this._fov=Math.min(t.fov,150),this._trans=[0,0,30],this._moveX=0,this._moveZ=0,this._usePivot=t.pivot,this._center=[0,0,0],this._offset=[0,0,0],this._rotX=0,this._rotY=0,this._near=.05,this._far=5e3,this._timers={},this.resetView()}setProjectionType(e){this._projectionType=e,this.updateProjection(),this.updateView()}setMode(e){this._mode=e,e===i.A.CameraMode.ORBIT&&this.resetViewFront()}setFov(e){this._fov=e,this.updateView(),this.optimizeNearFar()}setUsePivot(e){this._usePivot=e}toggleUsePivot(){this._usePivot=!this._usePivot}getView(){return this._view}getProjection(){return this._proj}getProjectionType(){return this._projectionType}isOrthographic(){return this._projectionType===i.A.Projection.ORTHOGRAPHIC}getMode(){return this._mode}getFov(){return this._fov}getUsePivot(){return this._usePivot}getConstantScreen(){var e=this._main.getCanvas().clientWidth;return this._projectionType===i.A.Projection.ORTHOGRAPHIC?e/this.getOrthoZoom():e*this._proj[0]}start(t,r){if(this._lastNormalizedMouseXY=Ee.A.normalizedMouse(t,r,this._width,this._height),this._usePivot){var i=this._main,s=i.getPicking();s.intersectionMouseMeshes(i.getMeshes(),t,r),s.getMesh()&&(e.Z0(as,s.getIntersectionPoint(),s.getMesh().getMatrix()),this.setPivot(as))}}setPivot(t){if(e.gL(this._offset,this._offset,function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=r*r+i*i+s*s+a*a,o=n?1/n:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-s*o,e[3]=a*o,e}(ls,this._quatRot)),e.jb(this._offset,this._offset,this._center),e.C(this._center,t),e.WQ(this._offset,this._offset,this._center),e.gL(this._offset,this._offset,this._quatRot),this._projectionType===i.A.Projection.PERSPECTIVE){var r=this.getTransZ();this._trans[2]=e.xg(this.computePosition(),this._center)*this._fov/45,this._offset[2]+=this.getTransZ()-r}else this._offset[2]=0}rotate(t,r){var s=as,a=ss,n=Ee.A.normalizedMouse(t,r,this._width,this._height);if(this._mode===i.A.CameraMode.ORBIT)_e(a,n,this._lastNormalizedMouseXY),this.setOrbit(this._rotX-2*a[1],this._rotY+2*a[0]),this.rotateDelay([6*-a[1],6*a[0]],-1);else if(this._mode===i.A.CameraMode.PLANE){var o=pe(this._lastNormalizedMouseXY,n);_e(a,n,this._lastNormalizedMouseXY),e.S8(s,e.hZ(s,-a[1],a[0],0)),be(this._quatRot,fe(ls,s,2*o),this._quatRot),this.rotateDelay([s[0],s[1],s[2],6*o],-1)}else if(this._mode===i.A.CameraMode.SPHERICAL){var l=Ee.A.mouseOnUnitSphere(this._lastNormalizedMouseXY),c=Ee.A.mouseOnUnitSphere(n),h=Math.acos(Math.min(1,e.Om(l,c)));e.S8(s,e.$A(s,l,c)),be(this._quatRot,fe(ls,s,2*h),this._quatRot),this.rotateDelay([s[0],s[1],s[2],6*h],-1)}this._lastNormalizedMouseXY=n,this.updateView()}setOrbit(e,t){var r=.49*Math.PI;this._rotX=Math.max(Math.min(e,r),-r),this._rotY=t;var i=this._quatRot;me(i),ve(i,i,this._rotX),Ae(i,i,this._rotY)}getTransZ(){return this._projectionType===i.A.Projection.PERSPECTIVE?45*this._trans[2]/this._fov:1e3}updateView(){var t=as,r=this._view,i=this._trans[0],s=this._trans[1],n=this._offset;e.hZ(ns,i-n[0],s-n[1],this.getTransZ()-n[2]),e.hZ(t,i-n[0],s-n[1],-n[2]),a.t5(r,ns,t,os),a.lK(r,r,a.I0(cs,this._quatRot)),a.Tl(r,r,e.ze(as,this._center))}optimizeNearFar(t){if(t||(t=this._lastBBox),t){this._lastBBox=t;var r=this.computePosition(ns),i=e.hZ(as,.5*(t[0]+t[3]),.5*(t[1]+t[4]),.5*(t[2]+t[5])),s=e.xg(r,i),a=.5*e.xg(t,e.hZ(as,t[3],t[4],t[5]));this._near=Math.max(.01,s-a),this._far=a+s,this.updateProjection()}}updateProjection(){this._projectionType===i.A.Projection.PERSPECTIVE?(a.fN(this._proj,this._fov*Math.PI/180,this._width/this._height,this._near,this._far),this._proj[10]=-1,this._proj[14]=-2*this._near):this.updateOrtho()}updateTranslation(){var e=this._trans;e[0]+=this._moveX*this._speed*e[2]/50/400,e[2]=Math.max(1e-5,e[2]+this._moveZ*this._speed/400),this._projectionType===i.A.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}translate(t,r){var i=this._speed*this._trans[2]/54,s=[-t*i,r*i,0];this.setTrans(e.WQ(this._trans,this._trans,s)),e.hs(s,s,5),this.translateDelay(s,-1)}zoom(t){var r=[0,0,0];e.jb(r,this._offset,this._trans),e.hs(r,r,t*this._speed/54),t<0&&(r[0]=r[1]=0),this.setTrans(e.WQ(this._trans,this._trans,r)),e.hs(r,r,5),this.translateDelay(r,-1)}setAndFocusOnPivot(e,t){this.setPivot(e),this.moveToDelay(this._offset[0],this._offset[1],this._offset[2]+t)}moveToDelay(t,r,i){var s=[t,r,i];this.translateDelay(e.jb(s,s,this._trans),is)}setTrans(t){e.C(this._trans,t),this._projectionType===i.A.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}getOrthoZoom(){return 55e-5*Math.abs(this._trans[2])}updateOrtho(){var e=this.getOrthoZoom(),t=this._width*e,r=this._height*e;a.v3(this._proj,-t,t,-r,r,-this._near,this._far)}computePosition(t){t=t||[0,0,0];var r=this._view;return e.hZ(t,-r[12],-r[13],-r[14]),c(cs,r),h(cs,cs),e.ei(t,t,cs)}resetView(){this._speed=1.5*s.A.SCALE,this.centerDelay([0,0,0],is),this.offsetDelay([0,0,0],is);var t=[0,0,30+this._speed/3];e.jb(t,t,this._trans),this.translateDelay(t,is),this.quatDelay([0,0,0,1],is)}resetViewFront(){this.quatDelay([0,0,0,1],rs)}resetViewBack(){this.quatDelay([0,1,0,0],rs)}resetViewTop(){this.quatDelay([Math.SQRT1_2,0,0,Math.SQRT1_2],rs)}resetViewBottom(){this.quatDelay([-Math.SQRT1_2,0,0,Math.SQRT1_2],rs)}resetViewLeft(){this.quatDelay([0,-Math.SQRT1_2,0,Math.SQRT1_2],rs)}resetViewRight(){this.quatDelay([0,Math.SQRT1_2,0,Math.SQRT1_2],rs)}toggleViewFront(){Math.abs(this._quatRot[3])>.99?this.resetViewBack():this.resetViewFront()}toggleViewTop(){var e=this._quatRot[0]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewBottom():this.resetViewTop()}toggleViewLeft(){var e=-this._quatRot[1]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewRight():this.resetViewLeft()}computeWorldToScreenMatrix(e){return e=e||a.vt(),a.lK(e,a.lK(e,this._viewport,this._proj),this._view)}unproject(t,r,i){var s=[0,0,0];return a.B8(cs,this.computeWorldToScreenMatrix(cs)),e.Z0(s,e.hZ(s,t,this._height-r,i),cs)}project(t){var r=[0,0,0];return e.Z0(r,t,this.computeWorldToScreenMatrix(cs)),r[1]=this._height-r[1],r}onResize(t,r){this._width=t,this._height=r;var i=this._viewport;a.D_(i),a.hs(i,i,e.hZ(as,.5*t,.5*r,.5)),a.Tl(i,i,e.hZ(as,1,1,1)),this.updateProjection()}snapClosestRotation(){for(var e=this._quatRot,t=1/0,r=0,i=ds.length,s=0;s<i;++s){var a=Me(e,ds[s]);t<(a=1-a*a)||(t=a,r=s)}this.quatDelay(ds[r],rs)}clearTimerN(e){window.clearInterval(this._timers[e]),this._timers[e]=0}delay(e,t,r){var i=r||"default";if(this._timers[i]&&this.clearTimerN(i),0===t)return e(1);if(!(t<0)){var s=0,a=(new Date).getTime();this._timers[i]=window.setInterval(function(){var r=((new Date).getTime()-a)/t;r=function(e){return-((e=Math.min(1,e)-1)*e*e*e-1)}(r),e(r-s,r),s=r,r>=1&&this.clearTimerN(i)}.bind(this),16.6)}}_translateDelta(t,r){var i=this._trans;e.Ln(i,i,t,r),this.setTrans(i),this._main.render()}translateDelay(e,t){var r=this._translateDelta.bind(this,e);this.delay(r,t,"translate")}_rotDelta(e,t){if(this._mode===i.A.CameraMode.ORBIT){var r=this._rotX+e[0]*t,s=this._rotY+e[1]*t;this.setOrbit(r,s)}else be(this._quatRot,fe(ls,e,e[3]*t),this._quatRot);this.updateView(),this._main.render()}rotateDelay(e,t){var r=this._rotDelta.bind(this,e);this.delay(r,t,"rotate")}_quatDelta(e,t){me(ls),function(e,t,r,i){var s,a,n,l,c,h=t[0],u=t[1],d=t[2],_=t[3],p=r[0],g=r[1],m=r[2],f=r[3];(a=h*p+u*g+d*m+_*f)<0&&(a=-a,p=-p,g=-g,m=-m,f=-f),1-a>o.p8?(s=Math.acos(a),n=Math.sin(s),l=Math.sin((1-i)*s)/n,c=Math.sin(i*s)/n):(l=1-i,c=i),e[0]=l*h+c*p,e[1]=l*u+c*g,e[2]=l*d+c*m,e[3]=l*_+c*f}(ls,ls,e,t);var r=this._quatRot;if(be(this._quatRot,this._quatRot,ls),this._mode===i.A.CameraMode.ORBIT){var s=r[0],a=r[1],n=r[2],l=r[3];this._rotY=Math.atan2(2*(l*a+n*s),1-2*(a*a+n*n)),this._rotX=Math.atan2(2*(l*s+a*n),1-2*(n*n+s*s))}this.updateView(),this._main.render()}quatDelay(e,t){var r=[0,0,0,0];!function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3]}(r,this._quatRot),be(r,r,e),ye(r,r);var i=this._quatDelta.bind(this,r);this.delay(i,t,"quat")}_centerDelta(t,r){e.Ln(this._center,this._center,t,r),this.updateView(),this._main.render()}centerDelay(t,r){var i=[0,0,0];e.jb(i,t,this._center);var s=this._centerDelta.bind(this,i);this.delay(s,r,"center")}_offsetDelta(t,r){e.Ln(this._offset,this._offset,t,r),this.updateView(),this._main.render()}offsetDelay(t,r){var i=[0,0,0];e.jb(i,t,this._offset);var s=this._offsetDelta.bind(this,i);this.delay(s,r,"offset")}computeFrustumFit(){var e,t=this._near;if(this._projectionType===i.A.Projection.ORTHOGRAPHIC)return e=Math.min(this._width,this._height)/t*.5,Math.sqrt(1+e*e)/e;var r=this._proj,s=t*(r[8]-1)/r[0],a=t*(1+r[8])/r[0],n=t*(1+r[9])/r[5],o=t*(r[9]-1)/r[5],l=Math.abs(a-s),c=Math.abs(n-o);return e=Math.min(c,l)/t*.5,this._fov/45*Math.sqrt(1+e*e)/e}},ps=class{constructor(e,t){this._main=t,this._gl=e,this._vertexBuffer=new d(e,e.ARRAY_BUFFER,e.STATIC_DRAW),this._texCoordBuffer=new d(e,e.ARRAY_BUFFER,e.STATIC_DRAW),this._fill=!0,this._monoTex=null,this._texture=null,this._texWidth=1,this._texHeight=1,this._type=0,this._blur=0,this.init()}init(){this.getTexCoordBuffer().update(new Float32Array([0,0,1,0,0,1,1,1])),this._monoTex=this.createOnePixelTexture(50,50,50,255),document.getElementById("backgroundopen").addEventListener("change",this.loadBackground.bind(this),!1)}loadBackground(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=this,i=new FileReader;i.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){var e=r._main.getCanvas();r.loadBackgroundTexture(t),r.onResize(e.width,e.height),r._main.render()}},document.getElementById("backgroundopen").value="",i.readAsDataURL(t)}}}getGL(){return this._gl}getBlur(){return this._blur}getVertexBuffer(){return this._vertexBuffer}getTexCoordBuffer(){return this._texCoordBuffer}release(){this.deleteTexture(),this.getVertexBuffer().release(),this.getTexCoordBuffer().release()}getType(){return this._type}setType(e){this._type=e}onResize(e,t){var r=e/t/(this._texWidth/this._texHeight),i=this._fill||0!==this._type?1/r:r,s=i<1?1:1/r,a=i<1?r:1;this.getVertexBuffer().update(new Float32Array([-s,-a,s,-a,-s,a,s,a]))}getTexture(){return this._texture?this._texture:this._monoTex}createOnePixelTexture(e,t,r,i){var s=this._gl,a=s.createTexture();return s.bindTexture(s.TEXTURE_2D,a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([e,t,r,i])),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.bindTexture(s.TEXTURE_2D,null),a}loadBackgroundTexture(e){var t=this._gl;this.deleteTexture(),this._texWidth=e.width,this._texHeight=e.height,this._texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)}deleteTexture(){this._texture&&(this._texWidth=this._texHeight=1,this._gl.deleteTexture(this._texture),this._texture=null)}render(){$[i.A.Shader.BACKGROUND].getOrCreate(this._gl).draw(this)}};var gs=e.vt(),ms=e.vt(),fs=a.vt(),vs=e.vt(),As=e.vt();const Ts=class{constructor(){this._gl=null,this._cameraSpeed=.25,this._pixelRatio=1,this._viewport=document.getElementById("viewport"),this._canvas=document.getElementById("canvas"),this._canvasWidth=0,this._canvasHeight=0,this._canvasOffsetLeft=0,this._canvasOffsetTop=0,this._stateManager=new Ji(this),this._sculptManager=null,this._camera=new _s(this),this._picking=new xi.A(this),this._pickingSym=new xi.A(this,!0),this._meshPreview=null,this._torusLength=.5,this._torusWidth=.1,this._torusRadius=2*Math.PI,this._torusRadial=32,this._torusTubular=128;var e=(0,n.A)();this._showContour=e.outline,this._showGrid=e.grid,this._grid=null,this._background=null,this._meshes=[],this._selectMeshes=[],this._mesh=null,this._rttContour=null,this._rttMerge=null,this._rttOpaque=null,this._rttTransparent=null,this._focusGui=!1,this._gui=new ts(this),this._preventRender=!1,this._drawFullScene=!1,this._autoMatrix=e.scalecenter,this._vertexSRGB=!0,this._autoRotateEnabled=!1,this._autoRotateSpeed=Math.PI/6,this._autoRotateAxis=1,this._autoRotatePivot=0,this._autoRotateLastTime=null}start(){if(this.initWebGL(),this._gl){this._sculptManager=new Vt(this),this._background=new ps(this._gl,this),this._rttContour=new Nr(this._gl,i.A.Shader.CONTOUR,null),this._rttMerge=new Nr(this._gl,i.A.Shader.MERGE,null),this._rttOpaque=new Nr(this._gl,i.A.Shader.FXAA),this._rttTransparent=new Nr(this._gl,null,this._rttOpaque.getDepth(),!0),this._grid=gt.createGrid(this._gl),this.initGrid(),this.loadTextures(),this._gui.initGui(),this.onCanvasResize();var e=(0,n.A)().modelurl;e?this.addModelURL(e):this.addSphere()}}addModelURL(e){var t=this.getFileType(e);if(t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="obj"===t?"text":"arraybuffer",r.onload=function(){200===r.status&&this.loadScene(r.response,t)}.bind(this),r.send(null)}}getBackground(){return this._background}getViewport(){return this._viewport}getCanvas(){return this._canvas}getPixelRatio(){return this._pixelRatio}getCanvasWidth(){return this._canvasWidth}getCanvasHeight(){return this._canvasHeight}getCamera(){return this._camera}getGui(){return this._gui}getMeshes(){return this._meshes}getMesh(){return this._mesh}getSelectedMeshes(){return this._selectMeshes}getPicking(){return this._picking}getPickingSymmetry(){return this._pickingSym}getSculptManager(){return this._sculptManager}getStateManager(){return this._stateManager}setMesh(e){return this.setOrUnsetMesh(e)}setCanvasCursor(e){this._canvas.style.cursor=e}setAutoRotateEnabled(e){this._autoRotateEnabled=e,this._autoRotateLastTime=null,e&&this.render()}setAutoRotateSpeed(e){this._autoRotateSpeed=e}setAutoRotateAxis(e){this._autoRotateAxis=e}setAutoRotatePivot(e){this._autoRotatePivot=e}_updateAutoRotate(){if(this._autoRotateEnabled&&this._mesh){var t=performance.now();if(null!==this._autoRotateLastTime){var r=(t-this._autoRotateLastTime)/1e3;this._autoRotateLastTime=t;var i=this._autoRotateSpeed;if(i){var s=i*r,n=this._mesh,o=n.getMatrix();e.hZ(ms,0,0,0),ms[this._autoRotateAxis]=1,a.D_(fs),0===this._autoRotatePivot?(e.Z0(gs,n.getCenter(),o),a.Tl(fs,fs,gs),a.e$(fs,fs,s,ms),a.Tl(fs,fs,[-gs[0],-gs[1],-gs[2]])):a.e$(fs,fs,s,ms),a.lK(o,fs,o),n.updateYawPitchRollFromMatrix()}}else this._autoRotateLastTime=t}}initGrid(){var e=this._grid;e.normalizeSize();var t=e.getMatrix();a.Tl(t,t,[0,-.45,0]),a.hs(t,t,[2.5,2.5,2.5]),this._grid.setShaderType(i.A.Shader.FLAT),e.setFlatColor([.04,.04,.04])}setOrUnsetMesh(e,t){if(e)if(t){var r=this.getIndexSelectMesh(e);r>=0?this._selectMeshes.length>1&&(this._selectMeshes.splice(r,1),e=this._selectMeshes[0]):this._selectMeshes.push(e)}else this._selectMeshes.length=0,this._selectMeshes.push(e);else this._selectMeshes.length=0;return this._mesh=e,this.getGui().updateMesh(),this.render(),e}selectAllMeshes(){this._meshes.length&&(this._selectMeshes=this._meshes.slice(),this._mesh=this._selectMeshes[0]||null,this.getGui().updateMesh(),this.render())}selectMoreMeshes(){if(this._meshes.length)if(this._mesh){if(this._selectMeshes.length!==this._meshes.length){var e=this.getIndexMesh(this._mesh);e<0&&(e=0);for(var t=1;t<=this._meshes.length;++t){var r=(e+t)%this._meshes.length,i=this._meshes[r];if(this.getIndexSelectMesh(i)<0)return this._selectMeshes.push(i),this._mesh=i,this.getGui().updateMesh(),void this.render()}}}else this.setOrUnsetMesh(this._meshes[0],!1)}selectLessMeshes(){if(this._selectMeshes.length){var e=this.getIndexSelectMesh(this._mesh);e<0&&(e=this._selectMeshes.length-1),this._selectMeshes.splice(e,1),this._selectMeshes.length?this._mesh=this._selectMeshes[0]:this._mesh=null,this.getGui().updateMesh(),this.render()}}renderSelectOverRtt(){this._requestRender()&&(this._drawFullScene=!1)}_requestRender(){return!0!==this._preventRender&&(window.requestAnimationFrame(this.applyRender.bind(this)),this._preventRender=!0,!0)}render(){this._drawFullScene=!0,this._requestRender()}applyRender(){this._preventRender=!1,this._updateAutoRotate(),this.updateMatricesAndSort();var e=this._gl;e&&(this._drawFullScene&&this._drawScene(),e.disable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttMerge.getFramebuffer()),this._rttMerge.render(this),e.bindFramebuffer(e.FRAMEBUFFER,null),this._rttOpaque.render(this),e.enable(e.DEPTH_TEST),this._sculptManager.postRender(),this._autoRotateEnabled&&this._mesh&&this.render())}_drawScene(){var e=this._gl,t=0,r=this._meshes,s=r.length;e.disable(e.DEPTH_TEST);var a=this._selectMeshes.length>0&&this._showContour&&$[i.A.Shader.CONTOUR].color[3]>0;if(a){e.bindFramebuffer(e.FRAMEBUFFER,this._rttContour.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT);for(var n=0,o=this._selectMeshes,l=o.length;n<l;++n)o[n].renderFlatColor(this)}for(e.enable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttOpaque.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this._showGrid&&this._grid.render(this),t=0;t<s&&!r[t].isTransparent();++t)r[t].render(this);var c=t;for(this._meshPreview&&this._meshPreview.render(this),this._background.render(),e.bindFramebuffer(e.FRAMEBUFFER,this._rttTransparent.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.depthFunc(e.LESS),t=0;t<s;++t)r[t].getShowWireframe()&&r[t].renderWireframe(this);for(e.depthFunc(e.LEQUAL),e.depthMask(!1),e.enable(e.CULL_FACE),t=c;t<s;++t)e.cullFace(e.FRONT),r[t].render(this),e.cullFace(e.BACK),r[t].render(this);e.disable(e.CULL_FACE),a&&this._rttContour.render(this),e.depthMask(!0),e.disable(e.BLEND)}updateMatricesAndSort(){var e=this._meshes,t=this._camera;e.length>0&&t.optimizeNearFar(this.computeBoundingBoxScene());for(var r=0,i=e.length;r<i;++r)e[r].updateMatrices(t);e.sort(ke.sortFunction),this._meshPreview&&this._meshPreview.updateMatrices(t),this._grid&&this._grid.updateMatrices(t)}initWebGL(){var e={antialias:!1,stencil:!0},t=document.getElementById("canvas"),r=this._gl=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);r?(Lr.initWebGLExtensions(r),Lr.getWebGLExtension("OES_element_index_uint")||(Pe.ONLY_DRAW_ARRAYS=!0),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.disable(r.CULL_FACE),r.frontFace(r.CCW),r.cullFace(r.BACK),r.disable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.disable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.depthMask(!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):window.alert("Could not initialise WebGL. No WebGL, no SculptGL. Sorry.")}loadTextures(){for(var e=this,t=this._gl,r=$[i.A.Shader.MATCAP],s=function(i,s){var a=new Image;a.src=i,a.onload=function(){r.createTexture(t,a,s),e.render()}},a=0,n=r.matcaps,o=n.length;a<o;++a)s(n[a].path,a);this.initAlphaTextures()}initAlphaTextures(){for(var e=xi.A.INIT_ALPHAS_PATHS,t=xi.A.INIT_ALPHAS_NAMES,r=0,i=e.length;r<i;++r){var a=new Image;a.src=s.A.getResourcePath("alpha/"+e[r]),a.onload=this.onLoadAlphaImage.bind(this,a,t[r])}}onCanvasResize(){var e=this._viewport,t=e.clientWidth*this._pixelRatio,r=e.clientHeight*this._pixelRatio;this._canvasOffsetLeft=e.offsetLeft,this._canvasOffsetTop=e.offsetTop,this._canvasWidth=t,this._canvasHeight=r,this._canvas.width=t,this._canvas.height=r,this._gl.viewport(0,0,t,r),this._camera.onResize(t,r),this._background.onResize(t,r),this._rttContour.onResize(t,r),this._rttMerge.onResize(t,r),this._rttOpaque.onResize(t,r),this._rttTransparent.onResize(t,r),this.render()}computeRadiusFromBoundingBox(e){var t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return.5*Math.sqrt(t*t+r*r+i*i)}computeBoundingBoxMeshes(e){for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],r=0,i=e.length;r<i;++r)if(e[r].isVisible()){var s=e[r].computeWorldBound();s[0]<t[0]&&(t[0]=s[0]),s[1]<t[1]&&(t[1]=s[1]),s[2]<t[2]&&(t[2]=s[2]),s[3]>t[3]&&(t[3]=s[3]),s[4]>t[4]&&(t[4]=s[4]),s[5]>t[5]&&(t[5]=s[5])}return t}computeBoundingBoxScene(){var e=this._meshes.slice();return e.push(this._grid),this._sculptManager.addSculptToScene(e),this.computeBoundingBoxMeshes(e)}normalizeAndCenterMeshes(t){var r=this.computeBoundingBoxMeshes(t),i=s.A.SCALE/e.xg([r[0],r[1],r[2]],[r[3],r[4],r[5]]),n=a.vt();a.hs(n,n,[i,i,i]),a.Tl(n,n,[.5*-(r[0]+r[3]),.5*-(r[1]+r[4]),.5*-(r[2]+r[5])]);for(var o=0,l=t.length;o<l;++o){var c=t[o].getMatrix();a.lK(c,n,c)}}addSphere(){var e=new Hr(gt.createCube(this._gl));return e.normalizeSize(),this.subdivideClamp(e),this.addNewMesh(e)}addCube(){var e=new Hr(gt.createCube(this._gl));return e.normalizeSize(),a.hs(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e,!0),this.addNewMesh(e)}addPlane(){var e=new Hr(gt.createPlane(this._gl));return e.normalizeSize(),this.subdivideClamp(e,!0),this.addNewMesh(e)}addCylinder(){var e=new Hr(gt.createCylinder(this._gl));return e.normalizeSize(),a.hs(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e),this.addNewMesh(e)}addTorus(e){var t=new Hr(gt.createTorus(this._gl,this._torusLength,this._torusWidth,this._torusRadius,this._torusRadial,this._torusTubular));if(e){t.setShowWireframe(!0);var r=.3*s.A.SCALE;return a.hs(t.getMatrix(),t.getMatrix(),[r,r,r]),void(this._meshPreview=t)}t.normalizeSize(),this.subdivideClamp(t),this.addNewMesh(t)}subdivideClamp(e,t){for(Gt.LINEAR=!!t;e.getNbFaces()<5e4;)e.addLevel();e._meshes.splice(0,Math.min(e._meshes.length-4,4)),e._sel=e._meshes.length-1,Gt.LINEAR=!1}addNewMesh(e){return this._meshes.push(e),this._stateManager.pushStateAdd(e),this.setMesh(e),e}addNewMeshBatch(e){return this._meshes.push(e),e}loadScene(e,t){var r;"obj"===t?r=or.importOBJ(e,this._gl):"sgl"===t?r=or.importSGL(e,this._gl,this):"stl"===t?r=or.importSTL(e,this._gl):"ply"===t&&(r=or.importPLY(e,this._gl));var i=r.length;if(0!==i){for(var a=this._meshes,n=0;n<i;++n){var o=r[n]=new Hr(r[n]);!this._vertexSRGB&&o.getColors()&&s.A.convertArrayVec3toSRGB(o.getColors()),o.init(),o.initRender(),a.push(o)}return this._autoMatrix&&this.normalizeAndCenterMeshes(r),this._stateManager.pushStateAdd(r),this.setMesh(a[a.length-1]),this.resetCameraMeshes(r),r}}clearScene(){this.getStateManager().reset(),this.getMeshes().length=0,this.getCamera().resetView(),this.setMesh(null),this._action=i.A.Action.NOTHING}deleteCurrentSelection(){this._mesh&&(this.removeMeshes(this._selectMeshes),this._stateManager.pushStateRemove(this._selectMeshes.slice()),this._selectMeshes.length=0,this.setMesh(null))}removeMeshes(e){for(var t=this._meshes,r=0;r<e.length;++r)t.splice(this.getIndexMesh(e[r]),1)}getIndexMesh(e,t){for(var r=t?this._selectMeshes:this._meshes,i=e.getID(),s=0,a=r.length;s<a;++s){var n=r[s];if(n===e||n.getID()===i)return s}return-1}getIndexSelectMesh(e){return this.getIndexMesh(e,!0)}replaceMesh(e,t){var r=this.getIndexMesh(e);r>=0&&(this._meshes[r]=t),this._mesh===e&&this.setMesh(t)}duplicateSelection(){for(var e=this._selectMeshes.slice(),t=null,r=0;r<e.length;++r){t=e[r];var i=this._createMeshCopy(t);this.addNewMesh(i)}this.setMesh(t)}duplicateSelectionLinear(e,t,r){t=this._getFiniteNumber(t),r=this._getAxisIndex(r);var i=this._getAxisVector(r);this._duplicateSelectionPattern(e,this._buildLinearPattern(i,t))}duplicateSelectionPolar(e,t,r,i){t=this._getFiniteNumber(t),r=this._getFiniteNumber(r),i=this._getAxisIndex(i);var s=this._getAxisVector(i),a=this._getPolarOffset(r,i);this._duplicateSelectionPattern(e,this._buildPolarPattern(s,a,t))}_applyMeshTransform(e,t){a.lK(e.getMatrix(),t,e.getMatrix()),a.lK(e.getEditMatrix(),t,e.getEditMatrix())}_createTranslationMatrix(e){var t=a.vt();return a.Tl(t,t,e),t}_createMeshCopy(e){var t=new Le(e.getGL()),r=e.getMeshData(),i=t.getMeshData();return r._verticesXYZ&&(i._verticesXYZ=r._verticesXYZ.slice()),r._normalsXYZ&&(i._normalsXYZ=r._normalsXYZ.slice()),r._colorsRGB&&(i._colorsRGB=r._colorsRGB.slice()),r._materialsPBR&&(i._materialsPBR=r._materialsPBR.slice()),r._facesABCD&&(i._facesABCD=r._facesABCD.slice()),i._nbVertices=r._nbVertices,i._nbFaces=r._nbFaces,r._texCoordsST&&(i._texCoordsST=r._texCoordsST.slice()),r._UVfacesABCD&&(i._UVfacesABCD=r._UVfacesABCD.slice()),r._duplicateStartCount&&(i._duplicateStartCount=r._duplicateStartCount.slice()),i._nbTexCoords=r._nbTexCoords,r._vertRingFace&&(i._vertRingFace=r._vertRingFace.slice()),r._vrvStartCount&&(i._vrvStartCount=r._vrvStartCount.slice()),r._vrfStartCount&&(i._vrfStartCount=r._vrfStartCount.slice()),r._vertRingVert&&(i._vertRingVert=r._vertRingVert.slice()),r._vertOnEdge&&(i._vertOnEdge=r._vertOnEdge.slice()),r._edges&&(i._edges=r._edges.slice()),r._faceEdges&&(i._faceEdges=r._faceEdges.slice()),r._facesToTriangles&&(i._facesToTriangles=r._facesToTriangles.slice()),r._trianglesABC&&(i._trianglesABC=r._trianglesABC.slice()),r._UVtrianglesABC&&(i._UVtrianglesABC=r._UVtrianglesABC.slice()),r._faceNormalsXYZ&&(i._faceNormalsXYZ=r._faceNormalsXYZ.slice()),r._faceCentersXYZ&&(i._faceCentersXYZ=r._faceCentersXYZ.slice()),r._faceBoxes&&(i._faceBoxes=r._faceBoxes.slice()),r._DAverticesXYZ&&(i._DAverticesXYZ=r._DAverticesXYZ.slice()),r._DAnormalsXYZ&&(i._DAnormalsXYZ=r._DAnormalsXYZ.slice()),r._DAcolorsRGB&&(i._DAcolorsRGB=r._DAcolorsRGB.slice()),r._DAmaterialsPBR&&(i._DAmaterialsPBR=r._DAmaterialsPBR.slice()),r._DAtexCoordsST&&(i._DAtexCoordsST=r._DAtexCoordsST.slice()),i._vertTagFlags=new Int32Array(i._nbVertices),i._vertSculptFlags=new Int32Array(i._nbVertices),i._vertStateFlags=new Int32Array(i._nbVertices),i._vertProxy=new Float32Array(3*i._nbVertices),i._facesTagFlags=new Int32Array(i._nbFaces),i._facePosInLeaf=new Uint32Array(i._nbFaces),i._faceLeaf=new Array(i._nbFaces),t.updateCenter(),t.computeOctree(),t.copyTransformData(e),t.copyRenderConfig(e),t.initRender(),t.getRenderData()&&(t.updateGeometryBuffers(),t.updateDuplicateColorsAndMaterials()),t}_duplicateSelectionPattern(e,t){if(this._selectMeshes.length){var r=this._selectMeshes.slice();if(!((e=this._getPatternCount(e,r))<=0)){var i=[];try{for(var s=new Array(r.length),a=0;a<r.length;++a)s[a]=t(r[a]);for(var n=1;n<=e;++n)for(var o=0;o<r.length;++o){var l=r[o],c=this._createMeshCopy(l);this._applyMeshTransform(c,s[o]()),i.push(c)}}catch(e){return console.error("Pattern duplication failed:",e),void window.alert("Failed to create pattern copies. Try reducing the number of copies or selected meshes.")}this._addMeshes(i,r[r.length-1]),i.length>0&&console.info("Successfully created",i.length,"pattern copies")}}}_buildLinearPattern(t,r){var i=e.hs(As,t,r),s=this._createTranslationMatrix(i);return function(){var e=a.vt();return function(){return a.lK(e,s,e),a.o8(e)}}.bind(this)}_buildPolarPattern(t,r,i){return function(s){e.Z0(vs,s.getCenter(),s.getMatrix());var n=i*Math.PI/180,o=this._createPolarMatrix(vs,t,r,n),l=a.vt();return function(){return a.lK(l,o,l),a.o8(l)}}.bind(this)}_addMeshes(e,t){e.length&&(Array.prototype.push.apply(this._meshes,e),this._stateManager.pushStateAdd(e),void 0!==t?this.setMesh(t):this.setMesh(e[e.length-1]))}_createPolarMatrix(e,t,r,i){var s=a.vt();return(r[0]||r[1]||r[2])&&a.Tl(s,s,r),a.Tl(s,s,e),a.e$(s,s,i,t),a.Tl(s,s,[-e[0],-e[1],-e[2]]),s}_getAxisVector(e){return 0===e?[1,0,0]:1===e?[0,1,0]:[0,0,1]}_getAxisIndex(e){var t=Math.round(Number(e));return 0!==t&&1!==t&&2!==t?2:t}_getPatternCount(e,t){var r=Math.floor(Number(e));if(!Number.isFinite(r)||r<=0)return 0;var i=t.length;if(!i)return 0;for(var s=0;s<i;++s)if(!t[s]||"function"!=typeof t[s].getNbTriangles)return console.error("Invalid mesh detected at index",s),window.alert("One or more selected meshes are invalid. Please reselect and try again."),0;var a=Math.floor(20/i);if(a<1)return 0;for(var n=0,o=0;o<i;++o)try{var l=t[o].getNbTriangles();if(!Number.isFinite(l)||l<0)return console.error("Invalid triangle count for mesh",o,":",l),window.alert("Unable to calculate mesh complexity. Please try with different meshes."),0;n+=l}catch(e){return console.error("Error getting triangle count for mesh",o,":",e),window.alert("Error analyzing mesh geometry. Please try with different meshes."),0}if(0===n)return window.alert("Selected meshes have no triangles. Cannot duplicate empty meshes."),0;var c=Math.floor(1e6/n);if(c<1)return window.alert("Selected meshes are too dense to duplicate safely. Try decimating or reducing the selection."),0;var h=Math.min(r,a,c);return r>h&&(console.warn("Pattern duplication reduced from",r,"to",h,"to avoid excessive geometry."),console.info("Mesh count:",i,"Total triangles:",n,"Max copies allowed:",h)),h}_getFiniteNumber(e){var t=Number(e);return Number.isFinite(t)?t:0}_getPolarOffset(e,t){return e?0===t?[0,e,0]:[e,0,0]:[0,0,0]}onLoadAlphaImage(e,t,r){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var s=i.getContext("2d");s.drawImage(e,0,0);for(var a=s.getImageData(0,0,e.width,e.height).data,n=a.subarray(0,a.length/4),o=0,l=0,c=n.length;o<c;++o,l+=4)n[o]=Math.round((a[l]+a[l+1]+a[l+2])/3);var h={};h[t=ts.addAlpha(n,e.width,e.height,t)._name]=t,this.getGui().addAlphaOptions(h),r&&r._ctrlAlpha&&r._ctrlAlpha.setValue(t)}},bs=class extends Ts{constructor(){super(),this._mouseX=0,this._mouseY=0,this._lastMouseX=0,this._lastMouseY=0,this._lastScale=0,this._action=i.A.Action.NOTHING,this._lastNbPointers=0,this._isWheelingIn=!1,this._maskX=0,this._maskY=0,this._hammer=new t.Manager(this._canvas),this._eventProxy={},this.initHammer(),this.addEvents()}addEvents(){var e=this._canvas,t=this.onMouseWheel.bind(this),r=this.onPointer.bind(this);e.addEventListener("pointerdown",r,!1),e.addEventListener("pointermove",r,!1),e.addEventListener("mousedown",this.onMouseDown.bind(this),!1),e.addEventListener("mouseup",this.onMouseUp.bind(this),!1),e.addEventListener("mouseout",this.onMouseOut.bind(this),!1),e.addEventListener("mouseover",this.onMouseOver.bind(this),!1),e.addEventListener("mousemove",s.A.throttle(this.onMouseMove.bind(this),16.66),!1),e.addEventListener("mousewheel",t,!1),e.addEventListener("DOMMouseScroll",t,!1),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1);var i=this.loadFiles.bind(this),a=this.stopAndPrevent.bind(this);e.addEventListener("webglcontextlost",this.onContextLost.bind(this),!1),e.addEventListener("webglcontextrestored",this.onContextRestored.bind(this),!1),window.addEventListener("dragenter",a,!1),window.addEventListener("dragover",a,!1),window.addEventListener("drop",i,!1),document.getElementById("fileopen").addEventListener("change",i,!1)}onPointer(e){r.A.pressure=e.pressure}initHammer(){this._hammer.options.enable=!0,this._initHammerRecognizers(),this._initHammerEvents()}_initHammerRecognizers(){var e=this._hammer;e.add(new t.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new t.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new t.Pan({event:"pan",pointers:0,threshold:0})),e.add(new t.Pinch({event:"pinch",pointers:2,threshold:.1})),e.get("pinch").recognizeWith(e.get("pan"))}_initHammerEvents(){var e=this._hammer;e.on("panstart",this.onPanStart.bind(this)),e.on("panmove",this.onPanMove.bind(this)),e.on("panend pancancel",this.onPanEnd.bind(this)),e.on("doubletap",this.onDoubleTap.bind(this)),e.on("doubletap2fingers",this.onDoubleTap2Fingers.bind(this)),e.on("pinchstart",this.onPinchStart.bind(this)),e.on("pinchin pinchout",this.onPinchInOut.bind(this))}stopAndPrevent(e){e.stopPropagation(),e.preventDefault()}onContextLost(){window.alert("Oops... WebGL context lost.")}onContextRestored(){window.alert("Wow... Context is restored.")}onKeyDown(e){this._gui.callFunc("onKeyDown",e)}onKeyUp(e){this._gui.callFunc("onKeyUp",e)}onPanStart(e){if("mouse"!==e.pointerType){this._focusGui=!1;var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y,this.onPanUpdateNbPointers(Math.min(3,e.pointers.length))}}onPanMove(e){if("mouse"!==e.pointerType){var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y;var r=Math.min(3,e.pointers.length);r!==this._lastNbPointers&&(this.onDeviceUp(),this.onPanUpdateNbPointers(r)),this.onDeviceMove(t),this._isIOS()&&(window.clearTimeout(this._timerResetPointer),this._timerResetPointer=window.setTimeout(function(){this._lastNbPointers=0}.bind(this),60))}}_isIOS(){return void 0!==this._isIOS||(this._isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)),this._isIOS}onPanUpdateNbPointers(e){var t=this._eventProxy;t.which=1===e&&this._lastNbPointers>=1?3:e,this._lastNbPointers=e,this.onDeviceDown(t)}onPanEnd(e){"mouse"!==e.pointerType&&(this.onDeviceUp(),window.setTimeout(function(){e.pointers.length||(this._lastNbPointers=0)}.bind(this),60))}onDoubleTap(t){if(!this._focusGui){var r=this._eventProxy;r.pageX=t.center.x,r.pageY=t.center.y,this.setMousePosition(r);var i=this._picking,s=i.intersectionMouseMeshes(),a=this._camera,n=[0,0,0];if(!s)return this.resetCameraMeshes();e.Z0(n,i.getIntersectionPoint(),i.getMesh().getMatrix());var o=a._trans[2];a.isOrthographic()||(o=Math.min(o,e.xg(n,a.computePosition()))),a.setAndFocusOnPivot(n,o),this.render()}}onDoubleTap2Fingers(){this._focusGui||this.resetCameraMeshes()}onPinchStart(e){this._focusGui=!1,this._lastScale=e.scale}onPinchInOut(e){var t=25*(e.scale-this._lastScale);this._lastScale=e.scale,this.onDeviceWheel(t)}resetCameraMeshes(t){if(t||(t=this._meshes),t.length>0){var r=[0,0,0],i=this.computeBoundingBoxMeshes(t),s=.8*this.computeRadiusFromBoundingBox(i);s*=this._camera.computeFrustumFit(),e.hZ(r,.5*(i[0]+i[3]),.5*(i[1]+i[4]),.5*(i[2]+i[5])),this._camera.setAndFocusOnPivot(r,s)}else this._camera.resetView();this.render()}getFileType(e){var t=e.toLowerCase();return t.endsWith(".obj")?"obj":t.endsWith(".sgl")?"sgl":t.endsWith(".stl")?"stl":t.endsWith(".ply")?"ply":void 0}loadFiles(e){e.stopPropagation(),e.preventDefault();for(var t=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0,i=t.length;r<i;++r){var s=t[r],a=this.getFileType(s.name);this.readFile(s,a)}}readFile(e,t){var r=t||this.getFileType(e.name);if(r){var i=new FileReader,s=this;i.onload=function(e){s.loadScene(e.target.result,r),document.getElementById("fileopen").value=""},"obj"===r?i.readAsText(e):i.readAsArrayBuffer(e)}}onMouseDown(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseDown",e),this.onDeviceDown(e)}onMouseMove(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseMove",e),this.onDeviceMove(e)}onMouseOver(e){this._focusGui=!1,this._gui.callFunc("onMouseOver",e)}onMouseOut(e){this._focusGui=!0,this._gui.callFunc("onMouseOut",e),this.onMouseUp(e)}onMouseUp(e){e.preventDefault(),this._gui.callFunc("onMouseUp",e),this.onDeviceUp()}onMouseWheel(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseWheel",e);var t=void 0===e.wheelDelta?-e.detail:e.wheelDelta;this.onDeviceWheel(t>0?1:-1)}onDeviceUp(){this.setCanvasCursor("default"),Hr.RENDER_HINT=Hr.NONE,this._sculptManager.end(),this._action===i.A.Action.MASK_EDIT&&this._mesh&&(this._lastMouseX===this._maskX&&this._lastMouseY===this._maskY?this.getSculptManager().getTool(i.A.Tools.MASKING).invert():this.getSculptManager().getTool(i.A.Tools.MASKING).clear()),this._action=i.A.Action.NOTHING,this.render(),this._stateManager.cleanNoop()}onDeviceWheel(e){e>0&&!this._isWheelingIn&&(this._isWheelingIn=!0,this._camera.start(this._mouseX,this._mouseY)),this._camera.zoom(.02*e),Hr.RENDER_HINT=Hr.CAMERA,this.render(),this._timerEndWheel&&window.clearTimeout(this._timerEndWheel),this._timerEndWheel=window.setTimeout(this._endWheel.bind(this),300)}_endWheel(){Hr.RENDER_HINT=Hr.NONE,this._isWheelingIn=!1,this.render()}setMousePosition(e){this._mouseX=this._pixelRatio*(e.pageX-this._canvasOffsetLeft),this._mouseY=this._pixelRatio*(e.pageY-this._canvasOffsetTop)}onDeviceDown(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,r=this._mouseY,s=e.which,a=!1;1===s&&(a=this._sculptManager.start(e.shiftKey)),1===s&&a&&this.setCanvasCursor("none"),3===s&&e.ctrlKey?this._action=i.A.Action.CAMERA_ZOOM:2===s?this._action=i.A.Action.CAMERA_PAN:!a&&e.ctrlKey?(this._maskX=t,this._maskY=r,this._action=i.A.Action.MASK_EDIT):a&&3!==s||!e.altKey?this._action=3===s||1===s&&!a?i.A.Action.CAMERA_ROTATE:i.A.Action.SCULPT_EDIT:this._action=i.A.Action.CAMERA_PAN_ZOOM_ALT,this._action!==i.A.Action.CAMERA_ROTATE&&this._action!==i.A.Action.CAMERA_ZOOM||this._camera.start(t,r),this._lastMouseX=t,this._lastMouseY=r}}getSpeedFactor(){return this._cameraSpeed/(this._canvasHeight*this.getPixelRatio())}onDeviceMove(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,r=this._mouseY,s=this._action,a=this.getSpeedFactor();s===i.A.Action.CAMERA_ZOOM||s===i.A.Action.CAMERA_PAN_ZOOM_ALT&&!e.altKey?(Hr.RENDER_HINT=Hr.CAMERA,this._camera.zoom((t-this._lastMouseX+r-this._lastMouseY)*a),this.render()):s===i.A.Action.CAMERA_PAN_ZOOM_ALT||s===i.A.Action.CAMERA_PAN?(Hr.RENDER_HINT=Hr.CAMERA,this._camera.translate((t-this._lastMouseX)*a,(r-this._lastMouseY)*a),this.render()):s===i.A.Action.CAMERA_ROTATE?(Hr.RENDER_HINT=Hr.CAMERA,e.shiftKey||this._camera.rotate(t,r),this.render()):(Hr.RENDER_HINT=Hr.PICKING,this._sculptManager.preUpdate(),s===i.A.Action.SCULPT_EDIT&&(Hr.RENDER_HINT=Hr.SCULPT,this._sculptManager.update(this),this.getMesh().isDynamic&&this._gui.updateMeshInfo())),this._lastMouseX=t,this._lastMouseY=r,this.renderSelectOverRtt()}}};window.SculptGL=bs;const Ms=bs})(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__})());